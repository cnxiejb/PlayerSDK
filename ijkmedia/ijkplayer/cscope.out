cscope 15 $HOME/Documents/cscope/ijkplayer -q 0000002833 0000433692
	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/ffmpeg_api_jni.c

24 
	~"ffm³g_­i_jni.h
"

26 
	~<as£¹.h
>

27 
	~<¡ršg.h
>

28 
	~<jni.h
>

29 
	~"../ff_ffšc.h
"

30 
	~"ijksdl/ijksdl_log.h
"

31 
	~"ijksdl/ªdroid/ijksdl_ªdroid_jni.h
"

33 
	#JNI_CLASS_FFMPEG_API
 "tv/dªmaku/ijk/medŸ/¶ay”/ffm³g/FFm³gApi"

	)

35 
	sffm³g_­i_f›lds_t
 {

36 
jşass
 
	mşazz
;

37 } 
	tffm³g_­i_f›lds_t
;

38 
ffm³g_­i_f›lds_t
 
	gg_şazz
;

40 
j¡ršg


41 
	$FFm³gApi_av_ba£64_’code
(
JNIEnv
 *
’v
, 
jşass
 
şazz
, 
jby‹A¼ay
 
š
)

43 
j¡ršg
 
»t_¡ršg
 = 
NULL
;

44 * 
out_bufãr
 = 0;

45 
out_size
 = 0;

46 
jby‹
* 
š_bufãr
 = 0;

47 
jsize
 
š_size
 = (*
’v
)->
	`G‘A¼ayL’gth
Ónv, 
š
);

48 ià(
š_size
 <= 0)

49 
ç
;

51 
š_bufãr
 = (*
’v
)->
	`G‘By‹A¼ayEËm’ts
Ónv, 
š
, 
NULL
);

52 ià(!
š_bufãr
)

53 
ç
;

55 
out_size
 = 
	`AV_BASE64_SIZE
(
š_size
);

56 
out_bufãr
 = 
	`m®loc
(
out_size
 + 1);

57 ià(!
out_bufãr
)

58 
ç
;

59 
out_bufãr
[
out_size
] = 0;

61 ià(!
	`av_ba£64_’code
(
out_bufãr
, 
out_size
, (cÚ¡ 
ušt8_t
 *)
š_bufãr
, 
š_size
))

62 
ç
;

64 
»t_¡ršg
 = (*
’v
)->
	`NewSŒšgUTF
Ónv, 
out_bufãr
);

65 
ç
:

66 ià(
š_bufãr
) {

67 (*
’v
)->
	`R–—£By‹A¼ayEËm’ts
Ónv, 
š
, 
š_bufãr
, 
JNI_ABORT
);

68 
š_bufãr
 = 
NULL
;

70 ià(
out_bufãr
) {

71 
	`ä“
(
out_bufãr
);

72 
out_bufãr
 = 
NULL
;

74  
»t_¡ršg
;

75 
	}
}

77 
JNIN©iveM‘hod
 
	gg_m‘hods
[] = {

78 {"av_ba£64_’code", "([B)Ljava/Ïng/SŒšg;", (*è
FFm³gApi_av_ba£64_’code
},

81 
	$FFm³gApi_glob®_š™
(
JNIEnv
 *
’v
)

83 
»t
 = 0;

85 
	`IJK_FIND_JAVA_CLASS
(
’v
, 
g_şazz
.
şazz
, 
JNI_CLASS_FFMPEG_API
);

86 (*
’v
)->
	`Regi¡”N©ives
Ónv, 
g_şazz
.
şazz
, 
g_m‘hods
, 
	`NELEM
(g_methods));

88  
»t
;

89 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/ffmpeg_api_jni.h

24 #iâdeà
IJKPLAYER_ANDROID__FFMPEG_API_JNI_H


26 
	~<jni.h
>

28 
FFm³gApi_glob®_š™
(
JNIEnv
 *
’v
);

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/ijkplayer_android.c

24 
	~"ijk¶ay”_ªdroid.h
"

26 
	~<as£¹.h
>

27 
	~"ijksdl/ªdroid/ijksdl_ªdroid.h
"

28 
	~"../ff_fã¼Ü.h
"

29 
	~"../ff_fåÏy.h
"

30 
	~"../ijk¶ay”_š‹º®.h
"

31 
	~"../p–še/få–še_fåÏy.h
"

32 
	~"p–še/få–še_ªdroid.h
"

34 
IjkMedŸPÏy”
 *
ijkmp_ªdroid_ü—‹
((*
msg_loİ
)(*))

36 
IjkMedŸPÏy”
 *
mp
 = 
	`ijkmp_ü—‹
(
msg_loİ
);

37 ià(!
mp
)

38 
ç
;

40 
mp
->
fåÏy”
->
vout
 = 
	`SDL_VoutAndroid_C»©eFÜAndroidSurçû
();

41 ià(!
mp
->
fåÏy”
->
vout
)

42 
ç
;

44 
mp
->
fåÏy”
->
p–še
 = 
	`få–še_ü—‹_äom_ªdroid
(mp->ffplayer);

45 ià(!
mp
->
fåÏy”
->
p–še
)

46 
ç
;

48 
	`få–še_£t_vout
(
mp
->
fåÏy”
->
p–še
, mp->fåÏy”->
vout
);

50  
mp
;

52 
ç
:

53 
	`ijkmp_dec_»f_p
(&
mp
);

54  
NULL
;

55 
	}
}

57 
	$ijkmp_ªdroid_£t_surçû_l
(
JNIEnv
 *
’v
, 
IjkMedŸPÏy”
 *
mp
, 
jobjeù
 
ªdroid_surçû
)

59 ià(!
mp
 || !mp->
fåÏy”
 || !mp->fåÏy”->
vout
)

62 
	`SDL_VoutAndroid_S‘AndroidSurçû
(
’v
, 
mp
->
fåÏy”
->
vout
, 
ªdroid_surçû
);

63 
	`få–še_£t_surçû
(
’v
, 
mp
->
fåÏy”
->
p–še
, 
ªdroid_surçû
);

64 
	}
}

66 
	$ijkmp_ªdroid_£t_surçû
(
JNIEnv
 *
’v
, 
IjkMedŸPÏy”
 *
mp
, 
jobjeù
 
ªdroid_surçû
)

68 ià(!
mp
)

71 
	`MPTRACE
("ijkmp_£t_ªdroid_surçû(surçû=%p)", (*)
ªdroid_surçû
);

72 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

73 
	`ijkmp_ªdroid_£t_surçû_l
(
’v
, 
mp
, 
ªdroid_surçû
);

74 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

75 
	`MPTRACE
("ijkmp_£t_ªdroid_surçû(surçû=%p)=void", (*)
ªdroid_surçû
);

76 
	}
}

78 
	$ijkmp_ªdroid_£t_vŞume
(
JNIEnv
 *
’v
, 
IjkMedŸPÏy”
 *
mp
, 
Ëá
, 
right
)

80 ià(!
mp
)

83 
	`MPTRACE
("ijkmp_ªdroid_£t_vŞume(%f, %f)", 
Ëá
, 
right
);

84 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

86 ià(
mp
 && mp->
fåÏy”
 && mp->fåÏy”->
p–še
) {

87 
	`få–še_£t_vŞume
(
mp
->
fåÏy”
->
p–še
, 
Ëá
, 
right
);

90 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

91 
	`MPTRACE
("ijkmp_ªdroid_£t_vŞume(%f, %f)=void", 
Ëá
, 
right
);

92 
	}
}

94 
	$ijkmp_ªdroid_g‘_audio_£ssiÚ_id
(
JNIEnv
 *
’v
, 
IjkMedŸPÏy”
 *
mp
)

96 
audio_£ssiÚ_id
 = 0;

97 ià(!
mp
)

98  
audio_£ssiÚ_id
;

100 
	`MPTRACE
("%s()", 
__func__
);

101 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

103 ià(
mp
 && mp->
fåÏy”
 && mp->fåÏy”->
aout
) {

104 
audio_£ssiÚ_id
 = 
	`SDL_AoutG‘AudioSessiÚId
(
mp
->
fåÏy”
->
aout
);

107 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

108 
	`MPTRACE
("%s()=%d", 
__func__
, 
audio_£ssiÚ_id
);

110  
audio_£ssiÚ_id
;

111 
	}
}

113 
ijkmp_ªdroid_£t_medŸcodec_£Ëù_ÿÎback
(
IjkMedŸPÏy”
 *
mp
, 
	$boŞ
 (*
ÿÎback
)(*
İaque
, 
ijkmp_medŸcodecšfo_cÚ‹xt
 *
mcc
), *opaque)

115 ià(!
mp
)

118 
	`MPTRACE
("ijkmp_android_set_mediacodec_select_callback()");

119 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

121 ià(
mp
 && mp->
fåÏy”
 && mp->fåÏy”->
p–še
) {

122 
	`få–še_£t_medŸcodec_£Ëù_ÿÎback
(
mp
->
fåÏy”
->
p–še
, 
ÿÎback
, 
İaque
);

125 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

126 
	`MPTRACE
("ijkmp_android_set_mediacodec_select_callback()=void");

127 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/ijkplayer_android.h

24 #iâdeà
IJKPLAYER_ANDROID__IJKPLAYER_ANDROID_H


25 
	#IJKPLAYER_ANDROID__IJKPLAYER_ANDROID_H


	)

27 
	~<jni.h
>

28 
	~"ijk¶ay”_ªdroid_def.h
"

29 
	~"../ijk¶ay”.h
"

31 
	sijkmp_ªdroid_medŸ_fÜm©_cÚ‹xt
 {

32 cÚ¡ *
	mmime_ty³
;

33 
	m´ofe
;

34 
	mËv–
;

35 } 
	tijkmp_ªdroid_medŸ_fÜm©_cÚ‹xt
;

38 
IjkMedŸPÏy”
 *
ijkmp_ªdroid_ü—‹
((*
msg_loİ
)(*));

40 
	`ijkmp_ªdroid_£t_surçû
(
JNIEnv
 *
’v
, 
IjkMedŸPÏy”
 *
mp
, 
jobjeù
 
ªdroid_surçû
);

41 
	`ijkmp_ªdroid_£t_vŞume
(
JNIEnv
 *
’v
, 
IjkMedŸPÏy”
 *
mp
, 
Ëá
, 
right
);

42 
	`ijkmp_ªdroid_g‘_audio_£ssiÚ_id
(
JNIEnv
 *
’v
, 
IjkMedŸPÏy”
 *
mp
);

43 
	`ijkmp_ªdroid_£t_medŸcodec_£Ëù_ÿÎback
(
IjkMedŸPÏy”
 *
mp
, 
	$boŞ
 (*
ÿÎback
)(*
İaque
, 
ijkmp_medŸcodecšfo_cÚ‹xt
 *
mcc
), *opaque);

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/ijkplayer_android_def.h

24 #iâdeà
IJKPLAYER_ANDROID__IJKPLAYER_ANDROID_DEF_H


25 
	#IJKPLAYER_ANDROID__IJKPLAYER_ANDROID_DEF_H


	)

32 
	emedŸ_ev’t_ty³
 {

33 
	mMEDIA_NOP
 = 0,

34 
	mMEDIA_PREPARED
 = 1,

35 
	mMEDIA_PLAYBACK_COMPLETE
 = 2,

36 
	mMEDIA_BUFFERING_UPDATE
 = 3,

37 
	mMEDIA_SEEK_COMPLETE
 = 4,

38 
	mMEDIA_SET_VIDEO_SIZE
 = 5,

39 
	mMEDIA_TIMED_TEXT
 = 99,

40 
	mMEDIA_ERROR
 = 100,

41 
	mMEDIA_INFO
 = 200,

44 
	mMEDIA_SET_VIDEO_SAR
 = 10001,

66 
	emedŸ_”rÜ_ty³
 {

68 
	mMEDIA_ERROR_UNKNOWN
 = 1,

70 
	mMEDIA_ERROR_SERVER_DIED
 = 100,

72 
	mMEDIA_ERROR_NOT_VALID_FOR_PROGRESSIVE_PLAYBACK
 = 200,

76 
	mMEDIA_ERROR_IO
 = -1004,

77 
	mMEDIA_ERROR_MALFORMED
 = -1007,

78 
	mMEDIA_ERROR_UNSUPPORTED
 = -1010,

79 
	mMEDIA_ERROR_TIMED_OUT
 = -110,

81 
	mMEDIA_ERROR_IJK_PLAYER
 = -10000,

100 
	emedŸ_šfo_ty³
 {

102 
	mMEDIA_INFO_UNKNOWN
 = 1,

105 
	mMEDIA_INFO_STARTED_AS_NEXT
 = 2,

107 
	mMEDIA_INFO_VIDEO_RENDERING_START
 = 3,

111 
	mMEDIA_INFO_VIDEO_TRACK_LAGGING
 = 700,

114 
	mMEDIA_INFO_BUFFERING_START
 = 701,

116 
	mMEDIA_INFO_BUFFERING_END
 = 702,

118 
	mMEDIA_INFO_NETWORK_BANDWIDTH
 = 703,

124 
	mMEDIA_INFO_BAD_INTERLEAVING
 = 800,

126 
	mMEDIA_INFO_NOT_SEEKABLE
 = 801,

128 
	mMEDIA_INFO_METADATA_UPDATE
 = 802,

131 
	mMEDIA_INFO_TIMED_TEXT_ERROR
 = 900,

134 
	mMEDIA_INFO_VIDEO_ROTATION_CHANGED
 = 10001,

135 
	mMEDIA_INFO_AUDIO_RENDERING_START
 = 10002,

138 
	sijkmp_medŸcodecšfo_cÚ‹xt


140 
	mmime_ty³
[128];

141 
	m´ofe
;

142 
	mËv–
;

143 
	mcodec_Çme
[128];

144 } 
	tijkmp_medŸcodecšfo_cÚ‹xt
;

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/ijkplayer_jni.c

24 
	~<as£¹.h
>

25 
	~<¡ršg.h
>

26 
	~<±h»ad.h
>

27 
	~<jni.h
>

28 
	~<uni¡d.h
>

29 
	~"j4a/şass/java/ut/A¼ayLi¡.h
"

30 
	~"j4a/şass/ªdroid/os/BundË.h
"

31 
	~"j4a/şass/tv/dªmaku/ijk/medŸ/¶ay”/IjkMedŸPÏy”.h
"

32 
	~"j4a/şass/tv/dªmaku/ijk/medŸ/¶ay”/misc/IMedŸD©aSourû.h
"

33 
	~"j4a/şass/tv/dªmaku/ijk/medŸ/¶ay”/misc/IIjkIOH‰p.h
"

34 
	~"ijksdl/ijksdl_log.h
"

35 
	~"../ff_fåÏy.h
"

36 
	~"ffm³g_­i_jni.h
"

37 
	~"ijk¶ay”_ªdroid_def.h
"

38 
	~"ijk¶ay”_ªdroid.h
"

39 
	~"ijksdl/ªdroid/ijksdl_ªdroid_jni.h
"

40 
	~"ijksdl/ªdroid/ijksdl_codec_ªdroid_medŸdef.h
"

41 
	~"ijkavfÜm©/ijkavfÜm©.h
"

43 
	#JNI_MODULE_PACKAGE
 "tv/dªmaku/ijk/medŸ/¶ay”"

	)

44 
	#JNI_CLASS_IJKPLAYER
 "tv/dªmaku/ijk/medŸ/¶ay”/IjkMedŸPÏy”"

	)

45 
	#JNI_IJK_MEDIA_EXCEPTION
 "tv/dªmaku/ijk/medŸ/¶ay”/IjkMedŸExû±iÚ"

	)

47 
	#IJK_CHECK_MPRET_GOTO
(
»tv®
, 
’v
, 
Ïb–
) \

48 
	`JNI_CHECK_GOTO
((
»tv®
 !ğ
EIJK_INVALID_STATE
), 
’v
, "java/Ïng/IÎeg®S‹Exû±iÚ", 
NULL
, 
Ïb–
); \

49 
	`JNI_CHECK_GOTO
((
»tv®
 !ğ
EIJK_OUT_OF_MEMORY
), 
’v
, "java/Ïng/OutOfMemÜyE¼Ü", 
NULL
, 
Ïb–
); \

50 
	`JNI_CHECK_GOTO
((
»tv®
 =ğ0), 
’v
, 
JNI_IJK_MEDIA_EXCEPTION
, 
NULL
, 
Ïb–
);

	)

52 
JavaVM
* 
	gg_jvm
;

54 
	s¶ay”_f›lds_t
 {

55 
±h»ad_mu‹x_t
 
	mmu‹x
;

56 
jşass
 
	mşazz
;

57 } 
	t¶ay”_f›lds_t
;

58 
¶ay”_f›lds_t
 
	gg_şazz
;

60 
šjeù_ÿÎback
(*
İaque
, 
ty³
, *
d©a
, 
size_t
 
d©a_size
);

61 
boŞ
 
medŸcodec_£Ëù_ÿÎback
(*
İaque
, 
ijkmp_medŸcodecšfo_cÚ‹xt
 *
mcc
);

63 
IjkMedŸPÏy”
 *
	$jni_g‘_medŸ_¶ay”
(
JNIEnv
* 
’v
, 
jobjeù
 
thiz
)

65 
	`±h»ad_mu‹x_lock
(&
g_şazz
.
mu‹x
);

67 
IjkMedŸPÏy”
 *
mp
 = (IjkMedŸPÏy” *è(
šŒ_t
è
	`J4AC_IjkMedŸPÏy”__mN©iveMedŸPÏy”__g‘__ÿtchAÎ
(
’v
, 
thiz
);

68 ià(
mp
) {

69 
	`ijkmp_šc_»f
(
mp
);

72 
	`±h»ad_mu‹x_uÆock
(&
g_şazz
.
mu‹x
);

73  
mp
;

74 
	}
}

76 
IjkMedŸPÏy”
 *
	$jni_£t_medŸ_¶ay”
(
JNIEnv
* 
’v
, 
jobjeù
 
thiz
, 
IjkMedŸPÏy”
 *
mp
)

78 
	`±h»ad_mu‹x_lock
(&
g_şazz
.
mu‹x
);

80 
IjkMedŸPÏy”
 *
Şd
 = (IjkMedŸPÏy”*è(
šŒ_t
è
	`J4AC_IjkMedŸPÏy”__mN©iveMedŸPÏy”__g‘__ÿtchAÎ
(
’v
, 
thiz
);

81 ià(
mp
) {

82 
	`ijkmp_šc_»f
(
mp
);

84 
	`J4AC_IjkMedŸPÏy”__mN©iveMedŸPÏy”__£t__ÿtchAÎ
(
’v
, 
thiz
, (
šŒ_t
è
mp
);

86 
	`±h»ad_mu‹x_uÆock
(&
g_şazz
.
mu‹x
);

89 ià(
Şd
 !ğ
NULL
 ) {

90 
	`ijkmp_dec_»f_p
(&
Şd
);

93  
Şd
;

94 
	}
}

96 
št64_t
 
	$jni_£t_medŸ_d©a_sourû
(
JNIEnv
* 
’v
, 
jobjeù
 
thiz
, jobjeù 
medŸ_d©a_sourû
)

98 
št64_t
 
ÇtiveMedŸD©aSourû
 = 0;

100 
	`±h»ad_mu‹x_lock
(&
g_şazz
.
mu‹x
);

102 
jobjeù
 
Şd
 = (jobjeùè(
šŒ_t
è
	`J4AC_IjkMedŸPÏy”__mN©iveMedŸD©aSourû__g‘__ÿtchAÎ
(
’v
, 
thiz
);

103 ià(
Şd
) {

104 
	`J4AC_IMedŸD©aSourû__şo£__ÿtchAÎ
(
’v
, 
Şd
);

105 
	`J4A_D–‘eGlob®Ref__p
(
’v
, &
Şd
);

106 
	`J4AC_IjkMedŸPÏy”__mN©iveMedŸD©aSourû__£t__ÿtchAÎ
(
’v
, 
thiz
, 0);

109 ià(
medŸ_d©a_sourû
) {

110 
jobjeù
 
glob®_medŸ_d©a_sourû
 = (*
’v
)->
	`NewGlob®Ref
Ónv, 
medŸ_d©a_sourû
);

111 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
è|| !
glob®_medŸ_d©a_sourû
)

112 
ç
;

114 
ÇtiveMedŸD©aSourû
 = (
št64_t
è(
šŒ_t
è
glob®_medŸ_d©a_sourû
;

115 
	`J4AC_IjkMedŸPÏy”__mN©iveMedŸD©aSourû__£t__ÿtchAÎ
(
’v
, 
thiz
, (
jlÚg
è
ÇtiveMedŸD©aSourû
);

118 
ç
:

119 
	`±h»ad_mu‹x_uÆock
(&
g_şazz
.
mu‹x
);

120  
ÇtiveMedŸD©aSourû
;

121 
	}
}

123 
št64_t
 
	$jni_£t_ijkio_h‰p
(
JNIEnv
* 
’v
, 
jobjeù
 
thiz
, jobjeù 
ijk_io
)

125 
št64_t
 
ÇtiveIjkIOH‰p
 = 0;

127 
	`±h»ad_mu‹x_lock
(&
g_şazz
.
mu‹x
);

129 
jobjeù
 
Şd
 = (jobjeùè(
šŒ_t
è
	`J4AC_IjkMedŸPÏy”__mN©iveIjkIOH‰p__g‘__ÿtchAÎ
(
’v
, 
thiz
);

130 ià(
Şd
) {

131 
	`J4AC_IIjkIOH‰p__şo£__ÿtchAÎ
(
’v
, 
Şd
);

132 
	`J4A_D–‘eGlob®Ref__p
(
’v
, &
Şd
);

133 
	`J4AC_IjkMedŸPÏy”__mN©iveIjkIOH‰p__£t__ÿtchAÎ
(
’v
, 
thiz
, 0);

136 ià(
ijk_io
) {

137 
jobjeù
 
glob®_ijkio_h‰p
 = (*
’v
)->
	`NewGlob®Ref
Ónv, 
ijk_io
);

138 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
è|| !
glob®_ijkio_h‰p
)

139 
ç
;

140 
ÇtiveIjkIOH‰p
 = (
št64_t
è(
šŒ_t
è
glob®_ijkio_h‰p
;

141 
	`J4AC_IjkMedŸPÏy”__mN©iveIjkIOH‰p__£t__ÿtchAÎ
(
’v
, 
thiz
, (
jlÚg
è
ÇtiveIjkIOH‰p
);

144 
ç
:

145 
	`±h»ad_mu‹x_uÆock
(&
g_şazz
.
mu‹x
);

146  
ÇtiveIjkIOH‰p
;

147 
	}
}

149 
mes§ge_loİ
(*
¬g
);

152 
	$IjkMedŸPÏy”_£tD©aSourûAndH—d”s
(

153 
JNIEnv
 *
’v
, 
jobjeù
 
thiz
, 
j¡ršg
 
·th
,

154 
jobjeùA¼ay
 
keys
, jobjeùA¼ay 
v®ues
)

156 
	`MPTRACE
("%s\n", 
__func__
);

157 
»tv®
 = 0;

158 cÚ¡ *
c_·th
 = 
NULL
;

159 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

160 
	`JNI_CHECK_GOTO
(
·th
, 
’v
, "java/Ïng/IÎeg®Argum’tExû±iÚ", "mpjni: s‘D©aSourû:‚uÎ…©h", 
LABEL_RETURN
);

161 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, "java/Ïng/IÎeg®S‹Exû±iÚ", "mpjni: s‘D©aSourû:‚uÎ mp", 
LABEL_RETURN
);

163 
c_·th
 = (*
’v
)->
	`G‘SŒšgUTFCh¬s
Ónv, 
·th
, 
NULL
 );

164 
	`JNI_CHECK_GOTO
(
c_·th
, 
’v
, "java/Ïng/OutOfMemÜyE¼Ü", "mpjni: s‘D©aSourû:…©h.¡ršg oom", 
LABEL_RETURN
);

166 
	`ALOGV
("£tD©aSourû:…©h %s", 
c_·th
);

167 
»tv®
 = 
	`ijkmp_£t_d©a_sourû
(
mp
, 
c_·th
);

168 (*
’v
)->
	`R–—£SŒšgUTFCh¬s
Ónv, 
·th
, 
c_·th
);

170 
	`IJK_CHECK_MPRET_GOTO
(
»tv®
, 
’v
, 
LABEL_RETURN
);

172 
LABEL_RETURN
:

173 
	`ijkmp_dec_»f_p
(&
mp
);

174 
	}
}

177 
	$IjkMedŸPÏy”_£tD©aSourûFd
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
, 
jšt
 
fd
)

179 
	`MPTRACE
("%s\n", 
__func__
);

180 
»tv®
 = 0;

181 
dupFd
 = 0;

182 
uri
[128];

183 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

184 
	`JNI_CHECK_GOTO
(
fd
 > 0, 
’v
, "java/Ïng/IÎeg®Argum’tExû±iÚ", "mpjni: s‘D©aSourûFd:‚uÎ fd", 
LABEL_RETURN
);

185 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, "java/Ïng/IÎeg®S‹Exû±iÚ", "mpjni: s‘D©aSourûFd:‚uÎ mp", 
LABEL_RETURN
);

187 
dupFd
 = 
	`dup
(
fd
);

189 
	`ALOGV
("£tD©aSourûFd: dup(%d)=%d\n", 
fd
, 
dupFd
);

190 
	`¢´štf
(
uri
, (uri), "pe:%d", 
dupFd
);

191 
»tv®
 = 
	`ijkmp_£t_d©a_sourû
(
mp
, 
uri
);

193 
	`IJK_CHECK_MPRET_GOTO
(
»tv®
, 
’v
, 
LABEL_RETURN
);

195 
LABEL_RETURN
:

196 
	`ijkmp_dec_»f_p
(&
mp
);

197 
	}
}

200 
	$IjkMedŸPÏy”_£tD©aSourûC®lback
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
, jobjeù 
ÿÎback
)

202 
	`MPTRACE
("%s\n", 
__func__
);

203 
»tv®
 = 0;

204 
uri
[128];

205 
št64_t
 
ÇtiveMedŸD©aSourû
 = 0;

206 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

207 
	`JNI_CHECK_GOTO
(
ÿÎback
, 
’v
, "java/Ïng/IÎeg®Argum’tExû±iÚ", "mpjni: s‘D©aSourûC®lback:‚uÎ fd", 
LABEL_RETURN
);

208 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, "java/Ïng/IÎeg®S‹Exû±iÚ", "mpjni: s‘D©aSourûC®lback:‚uÎ mp", 
LABEL_RETURN
);

210 
ÇtiveMedŸD©aSourû
 = 
	`jni_£t_medŸ_d©a_sourû
(
’v
, 
thiz
, 
ÿÎback
);

211 
	`JNI_CHECK_GOTO
(
ÇtiveMedŸD©aSourû
, 
’v
, "java/Ïng/IÎeg®S‹Exû±iÚ", "mpjni: jni_£t_medŸ_d©a_sourû: NewGlob®Ref", 
LABEL_RETURN
);

213 
	`ALOGV
("£tD©aSourûC®lback: %"
PRId64
"\n", 
ÇtiveMedŸD©aSourû
);

214 
	`¢´štf
(
uri
, (uri), "ijkmedŸd©asourû:%"
PRId64
, 
ÇtiveMedŸD©aSourû
);

216 
»tv®
 = 
	`ijkmp_£t_d©a_sourû
(
mp
, 
uri
);

218 
	`IJK_CHECK_MPRET_GOTO
(
»tv®
, 
’v
, 
LABEL_RETURN
);

220 
LABEL_RETURN
:

221 
	`ijkmp_dec_»f_p
(&
mp
);

222 
	}
}

225 
	$IjkMedŸPÏy”_£tD©aSourûIjkIOH‰pC®lback
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
, jobjeù 
ÿÎback
) {

226 
	`MPTRACE
("%s\n", 
__func__
);

227 
»tv®
 = 0;

228 
uri
[128];

229 
št64_t
 
ÇtiveIjkIOH‰p
 = 0;

231 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

232 
	`JNI_CHECK_GOTO
(
ÿÎback
, 
’v
, "java/Ïng/IÎeg®Argum’tExû±iÚ", "mpjni: s‘D©aSourûIjkIOC®lback:‚uÎ fd", 
LABEL_RETURN
);

233 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, "java/Ïng/IÎeg®S‹Exû±iÚ", "mpjni: s‘D©aSourûIjkIOC®lback:‚uÎ mp", 
LABEL_RETURN
);

235 
ÇtiveIjkIOH‰p
 = 
	`jni_£t_ijkio_h‰p
(
’v
, 
thiz
, 
ÿÎback
);

236 
	`JNI_CHECK_GOTO
(
ÇtiveIjkIOH‰p
, 
’v
, "java/Ïng/IÎeg®S‹Exû±iÚ", "mpjni: jni_£t_ijkio_h‰p: NewGlob®Ref", 
LABEL_RETURN
);

238 
	`ALOGV
("£tD©aSourûIjkIOH‰pC®lback: %"
PRId64
"\n", 
ÇtiveIjkIOH‰p
);

239 
	`¢´štf
(
uri
, (uri), "ijkio:h‰p:%"
PRId64
, 
ÇtiveIjkIOH‰p
);

241 
»tv®
 = 
	`ijkmp_£t_d©a_sourû
(
mp
, 
uri
);

243 
	`IJK_CHECK_MPRET_GOTO
(
»tv®
, 
’v
, 
LABEL_RETURN
);

245 
LABEL_RETURN
:

246 
	`ijkmp_dec_»f_p
(&
mp
);

247 
	}
}

250 
	$IjkMedŸPÏy”_£tVideoSurçû
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
, jobjeù 
jsurçû
)

252 
	`MPTRACE
("%s\n", 
__func__
);

253 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

254 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, 
NULL
, "mpjni: s‘VideoSurçû:‚uÎ mp", 
LABEL_RETURN
);

256 
	`ijkmp_ªdroid_£t_surçû
(
’v
, 
mp
, 
jsurçû
);

258 
LABEL_RETURN
:

259 
	`ijkmp_dec_»f_p
(&
mp
);

261 
	}
}

264 
	$IjkMedŸPÏy”_´•¬eAsync
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
)

266 
	`MPTRACE
("%s\n", 
__func__
);

267 
»tv®
 = 0;

268 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

269 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, "java/Ïng/IÎeg®S‹Exû±iÚ", "mpjni:…»·»Async:‚uÎ mp", 
LABEL_RETURN
);

271 
»tv®
 = 
	`ijkmp_´•¬e_async
(
mp
);

272 
	`IJK_CHECK_MPRET_GOTO
(
»tv®
, 
’v
, 
LABEL_RETURN
);

274 
LABEL_RETURN
:

275 
	`ijkmp_dec_»f_p
(&
mp
);

276 
	}
}

279 
	$IjkMedŸPÏy”_¡¬t
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
)

281 
	`MPTRACE
("%s\n", 
__func__
);

282 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

283 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, "java/Ïng/IÎeg®S‹Exû±iÚ", "mpjni: s¹:‚uÎ mp", 
LABEL_RETURN
);

285 
	`ijkmp_¡¬t
(
mp
);

287 
LABEL_RETURN
:

288 
	`ijkmp_dec_»f_p
(&
mp
);

289 
	}
}

292 
	$IjkMedŸPÏy”_¡İ
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
)

294 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

295 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, "java/Ïng/IÎeg®S‹Exû±iÚ", "mpjni: stİ:‚uÎ mp", 
LABEL_RETURN
);

297 
	`ijkmp_¡İ
(
mp
);

299 
LABEL_RETURN
:

300 
	`ijkmp_dec_»f_p
(&
mp
);

301 
	}
}

304 
	$IjkMedŸPÏy”_·u£
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
)

306 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

307 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, "java/Ïng/IÎeg®S‹Exû±iÚ", "mpjni:…au£:‚uÎ mp", 
LABEL_RETURN
);

309 
	`ijkmp_·u£
(
mp
);

311 
LABEL_RETURN
:

312 
	`ijkmp_dec_»f_p
(&
mp
);

313 
	}
}

316 
	$IjkMedŸPÏy”_£ekTo
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
, 
jlÚg
 
m£c
)

318 
	`MPTRACE
("%s\n", 
__func__
);

319 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

320 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, "java/Ïng/IÎeg®S‹Exû±iÚ", "mpjni: s“kTo:‚uÎ mp", 
LABEL_RETURN
);

322 
	`ijkmp_£ek_to
(
mp
, 
m£c
);

324 
LABEL_RETURN
:

325 
	`ijkmp_dec_»f_p
(&
mp
);

326 
	}
}

328 
jboŞ—n


329 
	$IjkMedŸPÏy”_isPÏyšg
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
)

331 
jboŞ—n
 
»tv®
 = 
JNI_FALSE
;

332 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

333 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, 
NULL
, "mpjni: isPÏyšg:‚uÎ mp", 
LABEL_RETURN
);

335 
»tv®
 = 
	`ijkmp_is_¶ayšg
(
mp
è? 
JNI_TRUE
 : 
JNI_FALSE
;

337 
LABEL_RETURN
:

338 
	`ijkmp_dec_»f_p
(&
mp
);

339  
»tv®
;

340 
	}
}

342 
jlÚg


343 
	$IjkMedŸPÏy”_g‘Cu¼’tPos™iÚ
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
)

345 
jlÚg
 
»tv®
 = 0;

346 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

347 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, 
NULL
, "mpjni: g‘Cu¼’tPos™iÚ:‚uÎ mp", 
LABEL_RETURN
);

349 
»tv®
 = 
	`ijkmp_g‘_cu¼’t_pos™iÚ
(
mp
);

351 
LABEL_RETURN
:

352 
	`ijkmp_dec_»f_p
(&
mp
);

353  
»tv®
;

354 
	}
}

356 
jlÚg


357 
	$IjkMedŸPÏy”_g‘Du¿tiÚ
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
)

359 
jlÚg
 
»tv®
 = 0;

360 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

361 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, 
NULL
, "mpjni: g‘Du¿tiÚ:‚uÎ mp", 
LABEL_RETURN
);

363 
»tv®
 = 
	`ijkmp_g‘_du¿tiÚ
(
mp
);

365 
LABEL_RETURN
:

366 
	`ijkmp_dec_»f_p
(&
mp
);

367  
»tv®
;

368 
	}
}

371 
	$IjkMedŸPÏy”_»Ëa£
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
)

373 
	`MPTRACE
("%s\n", 
__func__
);

374 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

375 ià(!
mp
)

378 
	`ijkmp_ªdroid_£t_surçû
(
’v
, 
mp
, 
NULL
);

380 
	`ijkmp_shutdown
(
mp
);

382 
jobjeù
 
w—k_thiz
 = (jobjeùè
	`ijkmp_£t_w—k_thiz
(
mp
, 
NULL
 );

383 (*
’v
)->
	`D–‘eGlob®Ref
Ónv, 
w—k_thiz
);

384 
	`jni_£t_medŸ_¶ay”
(
’v
, 
thiz
, 
NULL
);

385 
	`jni_£t_medŸ_d©a_sourû
(
’v
, 
thiz
, 
NULL
);

387 
	`ijkmp_dec_»f_p
(&
mp
);

388 
	}
}

390 
IjkMedŸPÏy”_Çtive_£tup
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
, jobjeù 
w—k_this
);

392 
	$IjkMedŸPÏy”_»£t
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
)

394 
	`MPTRACE
("%s\n", 
__func__
);

395 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

396 ià(!
mp
)

399 
jobjeù
 
w—k_thiz
 = (jobjeùè
	`ijkmp_£t_w—k_thiz
(
mp
, 
NULL
 );

401 
	`IjkMedŸPÏy”_»Ëa£
(
’v
, 
thiz
);

402 
	`IjkMedŸPÏy”_Çtive_£tup
(
’v
, 
thiz
, 
w—k_thiz
);

404 
	`ijkmp_dec_»f_p
(&
mp
);

405 
	}
}

408 
	$IjkMedŸPÏy”_£tLoİCouÁ
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
, 
jšt
 
loİ_couÁ
)

410 
	`MPTRACE
("%s\n", 
__func__
);

411 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

412 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, 
NULL
, "mpjni: s‘LoİCouÁ:‚uÎ mp", 
LABEL_RETURN
);

414 
	`ijkmp_£t_loİ
(
mp
, 
loİ_couÁ
);

416 
LABEL_RETURN
:

417 
	`ijkmp_dec_»f_p
(&
mp
);

418 
	}
}

420 
jšt


421 
	$IjkMedŸPÏy”_g‘LoİCouÁ
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
)

423 
jšt
 
loİ_couÁ
 = 1;

424 
	`MPTRACE
("%s\n", 
__func__
);

425 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

426 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, 
NULL
, "mpjni: g‘LoİCouÁ:‚uÎ mp", 
LABEL_RETURN
);

428 
loİ_couÁ
 = 
	`ijkmp_g‘_loİ
(
mp
);

430 
LABEL_RETURN
:

431 
	`ijkmp_dec_»f_p
(&
mp
);

432  
loİ_couÁ
;

433 
	}
}

435 
jæßt


436 
	$ijkMedŸPÏy”_g‘Prİ”tyFlßt
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
, 
jšt
 
id
, 
jæßt
 
deçuÉ_v®ue
)

438 
jæßt
 
v®ue
 = 
deçuÉ_v®ue
;

439 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

440 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, 
NULL
, "mpjni: g‘Prİ”tyFlßt:‚uÎ mp", 
LABEL_RETURN
);

442 
v®ue
 = 
	`ijkmp_g‘_´İ”ty_æßt
(
mp
, 
id
, 
deçuÉ_v®ue
);

444 
LABEL_RETURN
:

445 
	`ijkmp_dec_»f_p
(&
mp
);

446  
v®ue
;

447 
	}
}

450 
	$ijkMedŸPÏy”_£tPrİ”tyFlßt
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
, 
jšt
 
id
, 
jæßt
 
v®ue
)

452 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

453 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, 
NULL
, "mpjni: s‘Prİ”tyFlßt:‚uÎ mp", 
LABEL_RETURN
);

455 
	`ijkmp_£t_´İ”ty_æßt
(
mp
, 
id
, 
v®ue
);

457 
LABEL_RETURN
:

458 
	`ijkmp_dec_»f_p
(&
mp
);

460 
	}
}

462 
jlÚg


463 
	$ijkMedŸPÏy”_g‘Prİ”tyLÚg
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
, 
jšt
 
id
, 
jlÚg
 
deçuÉ_v®ue
)

465 
jlÚg
 
v®ue
 = 
deçuÉ_v®ue
;

466 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

467 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, 
NULL
, "mpjni: g‘Prİ”tyLÚg:‚uÎ mp", 
LABEL_RETURN
);

469 
v®ue
 = 
	`ijkmp_g‘_´İ”ty_št64
(
mp
, 
id
, 
deçuÉ_v®ue
);

471 
LABEL_RETURN
:

472 
	`ijkmp_dec_»f_p
(&
mp
);

473  
v®ue
;

474 
	}
}

477 
	$ijkMedŸPÏy”_£tPrİ”tyLÚg
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
, 
jšt
 
id
, 
jlÚg
 
v®ue
)

479 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

480 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, 
NULL
, "mpjni: s‘Prİ”tyLÚg:‚uÎ mp", 
LABEL_RETURN
);

482 
	`ijkmp_£t_´İ”ty_št64
(
mp
, 
id
, 
v®ue
);

484 
LABEL_RETURN
:

485 
	`ijkmp_dec_»f_p
(&
mp
);

487 
	}
}

490 
	$ijkMedŸPÏy”_£tSŒ—mS–eùed
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
, 
jšt
 
¡»am
, 
jboŞ—n
 
£Ëùed
)

492 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

493 
»t
 = 0;

494 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, 
NULL
, "mpjni: s‘SŒ—mS–eùed:‚uÎ mp", 
LABEL_RETURN
);

496 
»t
 = 
	`ijkmp_£t_¡»am_£Ëùed
(
mp
, 
¡»am
, 
£Ëùed
);

497 ià(
»t
 < 0) {

498 
	`ALOGE
("çedØ% %d", 
£Ëùed
 ? "£Ëù" : "de£Ëù", 
¡»am
);

499 
LABEL_RETURN
;

502 
LABEL_RETURN
:

503 
	`ijkmp_dec_»f_p
(&
mp
);

505 
	}
}

508 
	$IjkMedŸPÏy”_£tVŞume
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
, 
jæßt
 
ËáVŞume
, jæßˆ
rightVŞume
)

510 
	`MPTRACE
("%s\n", 
__func__
);

511 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

512 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, 
NULL
, "mpjni: s‘VŞume:‚uÎ mp", 
LABEL_RETURN
);

514 
	`ijkmp_ªdroid_£t_vŞume
(
’v
, 
mp
, 
ËáVŞume
, 
rightVŞume
);

516 
LABEL_RETURN
:

517 
	`ijkmp_dec_»f_p
(&
mp
);

518 
	}
}

520 
jšt


521 
	$IjkMedŸPÏy”_g‘AudioSessiÚId
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
)

523 
jšt
 
audio_£ssiÚ_id
 = 0;

524 
	`MPTRACE
("%s\n", 
__func__
);

525 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

526 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, 
NULL
, "mpjni: g‘AudioSessiÚId:‚uÎ mp", 
LABEL_RETURN
);

528 
audio_£ssiÚ_id
 = 
	`ijkmp_ªdroid_g‘_audio_£ssiÚ_id
(
’v
, 
mp
);

530 
LABEL_RETURN
:

531 
	`ijkmp_dec_»f_p
(&
mp
);

532  
audio_£ssiÚ_id
;

533 
	}
}

536 
	$IjkMedŸPÏy”_£tO±iÚ
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
, 
jšt
 
ÿ‹gÜy
, jobjeù 
Çme
, jobjeù 
v®ue
)

538 
	`MPTRACE
("%s\n", 
__func__
);

539 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

540 cÚ¡ *
c_Çme
 = 
NULL
;

541 cÚ¡ *
c_v®ue
 = 
NULL
;

542 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, "java/Ïng/IÎeg®S‹Exû±iÚ", "mpjni: s‘O±iÚ:‚uÎ mp", 
LABEL_RETURN
);

544 
c_Çme
 = (*
’v
)->
	`G‘SŒšgUTFCh¬s
Ónv, 
Çme
, 
NULL
 );

545 
	`JNI_CHECK_GOTO
(
c_Çme
, 
’v
, "java/Ïng/OutOfMemÜyE¼Ü", "mpjni: s‘O±iÚ:‚ame.¡ršg oom", 
LABEL_RETURN
);

547 ià(
v®ue
) {

548 
c_v®ue
 = (*
’v
)->
	`G‘SŒšgUTFCh¬s
Ónv, 
v®ue
, 
NULL
 );

549 
	`JNI_CHECK_GOTO
(
c_Çme
, 
’v
, "java/Ïng/OutOfMemÜyE¼Ü", "mpjni: s‘O±iÚ:‚ame.¡ršg oom", 
LABEL_RETURN
);

552 
	`ijkmp_£t_İtiÚ
(
mp
, 
ÿ‹gÜy
, 
c_Çme
, 
c_v®ue
);

554 
LABEL_RETURN
:

555 ià(
c_Çme
)

556 (*
’v
)->
	`R–—£SŒšgUTFCh¬s
Ónv, 
Çme
, 
c_Çme
);

557 ià(
c_v®ue
)

558 (*
’v
)->
	`R–—£SŒšgUTFCh¬s
Ónv, 
v®ue
, 
c_v®ue
);

559 
	`ijkmp_dec_»f_p
(&
mp
);

560 
	}
}

563 
	$IjkMedŸPÏy”_£tO±iÚLÚg
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
, 
jšt
 
ÿ‹gÜy
, jobjeù 
Çme
, 
jlÚg
 
v®ue
)

565 
	`MPTRACE
("%s\n", 
__func__
);

566 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

567 cÚ¡ *
c_Çme
 = 
NULL
;

568 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, "java/Ïng/IÎeg®S‹Exû±iÚ", "mpjni: s‘O±iÚLÚg:‚uÎ mp", 
LABEL_RETURN
);

570 
c_Çme
 = (*
’v
)->
	`G‘SŒšgUTFCh¬s
Ónv, 
Çme
, 
NULL
 );

571 
	`JNI_CHECK_GOTO
(
c_Çme
, 
’v
, "java/Ïng/OutOfMemÜyE¼Ü", "mpjni: s‘O±iÚLÚg:‚ame.¡ršg oom", 
LABEL_RETURN
);

573 
	`ijkmp_£t_İtiÚ_št
(
mp
, 
ÿ‹gÜy
, 
c_Çme
, 
v®ue
);

575 
LABEL_RETURN
:

576 ià(
c_Çme
)

577 (*
’v
)->
	`R–—£SŒšgUTFCh¬s
Ónv, 
Çme
, 
c_Çme
);

578 
	`ijkmp_dec_»f_p
(&
mp
);

579 
	}
}

581 
j¡ršg


582 
	$IjkMedŸPÏy”_g‘CŞÜFÜm©Name
(
JNIEnv
 *
’v
, 
jşass
 
şazz
, 
jšt
 
medŸCodecCŞÜFÜm©
)

584 cÚ¡ *
codec_Çme
 = 
	`SDL_AMedŸCodec_g‘CŞÜFÜm©Name
(
medŸCodecCŞÜFÜm©
);

585 ià(!
codec_Çme
)

586  
NULL
 ;

588  (*
’v
)->
	`NewSŒšgUTF
Ónv, 
codec_Çme
);

589 
	}
}

591 
j¡ršg


592 
	$IjkMedŸPÏy”_g‘VideoCodecInfo
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
)

594 
	`MPTRACE
("%s\n", 
__func__
);

595 
j¡ršg
 
jcodec_šfo
 = 
NULL
;

596 
»t
 = 0;

597 *
codec_šfo
 = 
NULL
;

598 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

599 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, "java/Ïng/IÎeg®S‹Exû±iÚ", "mpjni: g‘VideoCodecInfo:‚uÎ mp", 
LABEL_RETURN
);

601 
»t
 = 
	`ijkmp_g‘_video_codec_šfo
(
mp
, &
codec_šfo
);

602 ià(
»t
 < 0 || !
codec_šfo
)

603 
LABEL_RETURN
;

605 
jcodec_šfo
 = (*
’v
)->
	`NewSŒšgUTF
Ónv, 
codec_šfo
);

606 
LABEL_RETURN
:

607 ià(
codec_šfo
)

608 
	`ä“
(
codec_šfo
);

610 
	`ijkmp_dec_»f_p
(&
mp
);

611  
jcodec_šfo
;

612 
	}
}

614 
j¡ršg


615 
	$IjkMedŸPÏy”_g‘AudioCodecInfo
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
)

617 
	`MPTRACE
("%s\n", 
__func__
);

618 
j¡ršg
 
jcodec_šfo
 = 
NULL
;

619 
»t
 = 0;

620 *
codec_šfo
 = 
NULL
;

621 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

622 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, "java/Ïng/IÎeg®S‹Exû±iÚ", "mpjni: g‘AudioCodecInfo:‚uÎ mp", 
LABEL_RETURN
);

624 
»t
 = 
	`ijkmp_g‘_audio_codec_šfo
(
mp
, &
codec_šfo
);

625 ià(
»t
 < 0 || !
codec_šfo
)

626 
LABEL_RETURN
;

628 
jcodec_šfo
 = (*
’v
)->
	`NewSŒšgUTF
Ónv, 
codec_šfo
);

629 
LABEL_RETURN
:

630 ià(
codec_šfo
)

631 
	`ä“
(
codec_šfo
);

633 
	`ijkmp_dec_»f_p
(&
mp
);

634  
jcodec_šfo
;

635 
	}
}

637 
šlše
 
	$flM‘aIÁ”Çl
(
JNIEnv
 *
’v
, 
jobjeù
 
jbundË
, 
IjkMedŸM‘a
 *
m‘a
, cÚ¡ *
key
, cÚ¡ *
deçuÉ_v®ue
)

639 cÚ¡ *
v®ue
 = 
	`ijkm‘a_g‘_¡ršg_l
(
m‘a
, 
key
);

640 ià(
v®ue
 =ğ
NULL
 )

641 
v®ue
 = 
deçuÉ_v®ue
;

643 
	`J4AC_BundË__putSŒšg__w™hCSŒšg__ÿtchAÎ
(
’v
, 
jbundË
, 
key
, 
v®ue
);

644 
	}
}

646 
jobjeù


647 
	$IjkMedŸPÏy”_g‘MedŸM‘a
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
)

649 
	`MPTRACE
("%s\n", 
__func__
);

650 
boŞ
 
is_locked
 = 
çl£
;

651 
jobjeù
 
j»t_bundË
 = 
NULL
;

652 
jobjeù
 
jloÿl_bundË
 = 
NULL
;

653 
jobjeù
 
j¡»am_bundË
 = 
NULL
;

654 
jobjeù
 
j¬¿y_li¡
 = 
NULL
;

655 
IjkMedŸM‘a
 *
m‘a
 = 
NULL
;

656 
IjkMedŸPÏy”
 *
mp
 = 
	`jni_g‘_medŸ_¶ay”
(
’v
, 
thiz
);

657 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, "java/Ïng/IÎeg®S‹Exû±iÚ", "mpjni: g‘MedŸM‘a:‚uÎ mp", 
LABEL_RETURN
);

659 
m‘a
 = 
	`ijkmp_g‘_m‘a_l
(
mp
);

660 ià(!
m‘a
)

661 
LABEL_RETURN
;

663 
	`ijkm‘a_lock
(
m‘a
);

664 
is_locked
 = 
Œue
;

666 
jloÿl_bundË
 = 
	`J4AC_BundË__BundË
(
’v
);

667 ià(
	`J4A_Exû±iÚCheck__throwAny
(
’v
)) {

668 
LABEL_RETURN
;

671 
	`flM‘aIÁ”Çl
(
’v
, 
jloÿl_bundË
, 
m‘a
, 
IJKM_KEY_FORMAT
, 
NULL
 );

672 
	`flM‘aIÁ”Çl
(
’v
, 
jloÿl_bundË
, 
m‘a
, 
IJKM_KEY_DURATION_US
, 
NULL
 );

673 
	`flM‘aIÁ”Çl
(
’v
, 
jloÿl_bundË
, 
m‘a
, 
IJKM_KEY_START_US
, 
NULL
 );

674 
	`flM‘aIÁ”Çl
(
’v
, 
jloÿl_bundË
, 
m‘a
, 
IJKM_KEY_BITRATE
, 
NULL
 );

676 
	`flM‘aIÁ”Çl
(
’v
, 
jloÿl_bundË
, 
m‘a
, 
IJKM_KEY_VIDEO_STREAM
, "-1");

677 
	`flM‘aIÁ”Çl
(
’v
, 
jloÿl_bundË
, 
m‘a
, 
IJKM_KEY_AUDIO_STREAM
, "-1");

678 
	`flM‘aIÁ”Çl
(
’v
, 
jloÿl_bundË
, 
m‘a
, 
IJKM_KEY_TIMEDTEXT_STREAM
, "-1");

680 
j¬¿y_li¡
 = 
	`J4AC_A¼ayLi¡__A¼ayLi¡
(
’v
);

681 ià(
	`J4A_Exû±iÚCheck__throwAny
(
’v
)) {

682 
LABEL_RETURN
;

685 
size_t
 
couÁ
 = 
	`ijkm‘a_g‘_chd»n_couÁ_l
(
m‘a
);

686 
size_t
 
i
 = 0; i < 
couÁ
; ++i) {

687 
IjkMedŸM‘a
 *
¡»amRawM‘a
 = 
	`ijkm‘a_g‘_chd_l
(
m‘a
, 
i
);

688 ià(
¡»amRawM‘a
) {

689 
j¡»am_bundË
 = 
	`J4AC_BundË__BundË
(
’v
);

690 ià(
	`J4A_Exû±iÚCheck__throwAny
(
’v
)) {

691 
LABEL_RETURN
;

694 
	`flM‘aIÁ”Çl
(
’v
, 
j¡»am_bundË
, 
¡»amRawM‘a
, 
IJKM_KEY_TYPE
, 
IJKM_VAL_TYPE__UNKNOWN
);

695 
	`flM‘aIÁ”Çl
(
’v
, 
j¡»am_bundË
, 
¡»amRawM‘a
, 
IJKM_KEY_LANGUAGE
, 
NULL
);

696 cÚ¡ *
ty³
 = 
	`ijkm‘a_g‘_¡ršg_l
(
¡»amRawM‘a
, 
IJKM_KEY_TYPE
);

697 ià(
ty³
) {

698 
	`flM‘aIÁ”Çl
(
’v
, 
j¡»am_bundË
, 
¡»amRawM‘a
, 
IJKM_KEY_CODEC_NAME
, 
NULL
 );

699 
	`flM‘aIÁ”Çl
(
’v
, 
j¡»am_bundË
, 
¡»amRawM‘a
, 
IJKM_KEY_CODEC_PROFILE
, 
NULL
 );

700 
	`flM‘aIÁ”Çl
(
’v
, 
j¡»am_bundË
, 
¡»amRawM‘a
, 
IJKM_KEY_CODEC_LEVEL
, 
NULL
 );

701 
	`flM‘aIÁ”Çl
(
’v
, 
j¡»am_bundË
, 
¡»amRawM‘a
, 
IJKM_KEY_CODEC_LONG_NAME
, 
NULL
 );

702 
	`flM‘aIÁ”Çl
(
’v
, 
j¡»am_bundË
, 
¡»amRawM‘a
, 
IJKM_KEY_CODEC_PIXEL_FORMAT
, 
NULL
 );

703 
	`flM‘aIÁ”Çl
(
’v
, 
j¡»am_bundË
, 
¡»amRawM‘a
, 
IJKM_KEY_BITRATE
, 
NULL
 );

704 
	`flM‘aIÁ”Çl
(
’v
, 
j¡»am_bundË
, 
¡»amRawM‘a
, 
IJKM_KEY_CODEC_PROFILE_ID
, 
NULL
 );

706 ià(0 =ğ
	`¡rcmp
(
ty³
, 
IJKM_VAL_TYPE__VIDEO
)) {

707 
	`flM‘aIÁ”Çl
(
’v
, 
j¡»am_bundË
, 
¡»amRawM‘a
, 
IJKM_KEY_WIDTH
, 
NULL
 );

708 
	`flM‘aIÁ”Çl
(
’v
, 
j¡»am_bundË
, 
¡»amRawM‘a
, 
IJKM_KEY_HEIGHT
, 
NULL
 );

709 
	`flM‘aIÁ”Çl
(
’v
, 
j¡»am_bundË
, 
¡»amRawM‘a
, 
IJKM_KEY_FPS_NUM
, 
NULL
 );

710 
	`flM‘aIÁ”Çl
(
’v
, 
j¡»am_bundË
, 
¡»amRawM‘a
, 
IJKM_KEY_FPS_DEN
, 
NULL
 );

711 
	`flM‘aIÁ”Çl
(
’v
, 
j¡»am_bundË
, 
¡»amRawM‘a
, 
IJKM_KEY_TBR_NUM
, 
NULL
 );

712 
	`flM‘aIÁ”Çl
(
’v
, 
j¡»am_bundË
, 
¡»amRawM‘a
, 
IJKM_KEY_TBR_DEN
, 
NULL
 );

713 
	`flM‘aIÁ”Çl
(
’v
, 
j¡»am_bundË
, 
¡»amRawM‘a
, 
IJKM_KEY_SAR_NUM
, 
NULL
 );

714 
	`flM‘aIÁ”Çl
(
’v
, 
j¡»am_bundË
, 
¡»amRawM‘a
, 
IJKM_KEY_SAR_DEN
, 
NULL
 );

715 } ià(0 =ğ
	`¡rcmp
(
ty³
, 
IJKM_VAL_TYPE__AUDIO
)) {

716 
	`flM‘aIÁ”Çl
(
’v
, 
j¡»am_bundË
, 
¡»amRawM‘a
, 
IJKM_KEY_SAMPLE_RATE
, 
NULL
 );

717 
	`flM‘aIÁ”Çl
(
’v
, 
j¡»am_bundË
, 
¡»amRawM‘a
, 
IJKM_KEY_CHANNEL_LAYOUT
, 
NULL
 );

719 
	`J4AC_A¼ayLi¡__add
(
’v
, 
j¬¿y_li¡
, 
j¡»am_bundË
);

720 ià(
	`J4A_Exû±iÚCheck__throwAny
(
’v
)) {

721 
LABEL_RETURN
;

725 
	`SDL_JNI_D–‘eLoÿlRefP
(
’v
, &
j¡»am_bundË
);

729 
	`J4AC_BundË__putP¬ûÏbËA¼ayLi¡__w™hCSŒšg__ÿtchAÎ
(
’v
, 
jloÿl_bundË
, 
IJKM_KEY_STREAMS
, 
j¬¿y_li¡
);

730 
j»t_bundË
 = 
jloÿl_bundË
;

731 
jloÿl_bundË
 = 
NULL
;

732 
LABEL_RETURN
:

733 ià(
is_locked
 && 
m‘a
)

734 
	`ijkm‘a_uÆock
(
m‘a
);

736 
	`SDL_JNI_D–‘eLoÿlRefP
(
’v
, &
j¡»am_bundË
);

737 
	`SDL_JNI_D–‘eLoÿlRefP
(
’v
, &
jloÿl_bundË
);

738 
	`SDL_JNI_D–‘eLoÿlRefP
(
’v
, &
j¬¿y_li¡
);

740 
	`ijkmp_dec_»f_p
(&
mp
);

741  
j»t_bundË
;

742 
	}
}

745 
	$IjkMedŸPÏy”_Çtive_š™
(
JNIEnv
 *
’v
)

747 
	`MPTRACE
("%s\n", 
__func__
);

748 
	}
}

751 
	$IjkMedŸPÏy”_Çtive_£tup
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
, jobjeù 
w—k_this
)

753 
	`MPTRACE
("%s\n", 
__func__
);

754 
IjkMedŸPÏy”
 *
mp
 = 
	`ijkmp_ªdroid_ü—‹
(
mes§ge_loİ
);

755 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, "java/Ïng/OutOfMemÜyE¼Ü", "mpjni:‚©ive_£tup: ijkmp_ü—‹(èçed", 
LABEL_RETURN
);

757 
	`jni_£t_medŸ_¶ay”
(
’v
, 
thiz
, 
mp
);

758 
	`ijkmp_£t_w—k_thiz
(
mp
, (*
’v
)->
	`NewGlob®Ref
Ónv, 
w—k_this
));

759 
	`ijkmp_£t_šjeù_İaque
(
mp
, 
	`ijkmp_g‘_w—k_thiz
(mp));

760 
	`ijkmp_£t_ijkio_šjeù_İaque
(
mp
, 
	`ijkmp_g‘_w—k_thiz
(mp));

761 
	`ijkmp_ªdroid_£t_medŸcodec_£Ëù_ÿÎback
(
mp
, 
medŸcodec_£Ëù_ÿÎback
, 
	`ijkmp_g‘_w—k_thiz
(mp));

763 
LABEL_RETURN
:

764 
	`ijkmp_dec_»f_p
(&
mp
);

765 
	}
}

768 
	$IjkMedŸPÏy”_Çtive_fš®ize
(
JNIEnv
 *
’v
, 
jobjeù
 
thiz
, jobjeù 
Çme
, jobjeù 
v®ue
)

770 
	`MPTRACE
("%s\n", 
__func__
);

771 
	`IjkMedŸPÏy”_»Ëa£
(
’v
, 
thiz
);

772 
	}
}

776 
	$šjeù_ÿÎback
(*
İaque
, 
wh©
, *
d©a
, 
size_t
 
d©a_size
)

778 
JNIEnv
 *
’v
 = 
NULL
;

779 
jobjeù
 
jbundË
 = 
NULL
;

780 
»t
 = -1;

781 
	`SDL_JNI_S‘upTh»adEnv
(&
’v
);

783 
jobjeù
 
w—k_thiz
 = (jobjeùè
İaque
;

784 ià(
w—k_thiz
 =ğ
NULL
 )

785 
ç
;

786 
wh©
) {

787 
AVAPP_CTRL_WILL_HTTP_OPEN
:

788 
AVAPP_CTRL_WILL_LIVE_OPEN
:

789 
AVAPP_CTRL_WILL_CONCAT_SEGMENT_OPEN
: {

790 
AVAµIOCÚŒŞ
 *
»®_d©a
 = (AVAµIOCÚŒŞ *)
d©a
;

791 
»®_d©a
->
is_hªdËd
 = 0;

793 
jbundË
 = 
	`J4AC_BundË__BundË__ÿtchAÎ
(
’v
);

794 ià(!
jbundË
) {

795 
	`ALOGE
("%s: J4AC_BundË__BundË__ÿtchAÎ faed fÜ ca£ %d\n", 
__func__
, 
wh©
);

796 
ç
;

798 
	`J4AC_BundË__putSŒšg__w™hCSŒšg__ÿtchAÎ
(
’v
, 
jbundË
, "u¾", 
»®_d©a
->
u¾
);

799 
	`J4AC_BundË__putIÁ__w™hCSŒšg__ÿtchAÎ
(
’v
, 
jbundË
, "£gm’t_šdex", 
»®_d©a
->
£gm’t_šdex
);

800 
	`J4AC_BundË__putIÁ__w™hCSŒšg__ÿtchAÎ
(
’v
, 
jbundË
, "»Œy_couÁ”", 
»®_d©a
->
»Œy_couÁ”
);

801 
»®_d©a
->
is_hªdËd
 = 
	`J4AC_IjkMedŸPÏy”__ÚN©iveInvoke
(
’v
, 
w—k_thiz
, 
wh©
, 
jbundË
);

802 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
)) {

803 
ç
;

806 
	`J4AC_BundË__g‘SŒšg__w™hCSŒšg__asCBufãr
(
’v
, 
jbundË
, "u¾", 
»®_d©a
->
u¾
, (real_data->url));

807 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
)) {

808 
ç
;

810 
»t
 = 0;

813 
AVAPP_EVENT_WILL_HTTP_OPEN
:

814 
AVAPP_EVENT_DID_HTTP_OPEN
:

815 
AVAPP_EVENT_WILL_HTTP_SEEK
:

816 
AVAPP_EVENT_DID_HTTP_SEEK
: {

817 
AVAµH‰pEv’t
 *
»®_d©a
 = (AVAµH‰pEv’ˆ*è
d©a
;

818 
jbundË
 = 
	`J4AC_BundË__BundË__ÿtchAÎ
(
’v
);

819 ià(!
jbundË
) {

820 
	`ALOGE
("%s: J4AC_BundË__BundË__ÿtchAÎ faed fÜ ca£ %d\n", 
__func__
, 
wh©
);

821 
ç
;

823 
	`J4AC_BundË__putSŒšg__w™hCSŒšg__ÿtchAÎ
(
’v
, 
jbundË
, "u¾", 
»®_d©a
->
u¾
);

824 
	`J4AC_BundË__putLÚg__w™hCSŒšg__ÿtchAÎ
(
’v
, 
jbundË
, "off£t", 
»®_d©a
->
off£t
);

825 
	`J4AC_BundË__putIÁ__w™hCSŒšg__ÿtchAÎ
(
’v
, 
jbundË
, "”rÜ", 
»®_d©a
->
”rÜ
);

826 
	`J4AC_BundË__putIÁ__w™hCSŒšg__ÿtchAÎ
(
’v
, 
jbundË
, "h‰p_code", 
»®_d©a
->
h‰p_code
);

827 
	`J4AC_IjkMedŸPÏy”__ÚN©iveInvoke
(
’v
, 
w—k_thiz
, 
wh©
, 
jbundË
);

828 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
))

829 
ç
;

830 
»t
 = 0;

833 
AVAPP_CTRL_DID_TCP_OPEN
:

834 
AVAPP_CTRL_WILL_TCP_OPEN
: {

835 
AVAµTıIOCÚŒŞ
 *
»®_d©a
 = (AVAµTıIOCÚŒŞ *)
d©a
;

836 
jbundË
 = 
	`J4AC_BundË__BundË__ÿtchAÎ
(
’v
);

837 ià(!
jbundË
) {

838 
	`ALOGE
("%s: J4AC_BundË__BundË__ÿtchAÎ faed fÜ ca£ %d\n", 
__func__
, 
wh©
);

839 
ç
;

841 
	`J4AC_BundË__putIÁ__w™hCSŒšg__ÿtchAÎ
(
’v
, 
jbundË
, "”rÜ", 
»®_d©a
->
”rÜ
);

842 
	`J4AC_BundË__putIÁ__w™hCSŒšg__ÿtchAÎ
(
’v
, 
jbundË
, "çmy", 
»®_d©a
->
çmy
);

843 
	`J4AC_BundË__putSŒšg__w™hCSŒšg__ÿtchAÎ
(
’v
, 
jbundË
, "", 
»®_d©a
->

);

844 
	`J4AC_BundË__putIÁ__w™hCSŒšg__ÿtchAÎ
(
’v
, 
jbundË
, "pÜt", 
»®_d©a
->
pÜt
);

845 
	`J4AC_BundË__putIÁ__w™hCSŒšg__ÿtchAÎ
(
’v
, 
jbundË
, "fd", 
»®_d©a
->
fd
);

846 
	`J4AC_IjkMedŸPÏy”__ÚN©iveInvoke
(
’v
, 
w—k_thiz
, 
wh©
, 
jbundË
);

847 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
))

848 
ç
;

849 
»t
 = 0;

853 
»t
 = 0;

856 
ç
:

857 
	`SDL_JNI_D–‘eLoÿlRefP
(
’v
, &
jbundË
);

858  
»t
;

859 
	}
}

861 
boŞ
 
	$medŸcodec_£Ëù_ÿÎback
(*
İaque
, 
ijkmp_medŸcodecšfo_cÚ‹xt
 *
mcc
)

863 
JNIEnv
 *
’v
 = 
NULL
;

864 
jobjeù
 
w—k_this
 = (jobjeùè
İaque
;

865 cÚ¡ *
found_codec_Çme
 = 
NULL
;

867 ià(
JNI_OK
 !ğ
	`SDL_JNI_S‘upTh»adEnv
(&
’v
)) {

868 
	`ALOGE
("%s: S‘upTh»adEnv faed\n", 
__func__
);

872 
found_codec_Çme
 = 
	`J4AC_IjkMedŸPÏy”__ÚS–eùCodec__w™hCSŒšg__asCBufãr
(
’v
, 
w—k_this
, 
mcc
->
mime_ty³
, mcc->
´ofe
, mcc->
Ëv–
, mcc->
codec_Çme
, (mcc->codec_name));

873 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
è|| !
found_codec_Çme
) {

874 
	`ALOGE
("%s: onS–eùCodeøçed\n", 
__func__
);

875 
ç
;

878 
ç
:

879  
found_codec_Çme
;

880 
	}
}

882 
šlše
 
	$po¡_ev’t
(
JNIEnv
 *
’v
, 
jobjeù
 
w—k_this
, 
wh©
, 
¬g1
, 
¬g2
)

885 
	`J4AC_IjkMedŸPÏy”__po¡Ev’tFromN©ive
(
’v
, 
w—k_this
, 
wh©
, 
¬g1
, 
¬g2
, 
NULL
);

887 
	}
}

889 
šlše
 
	$po¡_ev’t2
(
JNIEnv
 *
’v
, 
jobjeù
 
w—k_this
, 
wh©
, 
¬g1
, 
¬g2
, jobjeù 
obj
)

892 
	`J4AC_IjkMedŸPÏy”__po¡Ev’tFromN©ive
(
’v
, 
w—k_this
, 
wh©
, 
¬g1
, 
¬g2
, 
obj
);

894 
	}
}

896 
	$mes§ge_loİ_n
(
JNIEnv
 *
’v
, 
IjkMedŸPÏy”
 *
mp
)

898 
jobjeù
 
w—k_thiz
 = (jobjeùè
	`ijkmp_g‘_w—k_thiz
(
mp
);

899 
	`JNI_CHECK_GOTO
(
w—k_thiz
, 
’v
, 
NULL
, "mpjni: mes§ge_loİ_n:‚uÎ w—k_thiz", 
LABEL_RETURN
);

902 
AVMes§ge
 
msg
;

904 
»tv®
 = 
	`ijkmp_g‘_msg
(
mp
, &
msg
, 1);

905 ià(
»tv®
 < 0)

909 
	`as£¹
(
»tv®
 > 0);

911 
msg
.
wh©
) {

912 
FFP_MSG_FLUSH
:

913 
	`MPTRACE
("FFP_MSG_FLUSH:\n");

914 
	`po¡_ev’t
(
’v
, 
w—k_thiz
, 
MEDIA_NOP
, 0, 0);

916 
FFP_MSG_ERROR
:

917 
	`MPTRACE
("FFP_MSG_ERROR: %d\n", 
msg
.
¬g1
);

918 
	`po¡_ev’t
(
’v
, 
w—k_thiz
, 
MEDIA_ERROR
, 
MEDIA_ERROR_IJK_PLAYER
, 
msg
.
¬g1
);

920 
FFP_MSG_PREPARED
:

921 
	`MPTRACE
("FFP_MSG_PREPARED:\n");

922 
	`po¡_ev’t
(
’v
, 
w—k_thiz
, 
MEDIA_PREPARED
, 0, 0);

924 
FFP_MSG_COMPLETED
:

925 
	`MPTRACE
("FFP_MSG_COMPLETED:\n");

926 
	`po¡_ev’t
(
’v
, 
w—k_thiz
, 
MEDIA_PLAYBACK_COMPLETE
, 0, 0);

928 
FFP_MSG_VIDEO_SIZE_CHANGED
:

929 
	`MPTRACE
("FFP_MSG_VIDEO_SIZE_CHANGED: %d, %d\n", 
msg
.
¬g1
, msg.
¬g2
);

930 
	`po¡_ev’t
(
’v
, 
w—k_thiz
, 
MEDIA_SET_VIDEO_SIZE
, 
msg
.
¬g1
, msg.
¬g2
);

932 
FFP_MSG_SAR_CHANGED
:

933 
	`MPTRACE
("FFP_MSG_SAR_CHANGED: %d, %d\n", 
msg
.
¬g1
, msg.
¬g2
);

934 
	`po¡_ev’t
(
’v
, 
w—k_thiz
, 
MEDIA_SET_VIDEO_SAR
, 
msg
.
¬g1
, msg.
¬g2
);

936 
FFP_MSG_VIDEO_RENDERING_START
:

937 
	`MPTRACE
("FFP_MSG_VIDEO_RENDERING_START:\n");

938 
	`po¡_ev’t
(
’v
, 
w—k_thiz
, 
MEDIA_INFO
, 
MEDIA_INFO_VIDEO_RENDERING_START
, 0);

940 
FFP_MSG_AUDIO_RENDERING_START
:

941 
	`MPTRACE
("FFP_MSG_AUDIO_RENDERING_START:\n");

942 
	`po¡_ev’t
(
’v
, 
w—k_thiz
, 
MEDIA_INFO
, 
MEDIA_INFO_AUDIO_RENDERING_START
, 0);

944 
FFP_MSG_VIDEO_ROTATION_CHANGED
:

945 
	`MPTRACE
("FFP_MSG_VIDEO_ROTATION_CHANGED: %d\n", 
msg
.
¬g1
);

946 
	`po¡_ev’t
(
’v
, 
w—k_thiz
, 
MEDIA_INFO
, 
MEDIA_INFO_VIDEO_ROTATION_CHANGED
, 
msg
.
¬g1
);

948 
FFP_MSG_BUFFERING_START
:

949 
	`MPTRACE
("FFP_MSG_BUFFERING_START:\n");

950 
	`po¡_ev’t
(
’v
, 
w—k_thiz
, 
MEDIA_INFO
, 
MEDIA_INFO_BUFFERING_START
, 0);

952 
FFP_MSG_BUFFERING_END
:

953 
	`MPTRACE
("FFP_MSG_BUFFERING_END:\n");

954 
	`po¡_ev’t
(
’v
, 
w—k_thiz
, 
MEDIA_INFO
, 
MEDIA_INFO_BUFFERING_END
, 0);

956 
FFP_MSG_BUFFERING_UPDATE
:

958 
	`po¡_ev’t
(
’v
, 
w—k_thiz
, 
MEDIA_BUFFERING_UPDATE
, 
msg
.
¬g1
, msg.
¬g2
);

960 
FFP_MSG_BUFFERING_BYTES_UPDATE
:

962 
FFP_MSG_BUFFERING_TIME_UPDATE
:

964 
FFP_MSG_SEEK_COMPLETE
:

965 
	`MPTRACE
("FFP_MSG_SEEK_COMPLETE:\n");

966 
	`po¡_ev’t
(
’v
, 
w—k_thiz
, 
MEDIA_SEEK_COMPLETE
, 0, 0);

968 
FFP_MSG_PLAYBACK_STATE_CHANGED
:

970 
FFP_MSG_TIMED_TEXT
:

971 ià(
msg
.
obj
) {

972 
j¡ršg
 
‹xt
 = (*
’v
)->
	`NewSŒšgUTF
Ónv, (*)
msg
.
obj
);

973 
	`po¡_ev’t2
(
’v
, 
w—k_thiz
, 
MEDIA_TIMED_TEXT
, 0, 0, 
‹xt
);

974 
	`J4A_D–‘eLoÿlRef__p
(
’v
, &
‹xt
);

977 
	`po¡_ev’t2
(
’v
, 
w—k_thiz
, 
MEDIA_TIMED_TEXT
, 0, 0, 
NULL
);

981 
	`ALOGE
("unknowÀFFP_MSG_xxx(%d)\n", 
msg
.
wh©
);

984 
	`msg_ä“_»s
(&
msg
);

987 
LABEL_RETURN
:

989 
	}
}

991 
	$mes§ge_loİ
(*
¬g
)

993 
	`MPTRACE
("%s\n", 
__func__
);

995 
JNIEnv
 *
’v
 = 
NULL
;

996 (*
g_jvm
)->
	`A‰achCu¼’tTh»ad
(g_jvm, &
’v
, 
NULL
 );

998 
IjkMedŸPÏy”
 *
mp
 = (IjkMedŸPÏy”*è
¬g
;

999 
	`JNI_CHECK_GOTO
(
mp
, 
’v
, 
NULL
, "mpjni:‚©ive_mes§ge_loİ:‚uÎ mp", 
LABEL_RETURN
);

1001 
	`mes§ge_loİ_n
(
’v
, 
mp
);

1003 
LABEL_RETURN
:

1004 
	`ijkmp_dec_»f_p
(&
mp
);

1005 (*
g_jvm
)->
	`D‘achCu¼’tTh»ad
(g_jvm);

1007 
	`MPTRACE
("message_loopƒxit");

1009 
	}
}

1012 
mÚ¡¬tup
(cÚ¡ *
libÇme
);

1013 
mÚş—nup
();

1016 
	$IjkMedŸPÏy”_Çtive_´ofeBegš
(
JNIEnv
 *
’v
, 
jşass
 
şazz
, 
j¡ršg
 
libName
)

1018 
	`MPTRACE
("%s\n", 
__func__
);

1020 cÚ¡ *
c_lib_Çme
 = 
NULL
;

1021 
s_mÚ¡¬tup
 = 0;

1023 ià(!
libName
)

1026 ià(
s_mÚ¡¬tup
) {

1027 
	`ALOGW
("monstartup‡lready called\b");

1031 
c_lib_Çme
 = (*
’v
)->
	`G‘SŒšgUTFCh¬s
Ónv, 
libName
, 
NULL
 );

1032 
	`JNI_CHECK_GOTO
(
c_lib_Çme
, 
’v
, "java/Ïng/OutOfMemÜyE¼Ü", "mpjni: mÚ¡¬tup:†ibName.¡ršg oom", 
LABEL_RETURN
);

1034 
s_mÚ¡¬tup
 = 1;

1035 
	`mÚ¡¬tup
(
c_lib_Çme
);

1036 
	`ALOGD
("mÚ¡¬tup: %s\n", 
c_lib_Çme
);

1038 
LABEL_RETURN
:

1039 ià(
c_lib_Çme
)

1040 (*
’v
)->
	`R–—£SŒšgUTFCh¬s
Ónv, 
libName
, 
c_lib_Çme
);

1041 
	}
}

1044 
	$IjkMedŸPÏy”_Çtive_´ofeEnd
(
JNIEnv
 *
’v
, 
jşass
 
şazz
)

1046 
	`MPTRACE
("%s\n", 
__func__
);

1047 
s_mÚş—nup
 = 0;

1049 ià(
s_mÚş—nup
) {

1050 
	`ALOGW
("moncleanu‡lready called\b");

1054 
s_mÚş—nup
 = 1;

1055 
	`mÚş—nup
();

1056 
	`ALOGD
("moncleanup\n");

1057 
	}
}

1060 
	$IjkMedŸPÏy”_Çtive_£tLogLev–
(
JNIEnv
 *
’v
, 
jşass
 
şazz
, 
jšt
 
Ëv–
)

1062 
	`MPTRACE
("%s(%d)\n", 
__func__
, 
Ëv–
);

1063 
	`ijkmp_glob®_£t_log_Ëv–
(
Ëv–
);

1064 
	`ALOGD
("moncleanup\n");

1065 
	}
}

1072 
JNIN©iveM‘hod
 
	gg_m‘hods
[] = {

1076 (*è
IjkMedŸPÏy”_£tD©aSourûAndH—d”s


1078 { "_£tD©aSourûFd", "(I)V", (*è
IjkMedŸPÏy”_£tD©aSourûFd
 },

1079 { "_£tD©aSourû", "(Ltv/dªmaku/ijk/medŸ/¶ay”/misc/IMedŸD©aSourû;)V", (*)
IjkMedŸPÏy”_£tD©aSourûC®lback
 },

1080 { "_£tD©aSourûIjkIOH‰p", "(Ltv/dªmaku/ijk/medŸ/¶ay”/misc/IIjkIOH‰p;)V", (*)
IjkMedŸPÏy”_£tD©aSourûIjkIOH‰pC®lback
 },

1082 { "_£tVideoSurçû", "(Lªdroid/v›w/Surçû;)V", (*è
IjkMedŸPÏy”_£tVideoSurçû
 },

1083 { "_´•¬eAsync", "()V", (*è
IjkMedŸPÏy”_´•¬eAsync
 },

1084 { "_¡¬t", "()V", (*è
IjkMedŸPÏy”_¡¬t
 },

1085 { "_¡İ", "()V", (*è
IjkMedŸPÏy”_¡İ
 },

1086 { "£ekTo", "(J)V", (*è
IjkMedŸPÏy”_£ekTo
 },

1087 { "_·u£", "()V", (*è
IjkMedŸPÏy”_·u£
 },

1088 { "isPÏyšg", "()Z", (*è
IjkMedŸPÏy”_isPÏyšg
 },

1089 { "g‘Cu¼’tPos™iÚ", "()J", (*è
IjkMedŸPÏy”_g‘Cu¼’tPos™iÚ
 },

1090 { "g‘Du¿tiÚ", "()J", (*è
IjkMedŸPÏy”_g‘Du¿tiÚ
 },

1091 { "_»Ëa£", "()V", (*è
IjkMedŸPÏy”_»Ëa£
 },

1092 { "_»£t", "()V", (*è
IjkMedŸPÏy”_»£t
 },

1093 { "£tVŞume", "(FF)V", (*è
IjkMedŸPÏy”_£tVŞume
 },

1094 { "g‘AudioSessiÚId", "()I", (*è
IjkMedŸPÏy”_g‘AudioSessiÚId
 },

1095 { "Çtive_š™", "()V", (*è
IjkMedŸPÏy”_Çtive_š™
 },

1096 { "Çtive_£tup", "(Ljava/Ïng/Objeù;)V", (*è
IjkMedŸPÏy”_Çtive_£tup
 },

1097 { "Çtive_fš®ize", "()V", (*è
IjkMedŸPÏy”_Çtive_fš®ize
 },

1099 { "_£tO±iÚ", "(ILjava/Ïng/SŒšg;Ljava/Ïng/SŒšg;)V", (*è
IjkMedŸPÏy”_£tO±iÚ
 },

1100 { "_£tO±iÚ", "(ILjava/Ïng/SŒšg;J)V", (*è
IjkMedŸPÏy”_£tO±iÚLÚg
 },

1102 { "_g‘CŞÜFÜm©Name", "(I)Ljava/Ïng/SŒšg;", (*è
IjkMedŸPÏy”_g‘CŞÜFÜm©Name
 },

1103 { "_g‘VideoCodecInfo", "()Ljava/Ïng/SŒšg;", (*è
IjkMedŸPÏy”_g‘VideoCodecInfo
 },

1104 { "_g‘AudioCodecInfo", "()Ljava/Ïng/SŒšg;", (*è
IjkMedŸPÏy”_g‘AudioCodecInfo
 },

1105 { "_g‘MedŸM‘a", "()Lªdroid/os/BundË;", (*è
IjkMedŸPÏy”_g‘MedŸM‘a
 },

1106 { "_£tLoİCouÁ", "(I)V", (*è
IjkMedŸPÏy”_£tLoİCouÁ
 },

1107 { "_g‘LoİCouÁ", "()I", (*è
IjkMedŸPÏy”_g‘LoİCouÁ
 },

1108 { "_g‘Prİ”tyFlßt", "(IF)F", (*è
ijkMedŸPÏy”_g‘Prİ”tyFlßt
 },

1109 { "_£tPrİ”tyFlßt", "(IF)V", (*è
ijkMedŸPÏy”_£tPrİ”tyFlßt
 },

1110 { "_g‘Prİ”tyLÚg", "(IJ)J", (*è
ijkMedŸPÏy”_g‘Prİ”tyLÚg
 },

1111 { "_£tPrİ”tyLÚg", "(IJ)V", (*è
ijkMedŸPÏy”_£tPrİ”tyLÚg
 },

1112 { "_£tSŒ—mS–eùed", "(IZ)V", (*è
ijkMedŸPÏy”_£tSŒ—mS–eùed
 },

1114 { "Çtive_´ofeBegš", "(Ljava/Ïng/SŒšg;)V", (*è
IjkMedŸPÏy”_Çtive_´ofeBegš
 },

1115 { "Çtive_´ofeEnd", "()V", (*è
IjkMedŸPÏy”_Çtive_´ofeEnd
 },

1117 { "Çtive_£tLogLev–", "(I)V", (*è
IjkMedŸPÏy”_Çtive_£tLogLev–
 },

1120 
JNIEXPORT
 
jšt
 
	$JNI_OnLßd
(
JavaVM
 *
vm
, *
»£rved
)

1122 
JNIEnv
* 
’v
 = 
NULL
;

1124 
g_jvm
 = 
vm
;

1125 ià((*
vm
)->
	`G‘Env
(vm, (**è&
’v
, 
JNI_VERSION_1_4
è!ğ
JNI_OK
) {

1128 
	`as£¹
(
’v
 !ğ
NULL
);

1130 
	`±h»ad_mu‹x_š™
(&
g_şazz
.
mu‹x
, 
NULL
 );

1133 
	`IJK_FIND_JAVA_CLASS
(
’v
, 
g_şazz
.
şazz
, 
JNI_CLASS_IJKPLAYER
);

1134 (*
’v
)->
	`Regi¡”N©ives
Ónv, 
g_şazz
.
şazz
, 
g_m‘hods
, 
	`NELEM
(g_methods) );

1136 
	`ijkmp_glob®_š™
();

1137 
	`ijkmp_glob®_£t_šjeù_ÿÎback
(
šjeù_ÿÎback
);

1139 
	`FFm³gApi_glob®_š™
(
’v
);

1141  
JNI_VERSION_1_4
;

1142 
	}
}

1144 
JNIEXPORT
 
	$JNI_OnUÆßd
(
JavaVM
 *
jvm
, *
»£rved
)

1146 
	`ijkmp_glob®_unš™
();

1148 
	`±h»ad_mu‹x_de¡roy
(&
g_şazz
.
mu‹x
);

1149 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/pipeline/ffpipeline_android.c

24 
	~"få–še_ªdroid.h
"

25 
	~<jni.h
>

26 
	~"få’ode_ªdroid_medŸcodec_vdec.h
"

27 
	~"../../p–še/få’ode_fåÏy_vdec.h
"

28 
	~"../../ff_fåÏy.h
"

29 
	~"ijksdl/ªdroid/ijksdl_ªdroid_jni.h
"

30 
	~"ijksdl/ªdroid/ijksdl_ªdroid.h
"

32 
SDL_CÏss
 
	gg_p–še_şass
 = {

33 .
Çme
 = "ffpipeline_android_media",

36 
	sIJKFF_P–še_O·que
 {

37 
FFPÏy”
 *
	mfå
;

38 
SDL_mu‹x
 *
	msurçû_mu‹x
;

39 
jobjeù
 
	mjsurçû
;

40 vŞ©
boŞ
 
	mis_surçû_Ãed_»cÚfigu»
;

42 
boŞ
 (*
medŸcodec_£Ëù_ÿÎback
)(*
	mİaque
, 
ijkmp_medŸcodecšfo_cÚ‹xt
 *
	mmcc
);

43 *
	mmedŸcodec_£Ëù_ÿÎback_İaque
;

45 
SDL_Vout
 *
	mw—k_vout
;

47 
	mËá_vŞume
;

48 
	mright_vŞume
;

49 } 
	tIJKFF_P–še_O·que
;

51 
	$func_de¡roy
(
IJKFF_P–še
 *
p–še
)

53 
IJKFF_P–še_O·que
 *
İaque
 = 
p–še
->opaque;

54 
JNIEnv
 *
’v
 = 
NULL
;

56 
	`SDL_De¡royMu‹xP
(&
İaque
->
surçû_mu‹x
);

58 ià(
JNI_OK
 !ğ
	`SDL_JNI_S‘upTh»adEnv
(&
’v
)) {

59 
	`ALOGE
("amediacodec-pipeline:destroy: SetupThreadEnv failed\n");

60 
ç
;

63 
	`SDL_JNI_D–‘eGlob®RefP
(
’v
, &
İaque
->
jsurçû
);

64 
ç
:

66 
	}
}

68 
IJKFF_P’ode
 *
	$func_İ’_video_decod”
(
IJKFF_P–še
 *
p–še
, 
FFPÏy”
 *
få
)

70 
IJKFF_P–še_O·que
 *
İaque
 = 
p–še
->opaque;

71 
IJKFF_P’ode
 *
node
 = 
NULL
;

73 ià(
få
->
medŸcodec_®l_videos
 || få->
medŸcodec_avc
 || få->
medŸcodec_hevc
 || få->
medŸcodec_m³g2
)

74 
node
 = 
	`få’ode_ü—‹_video_decod”_äom_ªdroid_medŸcodec
(
få
, 
p–še
, 
İaque
->
w—k_vout
);

75 ià(!
node
) {

76 
node
 = 
	`få’ode_ü—‹_video_decod”_äom_fåÏy
(
få
);

79  
node
;

80 
	}
}

82 
SDL_Aout
 *
	$func_İ’_audio_ouut
(
IJKFF_P–še
 *
p–še
, 
FFPÏy”
 *
få
)

84 
SDL_Aout
 *
aout
 = 
NULL
;

85 ià(
få
->
İ’¦es
) {

86 
aout
 = 
	`SDL_AoutAndroid_C»©eFÜO³nSLES
();

88 
aout
 = 
	`SDL_AoutAndroid_C»©eFÜAudioT¿ck
();

90 ià(
aout
)

91 
	`SDL_AoutS‘S‹»oVŞume
(
aout
, 
p–še
->
İaque
->
Ëá_vŞume
,…–še->İaque->
right_vŞume
);

92  
aout
;

93 
	}
}

96 
šlše
 
boŞ
 
	$check_få–še
(
IJKFF_P–še
* 
p–še
, cÚ¡ *
func_Çme
)

98 ià(!
p–še
 || !p–še->
İaque
 || !p–še->
İaque_şass
) {

99 
	`ALOGE
("%s.%s: inv®id…–še\n", 
p–še
->
İaque_şass
->
Çme
, 
func_Çme
);

100  
çl£
;

103 ià(
p–še
->
İaque_şass
 !ğ&
g_p–še_şass
) {

104 
	`ALOGE
("%s.%s: unsuµÜ‹d m‘hod\n", 
p–še
->
İaque_şass
->
Çme
, 
func_Çme
);

105  
çl£
;

108  
Œue
;

109 
	}
}

111 
IJKFF_P–še
 *
	$få–še_ü—‹_äom_ªdroid
(
FFPÏy”
 *
få
)

113 
	`ALOGD
("ffpipeline_create_from_android()\n");

114 
IJKFF_P–še
 *
p–še
 = 
	`få–še_®loc
(&
g_p–še_şass
, (
IJKFF_P–še_O·que
));

115 ià(!
p–še
)

116  
p–še
;

118 
IJKFF_P–še_O·que
 *
İaque
 = 
p–še
->opaque;

119 
İaque
->
få
 = ffp;

120 
İaque
->
surçû_mu‹x
 = 
	`SDL_C»©eMu‹x
();

121 
İaque
->
Ëá_vŞume
 = 1.0f;

122 
İaque
->
right_vŞume
 = 1.0f;

123 ià(!
İaque
->
surçû_mu‹x
) {

124 
	`ALOGE
("ffpipeline-android:create SDL_CreateMutex failed\n");

125 
ç
;

128 
p–še
->
func_de¡roy
 = func_destroy;

129 
p–še
->
func_İ’_video_decod”
 = func_open_video_decoder;

130 
p–še
->
func_İ’_audio_ouut
 = func_open_audio_output;

132  
p–še
;

133 
ç
:

134 
	`få–še_ä“_p
(&
p–še
);

135  
NULL
;

136 
	}
}

138 
	$få–še_lock_surçû
(
IJKFF_P–še
* 
p–še
)

140 
IJKFF_P–še_O·que
 *
İaque
 = 
p–še
->opaque;

141  
	`SDL_LockMu‹x
(
İaque
->
surçû_mu‹x
);

142 
	}
}

144 
	$få–še_uÆock_surçû
(
IJKFF_P–še
* 
p–še
)

146 
IJKFF_P–še_O·que
 *
İaque
 = 
p–še
->opaque;

147  
	`SDL_UÆockMu‹x
(
İaque
->
surçû_mu‹x
);

148 
	}
}

150 
jobjeù
 
	$få–še_g‘_surçû_as_glob®_»f_l
(
JNIEnv
 *
’v
, 
IJKFF_P–še
* 
p–še
)

152 ià(!
	`check_få–še
(
p–še
, 
__func__
))

153  
NULL
;

155 
IJKFF_P–še_O·que
 *
İaque
 = 
p–še
->opaque;

156 ià(!
İaque
->
surçû_mu‹x
)

157  
NULL
;

159 
jobjeù
 
glob®_»f
 = 
NULL
;

160 ià(
İaque
->
jsurçû
)

161 
glob®_»f
 = (*
’v
)->
	`NewGlob®Ref
Ónv, 
İaque
->
jsurçû
);

163  
glob®_»f
;

164 
	}
}

166 
jobjeù
 
	$få–še_g‘_surçû_as_glob®_»f
(
JNIEnv
 *
’v
, 
IJKFF_P–še
* 
p–še
)

168 
	`få–še_lock_surçû
(
p–še
);

169 
jobjeù
 
Ãw_surçû
 = 
	`få–še_g‘_surçû_as_glob®_»f_l
(
’v
, 
p–še
);

170 
	`få–še_uÆock_surçû
(
p–še
);

171  
Ãw_surçû
;

172 
	}
}

174 
	$få–še_£t_vout
(
IJKFF_P–še
* 
p–še
, 
SDL_Vout
 *
vout
)

176 ià(!
	`check_få–še
(
p–še
, 
__func__
))

179 
IJKFF_P–še_O·que
 *
İaque
 = 
p–še
->opaque;

180 
İaque
->
w—k_vout
 = 
vout
;

181 
	}
}

183 
	$få–še_£t_surçû
(
JNIEnv
 *
’v
, 
IJKFF_P–še
* 
p–še
, 
jobjeù
 
surçû
)

185 
	`ALOGD
("%s()\n", 
__func__
);

186 ià(!
	`check_få–še
(
p–še
, 
__func__
))

189 
IJKFF_P–še_O·que
 *
İaque
 = 
p–še
->opaque;

190 ià(!
İaque
->
surçû_mu‹x
)

193 
	`få–še_lock_surçû
(
p–še
);

195 
jobjeù
 
´ev_surçû
 = 
İaque
->
jsurçû
;

197 ià((
surçû
 =ğ
´ev_surçû
) ||

198 (
surçû
 && 
´ev_surçû
 && (*
’v
)->
	`IsSameObjeù
(env, surface,…rev_surface))) {

201 
	`SDL_VoutAndroid_£tAMedŸCodec
(
İaque
->
w—k_vout
, 
NULL
);

202 ià(
surçû
) {

203 
İaque
->
jsurçû
 = (*
’v
)->
	`NewGlob®Ref
Ónv, 
surçû
);

205 
İaque
->
jsurçû
 = 
NULL
;

207 
İaque
->
is_surçû_Ãed_»cÚfigu»
 = 
Œue
;

209 ià(
´ev_surçû
 !ğ
NULL
) {

210 
	`SDL_JNI_D–‘eGlob®RefP
(
’v
, &
´ev_surçû
);

214 
	`få–še_uÆock_surçû
(
p–še
);

217 
	}
}

219 
boŞ
 
	$få–še_is_surçû_Ãed_»cÚfigu»_l
(
IJKFF_P–še
* 
p–še
)

221 ià(!
	`check_få–še
(
p–še
, 
__func__
))

222  
çl£
;

224  
p–še
->
İaque
->
is_surçû_Ãed_»cÚfigu»
;

225 
	}
}

227 
	$få–še_£t_surçû_Ãed_»cÚfigu»_l
(
IJKFF_P–še
* 
p–še
, 
boŞ
 
Ãed_»cÚfigu»
)

229 
	`ALOGD
("%s(%d)\n", 
__func__
, ()
Ãed_»cÚfigu»
);

230 ià(!
	`check_få–še
(
p–še
, 
__func__
))

233 
p–še
->
İaque
->
is_surçû_Ãed_»cÚfigu»
 = 
Ãed_»cÚfigu»
;

234 
	}
}

236 
få–še_£t_medŸcodec_£Ëù_ÿÎback
(
IJKFF_P–še
* 
p–še
, 
	$boŞ
 (*
ÿÎback
)(*
İaque
, 
ijkmp_medŸcodecšfo_cÚ‹xt
 *
mcc
), *opaque)

238 
	`ALOGD
("%s\n", 
__func__
);

239 ià(!
	`check_få–še
(
p–še
, 
__func__
))

242 
p–še
->
İaque
->
medŸcodec_£Ëù_ÿÎback
 = 
ÿÎback
;

243 
p–še
->
İaque
->
medŸcodec_£Ëù_ÿÎback_İaque
 = opaque;

244 
	}
}

246 
boŞ
 
	$få–še_£Ëù_medŸcodec_l
(
IJKFF_P–še
* 
p–še
, 
ijkmp_medŸcodecšfo_cÚ‹xt
 *
mcc
)

248 
	`ALOGD
("%s\n", 
__func__
);

249 ià(!
	`check_få–še
(
p–še
, 
__func__
))

250  
çl£
;

252 ià(!
mcc
 || !
p–še
->
İaque
->
medŸcodec_£Ëù_ÿÎback
)

253  
çl£
;

255  
p–še
->
İaque
->
	`medŸcodec_£Ëù_ÿÎback
Õ–še->İaque->
medŸcodec_£Ëù_ÿÎback_İaque
, 
mcc
);

256 
	}
}

258 
	$få–še_£t_vŞume
(
IJKFF_P–še
* 
p–še
, 
Ëá
, 
right
)

260 
	`ALOGD
("%s\n", 
__func__
);

261 ià(!
	`check_få–še
(
p–še
, 
__func__
))

264 
IJKFF_P–še_O·que
 *
İaque
 = 
p–še
->opaque;

265 
İaque
->
Ëá_vŞume
 = 
Ëá
;

266 
İaque
->
right_vŞume
 = 
right
;

268 ià(
İaque
->
få
 && o·que->få->
aout
) {

269 
	`SDL_AoutS‘S‹»oVŞume
(
İaque
->
få
->
aout
, 
Ëá
, 
right
);

271 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/pipeline/ffpipeline_android.h

24 #iâdeà
FFPLAY__FF_FFPIPELINE_ANDROID_H


25 
	#FFPLAY__FF_FFPIPELINE_ANDROID_H


	)

27 
	~<¡dboŞ.h
>

28 
	~<jni.h
>

29 
	~"../ijk¶ay”_ªdroid_def.h
"

30 
	~"../../ff_få–še.h
"

31 
	~"ijksdl/ijksdl_vout.h
"

33 
FFPÏy”
 
	tFFPÏy”
;

34 
IJKFF_P–še
 
	tIJKFF_P–še
;

36 
IJKFF_P–še
 *
få–še_ü—‹_äom_ªdroid
(
FFPÏy”
 *
få
);

38 
få–še_£t_vout
(
IJKFF_P–še
* 
p–še
, 
SDL_Vout
 *
vout
);

40 
få–še_£t_surçû
(
JNIEnv
 *
’v
, 
IJKFF_P–še
* 
p–še
, 
jobjeù
 
surçû
);

42 
få–še_lock_surçû
(
IJKFF_P–še
* 
p–še
);

43 
få–še_uÆock_surçû
(
IJKFF_P–še
* 
p–še
);

44 
jobjeù
 
få–še_g‘_surçû_as_glob®_»f_l
(
JNIEnv
 *
’v
, 
IJKFF_P–še
* 
p–še
);

45 
jobjeù
 
få–še_g‘_surçû_as_glob®_»f
(
JNIEnv
 *
’v
, 
IJKFF_P–še
* 
p–še
);

47 
boŞ
 
få–še_is_surçû_Ãed_»cÚfigu»_l
(
IJKFF_P–še
* 
p–še
);

48 
få–še_£t_surçû_Ãed_»cÚfigu»_l
(
IJKFF_P–še
* 
p–še
, 
boŞ
 
Ãed_»cÚfigu»
);

50 
få–še_£t_medŸcodec_£Ëù_ÿÎback
(
IJKFF_P–še
* 
p–še
, 
	$boŞ
 (*
ÿÎback
)(*
İaque
, 
ijkmp_medŸcodecšfo_cÚ‹xt
 *
mcc
), *opaque);

51 
boŞ
 
	`få–še_£Ëù_medŸcodec_l
(
IJKFF_P–še
* 
p–še
, 
ijkmp_medŸcodecšfo_cÚ‹xt
 *
mcc
);

53 
	`få–še_£t_vŞume
(
IJKFF_P–še
* 
p–še
, 
Ëá
, 
right
);

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/pipeline/ffpipenode_android_mediacodec_vdec.c

24 
	~"få’ode_ªdroid_medŸcodec_vdec.h
"

25 
	~"ijksdl/ªdroid/ijksdl_ªdroid_jni.h
"

26 
	~"ijksdl/ªdroid/ijksdl_codec_ªdroid_medŸfÜm©_java.h
"

27 
	~"ijksdl/ªdroid/ijksdl_codec_ªdroid_medŸcodec_java.h
"

28 
	~"ijksdl/ªdroid/ijksdl_codec_ªdroid_medŸcodec_dummy.h
"

29 
	~"ijksdl/ªdroid/ijksdl_vout_ªdroid_Çtivewšdow.h
"

30 
	~"ijksdl/ªdroid/ijksdl_vout_ov”Ïy_ªdroid_medŸcodec.h
"

31 
	~"ijk¶ay”/ff_få’ode.h
"

32 
	~"ijk¶ay”/ff_fåÏy.h
"

33 
	~"ijk¶ay”/ff_fåÏy_debug.h
"

34 
	~"h264_Çl.h
"

35 
	~"hevc_Çl.h
"

36 
	~"m³g4_esds.h
"

37 
	~"få–še_ªdroid.h
"

39 
	#AMC_USE_AVBITSTREAM_FILTER
 0

	)

40 #iâdeà
AMCTRACE


42 
	#AMCTRACE
 
ALOGE


	)

45 
	#AMC_INPUT_TIMEOUT_US
 (100 * 1000)

	)

46 
	#AMC_OUTPUT_TIMEOUT_US
 (100 * 1000)

	)

48 
	#MAX_FAKE_FRAMES
 (2)

	)

50 
	sAMC_Buf_Out
 {

51 
	mpÜt
;

52 
	macodec_£rŸl
;

53 
SDL_AMedŸCodecBufãrInfo
 
	mšfo
;

54 
	m±s
;

55 } 
	tAMC_Buf_Out
;

57 
	sIJKFF_P’ode_O·que
 {

58 
FFPÏy”
 *
	mfå
;

59 
IJKFF_P–še
 *
	mp–še
;

60 
Decod”
 *
	mdecod”
;

61 
SDL_Vout
 *
	mw—k_vout
;

63 
ijkmp_medŸcodecšfo_cÚ‹xt
 
	mmcc
;

65 
jobjeù
 
	mjsurçû
;

66 
SDL_AMedŸFÜm©
 *
	mšput_afÜm©
;

67 
SDL_AMedŸCodec
 *
	macodec
;

68 
SDL_AMedŸFÜm©
 *
	mouut_afÜm©
;

69 
	macodec_Çme
[128];

70 
	mäame_width
;

71 
	mäame_height
;

72 
	mäame_rÙ©e_deg»es
;

74 
AVCodecCÚ‹xt
 *
	mavùx
;

75 
AVCodecP¬am‘”s
 *
	mcodeı¬
;

76 
AVB™SŒ—mF‹rCÚ‹xt
 *
	mbsfc
;

78 #ià
AMC_USE_AVBITSTREAM_FILTER


79 
ušt8_t
 *
	mÜig_exŒad©a
;

80 
	mÜig_exŒad©a_size
;

82 
size_t
 
	mÇl_size
;

85 
SDL_Th»ad
 
	m_’queue_th»ad
;

86 
SDL_Th»ad
 *
	m’queue_th»ad
;

88 
SDL_mu‹x
 *
	macodec_mu‹x
;

89 
SDL_cÚd
 *
	macodec_cÚd
;

91 vŞ©
boŞ
 
	macodec_æush_»que¡
;

92 vŞ©
boŞ
 
	macodec_»cÚfigu»_»que¡
;

94 
SDL_mu‹x
 *
	macodec_fœ¡_dequeue_ouut_mu‹x
;

95 
SDL_cÚd
 *
	macodec_fœ¡_dequeue_ouut_cÚd
;

96 vŞ©
boŞ
 
	macodec_fœ¡_dequeue_ouut_»que¡
;

97 
boŞ
 
	mafÜm©_Ãed_»ü—‹
;

99 
SDL_mu‹x
 *
	mªy_šput_mu‹x
;

100 
SDL_cÚd
 *
	mªy_šput_cÚd
;

102 
	mšput_·ck‘_couÁ
;

103 
	mšput_”rÜ_couÁ
;

104 
	mouut_”rÜ_couÁ
;

106 
boŞ
 
	mquœk_»cÚfigu»_w™h_Ãw_codec
;

108 
	mn_buf_out
;

109 
AMC_Buf_Out
 *
	mamc_buf_out
;

110 
	moff_buf_out
;

111 
	mÏ¡_queued_±s
;

113 
SDL_S³edSam¶”
 
	m§m¶”
;

114 vŞ©
boŞ
 
	mabÜt
;

115 } 
	tIJKFF_P’ode_O·que
;

117 
SDL_AMedŸCodec
 *
	$ü—‹_codec_l
(
JNIEnv
 *
’v
, 
IJKFF_P’ode
 *
node
)

119 
IJKFF_P’ode_O·que
 *
İaque
 = 
node
->opaque;

120 
ijkmp_medŸcodecšfo_cÚ‹xt
 *
mcc
 = &
İaque
->mcc;

121 
SDL_AMedŸCodec
 *
acodec
 = 
NULL
;

123 ià(
İaque
->
jsurçû
 =ğ
NULL
) {

125 
acodec
 = 
	`SDL_AMedŸCodecDummy_ü—‹
();

127 
acodec
 = 
	`SDL_AMedŸCodecJava_ü—‹ByCodecName
(
’v
, 
mcc
->
codec_Çme
);

128 ià(
acodec
) {

129 
	`¡ºıy
(
İaque
->
acodec_Çme
, 
mcc
->
codec_Çme
, (opaque->acodec_name) / (*opaque->acodec_name));

130 
İaque
->
acodec_Çme
[(opaque->acodec_name) / (*opaque->acodec_name) - 1] = 0;

135 ià(!
acodec
)

136 
acodec
 = 
	`SDL_AMedŸCodecJava_ü—‹Decod”ByTy³
(
’v
, 
mcc
->
mime_ty³
);

139 ià(
acodec
) {

141 
İaque
->
quœk_»cÚfigu»_w™h_Ãw_codec
 = 
Œue
;

148 ià(0 =ğ
	`¡ºÿ£cmp
(
mcc
->
codec_Çme
, "OMX.TI.DUCATI1.", 15)) {

150 
İaque
->
n_buf_out
 = 1;

151 
	`ALOGD
("usšg bufã»d ouuˆfÜ %s", 
mcc
->
codec_Çme
);

155 ià(
İaque
->
äame_rÙ©e_deg»es
 == 90 || opaque->frame_rotate_degrees == 270) {

156 
İaque
->
äame_width
 = o·que->
codeı¬
->
height
;

157 
İaque
->
äame_height
 = o·que->
codeı¬
->
width
;

159 
İaque
->
äame_width
 = o·que->
codeı¬
->
width
;

160 
İaque
->
äame_height
 = o·que->
codeı¬
->
height
;

163  
acodec
;

164 
	}
}

166 
	$»ü—‹_fÜm©_l
(
JNIEnv
 *
’v
, 
IJKFF_P’ode
 *
node
)

168 
IJKFF_P’ode_O·que
 *
İaque
 = 
node
->opaque;

169 
FFPÏy”
 *
få
 = 
İaque
->ffp;

170 
rÙ©e_deg»es
 = 0;

172 
	`ALOGI
("AMedŸFÜm©: %s, %dx%d\n", 
İaque
->
mcc
.
mime_ty³
, o·que->
codeı¬
->
width
, o·que->codeı¬->
height
);

173 
	`SDL_AMedŸFÜm©_d–‘eP
(&
İaque
->
ouut_afÜm©
);

174 
İaque
->
šput_afÜm©
 = 
	`SDL_AMedŸFÜm©Java_ü—‹VideoFÜm©
(
’v
, o·que->
mcc
.
mime_ty³
, o·que->
codeı¬
->
width
, o·que->codeı¬->
height
);

175 ià(
İaque
->
codeı¬
->
exŒad©a
 && o·que->codeı¬->
exŒad©a_size
 > 0) {

176 ià((
İaque
->
codeı¬
->
codec_id
 =ğ
AV_CODEC_ID_H264
 && o·que->codeı¬->
exŒad©a
[0] == 1)

177 || (
İaque
->
codeı¬
->
codec_id
 =ğ
AV_CODEC_ID_HEVC
 && o·que->codeı¬->
exŒad©a_size
 > 3

178 && (
İaque
->
codeı¬
->
exŒad©a
[0] == 1 || opaque->codecpar->extradata[1] == 1))) {

179 #ià
AMC_USE_AVBITSTREAM_FILTER


180 ià(
İaque
->
codeı¬
->
codec_id
 =ğ
AV_CODEC_ID_H264
) {

181 
İaque
->
bsfc
 = 
	`av_b™¡»am_f‹r_š™
("h264_mp4toannexb");

182 ià(!
İaque
->
bsfc
) {

183 
	`ALOGE
("Cannot openhe h264_mp4toannexb BSF!\n");

184 
ç
;

187 
İaque
->
bsfc
 = 
	`av_b™¡»am_f‹r_š™
("hevc_mp4toannexb");

188 ià(!
İaque
->
bsfc
) {

189 
	`ALOGE
("Cannot openhe hevc_mp4toannexb BSF!\n");

190 
ç
;

194 
İaque
->
Üig_exŒad©a_size
 = o·que->
codeı¬
->
exŒad©a_size
;

195 
İaque
->
Üig_exŒad©a
 = (
ušt8_t
*è
	`av_m®locz
(İaque->
codeı¬
->
exŒad©a_size
 + 
FF_INPUT_BUFFER_PADDING_SIZE
);

196 ià(!
İaque
->
Üig_exŒad©a
) {

197 
ç
;

199 
	`memıy
(
İaque
->
Üig_exŒad©a
, o·que->
codeı¬
->
exŒad©a
, o·que->codeı¬->
exŒad©a_size
);

200 
i
 = 0; i < 
İaque
->
codeı¬
->
exŒad©a_size
; i+=4) {

201 
	`ALOGE
("csd-0[%d]: %02x%02x%02x%02x\n", 
İaque
->
codeı¬
->
exŒad©a_size
, ()İaque->codeı¬->
exŒad©a
[
i
+0], ()opaque->codecpar->extradata[i+1], ()opaque->codecpar->extradata[i+2], ()opaque->codecpar->extradata[i+3]);

203 
	`SDL_AMedŸFÜm©_£tBufãr
(
İaque
->
šput_afÜm©
, "csd-0", o·que->
codeı¬
->
exŒad©a
, o·que->codeı¬->
exŒad©a_size
);

205 
size_t
 
¥s_µs_size
 = 0;

206 
size_t
 
cÚv”t_size
 = 
İaque
->
codeı¬
->
exŒad©a_size
 + 20;

207 
ušt8_t
 *
cÚv”t_bufãr
 = (ušt8_ˆ*)
	`ÿÎoc
(1, 
cÚv”t_size
);

208 ià(!
cÚv”t_bufãr
) {

209 
	`ALOGE
("%s:¥s_µs_bufãr:‡Îoøçed\n", 
__func__
);

210 
ç
;

212 ià(
İaque
->
codeı¬
->
codec_id
 =ğ
AV_CODEC_ID_H264
) {

213 ià(0 !ğ
	`cÚv”t_¥s_µs
(
İaque
->
codeı¬
->
exŒad©a
, o·que->codeı¬->
exŒad©a_size
,

214 
cÚv”t_bufãr
, 
cÚv”t_size
,

215 &
¥s_µs_size
, &
İaque
->
Çl_size
)) {

216 
	`ALOGE
("%s:cÚv”t_¥s_µs: faed\n", 
__func__
);

217 
ç
;

220 ià(0 !ğ
	`cÚv”t_hevc_Çl_un™s
(
İaque
->
codeı¬
->
exŒad©a
, o·que->codeı¬->
exŒad©a_size
,

221 
cÚv”t_bufãr
, 
cÚv”t_size
,

222 &
¥s_µs_size
, &
İaque
->
Çl_size
)) {

223 
	`ALOGE
("%s:cÚv”t_hevc_Çl_un™s: faed\n", 
__func__
);

224 
ç
;

227 
	`SDL_AMedŸFÜm©_£tBufãr
(
İaque
->
šput_afÜm©
, "csd-0", 
cÚv”t_bufãr
, 
¥s_µs_size
);

228 
i
 = 0; i < 
¥s_µs_size
; i+=4) {

229 
	`ALOGE
("csd-0[%d]: %02x%02x%02x%02x\n", ()
¥s_µs_size
, ()
cÚv”t_bufãr
[
i
+0], ()convert_buffer[i+1], ()convert_buffer[i+2], ()convert_buffer[i+3]);

231 
	`ä“
(
cÚv”t_bufãr
);

233 } ià(
İaque
->
codeı¬
->
codec_id
 =ğ
AV_CODEC_ID_MPEG4
) {

234 
size_t
 
esds_dec_dsü_ty³_Ëngth
 = 
İaque
->
codeı¬
->
exŒad©a_size
 + 0x18;

235 
size_t
 
esds_es_dsü_ty³_Ëngth
 = 
esds_dec_dsü_ty³_Ëngth
 + 0x08;

236 
size_t
 
esds_size
 = 
esds_es_dsü_ty³_Ëngth
 + 0x05;

237 
ušt8_t
 *
cÚv”t_bufãr
 = (ušt8_ˆ*)
	`ÿÎoc
(1, 
esds_size
);

238 
	`»¡Üe_m³g4_esds
(
İaque
->
codeı¬
, o·que->codeı¬->
exŒad©a
, o·que->codeı¬->
exŒad©a_size
, 
esds_es_dsü_ty³_Ëngth
, 
esds_dec_dsü_ty³_Ëngth
, 
cÚv”t_bufãr
);

239 
	`SDL_AMedŸFÜm©_£tBufãr
(
İaque
->
šput_afÜm©
, "csd-0", 
cÚv”t_bufãr
, 
esds_size
);

240 
	`ä“
(
cÚv”t_bufãr
);

244 
	`ALOGE
("csd-0:‚aked\n");

247 
	`ALOGE
("nØbufãr(%d)\n", 
İaque
->
codeı¬
->
exŒad©a_size
);

250 
rÙ©e_deg»es
 = 
	`få_g‘_video_rÙ©e_deg»es
(
få
);

251 ià(
få
->
medŸcodec_auto_rÙ©e
 &&

252 
rÙ©e_deg»es
 != 0 &&

253 
	`SDL_Android_G‘ApiLev–
(è>ğ
IJK_API_21_LOLLIPOP
) {

254 
	`ALOGI
("amc:„Ù©š decod”: %d\n", 
rÙ©e_deg»es
);

255 
İaque
->
äame_rÙ©e_deg»es
 = 
rÙ©e_deg»es
;

256 
	`SDL_AMedŸFÜm©_£tIÁ32
(
İaque
->
šput_afÜm©
, "rÙ©iÚ-deg»es", 
rÙ©e_deg»es
);

257 
	`få_nÙify_msg2
(
få
, 
FFP_MSG_VIDEO_ROTATION_CHANGED
, 0);

259 
	`ALOGI
("amc:„Ù©nÙify: %d\n", 
rÙ©e_deg»es
);

260 
	`få_nÙify_msg2
(
få
, 
FFP_MSG_VIDEO_ROTATION_CHANGED
, 
rÙ©e_deg»es
);

264 
ç
:

266 
	}
}

268 
	$»cÚfigu»_codec_l
(
JNIEnv
 *
’v
, 
IJKFF_P’ode
 *
node
, 
jobjeù
 
Ãw_surçû
)

270 
IJKFF_P’ode_O·que
 *
İaque
 = 
node
->opaque;

271 
»t
 = 0;

272 
sdl_amedŸ_¡©us_t
 
amc_»t
 = 0;

273 
jobjeù
 
´ev_jsurçû
 = 
NULL
;

275 
´ev_jsurçû
 = 
İaque
->
jsurçû
;

276 ià(
Ãw_surçû
) {

277 
İaque
->
jsurçû
 = (*
’v
)->
	`NewGlob®Ref
Ónv, 
Ãw_surçû
);

278 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
è|| !
İaque
->
jsurçû
)

279 
ç
;

281 
İaque
->
jsurçû
 = 
NULL
;

284 
	`SDL_JNI_D–‘eGlob®RefP
(
’v
, &
´ev_jsurçû
);

286 ià(!
İaque
->
acodec
) {

287 
İaque
->
acodec
 = 
	`ü—‹_codec_l
(
’v
, 
node
);

288 ià(!
İaque
->
acodec
) {

289 
	`ALOGE
("%s:İ’_video_decod”: c»©e_codeøçed\n", 
__func__
);

290 
»t
 = -1;

291 
ç
;

295 ià(
	`SDL_AMedŸCodec_isCÚfigu»d
(
İaque
->
acodec
)) {

296 ià(
İaque
->
acodec
) {

297 ià(
	`SDL_AMedŸCodec_isS¹ed
(
İaque
->
acodec
)) {

298 
	`SDL_VoutAndroid_šv®id©eAÎBufãrs
(
İaque
->
w—k_vout
);

299 
	`SDL_AMedŸCodec_¡İ
(
İaque
->
acodec
);

301 ià(
İaque
->
quœk_»cÚfigu»_w™h_Ãw_codec
) {

302 
	`ALOGI
("quirk:„econfigure with‚ew codec");

303 
	`SDL_AMedŸCodec_deü—£Reã»nûP
(&
İaque
->
acodec
);

305 
İaque
->
acodec
 = 
	`ü—‹_codec_l
(
’v
, 
node
);

306 ià(!
İaque
->
acodec
) {

307 
	`ALOGE
("%s:İ’_video_decod”: c»©e_codeøçed\n", 
__func__
);

308 
»t
 = -1;

309 
ç
;

314 
	`as£¹
(
İaque
->
w—k_vout
);

317 
amc_»t
 = 
	`SDL_AMedŸCodec_cÚfigu»_surçû
(
’v
, 
İaque
->
acodec
, o·que->
šput_afÜm©
, o·que->
jsurçû
, 
NULL
, 0);

318 ià(
amc_»t
 !ğ
SDL_AMEDIA_OK
) {

319 
	`ALOGE
("%s:cÚfigu»_surçû: faed\n", 
__func__
);

320 
»t
 = -1;

321 
ç
;

324 
amc_»t
 = 
	`SDL_AMedŸCodec_¡¬t
(
İaque
->
acodec
);

325 ià(
amc_»t
 !ğ
SDL_AMEDIA_OK
) {

326 
	`ALOGE
("%s:SDL_AMedŸCodec_¡¬t: faed\n", 
__func__
);

327 
»t
 = -1;

328 
ç
;

331 
İaque
->
acodec_fœ¡_dequeue_ouut_»que¡
 = 
Œue
;

332 
	`ALOGI
("%s:Ãw‡codec: %p\n", 
__func__
, 
İaque
->
acodec
);

333 
	`SDL_VoutAndroid_£tAMedŸCodec
(
İaque
->
w—k_vout
, o·que->
acodec
);

335 
»t
 = 0;

336 
ç
:

337  
»t
;

338 
	}
}

341 
	$»cÚfigu»_codec
(
JNIEnv
 *
’v
, 
IJKFF_P’ode
 *
node
)

343 
IJKFF_P’ode_O·que
 *
İaque
 = 
node
->opaque;

344 
	`SDL_LockMu‹x
(
İaque
->
acodec_mu‹x
);

345 
»t
 = 
	`»cÚfigu»_codec_l
(
’v
, 
node
);

346 
	`SDL_UÆockMu‹x
(
İaque
->
acodec_mu‹x
);

347  
»t
;

348 
	}
}

351 
	$amc_fl_äame
(

352 
IJKFF_P’ode
 *
node
,

353 
AVF¿me
 *
äame
,

354 *
gÙ_äame
,

355 
ouut_bufãr_šdex
,

356 
acodec_£rŸl
,

357 
SDL_AMedŸCodecBufãrInfo
 *
bufãr_šfo
)

359 
IJKFF_P’ode_O·que
 *
İaque
 = 
node
->opaque;

360 
FFPÏy”
 *
få
 = 
İaque
->ffp;

361 
VideoS‹
 *
is
 = 
få
->is;

363 
äame
->
İaque
 = 
	`SDL_VoutAndroid_obšBufãrProxy
(İaque->
w—k_vout
, 
acodec_£rŸl
, 
ouut_bufãr_šdex
, 
bufãr_šfo
);

364 ià(!
äame
->
İaque
)

365 
ç
;

367 
äame
->
width
 = 
İaque
->
äame_width
;

368 
äame
->
height
 = 
İaque
->
äame_height
;

369 
äame
->
fÜm©
 = 
IJK_AV_PIX_FMT__ANDROID_MEDIACODEC
;

370 
äame
->
§m¶e_a¥eù_¿tio
 = 
İaque
->
codeı¬
->sample_aspect_ratio;

371 
äame
->
±s
 = 
	`av_»sÿË_q
(
bufãr_šfo
->
´e£Á©iÚTimeUs
, 
AV_TIME_BASE_Q
, 
is
->
video_¡
->
time_ba£
);

372 ià(
äame
->
±s
 < 0)

373 
äame
->
±s
 = 
AV_NOPTS_VALUE
;

376 *
gÙ_äame
 = 1;

378 
ç
:

379 *
gÙ_äame
 = 0;

381 
	}
}

383 
	$ãed_šput_bufãr
(
JNIEnv
 *
’v
, 
IJKFF_P’ode
 *
node
, 
št64_t
 
timeUs
, *
’queue_couÁ
)

385 
IJKFF_P’ode_O·que
 *
İaque
 = 
node
->opaque;

386 
FFPÏy”
 *
få
 = 
İaque
->ffp;

387 
IJKFF_P–še
 *
p–še
 = 
İaque
->pipeline;

388 
VideoS‹
 *
is
 = 
få
->is;

389 
Decod”
 *
d
 = &
is
->
viddec
;

390 
Pack‘Queue
 *
q
 = 
d
->
queue
;

391 
sdl_amedŸ_¡©us_t
 
amc_»t
 = 0;

392 
»t
 = 0;

393 
ssize_t
 
šput_bufãr_šdex
 = 0;

394 
ssize_t
 
cİy_size
 = 0;

395 
št64_t
 
time_¡amp
 = 0;

396 
ušt32_t
 
queue_æags
 = 0;

398 ià(
’queue_couÁ
)

399 *
’queue_couÁ
 = 0;

401 ià(
d
->
queue
->
abÜt_»que¡
) {

402 
»t
 = 0;

403 
ç
;

406 ià(!
d
->
·ck‘_³ndšg
 || d->
queue
->
£rŸl
 !ğd->
pkt_£rŸl
) {

407 #ià
AMC_USE_AVBITSTREAM_FILTER


409 
H264CÚv”tS‹
 
cÚv”t_¡©e
 = {0, 0};

411 
AVPack‘
 
pkt
;

413 ià(
d
->
queue
->
nb_·ck‘s
 == 0)

414 
	`SDL_CÚdSigÇl
(
d
->
em±y_queue_cÚd
);

415 ià(
	`få_·ck‘_queue_g‘_Ü_bufãršg
(
få
, 
d
->
queue
, &
pkt
, &d->
pkt_£rŸl
, &d->
fšished
) < 0) {

416 
»t
 = -1;

417 
ç
;

419 ià(
	`få_is_æush_·ck‘
(&
pkt
è|| 
İaque
->
acodec_æush_»que¡
) {

421 
İaque
->
acodec_æush_»que¡
 = 
Œue
;

422 
	`SDL_LockMu‹x
(
İaque
->
acodec_mu‹x
);

423 ià(
	`SDL_AMedŸCodec_isS¹ed
(
İaque
->
acodec
)) {

424 ià(
İaque
->
šput_·ck‘_couÁ
 > 0) {

426 
	`SDL_VoutAndroid_šv®id©eAÎBufãrs
(
İaque
->
w—k_vout
);

427 
	`SDL_AMedŸCodec_æush
(
İaque
->
acodec
);

428 
İaque
->
šput_·ck‘_couÁ
 = 0;

433 
İaque
->
acodec_æush_»que¡
 = 
çl£
;

434 
	`SDL_CÚdSigÇl
(
İaque
->
acodec_cÚd
);

435 
	`SDL_UÆockMu‹x
(
İaque
->
acodec_mu‹x
);

436 
d
->
fšished
 = 0;

437 
d
->
Ãxt_±s
 = d->
¡¬t_±s
;

438 
d
->
Ãxt_±s_tb
 = d->
¡¬t_±s_tb
;

440 } 
	`få_is_æush_·ck‘
(&
pkt
è|| 
d
->
queue
->
£rŸl
 !ğd->
pkt_£rŸl
);

441 
	`av_·ck‘_¥l™_side_d©a
(&
pkt
);

442 
	`av_·ck‘_uÄef
(&
d
->
pkt
);

443 
d
->
pkt_‹mp
 = d->
pkt
 =…kt;

444 
d
->
·ck‘_³ndšg
 = 1;

446 ià(
İaque
->
få
->
medŸcodec_hªdË_»sŞutiÚ_chªge
 &&

447 
İaque
->
codeı¬
->
codec_id
 =ğ
AV_CODEC_ID_H264
) {

448 
ušt8_t
 *
size_d©a
 = 
NULL
;

449 
size_d©a_size
 = 0;

450 
AVPack‘
 *
avpkt
 = &
d
->
pkt_‹mp
;

451 
size_d©a
 = 
	`av_·ck‘_g‘_side_d©a
(
avpkt
, 
AV_PKT_DATA_NEW_EXTRADATA
, &
size_d©a_size
);

453 ià(
size_d©a
 && 
size_d©a_size
 >= 7) {

454 
gÙ_piùu»
 = 0;

455 
AVF¿me
 *
äame
 = 
	`av_äame_®loc
();

456 
AVDiùiÚ¬y
 *
codec_İts
 = 
NULL
;

457 cÚ¡ 
AVCodec
 *
codec
 = 
İaque
->
decod”
->
avùx
->codec;

458 
AVCodecCÚ‹xt
 *
Ãw_avùx
 = 
	`avcodec_®loc_cÚ‹xt3
(
codec
);

459 
chªge_»t
 = 0;

460 ià(!
Ãw_avùx
)

461  
	`AVERROR
(
ENOMEM
);

463 
	`avcodec_·¿m‘”s_to_cÚ‹xt
(
Ãw_avùx
, 
İaque
->
codeı¬
);

464 
	`av_ä“p
(&
Ãw_avùx
->
exŒad©a
);

465 
Ãw_avùx
->
exŒad©a
 = 
	`av_m®locz
(
size_d©a_size
 + 
AV_INPUT_BUFFER_PADDING_SIZE
);

466 ià(!
Ãw_avùx
->
exŒad©a
) {

467 
	`avcodec_ä“_cÚ‹xt
(&
Ãw_avùx
);

468  
	`AVERROR
(
ENOMEM
);

470 
	`memıy
(
Ãw_avùx
->
exŒad©a
, 
size_d©a
, 
size_d©a_size
);

471 
Ãw_avùx
->
exŒad©a_size
 = 
size_d©a_size
;

473 
	`av_diù_£t
(&
codec_İts
, "threads", "1", 0);

474 
chªge_»t
 = 
	`avcodec_İ’2
(
Ãw_avùx
, 
codec
, &
codec_İts
);

475 
	`av_diù_ä“
(&
codec_İts
);

476 ià(
chªge_»t
 < 0) {

477 
	`avcodec_ä“_cÚ‹xt
(&
Ãw_avùx
);

478  
chªge_»t
;

481 
chªge_»t
 = 
	`avcodec_decode_video2
(
Ãw_avùx
, 
äame
, &
gÙ_piùu»
, 
avpkt
);

482 ià(
chªge_»t
 < 0) {

483 
	`avcodec_ä“_cÚ‹xt
(&
Ãw_avùx
);

484  
chªge_»t
;

486 ià(
İaque
->
codeı¬
->
width
 !ğ
Ãw_avùx
->width &&

487 
İaque
->
codeı¬
->
height
 !ğ
Ãw_avùx
->height) {

488 
	`ALOGW
("AV_PKT_DATA_NEW_EXTRADATA: %d x %d\n", 
Ãw_avùx
->
width
,‚ew_avùx->
height
);

489 
	`avcodec_·¿m‘”s_äom_cÚ‹xt
(
İaque
->
codeı¬
, 
Ãw_avùx
);

490 
İaque
->
afÜm©_Ãed_»ü—‹
 = 
Œue
;

491 
	`få–še_£t_surçû_Ãed_»cÚfigu»_l
(
p–še
, 
Œue
);

495 
	`av_äame_uÄef
(
äame
);

496 
	`avcodec_ä“_cÚ‹xt
(&
Ãw_avùx
);

500 #ià
AMC_USE_AVBITSTREAM_FILTER


502 ià(
d
->
bfsc_»t
 > 0) {

503 ià(
d
->
bfsc_d©a
)

504 
	`av_ä“p
(&
d
->
bfsc_d©a
);

505 
d
->
bfsc_»t
 = 0;

507 
d
->
bfsc_»t
 =

508 
	`av_b™¡»am_f‹r_f‹r
(
İaque
->
bsfc
, o·que->
avùx
, 
NULL
, &
d
->
pkt_‹mp
.
d©a
, &d->pkt_‹mp.
size
,

509 
d
->
pkt
.
d©a
, d->pkt.
size
, d->pkt.
æags
 & 
AV_PKT_FLAG_KEY
);

510 ià(
d
->
bfsc_»t
 > 0) {

511 
d
->
bfsc_d©a
 = d->
pkt_‹mp
.
d©a
;

512 } ià(
d
->
bfsc_»t
 < 0) {

513 
	`ALOGE
("%s:‡v_b™¡»am_f‹r_f‹¸çed\n", 
__func__
);

514 
»t
 = -1;

515 
ç
;

518 ià(
d
->
pkt_‹mp
.
size
 =ğd->
pkt
.siz+ 
İaque
->
avùx
->
exŒad©a_size
) {

519 
d
->
pkt_‹mp
.
d©a
 +ğ
İaque
->
avùx
->
exŒad©a_size
;

520 
d
->
pkt_‹mp
.
size
 = d->
pkt
.size;

523 
	`AMCTRACE
("bsfc->f‹r(%d): %p[%d] -> %p[%d]", 
d
->
bfsc_»t
, d->
pkt
.
d©a
, ()d->pkt.
size
, d->
pkt_‹mp
.data, ()d->pkt_temp.size);

526 
	`AMCTRACE
("¿w [%d][%d] %02x%02x%02x%02x%02x%02x%02x%02x", ()
d
->
pkt_‹mp
.
size
,

527 ()
İaque
->
Çl_size
,

528 
d
->
pkt_‹mp
.
d©a
[0],

529 
d
->
pkt_‹mp
.
d©a
[1],

530 
d
->
pkt_‹mp
.
d©a
[2],

531 
d
->
pkt_‹mp
.
d©a
[3],

532 
d
->
pkt_‹mp
.
d©a
[4],

533 
d
->
pkt_‹mp
.
d©a
[5],

534 
d
->
pkt_‹mp
.
d©a
[6],

535 
d
->
pkt_‹mp
.
d©a
[7]);

537 ià(
İaque
->
codeı¬
->
codec_id
 =ğ
AV_CODEC_ID_H264
 || o·que->codeı¬->codec_id =ğ
AV_CODEC_ID_HEVC
) {

538 
	`cÚv”t_h264_to_ªÃxb
(
d
->
pkt_‹mp
.
d©a
, d->pkt_‹mp.
size
, 
İaque
->
Çl_size
, &
cÚv”t_¡©e
);

539 
št64_t
 
time_¡amp
 = 
d
->
pkt_‹mp
.
±s
;

540 ià(!
time_¡amp
 && 
d
->
pkt_‹mp
.
dts
)

541 
time_¡amp
 = 
d
->
pkt_‹mp
.
dts
;

542 ià(
time_¡amp
 > 0) {

543 
time_¡amp
 = 
	`av_»sÿË_q
Ñime_¡amp, 
is
->
video_¡
->
time_ba£
, 
AV_TIME_BASE_Q
);

545 
time_¡amp
 = 0;

549 
	`AMCTRACE
("šput[%d][%d][%Îd,%Îd (%d, %dè-> %Îd] %02x%02x%02x%02x%02x%02x%02x%02x", ()
d
->
pkt_‹mp
.
size
,

550 ()
İaque
->
Çl_size
,

551 (
št64_t
)
d
->
pkt_‹mp
.
±s
,

552 (
št64_t
)
d
->
pkt_‹mp
.
dts
,

553 ()
is
->
video_¡
->
time_ba£
.
num
,

554 ()
is
->
video_¡
->
time_ba£
.
d’
,

555 (
št64_t
)
time_¡amp
,

556 
d
->
pkt_‹mp
.
d©a
[0],

557 
d
->
pkt_‹mp
.
d©a
[1],

558 
d
->
pkt_‹mp
.
d©a
[2],

559 
d
->
pkt_‹mp
.
d©a
[3],

560 
d
->
pkt_‹mp
.
d©a
[4],

561 
d
->
pkt_‹mp
.
d©a
[5],

562 
d
->
pkt_‹mp
.
d©a
[6],

563 
d
->
pkt_‹mp
.
d©a
[7]);

568 ià(
d
->
pkt_‹mp
.
d©a
) {

571 ià(
	`få–še_is_surçû_Ãed_»cÚfigu»_l
(
p–še
)) {

572 
jobjeù
 
Ãw_surçû
 = 
NULL
;

575 
	`få–še_lock_surçû
(
p–še
);

576 
	`få–še_£t_surçû_Ãed_»cÚfigu»_l
(
p–še
, 
çl£
);

577 
Ãw_surçû
 = 
	`få–še_g‘_surçû_as_glob®_»f_l
(
’v
, 
p–še
);

578 
	`få–še_uÆock_surçû
(
p–še
);

580 ià(!
İaque
->
afÜm©_Ãed_»ü—‹
 &&

581 (
İaque
->
jsurçû
 =ğ
Ãw_surçû
 ||

582 (
İaque
->
jsurçû
 && 
Ãw_surçû
 && (*
’v
)->
	`IsSameObjeù
(env,‚ew_surface, opaque->jsurface)))) {

583 
	`ALOGI
("%s: samsurçû,„eu£…»viou surçû\n", 
__func__
);

584 
	`J4A_D–‘eGlob®Ref__p
(
’v
, &
Ãw_surçû
);

586 ià(
İaque
->
afÜm©_Ãed_»ü—‹
) {

587 
	`ALOGI
("%s:„eü—‹‡fÜm©\n", 
__func__
);

588 
»t
 = 
	`»ü—‹_fÜm©_l
(
’v
, 
node
);

589 ià(
»t
) {

590 
	`ALOGE
("amc:„ecreate_format_l failed\n");

591 
ç
;

593 
İaque
->
afÜm©_Ãed_»ü—‹
 = 
çl£
;

596 
İaque
->
acodec_»cÚfigu»_»que¡
 = 
Œue
;

597 
	`SDL_LockMu‹x
(
İaque
->
acodec_mu‹x
);

598 
»t
 = 
	`»cÚfigu»_codec_l
(
’v
, 
node
, 
Ãw_surçû
);

599 
İaque
->
acodec_»cÚfigu»_»que¡
 = 
çl£
;

600 
	`SDL_CÚdSigÇl
(
İaque
->
acodec_cÚd
);

601 
	`SDL_UÆockMu‹x
(
İaque
->
acodec_mu‹x
);

603 
	`J4A_D–‘eGlob®Ref__p
(
’v
, &
Ãw_surçû
);

605 ià(
»t
 != 0) {

606 
	`ALOGE
("%s:„ecÚfigu»_codeøçed\n", 
__func__
);

607 
»t
 = 0;

608 
ç
;

611 
	`SDL_LockMu‹x
(
İaque
->
acodec_fœ¡_dequeue_ouut_mu‹x
);

612 !
q
->
abÜt_»que¡
 &&

613 !
İaque
->
acodec_»cÚfigu»_»que¡
 &&

614 !
İaque
->
acodec_æush_»que¡
 &&

615 
İaque
->
acodec_fœ¡_dequeue_ouut_»que¡
) {

616 
	`SDL_CÚdWa™Timeout
(
İaque
->
acodec_fœ¡_dequeue_ouut_cÚd
, o·que->
acodec_fœ¡_dequeue_ouut_mu‹x
, 100);

618 
	`SDL_UÆockMu‹x
(
İaque
->
acodec_fœ¡_dequeue_ouut_mu‹x
);

620 ià(
q
->
abÜt_»que¡
 || 
İaque
->
acodec_»cÚfigu»_»que¡
 || o·que->
acodec_æush_»que¡
) {

621 
»t
 = 0;

622 
ç
;

629 ià(!
İaque
->
jsurçû
) {

630 
»t
 = 
	`amc_decode_piùu»_çke
(
node
, 1000);

631 
ç
;

635 
queue_æags
 = 0;

636 
šput_bufãr_šdex
 = 
	`SDL_AMedŸCodec_dequeueIÅutBufãr
(
İaque
->
acodec
, 
timeUs
);

637 ià(
šput_bufãr_šdex
 < 0) {

638 ià(
	`SDL_AMedŸCodec_isIÅutBufãrsV®id
(
İaque
->
acodec
)) {

640 
»t
 = 0;

641 
ç
;

644 
queue_æags
 |ğ
AMEDIACODEC__BUFFER_FLAG_FAKE_FRAME
;

645 
cİy_size
 = 
d
->
pkt_‹mp
.
size
;

648 
	`SDL_AMedŸCodecFake_æushFakeF¿mes
(
İaque
->
acodec
);

650 
cİy_size
 = 
	`SDL_AMedŸCodec_wr™eIÅutD©a
(
İaque
->
acodec
, 
šput_bufãr_šdex
, 
d
->
pkt_‹mp
.
d©a
, d->pkt_‹mp.
size
);

651 ià(!
cİy_size
) {

652 
	`ALOGE
("%s: SDL_AMedŸCodec_g‘IÅutBufã¸çed\n", 
__func__
);

653 
»t
 = -1;

654 
ç
;

658 
time_¡amp
 = 
d
->
pkt_‹mp
.
±s
;

659 ià(
time_¡amp
 =ğ
AV_NOPTS_VALUE
 && 
d
->
pkt_‹mp
.
dts
 != AV_NOPTS_VALUE)

660 
time_¡amp
 = 
d
->
pkt_‹mp
.
dts
;

661 ià(
time_¡amp
 >= 0) {

662 
time_¡amp
 = 
	`av_»sÿË_q
Ñime_¡amp, 
is
->
video_¡
->
time_ba£
, 
AV_TIME_BASE_Q
);

664 
time_¡amp
 = 0;

667 
amc_»t
 = 
	`SDL_AMedŸCodec_queueIÅutBufãr
(
İaque
->
acodec
, 
šput_bufãr_šdex
, 0, 
cİy_size
, 
time_¡amp
, 
queue_æags
);

668 ià(
amc_»t
 !ğ
SDL_AMEDIA_OK
) {

669 
	`ALOGE
("%s: SDL_AMedŸCodec_g‘IÅutBufã¸çed\n", 
__func__
);

670 
»t
 = -1;

671 
ç
;

674 
İaque
->
šput_·ck‘_couÁ
++;

675 ià(
’queue_couÁ
)

676 ++*
’queue_couÁ
;

679 ià(
cİy_size
 < 0) {

680 
d
->
·ck‘_³ndšg
 = 0;

682 
d
->
pkt_‹mp
.
dts
 =

683 
d
->
pkt_‹mp
.
±s
 = 
AV_NOPTS_VALUE
;

684 ià(
d
->
pkt_‹mp
.
d©a
) {

685 
d
->
pkt_‹mp
.
d©a
 +ğ
cİy_size
;

686 
d
->
pkt_‹mp
.
size
 -ğ
cİy_size
;

687 ià(
d
->
pkt_‹mp
.
size
 <= 0)

688 
d
->
·ck‘_³ndšg
 = 0;

692 
d
->
·ck‘_³ndšg
 = 0;

693 
d
->
fšished
 = d->
pkt_£rŸl
;

698 
ç
:

699  
»t
;

700 
	}
}

702 
	$’queue_th»ad_func
(*
¬g
)

704 
JNIEnv
 *
’v
 = 
NULL
;

705 
IJKFF_P’ode
 *
node
 = 
¬g
;

706 
IJKFF_P’ode_O·que
 *
İaque
 = 
node
->opaque;

707 
FFPÏy”
 *
få
 = 
İaque
->ffp;

708 
VideoS‹
 *
is
 = 
få
->is;

709 
Decod”
 *
d
 = &
is
->
viddec
;

710 
Pack‘Queue
 *
q
 = 
d
->
queue
;

711 
»t
 = -1;

712 
dequeue_couÁ
 = 0;

714 ià(
JNI_OK
 !ğ
	`SDL_JNI_S‘upTh»adEnv
(&
’v
)) {

715 
	`ALOGE
("%s: S‘upTh»adEnv faed\n", 
__func__
);

716 
ç
;

719 !
q
->
abÜt_»que¡
 && !
İaque
->
abÜt
) {

720 
»t
 = 
	`ãed_šput_bufãr
(
’v
, 
node
, 
AMC_INPUT_TIMEOUT_US
, &
dequeue_couÁ
);

721 ià(
»t
 != 0) {

722 
ç
;

726 
»t
 = 0;

727 
ç
:

728 
	`SDL_AMedŸCodecFake_abÜt
(
İaque
->
acodec
);

729 
	`ALOGI
("MedŸCodec: %s:ƒx™: %d", 
__func__
, 
»t
);

730  
»t
;

731 
	}
}

733 
	$±s_äom_bufãr_šfo
(
IJKFF_P’ode
 *
node
, 
SDL_AMedŸCodecBufãrInfo
 *
bufãr_šfo
)

735 
IJKFF_P’ode_O·que
 *
İaque
 = 
node
->opaque;

736 
FFPÏy”
 *
få
 = 
İaque
->ffp;

737 
VideoS‹
 *
is
 = 
få
->is;

738 
AVR©iÚ®
 
tb
 = 
is
->
video_¡
->
time_ba£
;

739 
št64_t
 
amc_±s
 = 
	`av_»sÿË_q
(
bufãr_šfo
->
´e£Á©iÚTimeUs
, 
AV_TIME_BASE_Q
, 
is
->
video_¡
->
time_ba£
);

740 
±s
 = 
amc_±s
 < 0 ? 
NAN
 :‡mc_± * 
	`av_q2d
(
tb
);

742  
±s
;

743 
	}
}

746 
	$sÜt_amc_buf_out
(
AMC_Buf_Out
 *
buf_out
, 
size
) {

747 
AMC_Buf_Out
 *
a
, *
b
, 
tmp
;

748 
i
, 
j
;

750 
i
 = 0; i < 
size
; i++) {

751 
j
 = 
i
 + 1; j < 
size
; j++) {

752 
a
 = 
buf_out
 + 
i
;

753 
b
 = 
buf_out
 + 
j
;

754 ià(
a
->
±s
 < 
b
->pts) {

755 
tmp
 = *
a
;

756 *
a
 = *
b
;

757 *
b
 = 
tmp
;

761 
	}
}

763 
	$d¿š_ouut_bufãr_l
(
JNIEnv
 *
’v
, 
IJKFF_P’ode
 *
node
, 
št64_t
 
timeUs
, *
dequeue_couÁ
, 
AVF¿me
 *
äame
, *
gÙ_äame
)

765 
IJKFF_P’ode_O·que
 *
İaque
 = 
node
->opaque;

766 
FFPÏy”
 *
få
 = 
İaque
->ffp;

767 
»t
 = 0;

768 
SDL_AMedŸCodecBufãrInfo
 
bufãrInfo
;

769 
ssize_t
 
ouut_bufãr_šdex
 = 0;

771 ià(
dequeue_couÁ
)

772 *
dequeue_couÁ
 = 0;

774 ià(
JNI_OK
 !ğ
	`SDL_JNI_S‘upTh»adEnv
(&
’v
)) {

775 
	`ALOGE
("%s:ü—‹: S‘upTh»adEnv faed\n", 
__func__
);

776 
ç
;

779 
ouut_bufãr_šdex
 = 
	`SDL_AMedŸCodecFake_dequeueOuutBufãr
(
İaque
->
acodec
, &
bufãrInfo
, 
timeUs
);

780 ià(
ouut_bufãr_šdex
 =ğ
AMEDIACODEC__INFO_OUTPUT_BUFFERS_CHANGED
) {

781 
	`ALOGI
("AMEDIACODEC__INFO_OUTPUT_BUFFERS_CHANGED\n");

783 } ià(
ouut_bufãr_šdex
 =ğ
AMEDIACODEC__INFO_OUTPUT_FORMAT_CHANGED
) {

784 
	`ALOGI
("AMEDIACODEC__INFO_OUTPUT_FORMAT_CHANGED\n");

785 
	`SDL_AMedŸFÜm©_d–‘eP
(&
İaque
->
ouut_afÜm©
);

786 
İaque
->
ouut_afÜm©
 = 
	`SDL_AMedŸCodec_g‘OuutFÜm©
(İaque->
acodec
);

787 ià(
İaque
->
ouut_afÜm©
) {

788 
width
 = 0;

789 
height
 = 0;

790 
cŞÜ_fÜm©
 = 0;

791 
¡ride
 = 0;

792 
¦iû_height
 = 0;

793 
üİ_Ëá
 = 0;

794 
üİ_tİ
 = 0;

795 
üİ_right
 = 0;

796 
üİ_bÙtom
 = 0;

798 
	`SDL_AMedŸFÜm©_g‘IÁ32
(
İaque
->
ouut_afÜm©
, "width", &
width
);

799 
	`SDL_AMedŸFÜm©_g‘IÁ32
(
İaque
->
ouut_afÜm©
, "height", &
height
);

800 
	`SDL_AMedŸFÜm©_g‘IÁ32
(
İaque
->
ouut_afÜm©
, "cŞÜ-fÜm©", &
cŞÜ_fÜm©
);

802 
	`SDL_AMedŸFÜm©_g‘IÁ32
(
İaque
->
ouut_afÜm©
, "¡ride", &
¡ride
);

803 
	`SDL_AMedŸFÜm©_g‘IÁ32
(
İaque
->
ouut_afÜm©
, "¦iû-height", &
¦iû_height
);

804 
	`SDL_AMedŸFÜm©_g‘IÁ32
(
İaque
->
ouut_afÜm©
, "üİ-Ëá", &
üİ_Ëá
);

805 
	`SDL_AMedŸFÜm©_g‘IÁ32
(
İaque
->
ouut_afÜm©
, "üİ-tİ", &
üİ_tİ
);

806 
	`SDL_AMedŸFÜm©_g‘IÁ32
(
İaque
->
ouut_afÜm©
, "üİ-right", &
üİ_right
);

807 
	`SDL_AMedŸFÜm©_g‘IÁ32
(
İaque
->
ouut_afÜm©
, "üİ-bÙtom", &
üİ_bÙtom
);

813 
	`ALOGI
(

821 
width
, 
height
,

822 
	`SDL_AMedŸCodec_g‘CŞÜFÜm©Name
(
cŞÜ_fÜm©
), color_format,

823 
¡ride
,

824 
¦iû_height
,

825 
üİ_Ëá
, 
üİ_tİ
, 
üİ_right
, 
üİ_bÙtom
);

828 } ià(
ouut_bufãr_šdex
 =ğ
AMEDIACODEC__INFO_TRY_AGAIN_LATER
) {

829 
	`AMCTRACE
("AMEDIACODEC__INFO_TRY_AGAIN_LATER\n");

831 } ià(
ouut_bufãr_šdex
 < 0) {

832 
	`SDL_LockMu‹x
(
İaque
->
ªy_šput_mu‹x
);

833 
	`SDL_CÚdWa™Timeout
(
İaque
->
ªy_šput_cÚd
, o·que->
ªy_šput_mu‹x
, 1000);

834 
	`SDL_UÆockMu‹x
(
İaque
->
ªy_šput_mu‹x
);

836 
dÚe
;

837 } ià(
ouut_bufãr_šdex
 >= 0) {

838 
få
->
¡©
.
vdps
 = 
	`SDL_S³edSam¶”Add
(&
İaque
->
§m¶”
, 
FFP_SHOW_VDPS_MEDIACODEC
, "vdps[MediaCodec]");

840 ià(
dequeue_couÁ
)

841 ++*
dequeue_couÁ
;

843 #ifdeà
FFP_SHOW_AMC_VDPS


845 ià(
İaque
->
b’chm¬k_¡¬t_time
 == 0) {

846 
İaque
->
b’chm¬k_¡¬t_time
 = 
	`SDL_G‘TickHR
();

848 
İaque
->
b’chm¬k_äame_couÁ
 += 1;

849 ià(0 =ğ(
İaque
->
b’chm¬k_äame_couÁ
 % 240)) {

850 
Ušt64
 
diff
 = 
	`SDL_G‘TickHR
(è- 
İaque
->
b’chm¬k_¡¬t_time
;

851 
³r_äame_ms
 = ((è
diff
è/ 
İaque
->
b’chm¬k_äame_couÁ
;

852 
ås
 = ((è
İaque
->
b’chm¬k_äame_couÁ
è* 1000 / 
diff
;

853 
	`ALOGE
("%làås, %làms/äame, %"
PRIu64
" frames\n",

854 
ås
, 
³r_äame_ms
, 
İaque
->
b’chm¬k_äame_couÁ
);

858 #ifdeà
FFP_AMC_DISABLE_OUTPUT


859 ià(!(
bufãrInfo
.
æags
 & 
AMEDIACODEC__BUFFER_FLAG_FAKE_FRAME
)) {

860 
	`SDL_AMedŸCodec_»Ëa£OuutBufãr
(
İaque
->
acodec
, 
ouut_bufãr_šdex
, 
çl£
);

862 
dÚe
;

865 ià(
İaque
->
n_buf_out
) {

866 
AMC_Buf_Out
 *
buf_out
;

868 ià(
İaque
->
off_buf_out
 < o·que->
n_buf_out
) {

870 
buf_out
 = &
İaque
->
amc_buf_out
[İaque->
off_buf_out
++];

871 
buf_out
->
acodec_£rŸl
 = 
	`SDL_AMedŸCodec_g‘S”Ÿl
(
İaque
->
acodec
);

872 
buf_out
->
pÜt
 = 
ouut_bufãr_šdex
;

873 
buf_out
->
šfo
 = 
bufãrInfo
;

874 
buf_out
->
±s
 = 
	`±s_äom_bufãr_šfo
(
node
, &
bufãrInfo
);

875 
	`sÜt_amc_buf_out
(
İaque
->
amc_buf_out
, o·que->
off_buf_out
);

877 
±s
;

879 
±s
 = 
	`±s_äom_bufãr_šfo
(
node
, &
bufãrInfo
);

880 ià(
İaque
->
Ï¡_queued_±s
 !ğ
AV_NOPTS_VALUE
 &&

881 
±s
 < 
İaque
->
Ï¡_queued_±s
) {

888 
buf_out
 = &
İaque
->
amc_buf_out
[İaque->
off_buf_out
 - 1];

890 ià(
±s
 < 
buf_out
->pts) {

891 
»t
 = 
	`amc_fl_äame
(
node
, 
äame
, 
gÙ_äame
, 
ouut_bufãr_šdex
, 
	`SDL_AMedŸCodec_g‘S”Ÿl
(
İaque
->
acodec
), &
bufãrInfo
);

892 
İaque
->
Ï¡_queued_±s
 = 
±s
;

895 
i
;

898 
i
 = 
İaque
->
off_buf_out
 - 1; i >= 0; i--) {

899 
buf_out
 = &
İaque
->
amc_buf_out
[
i
];

900 ià(
±s
 > 
buf_out
->pts) {

901 
»t
 = 
	`amc_fl_äame
(
node
, 
äame
, 
gÙ_äame
, 
buf_out
->
pÜt
, buf_out->
acodec_£rŸl
, &buf_out->
šfo
);

902 
İaque
->
Ï¡_queued_±s
 = 
buf_out
->
±s
;

905 
buf_out
->
acodec_£rŸl
 = 
	`SDL_AMedŸCodec_g‘S”Ÿl
(
İaque
->
acodec
);

906 
buf_out
->
pÜt
 = 
ouut_bufãr_šdex
;

907 
buf_out
->
šfo
 = 
bufãrInfo
;

908 
buf_out
->
±s
 = 
	`±s_äom_bufãr_šfo
(
node
, &
bufãrInfo
);

909 
	`sÜt_amc_buf_out
(
İaque
->
amc_buf_out
, o·que->
n_buf_out
);

914 ià(
i
 < 0) {

916 ià(!(
bufãrInfo
.
æags
 & 
AMEDIACODEC__BUFFER_FLAG_FAKE_FRAME
)) {

917 
	`SDL_AMedŸCodec_»Ëa£OuutBufãr
(
İaque
->
acodec
, 
ouut_bufãr_šdex
, 
çl£
);

918 
dÚe
;

924 
»t
 = 
	`amc_fl_äame
(
node
, 
äame
, 
gÙ_äame
, 
ouut_bufãr_šdex
, 
	`SDL_AMedŸCodec_g‘S”Ÿl
(
İaque
->
acodec
), &
bufãrInfo
);

928 
dÚe
:

929 ià(
İaque
->
decod”
->
queue
->
abÜt_»que¡
)

930 
»t
 = -1;

932 
»t
 = 0;

933 
ç
:

934  
»t
;

935 
	}
}

937 
	$d¿š_ouut_bufãr
(
JNIEnv
 *
’v
, 
IJKFF_P’ode
 *
node
, 
št64_t
 
timeUs
, *
dequeue_couÁ
, 
AVF¿me
 *
äame
, *
gÙ_äame
)

939 
IJKFF_P’ode_O·que
 *
İaque
 = 
node
->opaque;

940 
	`SDL_LockMu‹x
(
İaque
->
acodec_mu‹x
);

942 ià(
İaque
->
acodec_æush_»que¡
 || o·que->
acodec_»cÚfigu»_»que¡
) {

945 
	`SDL_CÚdWa™Timeout
(
İaque
->
acodec_cÚd
, o·que->
acodec_mu‹x
, 100);

948 
»t
 = 
	`d¿š_ouut_bufãr_l
(
’v
, 
node
, 
timeUs
, 
dequeue_couÁ
, 
äame
, 
gÙ_äame
);

949 
	`SDL_UÆockMu‹x
(
İaque
->
acodec_mu‹x
);

950  
»t
;

951 
	}
}

953 
	$func_de¡roy
(
IJKFF_P’ode
 *
node
)

955 ià(!
node
 || !node->
İaque
)

958 
IJKFF_P’ode_O·que
 *
İaque
 = 
node
->opaque;

960 
	`SDL_De¡royCÚdP
(&
İaque
->
ªy_šput_cÚd
);

961 
	`SDL_De¡royMu‹xP
(&
İaque
->
ªy_šput_mu‹x
);

962 
	`SDL_De¡royCÚdP
(&
İaque
->
acodec_cÚd
);

963 
	`SDL_De¡royMu‹xP
(&
İaque
->
acodec_mu‹x
);

964 
	`SDL_De¡royCÚdP
(&
İaque
->
acodec_fœ¡_dequeue_ouut_cÚd
);

965 
	`SDL_De¡royMu‹xP
(&
İaque
->
acodec_fœ¡_dequeue_ouut_mu‹x
);

967 
	`SDL_AMedŸCodec_deü—£Reã»nûP
(&
İaque
->
acodec
);

968 
	`SDL_AMedŸFÜm©_d–‘eP
(&
İaque
->
šput_afÜm©
);

969 
	`SDL_AMedŸFÜm©_d–‘eP
(&
İaque
->
ouut_afÜm©
);

971 #ià
AMC_USE_AVBITSTREAM_FILTER


972 
	`av_ä“p
(&
İaque
->
Üig_exŒad©a
);

974 ià(
İaque
->
bsfc
) {

975 
	`av_b™¡»am_f‹r_şo£
(
İaque
->
bsfc
);

976 
İaque
->
bsfc
 = 
NULL
;

980 
	`avcodec_·¿m‘”s_ä“
(&
İaque
->
codeı¬
);

982 
JNIEnv
 *
’v
 = 
NULL
;

983 ià(
JNI_OK
 =ğ
	`SDL_JNI_S‘upTh»adEnv
(&
’v
)) {

984 ià(
İaque
->
jsurçû
 !ğ
NULL
) {

985 
	`SDL_JNI_D–‘eGlob®RefP
(
’v
, &
İaque
->
jsurçû
);

988 
	}
}

990 
	$func_run_sync
(
IJKFF_P’ode
 *
node
)

992 
JNIEnv
 *
’v
 = 
NULL
;

993 
IJKFF_P’ode_O·que
 *
İaque
 = 
node
->opaque;

994 
FFPÏy”
 *
få
 = 
İaque
->ffp;

995 
VideoS‹
 *
is
 = 
få
->is;

996 
Decod”
 *
d
 = &
is
->
viddec
;

997 
Pack‘Queue
 *
q
 = 
d
->
queue
;

998 
»t
 = 0;

999 
dequeue_couÁ
 = 0;

1000 
AVF¿me
 *
äame
 = 
NULL
;

1001 
gÙ_äame
 = 0;

1002 
AVR©iÚ®
 
tb
 = 
is
->
video_¡
->
time_ba£
;

1003 
AVR©iÚ®
 
äame_¿‹
 = 
	`av_guess_äame_¿‹
(
is
->
ic
, is->
video_¡
, 
NULL
);

1004 
du¿tiÚ
;

1005 
±s
;

1007 ià(!
İaque
->
acodec
) {

1008  
	`få_video_th»ad
(
få
);

1011 ià(
JNI_OK
 !ğ
	`SDL_JNI_S‘upTh»adEnv
(&
’v
)) {

1012 
	`ALOGE
("%s: S‘upTh»adEnv faed\n", 
__func__
);

1016 
äame
 = 
	`av_äame_®loc
();

1017 ià(!
äame
)

1018 
ç
;

1020 
İaque
->
’queue_th»ad
 = 
	`SDL_C»©eTh»adEx
(&İaque->
_’queue_th»ad
, 
’queue_th»ad_func
, 
node
, "amediacodec_input_thread");

1021 ià(!
İaque
->
’queue_th»ad
) {

1022 
	`ALOGE
("%s: SDL_C»©eTh»adEx faed\n", 
__func__
);

1023 
»t
 = -1;

1024 
ç
;

1027 !
q
->
abÜt_»que¡
) {

1028 
št64_t
 
timeUs
 = 
İaque
->
acodec_fœ¡_dequeue_ouut_»que¡
 ? 0 : 
AMC_OUTPUT_TIMEOUT_US
;

1029 
gÙ_äame
 = 0;

1030 
»t
 = 
	`d¿š_ouut_bufãr
(
’v
, 
node
, 
timeUs
, &
dequeue_couÁ
, 
äame
, &
gÙ_äame
);

1031 ià(
İaque
->
acodec_fœ¡_dequeue_ouut_»que¡
) {

1032 
	`SDL_LockMu‹x
(
İaque
->
acodec_fœ¡_dequeue_ouut_mu‹x
);

1033 
İaque
->
acodec_fœ¡_dequeue_ouut_»que¡
 = 
çl£
;

1034 
	`SDL_CÚdSigÇl
(
İaque
->
acodec_fœ¡_dequeue_ouut_cÚd
);

1035 
	`SDL_UÆockMu‹x
(
İaque
->
acodec_fœ¡_dequeue_ouut_mu‹x
);

1037 ià(
»t
 != 0) {

1038 
»t
 = -1;

1039 ià(
gÙ_äame
 && 
äame
->
İaque
)

1040 
	`SDL_VoutAndroid_»Ëa£BufãrProxyP
(
İaque
->
w—k_vout
, (
SDL_AMedŸCodecBufãrProxy
 **)&
äame
->İaque, 
çl£
);

1041 
ç
;

1043 ià(
gÙ_äame
) {

1044 
du¿tiÚ
 = (
äame_¿‹
.
num
 && f¿me_¿‹.
d’
 ? 
	`av_q2d
((
AVR©iÚ®
){frame_rate.den, frame_rate.num}) : 0);

1045 
±s
 = (
äame
->± =ğ
AV_NOPTS_VALUE
è? 
NAN
 : f¿me->± * 
	`av_q2d
(
tb
);

1046 
»t
 = 
	`få_queue_piùu»
(
få
, 
äame
, 
±s
, 
du¿tiÚ
, 
	`av_äame_g‘_pkt_pos
(äame), 
is
->
viddec
.
pkt_£rŸl
);

1047 ià(
»t
) {

1048 ià(
äame
->
İaque
)

1049 
	`SDL_VoutAndroid_»Ëa£BufãrProxyP
(
İaque
->
w—k_vout
, (
SDL_AMedŸCodecBufãrProxy
 **)&
äame
->İaque, 
çl£
);

1051 
	`av_äame_uÄef
(
äame
);

1055 
ç
:

1056 
	`av_äame_ä“
(&
äame
);

1057 
İaque
->
abÜt
 = 
Œue
;

1058 
	`SDL_Wa™Th»ad
(
İaque
->
’queue_th»ad
, 
NULL
);

1059 
	`SDL_AMedŸCodecFake_abÜt
(
İaque
->
acodec
);

1060 ià(
İaque
->
n_buf_out
) {

1061 
	`ä“
(
İaque
->
amc_buf_out
);

1062 
İaque
->
n_buf_out
 = 0;

1063 
İaque
->
amc_buf_out
 = 
NULL
;

1064 
İaque
->
off_buf_out
 = 0;

1065 
İaque
->
Ï¡_queued_±s
 = 
AV_NOPTS_VALUE
;

1067 ià(
İaque
->
acodec
) {

1068 
	`SDL_VoutAndroid_šv®id©eAÎBufãrs
(
İaque
->
w—k_vout
);

1069 
	`SDL_LockMu‹x
(
İaque
->
acodec_mu‹x
);

1070 
	`SDL_UÆockMu‹x
(
İaque
->
acodec_mu‹x
);

1072 
	`SDL_AMedŸCodec_¡İ
(
İaque
->
acodec
);

1073 
	`SDL_AMedŸCodec_deü—£Reã»nûP
(&
İaque
->
acodec
);

1074 
	`ALOGI
("MedŸCodec: %s:ƒx™: %d", 
__func__
, 
»t
);

1075  
»t
;

1077 
çÎback_to_fåÏy
:

1078 
	`ALOGW
("fallbacko ffplay decoder\n");

1079  
	`få_video_th»ad
(
İaque
->
få
);

1081 
	}
}

1083 
	$func_æush
(
IJKFF_P’ode
 *
node
)

1085 
IJKFF_P’ode_O·que
 *
İaque
 = 
node
->opaque;

1087 ià(!
İaque
)

1090 
İaque
->
acodec_æush_»que¡
 = 
Œue
;

1093 
	}
}

1095 
IJKFF_P’ode
 *
	$få’ode_ü—‹_video_decod”_äom_ªdroid_medŸcodec
(
FFPÏy”
 *
få
, 
IJKFF_P–še
 *
p–še
, 
SDL_Vout
 *
vout
)

1097 
	`ALOGD
("ffpipenode_create_video_decoder_from_android_mediacodec()\n");

1098 ià(
	`SDL_Android_G‘ApiLev–
(è< 
IJK_API_16_JELLY_BEAN
)

1099  
NULL
;

1101 ià(!
få
 || !få->
is
)

1102  
NULL
;

1104 
IJKFF_P’ode
 *
node
 = 
	`få’ode_®loc
((
IJKFF_P’ode_O·que
));

1105 ià(!
node
)

1106  
node
;

1108 
VideoS‹
 *
is
 = 
få
->is;

1109 
IJKFF_P’ode_O·que
 *
İaque
 = 
node
->opaque;

1110 
JNIEnv
 *
’v
 = 
NULL
;

1111 
»t
 = 0;

1112 
jobjeù
 
jsurçû
 = 
NULL
;

1114 
node
->
func_de¡roy
 = func_destroy;

1115 
node
->
func_run_sync
 = func_run_sync;

1116 
node
->
func_æush
 = func_flush;

1117 
İaque
->
p–še
 =…ipeline;

1118 
İaque
->
få
 = ffp;

1119 
İaque
->
decod”
 = &
is
->
viddec
;

1120 
İaque
->
w—k_vout
 = 
vout
;

1122 
İaque
->
codeı¬
 = 
	`avcodec_·¿m‘”s_®loc
();

1123 ià(!
İaque
->
codeı¬
)

1124 
ç
;

1126 
»t
 = 
	`avcodec_·¿m‘”s_äom_cÚ‹xt
(
İaque
->
codeı¬
, o·que->
decod”
->
avùx
);

1127 ià(
»t
)

1128 
ç
;

1130 
İaque
->
codeı¬
->
codec_id
) {

1131 
AV_CODEC_ID_H264
:

1132 ià(!
få
->
medŸcodec_avc
 && !få->
medŸcodec_®l_videos
) {

1133 
	`ALOGE
("%s: MedŸCodec: AVC/H264 i di§bËd. codec_id:%d \n", 
__func__
, 
İaque
->
codeı¬
->
codec_id
);

1134 
ç
;

1136 
İaque
->
codeı¬
->
´ofe
) {

1137 
FF_PROFILE_H264_BASELINE
:

1138 
	`ALOGI
("%s: MedŸCodec: H264_BASELINE:ƒÇbËd\n", 
__func__
);

1140 
FF_PROFILE_H264_CONSTRAINED_BASELINE
:

1141 
	`ALOGI
("%s: MedŸCodec: H264_CONSTRAINED_BASELINE:ƒÇbËd\n", 
__func__
);

1143 
FF_PROFILE_H264_MAIN
:

1144 
	`ALOGI
("%s: MedŸCodec: H264_MAIN:ƒÇbËd\n", 
__func__
);

1146 
FF_PROFILE_H264_EXTENDED
:

1147 
	`ALOGI
("%s: MedŸCodec: H264_EXTENDED:ƒÇbËd\n", 
__func__
);

1149 
FF_PROFILE_H264_HIGH
:

1150 
	`ALOGI
("%s: MedŸCodec: H264_HIGH:ƒÇbËd\n", 
__func__
);

1152 
FF_PROFILE_H264_HIGH_10
:

1153 
	`ALOGW
("%s: MedŸCodec: H264_HIGH_10: di§bËd\n", 
__func__
);

1154 
ç
;

1155 
FF_PROFILE_H264_HIGH_10_INTRA
:

1156 
	`ALOGW
("%s: MedŸCodec: H264_HIGH_10_INTRA: di§bËd\n", 
__func__
);

1157 
ç
;

1158 
FF_PROFILE_H264_HIGH_422
:

1159 
	`ALOGW
("%s: MedŸCodec: H264_HIGH_10_422: di§bËd\n", 
__func__
);

1160 
ç
;

1161 
FF_PROFILE_H264_HIGH_422_INTRA
:

1162 
	`ALOGW
("%s: MedŸCodec: H264_HIGH_10_INTRA: di§bËd\n", 
__func__
);

1163 
ç
;

1164 
FF_PROFILE_H264_HIGH_444
:

1165 
	`ALOGW
("%s: MedŸCodec: H264_HIGH_10_444: di§bËd\n", 
__func__
);

1166 
ç
;

1167 
FF_PROFILE_H264_HIGH_444_PREDICTIVE
:

1168 
	`ALOGW
("%s: MedŸCodec: H264_HIGH_444_PREDICTIVE: di§bËd\n", 
__func__
);

1169 
ç
;

1170 
FF_PROFILE_H264_HIGH_444_INTRA
:

1171 
	`ALOGW
("%s: MedŸCodec: H264_HIGH_444_INTRA: di§bËd\n", 
__func__
);

1172 
ç
;

1173 
FF_PROFILE_H264_CAVLC_444
:

1174 
	`ALOGW
("%s: MedŸCodec: H264_CAVLC_444: di§bËd\n", 
__func__
);

1175 
ç
;

1177 
	`ALOGW
("%s: MedŸCodec: (%dèunknowÀ´ofe: di§bËd\n", 
__func__
, 
İaque
->
codeı¬
->
´ofe
);

1178 
ç
;

1180 
	`¡rıy
(
İaque
->
mcc
.
mime_ty³
, 
SDL_AMIME_VIDEO_AVC
);

1181 
İaque
->
mcc
.
´ofe
 = o·que->
codeı¬
->profile;

1182 
İaque
->
mcc
.
Ëv–
 = o·que->
codeı¬
->level;

1184 
AV_CODEC_ID_HEVC
:

1185 ià(!
få
->
medŸcodec_hevc
 && !få->
medŸcodec_®l_videos
) {

1186 
	`ALOGE
("%s: MedŸCodec/HEVC i di§bËd. codec_id:%d \n", 
__func__
, 
İaque
->
codeı¬
->
codec_id
);

1187 
ç
;

1189 
	`¡rıy
(
İaque
->
mcc
.
mime_ty³
, 
SDL_AMIME_VIDEO_HEVC
);

1190 
İaque
->
mcc
.
´ofe
 = o·que->
codeı¬
->profile;

1191 
İaque
->
mcc
.
Ëv–
 = o·que->
codeı¬
->level;

1193 
AV_CODEC_ID_MPEG2VIDEO
:

1194 ià(!
få
->
medŸcodec_m³g2
 && !få->
medŸcodec_®l_videos
) {

1195 
	`ALOGE
("%s: MedŸCodec/MPEG2VIDEO i di§bËd. codec_id:%d \n", 
__func__
, 
İaque
->
codeı¬
->
codec_id
);

1196 
ç
;

1198 
	`¡rıy
(
İaque
->
mcc
.
mime_ty³
, 
SDL_AMIME_VIDEO_MPEG2VIDEO
);

1199 
İaque
->
mcc
.
´ofe
 = o·que->
codeı¬
->profile;

1200 
İaque
->
mcc
.
Ëv–
 = o·que->
codeı¬
->level;

1202 
AV_CODEC_ID_MPEG4
:

1203 ià(!
få
->
medŸcodec_m³g4
 && !få->
medŸcodec_®l_videos
) {

1204 
	`ALOGE
("%s: MedŸCodec/MPEG4 i di§bËd. codec_id:%d \n", 
__func__
, 
İaque
->
codeı¬
->
codec_id
);

1205 
ç
;

1207 ià((
İaque
->
codeı¬
->
codec_g
 & 0x0000FFFF) == 0x00005844) {

1208 
	`ALOGE
("%s: divx i nÙ suµÜ‹d \n", 
__func__
);

1209 
ç
;

1211 
	`¡rıy
(
İaque
->
mcc
.
mime_ty³
, 
SDL_AMIME_VIDEO_MPEG4
);

1212 
İaque
->
mcc
.
´ofe
 = o·que->
codeı¬
->profile >= 0 ? opaque->codecpar->profile : 0;

1213 
İaque
->
mcc
.
Ëv–
 = o·que->
codeı¬
->level >= 0 ? opaque->codecpar->level : 1;

1217 
	`ALOGE
("%s:ü—‹:‚Ù H264 o¸H265/HEVC, codec_id:%d \n", 
__func__
, 
İaque
->
codeı¬
->
codec_id
);

1218 
ç
;

1221 ià(
JNI_OK
 !ğ
	`SDL_JNI_S‘upTh»adEnv
(&
’v
)) {

1222 
	`ALOGE
("%s:ü—‹: S‘upTh»adEnv faed\n", 
__func__
);

1223 
ç
;

1226 
İaque
->
acodec_mu‹x
 = 
	`SDL_C»©eMu‹x
();

1227 
İaque
->
acodec_cÚd
 = 
	`SDL_C»©eCÚd
();

1228 
İaque
->
acodec_fœ¡_dequeue_ouut_mu‹x
 = 
	`SDL_C»©eMu‹x
();

1229 
İaque
->
acodec_fœ¡_dequeue_ouut_cÚd
 = 
	`SDL_C»©eCÚd
();

1230 
İaque
->
ªy_šput_mu‹x
 = 
	`SDL_C»©eMu‹x
();

1231 
İaque
->
ªy_šput_cÚd
 = 
	`SDL_C»©eCÚd
();

1233 ià(!
İaque
->
acodec_cÚd
 || !İaque->acodec_cÚd || !İaque->
acodec_fœ¡_dequeue_ouut_mu‹x
 || !İaque->
acodec_fœ¡_dequeue_ouut_cÚd
) {

1234 
	`ALOGE
("%s:İ’_video_decod”: SDL_C»©eCÚd(èçed\n", 
__func__
);

1235 
ç
;

1238 
»t
 = 
	`»ü—‹_fÜm©_l
(
’v
, 
node
);

1239 ià(
»t
) {

1240 
	`ALOGE
("amc:„ecreate_format_l failed\n");

1241 
ç
;

1244 ià(!
	`få–še_£Ëù_medŸcodec_l
(
p–še
, &
İaque
->
mcc
è|| !İaque->mcc.
codec_Çme
[0]) {

1245 
	`ALOGE
("amc:‚o suitable codec\n");

1246 
ç
;

1249 
jsurçû
 = 
	`få–še_g‘_surçû_as_glob®_»f
(
’v
, 
p–še
);

1250 
»t
 = 
	`»cÚfigu»_codec_l
(
’v
, 
node
, 
jsurçû
);

1251 
	`J4A_D–‘eGlob®Ref__p
(
’v
, &
jsurçû
);

1252 ià(
»t
 != 0)

1253 
ç
;

1255 
	`få_£t_video_codec_šfo
(
få
, 
MEDIACODEC_MODULE_NAME
, 
İaque
->
mcc
.
codec_Çme
);

1257 
İaque
->
off_buf_out
 = 0;

1258 ià(
İaque
->
n_buf_out
) {

1259 
i
;

1261 
İaque
->
amc_buf_out
 = 
	`ÿÎoc
(İaque->
n_buf_out
, (*opaque->amc_buf_out));

1262 
	`as£¹
(
İaque
->
amc_buf_out
 !ğ
NULL
);

1263 
i
 = 0; i < 
İaque
->
n_buf_out
; i++)

1264 
İaque
->
amc_buf_out
[
i
].
±s
 = 
AV_NOPTS_VALUE
;

1267 
	`SDL_S³edSam¶”Re£t
(&
İaque
->
§m¶”
);

1268 
få
->
¡©
.
vdec_ty³
 = 
FFP_PROPV_DECODER_MEDIACODEC
;

1269  
node
;

1270 
ç
:

1271 
	`få’ode_ä“_p
(&
node
);

1272  
NULL
;

1273 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/pipeline/ffpipenode_android_mediacodec_vdec.h

24 #iâdeà
FFPLAY__FF_FFPIPENODE_ANDROID_MEDIACODEC_VDEC_H


25 
	#FFPLAY__FF_FFPIPENODE_ANDROID_MEDIACODEC_VDEC_H


	)

27 
	~"../../ff_få’ode.h
"

28 
	~"../../ff_få–še.h
"

29 
	~"ijksdl/ijksdl_vout.h
"

31 
FFPÏy”
 
	tFFPÏy”
;

33 
IJKFF_P’ode
 *
få’ode_ü—‹_video_decod”_äom_ªdroid_medŸcodec
(
FFPÏy”
 *
få
, 
IJKFF_P–še
 *
p–še
, 
SDL_Vout
 *
vout
);

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/pipeline/h264_nal.h

25 
	~<lim™s.h
>

26 
	~"libavcodec/avcodec.h
"

27 
	~"ijksdl/ijksdl_log.h
"

30 
	$cÚv”t_¥s_µs
ĞcÚ¡ 
ušt8_t
 *
p_buf
, 
size_t
 
i_buf_size
,

31 
ušt8_t
 *
p_out_buf
, 
size_t
 
i_out_buf_size
,

32 
size_t
 *
p_¥s_µs_size
, size_ˆ*
p_Çl_size
)

35 
ušt32_t
 
i_d©a_size
 = 
i_buf_size
, 
i_Çl_size
, 
i_¥s_µs_size
 = 0;

36 
i_loİ_’d
;

39 ifĞ
i_d©a_size
 < 7 )

41 
	`ALOGE
( "Input Metadataoo small" );

47 ià(
p_Çl_size
)

48 *
p_Çl_size
 = (
p_buf
[4] & 0x03) + 1;

49 
p_buf
 += 5;

50 
i_d©a_size
 -= 5;

52  
j
 = 0; j < 2; j++ )

55 ifĞ
i_d©a_size
 < 1 )

57 
	`ALOGE
( "PPSoo small‡fter…rocessing SPS/PPS %u",

58 
i_d©a_size
 );

61 
i_loİ_’d
 = 
p_buf
[0] & (
j
 == 0 ? 0x1f : 0xff);

62 
p_buf
++; 
i_d©a_size
--;

64  
i
 = 0; i < 
i_loİ_’d
; i++)

66 ifĞ
i_d©a_size
 < 2 )

68 
	`ALOGE
Ğ"SPS i toØsm®È%u", 
i_d©a_size
 );

72 
i_Çl_size
 = (
p_buf
[0] << 8) |…_buf[1];

73 
p_buf
 += 2;

74 
i_d©a_size
 -= 2;

76 ifĞ
i_d©a_size
 < 
i_Çl_size
 )

78 
	`ALOGE
( "SPS size does‚ot match NAL specified size %u",

79 
i_d©a_size
 );

82 ifĞ
i_¥s_µs_size
 + 4 + 
i_Çl_size
 > 
i_out_buf_size
 )

84 
	`ALOGE
( "Output SPS/PPS bufferoo small" );

88 
p_out_buf
[
i_¥s_µs_size
++] = 0;

89 
p_out_buf
[
i_¥s_µs_size
++] = 0;

90 
p_out_buf
[
i_¥s_µs_size
++] = 0;

91 
p_out_buf
[
i_¥s_µs_size
++] = 1;

93 
	`memıy
Ğ
p_out_buf
 + 
i_¥s_µs_size
, 
p_buf
, 
i_Çl_size
 );

94 
i_¥s_µs_size
 +ğ
i_Çl_size
;

96 
p_buf
 +ğ
i_Çl_size
;

97 
i_d©a_size
 -ğ
i_Çl_size
;

101 *
p_¥s_µs_size
 = 
i_¥s_µs_size
;

104 
	}
}

108 
	sH264CÚv”tS‹
 {

109 
ušt32_t
 
	mÇl_Ën
;

110 
ušt32_t
 
	mÇl_pos
;

111 } 
	tH264CÚv”tS‹
;

113 
	$cÚv”t_h264_to_ªÃxb
Ğ
ušt8_t
 *
p_buf
, 
size_t
 
i_Ën
,

114 
size_t
 
i_Çl_size
,

115 
H264CÚv”tS‹
 *
¡©e
 )

117 ifĞ
i_Çl_size
 < 3 || i_nal_size > 4 )

121  
i_Ën
 > 0 )

123 ifĞ
¡©e
->
Çl_pos
 < 
i_Çl_size
 ) {

124 
i
;

125  
i
 = 0; 
¡©e
->
Çl_pos
 < 
i_Çl_size
 && i < 
i_Ën
; i++, state->nal_pos++ ) {

126 
¡©e
->
Çl_Ën
 = (¡©e->Çl_ËÀ<< 8è| 
p_buf
[
i
];

127 
p_buf
[
i
] = 0;

129 ifĞ
¡©e
->
Çl_pos
 < 
i_Çl_size
 )

131 
p_buf
[
i
 - 1] = 1;

132 
p_buf
 +ğ
i
;

133 
i_Ën
 -ğ
i
;

135 ifĞ
¡©e
->
Çl_Ën
 > 
INT_MAX
 )

137 ifĞ
¡©e
->
Çl_Ën
 > 
i_Ën
 )

139 
¡©e
->
Çl_Ën
 -ğ
i_Ën
;

144 
p_buf
 +ğ
¡©e
->
Çl_Ën
;

145 
i_Ën
 -ğ
¡©e
->
Çl_Ën
;

146 
¡©e
->
Çl_Ën
 = 0;

147 
¡©e
->
Çl_pos
 = 0;

150 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/pipeline/hevc_nal.h

23 
	~<lim™s.h
>

24 
	~"libavcodec/avcodec.h
"

25 
	~"ijksdl/ijksdl_log.h
"

28 
	$cÚv”t_hevc_Çl_un™s
(cÚ¡ 
ušt8_t
 *
p_buf
,
size_t
 
i_buf_size
,

29 
ušt8_t
 *
p_out_buf
,
size_t
 
i_out_buf_size
,

30 
size_t
 *
p_¥s_µs_size
,size_ˆ*
p_Çl_size
)

32 
i
, 
num_¬¿ys
;

33 cÚ¡ 
ušt8_t
 *
p_’d
 = 
p_buf
 + 
i_buf_size
;

34 
ušt32_t
 
i_¥s_µs_size
 = 0;

36 ifĞ
i_buf_size
 <ğ3 || ( !
p_buf
[0] && !p_buf[1] &&…_buf[2] <= 1 ) )

39 ifĞ
p_’d
 - 
p_buf
 < 23 )

41 
	`ALOGE
( "Input Metadataoo small" );

45 
p_buf
 += 21;

47 ifĞ
p_Çl_size
 )

48 *
p_Çl_size
 = (*
p_buf
 & 0x03) + 1;

49 
p_buf
++;

51 
num_¬¿ys
 = *
p_buf
++;

53  
i
 = 0; i < 
num_¬¿ys
; i++ )

55 
ty³
, 
út
, 
j
;

57 ifĞ
p_’d
 - 
p_buf
 < 3 )

59 
	`ALOGE
( "Input Metadataoo small" );

62 
ty³
 = *(
p_buf
++) & 0x3f;

63 ()(
ty³
);

65 
út
 = 
p_buf
[0] << 8 |…_buf[1];

66 
p_buf
 += 2;

68  
j
 = 0; j < 
út
; j++ )

70 
i_Çl_size
;

72 ifĞ
p_’d
 - 
p_buf
 < 2 )

74 
	`ALOGE
( "Input Metadataoo small" );

78 
i_Çl_size
 = 
p_buf
[0] << 8 |…_buf[1];

79 
p_buf
 += 2;

81 ifĞ
i_Çl_size
 < 0 || 
p_’d
 - 
p_buf
 < i_nal_size )

83 
	`ALOGE
( "NAL unit size does‚ot match Input Metadata size" );

87 ifĞ
i_¥s_µs_size
 + 4 + 
i_Çl_size
 > 
i_out_buf_size
 )

89 
	`ALOGE
( "Output bufferoo small" );

93 
p_out_buf
[
i_¥s_µs_size
++] = 0;

94 
p_out_buf
[
i_¥s_µs_size
++] = 0;

95 
p_out_buf
[
i_¥s_µs_size
++] = 0;

96 
p_out_buf
[
i_¥s_µs_size
++] = 1;

98 
	`memıy
(
p_out_buf
 + 
i_¥s_µs_size
, 
p_buf
, 
i_Çl_size
);

99 
p_buf
 +ğ
i_Çl_size
;

101 
i_¥s_µs_size
 +ğ
i_Çl_size
;

105 *
p_¥s_µs_size
 = 
i_¥s_µs_size
;

108 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/pipeline/mpeg4_esds.h

23 
	~<lim™s.h
>

24 
	~<¡dšt.h
>

25 
	~"libavcodec/avcodec.h
"

27 
	$»¡Üe_m³g4_esds
(
AVCodecP¬am‘”s
 *
codeı¬
,

28 
ušt8_t
 *
p_buf
, 
size_t
 
i_buf_size
,

29 
size_t
 
i_es_dsü_Ëngth
, size_ˆ
i_dec_dsü_Ëngth
,

30 
ušt8_t
 *
p_esds_buf
)

32 
p_esds_buf
[0] = 0x03;

33 
p_esds_buf
[1] = 0x80;

34 
p_esds_buf
[2] = 0x80;

35 
p_esds_buf
[3] = 0x80;

36 
p_esds_buf
[4] = 
i_es_dsü_Ëngth
;

37 
ušt16_t
 *
es_id
 = (ušt16_ˆ*)&
p_esds_buf
[5];

38 *
es_id
 = 
	`htobe16
(1);

40 
p_esds_buf
[8] = 0x04;

41 
p_esds_buf
[9] = 0x80;

42 
p_esds_buf
[10] = 0x80;

43 
p_esds_buf
[11] = 0x80;

44 
p_esds_buf
[12] = 
i_dec_dsü_Ëngth
;

45 
p_esds_buf
[13] = 0x20;

46 
p_esds_buf
[14] = 0x11;

47 
ušt32_t
 *
max_br
 = (ušt32_ˆ*)&
p_esds_buf
[18];

48 
ušt32_t
 *
avg_br
 = (ušt32_ˆ*)&
p_esds_buf
[22];

49 *
max_br
 = *
avg_br
 = 
	`htobe32
(
codeı¬
->
b™_¿‹
);

51 
p_esds_buf
[26] = 0x05;

52 
p_esds_buf
[27] = 0x80;

53 
p_esds_buf
[28] = 0x80;

54 
p_esds_buf
[29] = 0x80;

55 
p_esds_buf
[30] = 
i_buf_size
;

56 
	`memıy
(&
p_esds_buf
[31], 
p_buf
, 
i_buf_size
);

58 
p_esds_buf
[31+
i_buf_size
] = 0x06;

59 
p_esds_buf
[31+
i_buf_size
+1] = 0x80;

60 
p_esds_buf
[31+
i_buf_size
+2] = 0x80;

61 
p_esds_buf
[31+
i_buf_size
+3] = 0x80;

62 
p_esds_buf
[31+
i_buf_size
+4] = 0x01;

63 
p_esds_buf
[31+
i_buf_size
+5] = 0x02;

64 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/config.h

22 #iâdeà
FFPLAY__CONFIG_H


23 
	#FFPLAY__CONFIG_H


	)

25 
	~"libffm³g/cÚfig.h
"

29 #ifdeà
CONFIG_AVFILTER


30 #undeà
CONFIG_AVFILTER


32 
	#CONFIG_AVFILTER
 0

	)

34 #ifdeà
FFP_MERGE


35 #undeà
FFP_MERGE


38 #ifdeà
FFP_SUB


39 #undeà
FFP_SUB


42 #iâdeà
FFMPEG_LOG_TAG


43 
	#FFMPEG_LOG_TAG
 "IJKFFMPEG"

	)

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_cmdutils.c

26 
	~"ff_cmduts.h
"

28 
	~"libavut/di¥Ïy.h
"

29 
	~"libavut/ev®.h
"

73 
	$´št_”rÜ
(cÚ¡ *
f’ame
, 
”r
)

75 
”rbuf
[128];

76 cÚ¡ *
”rbuf_±r
 = 
”rbuf
;

78 ià(
	`av_¡»¼Ü
(
”r
, 
”rbuf
, (errbuf)) < 0)

79 
”rbuf_±r
 = 
	`¡»¼Ü
(
	`AVUNERROR
(
”r
));

80 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "%s: %s\n", 
f’ame
, 
”rbuf_±r
);

81 
	}
}

120 
	$check_¡»am_¥ecif›r
(
AVFÜm©CÚ‹xt
 *
s
, 
AVSŒ—m
 *
¡
, cÚ¡ *
¥ec
)

122 
»t
 = 
	`avfÜm©_m©ch_¡»am_¥ecif›r
(
s
, 
¡
, 
¥ec
);

123 ià(
»t
 < 0)

124 
	`av_log
(
s
, 
AV_LOG_ERROR
, "Inv®id sŒ—m s³cif›r: %s.\n", 
¥ec
);

125  
»t
;

126 
	}
}

128 
AVDiùiÚ¬y
 *
	$f‹r_codec_İts
(
AVDiùiÚ¬y
 *
İts
, 
AVCodecID
 
codec_id
,

129 
AVFÜm©CÚ‹xt
 *
s
, 
AVSŒ—m
 *
¡
, 
AVCodec
 *
codec
)

131 
AVDiùiÚ¬y
 *
»t
 = 
NULL
;

132 
AVDiùiÚ¬yEÁry
 *
t
 = 
NULL
;

133 
æags
 = 
s
->
ofÜm©
 ? 
AV_OPT_FLAG_ENCODING_PARAM


134 : 
AV_OPT_FLAG_DECODING_PARAM
;

135 
´efix
 = 0;

136 cÚ¡ 
AVCÏss
 *
cc
 = 
	`avcodec_g‘_şass
();

138 ià(!
codec
)

139 
codec
 = 
s
->
ofÜm©
 ? 
	`avcodec_fšd_’cod”
(
codec_id
)

140 : 
	`avcodec_fšd_decod”
(
codec_id
);

142 
¡
->
codeı¬
->
codec_ty³
) {

143 
AVMEDIA_TYPE_VIDEO
:

144 
´efix
 = 'v';

145 
æags
 |ğ
AV_OPT_FLAG_VIDEO_PARAM
;

147 
AVMEDIA_TYPE_AUDIO
:

148 
´efix
 = 'a';

149 
æags
 |ğ
AV_OPT_FLAG_AUDIO_PARAM
;

151 
AVMEDIA_TYPE_SUBTITLE
:

152 
´efix
 = 's';

153 
æags
 |ğ
AV_OPT_FLAG_SUBTITLE_PARAM
;

159 (
t
 = 
	`av_diù_g‘
(
İts
, "",, 
AV_DICT_IGNORE_SUFFIX
))) {

160 *
p
 = 
	`¡rchr
(
t
->
key
, ':');

163 ià(
p
)

164 
	`check_¡»am_¥ecif›r
(
s
, 
¡
, 
p
 + 1)) {

165 1: *
p
 = 0; ;

167 :  
NULL
;

170 ià(
	`av_İt_fšd
(&
cc
, 
t
->
key
, 
NULL
, 
æags
, 
AV_OPT_SEARCH_FAKE_OBJ
) ||

171 (
codec
 && codec->
´iv_şass
 &&

172 
	`av_İt_fšd
(&
codec
->
´iv_şass
, 
t
->
key
, 
NULL
, 
æags
,

173 
AV_OPT_SEARCH_FAKE_OBJ
)))

174 
	`av_diù_£t
(&
»t
, 
t
->
key
,->
v®ue
, 0);

175 ià(
t
->
key
[0] =ğ
´efix
 &&

176 
	`av_İt_fšd
(&
cc
, 
t
->
key
 + 1, 
NULL
, 
æags
,

177 
AV_OPT_SEARCH_FAKE_OBJ
))

178 
	`av_diù_£t
(&
»t
, 
t
->
key
 + 1,->
v®ue
, 0);

180 ià(
p
)

181 *
p
 = ':';

183  
»t
;

184 
	}
}

186 
AVDiùiÚ¬y
 **
	$£tup_fšd_¡»am_šfo_İts
(
AVFÜm©CÚ‹xt
 *
s
,

187 
AVDiùiÚ¬y
 *
codec_İts
)

189 
i
;

190 
AVDiùiÚ¬y
 **
İts
;

192 ià(!
s
->
nb_¡»ams
)

193  
NULL
;

194 
İts
 = 
	`av_m®locz
(
s
->
nb_¡»ams
 * (*opts));

195 ià(!
İts
) {

196 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

198  
NULL
;

200 
i
 = 0; i < 
s
->
nb_¡»ams
; i++)

201 
İts
[
i
] = 
	`f‹r_codec_İts
(
codec_İts
, 
s
->
¡»ams
[i]->
codeı¬
->
codec_id
,

202 
s
, s->
¡»ams
[
i
], 
NULL
);

203  
İts
;

204 
	}
}

206 *
	$grow_¬¿y
(*
¬¿y
, 
–em_size
, *
size
, 
Ãw_size
)

208 ià(
Ãw_size
 >ğ
INT_MAX
 / 
–em_size
) {

209 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Arrayoo big.\n");

210  
NULL
;

212 ià(*
size
 < 
Ãw_size
) {

213 
ušt8_t
 *
tmp
 = 
	`av_»®loc_¬¿y
(
¬¿y
, 
Ãw_size
, 
–em_size
);

214 ià(!
tmp
) {

215 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Could‚ot‡lloc buffer.\n");

216  
NULL
;

218 
	`mem£t
(
tmp
 + *
size
*
–em_size
, 0, (
Ãw_size
-*size) *ƒlem_size);

219 *
size
 = 
Ãw_size
;

220  
tmp
;

222  
¬¿y
;

223 
	}
}

225 
	$g‘_rÙ©iÚ
(
AVSŒ—m
 *
¡
)

227 
AVDiùiÚ¬yEÁry
 *
rÙ©e_g
 = 
	`av_diù_g‘
(
¡
->
m‘ad©a
, "rÙ©e", 
NULL
, 0);

228 
ušt8_t
* 
di¥Ïym©rix
 = 
	`av_¡»am_g‘_side_d©a
(
¡
,

229 
AV_PKT_DATA_DISPLAYMATRIX
, 
NULL
);

230 
th‘a
 = 0;

232 ià(
rÙ©e_g
 && *rÙ©e_g->
v®ue
 && 
	`¡rcmp
(rotate_tag->value, "0")) {

233 *

;

234 
th‘a
 = 
	`av_¡¹od
(
rÙ©e_g
->
v®ue
, &

);

235 ià(*

)

236 
th‘a
 = 0;

238 ià(
di¥Ïym©rix
 && !
th‘a
)

239 
th‘a
 = -
	`av_di¥Ïy_rÙ©iÚ_g‘
((
št32_t
*è
di¥Ïym©rix
);

241 
th‘a
 -ğ360*
	`æoÜ
(theta/360 + 0.9/360);

243 ià(
	`çbs
(
th‘a
 - 90*
	`round
(theta/90)) > 2)

244 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "Odd„otation‡ngle.\n"

249  
th‘a
;

250 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_cmdutils.h

26 #iâdeà
FFPLAY__FF_CMDUTILS_H


27 
	#FFPLAY__FF_CMDUTILS_H


	)

29 
	~"ff_ffšc.h
"

31 
´št_”rÜ
(cÚ¡ *
f’ame
, 
”r
);

32 
AVDiùiÚ¬y
 **
£tup_fšd_¡»am_šfo_İts
(
AVFÜm©CÚ‹xt
 *
s
, AVDiùiÚ¬y *
codec_İts
);

33 
AVDiùiÚ¬y
 *
f‹r_codec_İts
(AVDiùiÚ¬y *
İts
, 
AVCodecID
 
codec_id
,

34 
AVFÜm©CÚ‹xt
 *
s
, 
AVSŒ—m
 *
¡
, 
AVCodec
 *
codec
);

45 *
grow_¬¿y
(*
¬¿y
, 
–em_size
, *
size
, 
Ãw_size
);

47 
	#GROW_ARRAY
(
¬¿y
, 
nb_–ems
)\

48 
¬¿y
 = 
	`grow_¬¿y
×¼ay, (*¬¿y), &
nb_–ems
,‚b_–em + 1)

	)

50 
g‘_rÙ©iÚ
(
AVSŒ—m
 *
¡
);

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_fferror.h

25 #iâdeà
FFPLAY__FF_FFERROR_H


26 
	#FFPLAY__FF_FFERROR_H


	)

28 
	#EIJK_FAILED
 -1

	)

29 
	#EIJK_OUT_OF_MEMORY
 -2

	)

30 
	#EIJK_INVALID_STATE
 -3

	)

31 
	#EIJK_NULL_IS_PTR
 -4

	)

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffinc.h

25 #iâdeà
FFPLAY__FF_FFINC_H


26 
	#FFPLAY__FF_FFINC_H


	)

28 
	~<¡dboŞ.h
>

29 
	~<as£¹.h
>

30 
	~"libavut/av¡ršg.h
"

31 
	~"libavut/time.h
"

32 
	~"libavfÜm©/avfÜm©.h
"

33 
	~"libavcodec/avfá.h
"

34 
	~"libswsÿË/swsÿË.h
"

35 
	~"libavut/­¶iÿtiÚ.h
"

36 
	~"libavut/ba£64.h
"

37 
	~"libavut/”rÜ.h
"

38 
	~"libavut/İt.h
"

39 
	~"libavut/v”siÚ.h
"

40 
	~"libsw»§m¶e/sw»§m¶e.h
"

42 
	~"ijksdl/ijksdl.h
"

44 (*
	tijk_šjeù_ÿÎback
)(*
	tİaque
, 
	tty³
, *
	td©a
, 
	tsize_t
 
	td©a_size
);

46 
	#FFP_OPT_CATEGORY_FORMAT
 1

	)

47 
	#FFP_OPT_CATEGORY_CODEC
 2

	)

48 
	#FFP_OPT_CATEGORY_SWS
 3

	)

49 
	#FFP_OPT_CATEGORY_PLAYER
 4

	)

50 
	#FFP_OPT_CATEGORY_SWR
 5

	)

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffmsg.h

25 #iâdeà
FFPLAY__FF_FFMSG_H


26 
	#FFPLAY__FF_FFMSG_H


	)

28 
	#FFP_MSG_FLUSH
 0

	)

29 
	#FFP_MSG_ERROR
 100

	)

30 
	#FFP_MSG_PREPARED
 200

	)

31 
	#FFP_MSG_COMPLETED
 300

	)

32 
	#FFP_MSG_VIDEO_SIZE_CHANGED
 400

	)

33 
	#FFP_MSG_SAR_CHANGED
 401

	)

34 
	#FFP_MSG_VIDEO_RENDERING_START
 402

	)

35 
	#FFP_MSG_AUDIO_RENDERING_START
 403

	)

36 
	#FFP_MSG_VIDEO_ROTATION_CHANGED
 404

	)

37 
	#FFP_MSG_BUFFERING_START
 500

	)

38 
	#FFP_MSG_BUFFERING_END
 501

	)

39 
	#FFP_MSG_BUFFERING_UPDATE
 502

	)

40 
	#FFP_MSG_BUFFERING_BYTES_UPDATE
 503

	)

41 
	#FFP_MSG_BUFFERING_TIME_UPDATE
 504

	)

42 
	#FFP_MSG_SEEK_COMPLETE
 600

	)

43 
	#FFP_MSG_PLAYBACK_STATE_CHANGED
 700

	)

44 
	#FFP_MSG_TIMED_TEXT
 800

	)

46 
	#FFP_MSG_VIDEO_DECODER_OPEN
 10001

	)

48 
	#FFP_REQ_START
 20001

	)

49 
	#FFP_REQ_PAUSE
 20002

	)

50 
	#FFP_REQ_SEEK
 20003

	)

52 
	#FFP_PROP_FLOAT_VIDEO_DECODE_FRAMES_PER_SECOND
 10001

	)

53 
	#FFP_PROP_FLOAT_VIDEO_OUTPUT_FRAMES_PER_SECOND
 10002

	)

54 
	#FFP_PROP_FLOAT_PLAYBACK_RATE
 10003

	)

55 
	#FFP_PROP_FLOAT_PLAYBACK_VOLUME
 10006

	)

56 
	#FFP_PROP_FLOAT_AVDELAY
 10004

	)

57 
	#FFP_PROP_FLOAT_AVDIFF
 10005

	)

59 
	#FFP_PROP_INT64_SELECTED_VIDEO_STREAM
 20001

	)

60 
	#FFP_PROP_INT64_SELECTED_AUDIO_STREAM
 20002

	)

61 
	#FFP_PROP_INT64_SELECTED_TIMEDTEXT_STREAM
 20011

	)

62 
	#FFP_PROP_INT64_VIDEO_DECODER
 20003

	)

63 
	#FFP_PROP_INT64_AUDIO_DECODER
 20004

	)

64 
	#FFP_PROPV_DECODER_UNKNOWN
 0

	)

65 
	#FFP_PROPV_DECODER_AVCODEC
 1

	)

66 
	#FFP_PROPV_DECODER_MEDIACODEC
 2

	)

67 
	#FFP_PROPV_DECODER_VIDEOTOOLBOX
 3

	)

68 
	#FFP_PROP_INT64_VIDEO_CACHED_DURATION
 20005

	)

69 
	#FFP_PROP_INT64_AUDIO_CACHED_DURATION
 20006

	)

70 
	#FFP_PROP_INT64_VIDEO_CACHED_BYTES
 20007

	)

71 
	#FFP_PROP_INT64_AUDIO_CACHED_BYTES
 20008

	)

72 
	#FFP_PROP_INT64_VIDEO_CACHED_PACKETS
 20009

	)

73 
	#FFP_PROP_INT64_AUDIO_CACHED_PACKETS
 20010

	)

75 
	#FFP_PROP_INT64_BIT_RATE
 20100

	)

77 
	#FFP_PROP_INT64_TCP_SPEED
 20200

	)

79 
	#FFP_PROP_INT64_ASYNC_STATISTIC_BUF_BACKWARDS
 20201

	)

80 
	#FFP_PROP_INT64_ASYNC_STATISTIC_BUF_FORWARDS
 20202

	)

81 
	#FFP_PROP_INT64_ASYNC_STATISTIC_BUF_CAPACITY
 20203

	)

82 
	#FFP_PROP_INT64_TRAFFIC_STATISTIC_BYTE_COUNT
 20204

	)

84 
	#FFP_PROP_INT64_LATEST_SEEK_LOAD_DURATION
 20300

	)

86 
	#FFP_PROP_INT64_CACHE_STATISTIC_PHYSICAL_POS
 20205

	)

88 
	#FFP_PROP_INT64_CACHE_STATISTIC_BUF_FORWARDS
 20206

	)

90 
	#FFP_PROP_INT64_CACHE_STATISTIC_FILE_POS
 20207

	)

92 
	#FFP_PROP_INT64_CACHE_STATISTIC_COUNT_BYTES
 20208

	)

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffmsg_queue.h

25 #iâdeà
FFPLAY__FF_FFMSG_QUEUE_H


26 
	#FFPLAY__FF_FFMSG_QUEUE_H


	)

28 
	~"ff_ffšc.h
"

29 
	~"ff_ffmsg.h
"

33 
	sAVMes§ge
 {

34 
	mwh©
;

35 
	m¬g1
;

36 
	m¬g2
;

37 *
	mobj
;

38 (*
	mä“_l
)(*
	mobj
);

39 
AVMes§ge
 *
	mÃxt
;

40 } 
	tAVMes§ge
;

42 
	sMes§geQueue
 {

43 
AVMes§ge
 *
	mfœ¡_msg
, *
	mÏ¡_msg
;

44 
	mnb_mes§ges
;

45 
	mabÜt_»que¡
;

46 
SDL_mu‹x
 *
	mmu‹x
;

47 
SDL_cÚd
 *
	mcÚd
;

49 
AVMes§ge
 *
	m»cyşe_msg
;

50 
	m»cyşe_couÁ
;

51 
	m®loc_couÁ
;

52 } 
	tMes§geQueue
;

54 
šlše
 
	$msg_ä“_»s
(
AVMes§ge
 *
msg
)

56 ià(!
msg
 || !msg->
obj
)

58 
	`as£¹
(
msg
->
ä“_l
);

59 
msg
->
	`ä“_l
(msg->
obj
);

60 
msg
->
obj
 = 
NULL
;

61 
	}
}

63 
šlše
 
	$msg_queue_put_´iv©e
(
Mes§geQueue
 *
q
, 
AVMes§ge
 *
msg
)

65 
AVMes§ge
 *
msg1
;

67 ià(
q
->
abÜt_»que¡
)

70 #ifdeà
FFP_MERGE


71 
msg1
 = 
	`av_m®loc
((
AVMes§ge
));

73 
msg1
 = 
q
->
»cyşe_msg
;

74 ià(
msg1
) {

75 
q
->
»cyşe_msg
 = 
msg1
->
Ãxt
;

76 
q
->
»cyşe_couÁ
++;

78 
q
->
®loc_couÁ
++;

79 
msg1
 = 
	`av_m®loc
((
AVMes§ge
));

81 #ifdeà
FFP_SHOW_MSG_RECYCLE


82 
tÙ®_couÁ
 = 
q
->
»cyşe_couÁ
 + q->
®loc_couÁ
;

83 ià(!(
tÙ®_couÁ
 % 10)) {

84 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "msg-»cyş\t%d + \t%d = \t%d\n", 
q
->
»cyşe_couÁ
, q->
®loc_couÁ
, 
tÙ®_couÁ
);

88 ià(!
msg1
)

91 *
msg1
 = *
msg
;

92 
msg1
->
Ãxt
 = 
NULL
;

94 ià(!
q
->
Ï¡_msg
)

95 
q
->
fœ¡_msg
 = 
msg1
;

97 
q
->
Ï¡_msg
->
Ãxt
 = 
msg1
;

98 
q
->
Ï¡_msg
 = 
msg1
;

99 
q
->
nb_mes§ges
++;

100 
	`SDL_CÚdSigÇl
(
q
->
cÚd
);

102 
	}
}

104 
šlše
 
	$msg_queue_put
(
Mes§geQueue
 *
q
, 
AVMes§ge
 *
msg
)

106 
»t
;

108 
	`SDL_LockMu‹x
(
q
->
mu‹x
);

109 
»t
 = 
	`msg_queue_put_´iv©e
(
q
, 
msg
);

110 
	`SDL_UÆockMu‹x
(
q
->
mu‹x
);

112  
»t
;

113 
	}
}

115 
šlše
 
	$msg_š™_msg
(
AVMes§ge
 *
msg
)

117 
	`mem£t
(
msg
, 0, (
AVMes§ge
));

118 
	}
}

120 
šlše
 
	$msg_queue_put_sim¶e1
(
Mes§geQueue
 *
q
, 
wh©
)

122 
AVMes§ge
 
msg
;

123 
	`msg_š™_msg
(&
msg
);

124 
msg
.
wh©
 = what;

125 
	`msg_queue_put
(
q
, &
msg
);

126 
	}
}

128 
šlše
 
	$msg_queue_put_sim¶e2
(
Mes§geQueue
 *
q
, 
wh©
, 
¬g1
)

130 
AVMes§ge
 
msg
;

131 
	`msg_š™_msg
(&
msg
);

132 
msg
.
wh©
 = what;

133 
msg
.
¬g1
 =‡rg1;

134 
	`msg_queue_put
(
q
, &
msg
);

135 
	}
}

137 
šlše
 
	$msg_queue_put_sim¶e3
(
Mes§geQueue
 *
q
, 
wh©
, 
¬g1
, 
¬g2
)

139 
AVMes§ge
 
msg
;

140 
	`msg_š™_msg
(&
msg
);

141 
msg
.
wh©
 = what;

142 
msg
.
¬g1
 =‡rg1;

143 
msg
.
¬g2
 =‡rg2;

144 
	`msg_queue_put
(
q
, &
msg
);

145 
	}
}

147 
šlše
 
	$msg_obj_ä“_l
(*
obj
)

149 
	`av_ä“
(
obj
);

150 
	}
}

152 
šlše
 
	$msg_queue_put_sim¶e4
(
Mes§geQueue
 *
q
, 
wh©
, 
¬g1
, 
¬g2
, *
obj
, 
obj_Ën
)

154 
AVMes§ge
 
msg
;

155 
	`msg_š™_msg
(&
msg
);

156 
msg
.
wh©
 = what;

157 
msg
.
¬g1
 =‡rg1;

158 
msg
.
¬g2
 =‡rg2;

159 
msg
.
obj
 = 
	`av_m®loc
(
obj_Ën
);

160 
	`memıy
(
msg
.
obj
, obj, 
obj_Ën
);

161 
msg
.
ä“_l
 = 
msg_obj_ä“_l
;

162 
	`msg_queue_put
(
q
, &
msg
);

163 
	}
}

165 
šlše
 
	$msg_queue_š™
(
Mes§geQueue
 *
q
)

167 
	`mem£t
(
q
, 0, (
Mes§geQueue
));

168 
q
->
mu‹x
 = 
	`SDL_C»©eMu‹x
();

169 
q
->
cÚd
 = 
	`SDL_C»©eCÚd
();

170 
q
->
abÜt_»que¡
 = 1;

171 
	}
}

173 
šlše
 
	$msg_queue_æush
(
Mes§geQueue
 *
q
)

175 
AVMes§ge
 *
msg
, *
msg1
;

177 
	`SDL_LockMu‹x
(
q
->
mu‹x
);

178 
msg
 = 
q
->
fœ¡_msg
; msg !ğ
NULL
; msg = 
msg1
) {

179 
msg1
 = 
msg
->
Ãxt
;

180 #ifdeà
FFP_MERGE


181 
	`av_ä“p
(&
msg
);

183 
msg
->
Ãxt
 = 
q
->
»cyşe_msg
;

184 
q
->
»cyşe_msg
 = 
msg
;

187 
q
->
Ï¡_msg
 = 
NULL
;

188 
q
->
fœ¡_msg
 = 
NULL
;

189 
q
->
nb_mes§ges
 = 0;

190 
	`SDL_UÆockMu‹x
(
q
->
mu‹x
);

191 
	}
}

193 
šlše
 
	$msg_queue_de¡roy
(
Mes§geQueue
 *
q
)

195 
	`msg_queue_æush
(
q
);

197 
	`SDL_LockMu‹x
(
q
->
mu‹x
);

198 
q
->
»cyşe_msg
) {

199 
AVMes§ge
 *
msg
 = 
q
->
»cyşe_msg
;

200 ià(
msg
)

201 
q
->
»cyşe_msg
 = 
msg
->
Ãxt
;

202 
	`msg_ä“_»s
(
msg
);

203 
	`av_ä“p
(&
msg
);

205 
	`SDL_UÆockMu‹x
(
q
->
mu‹x
);

207 
	`SDL_De¡royMu‹x
(
q
->
mu‹x
);

208 
	`SDL_De¡royCÚd
(
q
->
cÚd
);

209 
	}
}

211 
šlše
 
	$msg_queue_abÜt
(
Mes§geQueue
 *
q
)

213 
	`SDL_LockMu‹x
(
q
->
mu‹x
);

215 
q
->
abÜt_»que¡
 = 1;

217 
	`SDL_CÚdSigÇl
(
q
->
cÚd
);

219 
	`SDL_UÆockMu‹x
(
q
->
mu‹x
);

220 
	}
}

222 
šlše
 
	$msg_queue_¡¬t
(
Mes§geQueue
 *
q
)

224 
	`SDL_LockMu‹x
(
q
->
mu‹x
);

225 
q
->
abÜt_»que¡
 = 0;

227 
AVMes§ge
 
msg
;

228 
	`msg_š™_msg
(&
msg
);

229 
msg
.
wh©
 = 
FFP_MSG_FLUSH
;

230 
	`msg_queue_put_´iv©e
(
q
, &
msg
);

231 
	`SDL_UÆockMu‹x
(
q
->
mu‹x
);

232 
	}
}

235 
šlše
 
	$msg_queue_g‘
(
Mes§geQueue
 *
q
, 
AVMes§ge
 *
msg
, 
block
)

237 
AVMes§ge
 *
msg1
;

238 
»t
;

240 
	`SDL_LockMu‹x
(
q
->
mu‹x
);

243 ià(
q
->
abÜt_»que¡
) {

244 
»t
 = -1;

248 
msg1
 = 
q
->
fœ¡_msg
;

249 ià(
msg1
) {

250 
q
->
fœ¡_msg
 = 
msg1
->
Ãxt
;

251 ià(!
q
->
fœ¡_msg
)

252 
q
->
Ï¡_msg
 = 
NULL
;

253 
q
->
nb_mes§ges
--;

254 *
msg
 = *
msg1
;

255 
msg1
->
obj
 = 
NULL
;

256 #ifdeà
FFP_MERGE


257 
	`av_ä“
(
msg1
);

259 
msg1
->
Ãxt
 = 
q
->
»cyşe_msg
;

260 
q
->
»cyşe_msg
 = 
msg1
;

262 
»t
 = 1;

264 } ià(!
block
) {

265 
»t
 = 0;

268 
	`SDL_CÚdWa™
(
q
->
cÚd
, q->
mu‹x
);

271 
	`SDL_UÆockMu‹x
(
q
->
mu‹x
);

272  
»t
;

273 
	}
}

275 
šlše
 
	$msg_queue_»move
(
Mes§geQueue
 *
q
, 
wh©
)

277 
AVMes§ge
 **
p_msg
, *
msg
, *
Ï¡_msg
;

278 
	`SDL_LockMu‹x
(
q
->
mu‹x
);

280 
Ï¡_msg
 = 
q
->
fœ¡_msg
;

282 ià(!
q
->
abÜt_»que¡
 && q->
fœ¡_msg
) {

283 
p_msg
 = &
q
->
fœ¡_msg
;

284 *
p_msg
) {

285 
msg
 = *
p_msg
;

287 ià(
msg
->
wh©
 == what) {

288 *
p_msg
 = 
msg
->
Ãxt
;

289 #ifdeà
FFP_MERGE


290 
	`av_ä“
(
msg
);

292 
	`msg_ä“_»s
(
msg
);

293 
msg
->
Ãxt
 = 
q
->
»cyşe_msg
;

294 
q
->
»cyşe_msg
 = 
msg
;

296 
q
->
nb_mes§ges
--;

298 
Ï¡_msg
 = 
msg
;

299 
p_msg
 = &
msg
->
Ãxt
;

303 ià(
q
->
fœ¡_msg
) {

304 
q
->
Ï¡_msg
 =†ast_msg;

306 
q
->
Ï¡_msg
 = 
NULL
;

310 
	`SDL_UÆockMu‹x
(
q
->
mu‹x
);

311 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffpipeline.c

24 
	~"ff_få–še.h
"

25 
	~<¡dlib.h
>

26 
	~<¡ršg.h
>

28 
IJKFF_P–še
 *
	$få–še_®loc
(
SDL_CÏss
 *
İaque_şass
, 
size_t
 
İaque_size
)

30 
IJKFF_P–še
 *
p–še
 = (IJKFF_P–še*è
	`ÿÎoc
(1, (IJKFF_Pipeline));

31 ià(!
p–še
)

32  
NULL
;

34 
p–še
->
İaque_şass
 = opaque_class;

35 
p–še
->
İaque
 = 
	`ÿÎoc
(1, 
İaque_size
);

36 ià(!
p–še
->
İaque
) {

37 
	`ä“
(
p–še
);

38  
NULL
;

41  
p–še
;

42 
	}
}

44 
	$få–še_ä“
(
IJKFF_P–še
 *
p–še
)

46 ià(!
p–še
)

49 ià(
p–še
->
func_de¡roy
) {

50 
p–še
->
	`func_de¡roy
(pipeline);

53 
	`ä“
(
p–še
->
İaque
);

54 
	`mem£t
(
p–še
, 0, (
IJKFF_P–še
));

55 
	`ä“
(
p–še
);

56 
	}
}

58 
	$få–še_ä“_p
(
IJKFF_P–še
 **
p–še
)

60 ià(!
p–še
)

63 
	`få–še_ä“
(*
p–še
);

64 
	}
}

66 
IJKFF_P’ode
* 
	$få–še_İ’_video_decod”
(
IJKFF_P–še
 *
p–še
, 
FFPÏy”
 *
få
)

68  
p–še
->
	`func_İ’_video_decod”
Õ–še, 
få
);

69 
	}
}

71 
SDL_Aout
 *
	$få–še_İ’_audio_ouut
(
IJKFF_P–še
 *
p–še
, 
FFPÏy”
 *
få
)

73  
p–še
->
	`func_İ’_audio_ouut
Õ–še, 
få
);

74 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffpipeline.h

24 #iâdeà
FFPLAY__FF_FFPIPELINE_H


25 
	#FFPLAY__FF_FFPIPELINE_H


	)

27 
	~"ijksdl/ijksdl_şass.h
"

28 
	~"ijksdl/ijksdl_mu‹x.h
"

29 
	~"ijksdl/ijksdl_aout.h
"

30 
	~"ff_få’ode.h
"

31 
	~"ff_fåÏy_def.h
"

33 
IJKFF_P–še_O·que
 
	tIJKFF_P–še_O·que
;

34 
IJKFF_P–še
 
	tIJKFF_P–še
;

35 
	sIJKFF_P–še
 {

36 
SDL_CÏss
 *
	mİaque_şass
;

37 
IJKFF_P–še_O·que
 *
	mİaque
;

39 (*
	mfunc_de¡roy
è(
IJKFF_P–še
 *
	mp–še
);

40 
	mIJKFF_P’ode
 *(*
	mfunc_İ’_video_decod”
è(
IJKFF_P–še
 *
	mp–še
, 
FFPÏy”
 *
	mfå
);

41 
	mSDL_Aout
 *(*
	mfunc_İ’_audio_ouut
è(
IJKFF_P–še
 *
	mp–še
, 
FFPÏy”
 *
	mfå
);

44 
IJKFF_P–še
 *
få–še_®loc
(
SDL_CÏss
 *
İaque_şass
, 
size_t
 
İaque_size
);

45 
få–še_ä“
(
IJKFF_P–še
 *
p–še
);

46 
få–še_ä“_p
(
IJKFF_P–še
 **
p–še
);

48 
IJKFF_P’ode
 *
få–še_İ’_video_decod”
(
IJKFF_P–še
 *
p–še
, 
FFPÏy”
 *
få
);

49 
SDL_Aout
 *
få–še_İ’_audio_ouut
(
IJKFF_P–še
 *
p–še
, 
FFPÏy”
 *
få
);

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffpipenode.c

25 
	~"ff_få’ode.h
"

26 
	~<¡dlib.h
>

27 
	~<¡ršg.h
>

29 
IJKFF_P’ode
 *
	$få’ode_®loc
(
size_t
 
İaque_size
)

31 
IJKFF_P’ode
 *
node
 = (IJKFF_P’ode*è
	`ÿÎoc
(1, (IJKFF_Pipenode));

32 ià(!
node
)

33  
NULL
;

35 
node
->
İaque
 = 
	`ÿÎoc
(1, 
İaque_size
);

36 ià(!
node
->
İaque
) {

37 
	`ä“
(
node
);

38  
NULL
;

41 
node
->
mu‹x
 = 
	`SDL_C»©eMu‹x
();

42 ià(
node
->
mu‹x
 =ğ
NULL
) {

43 
	`ä“
(
node
->
İaque
);

44 
	`ä“
(
node
);

45  
NULL
;

48  
node
;

49 
	}
}

51 
	$få’ode_ä“
(
IJKFF_P’ode
 *
node
)

53 ià(!
node
)

56 ià(
node
->
func_de¡roy
) {

57 
node
->
	`func_de¡roy
(node);

60 
	`SDL_De¡royMu‹xP
(&
node
->
mu‹x
);

62 
	`ä“
(
node
->
İaque
);

63 
	`mem£t
(
node
, 0, (
IJKFF_P’ode
));

64 
	`ä“
(
node
);

65 
	}
}

67 
	$få’ode_ä“_p
(
IJKFF_P’ode
 **
node
)

69 ià(!
node
)

72 
	`få’ode_ä“
(*
node
);

73 *
node
 = 
NULL
;

74 
	}
}

76 
	$få’ode_run_sync
(
IJKFF_P’ode
 *
node
)

78  
node
->
	`func_run_sync
(node);

79 
	}
}

81 
	$få’ode_æush
(
IJKFF_P’ode
 *
node
)

83 ià(!
node
 || !node->
func_æush
)

86  
node
->
	`func_æush
(node);

87 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffpipenode.h

24 #iâdeà
FFPLAY__FF_FFPIPENODE_H


25 
	#FFPLAY__FF_FFPIPENODE_H


	)

27 
	~"ijksdl/ijksdl_mu‹x.h
"

29 
IJKFF_P’ode_O·que
 
	tIJKFF_P’ode_O·que
;

30 
IJKFF_P’ode
 
	tIJKFF_P’ode
;

31 
	sIJKFF_P’ode
 {

32 
SDL_mu‹x
 *
	mmu‹x
;

33 *
	mİaque
;

35 (*
	mfunc_de¡roy
è(
IJKFF_P’ode
 *
	mnode
);

36 (*
	mfunc_run_sync
)(
IJKFF_P’ode
 *
	mnode
);

37 (*
	mfunc_æush
è(
IJKFF_P’ode
 *
	mnode
);

40 
IJKFF_P’ode
 *
få’ode_®loc
(
size_t
 
İaque_size
);

41 
få’ode_ä“
(
IJKFF_P’ode
 *
node
);

42 
få’ode_ä“_p
(
IJKFF_P’ode
 **
node
);

44 
få’ode_run_sync
(
IJKFF_P’ode
 *
node
);

45 
få’ode_æush
(
IJKFF_P’ode
 *
node
);

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffplay.c

23 
	~"ff_fåÏy.h
"

30 
	~"cÚfig.h
"

31 
	~<š‰y³s.h
>

32 
	~<m©h.h
>

33 
	~<lim™s.h
>

34 
	~<sigÇl.h
>

35 
	~<¡dšt.h
>

37 
	~"libavut/av¡ršg.h
"

38 
	~"libavut/ev®.h
"

39 
	~"libavut/m©hem©ics.h
"

40 
	~"libavut/pixdesc.h
"

41 
	~"libavut/imguts.h
"

42 
	~"libavut/diù.h
"

43 
	~"libavut/·r£uts.h
"

44 
	~"libavut/§m¶efmt.h
"

45 
	~"libavut/avas£¹.h
"

46 
	~"libavut/time.h
"

47 
	~"libavfÜm©/avfÜm©.h
"

48 #ià
CONFIG_AVDEVICE


49 
	~"libavdeviû/avdeviû.h
"

51 
	~"libswsÿË/swsÿË.h
"

52 
	~"libavut/İt.h
"

53 
	~"libavcodec/avfá.h
"

54 
	~"libsw»§m¶e/sw»§m¶e.h
"

56 #ià
CONFIG_AVFILTER


57 
	~"libavcodec/avcodec.h
"

58 
	~"libavf‹r/avf‹r.h
"

59 
	~"libavf‹r/bufãrsšk.h
"

60 
	~"libavf‹r/bufãr¤c.h
"

63 
	~"ijksdl/ijksdl_log.h
"

64 
	~"ijkavfÜm©/ijkavfÜm©.h
"

65 
	~"ff_cmduts.h
"

66 
	~"ff_fã¼Ü.h
"

67 
	~"ff_få–še.h
"

68 
	~"ff_få’ode.h
"

69 
	~"ff_fåÏy_debug.h
"

70 
	~"ijkm‘a.h
"

71 
	~"ijkv”siÚ.h
"

72 
	~<¡d©omic.h
>

74 #iâdeà
AV_CODEC_FLAG2_FAST


75 
	#AV_CODEC_FLAG2_FAST
 
CODEC_FLAG2_FAST


	)

78 #iâdeà
AV_CODEC_CAP_DR1


79 
	#AV_CODEC_CAP_DR1
 
CODEC_CAP_DR1


	)

84 #ià
defšed
(
__ANDROID__
)

85 #ifdeà
i¢ª


86 #undeà
i¢ª


88 
	#i¢ª
(
x
è(
	`i¢ª
(()(x)è|| 
	`i¢ªf
(()(x)))

	)

91 #ià
defšed
(
__ANDROID__
)

92 
	#´štf
(...è
	`ALOGD
(
__VA_ARGS__
)

	)

95 
	#FFP_IO_STAT_STEP
 (50 * 1024)

	)

97 
	#FFP_BUF_MSG_PERIOD
 (3)

	)

100 
	~"ff_fåÏy_İtiÚs.h
"

102 
AVPack‘
 
	gæush_pkt
;

104 #ià
CONFIG_AVFILTER


108 
	#IJKVERSION_GET_MAJOR
(
x
è((x >> 16è& 0xFF)

	)

109 
	#IJKVERSION_GET_MINOR
(
x
è((x >> 8è& 0xFF)

	)

110 
	#IJKVERSION_GET_MICRO
(
x
è((x ) & 0xFF)

	)

112 #ià
CONFIG_AVFILTER


113 
šlše


114 
	$cmp_audio_fmts
(
AVSam¶eFÜm©
 
fmt1
, 
št64_t
 
chªÃl_couÁ1
,

115 
AVSam¶eFÜm©
 
fmt2
, 
št64_t
 
chªÃl_couÁ2
)

118 ià(
chªÃl_couÁ1
 =ğ1 && 
chªÃl_couÁ2
 == 1)

119  
	`av_g‘_·cked_§m¶e_fmt
(
fmt1
è!ğav_g‘_·cked_§m¶e_fmt(
fmt2
);

121  
chªÃl_couÁ1
 !ğ
chªÃl_couÁ2
 || 
fmt1
 !ğ
fmt2
;

122 
	}
}

124 
šlše


125 
št64_t
 
	$g‘_v®id_chªÃl_Ïyout
(
št64_t
 
chªÃl_Ïyout
, 
chªÃls
)

127 ià(
chªÃl_Ïyout
 && 
	`av_g‘_chªÃl_Ïyout_nb_chªÃls
(chªÃl_Ïyoutè=ğ
chªÃls
)

128  
chªÃl_Ïyout
;

131 
	}
}

134 
ä“_piùu»
(
F¿me
 *
vp
);

136 
	$·ck‘_queue_put_´iv©e
(
Pack‘Queue
 *
q
, 
AVPack‘
 *
pkt
)

138 
MyAVPack‘Li¡
 *
pkt1
;

140 ià(
q
->
abÜt_»que¡
)

143 #ifdeà
FFP_MERGE


144 
pkt1
 = 
	`av_m®loc
((
MyAVPack‘Li¡
));

146 
pkt1
 = 
q
->
»cyşe_pkt
;

147 ià(
pkt1
) {

148 
q
->
»cyşe_pkt
 = 
pkt1
->
Ãxt
;

149 
q
->
»cyşe_couÁ
++;

151 
q
->
®loc_couÁ
++;

152 
pkt1
 = 
	`av_m®loc
((
MyAVPack‘Li¡
));

154 #ifdeà
FFP_SHOW_PKT_RECYCLE


155 
tÙ®_couÁ
 = 
q
->
»cyşe_couÁ
 + q->
®loc_couÁ
;

156 ià(!(
tÙ®_couÁ
 % 50)) {

157 
	`av_log
(
få
, 
AV_LOG_DEBUG
, "pkt-»cyş\t%d + \t%d = \t%d\n", 
q
->
»cyşe_couÁ
, q->
®loc_couÁ
, 
tÙ®_couÁ
);

161 ià(!
pkt1
)

163 
pkt1
->
pkt
 = *pkt;

164 
pkt1
->
Ãxt
 = 
NULL
;

165 ià(
pkt
 =ğ&
æush_pkt
)

166 
q
->
£rŸl
++;

167 
pkt1
->
£rŸl
 = 
q
->serial;

169 ià(!
q
->
Ï¡_pkt
)

170 
q
->
fœ¡_pkt
 = 
pkt1
;

172 
q
->
Ï¡_pkt
->
Ãxt
 = 
pkt1
;

173 
q
->
Ï¡_pkt
 = 
pkt1
;

174 
q
->
nb_·ck‘s
++;

175 
q
->
size
 +ğ
pkt1
->
pkt
.size + (*pkt1);

177 
q
->
du¿tiÚ
 +ğ
	`FFMAX
(
pkt1
->
pkt
.du¿tiÚ, 
MIN_PKT_DURATION
);

180 
	`SDL_CÚdSigÇl
(
q
->
cÚd
);

182 
	}
}

184 
	$·ck‘_queue_put
(
Pack‘Queue
 *
q
, 
AVPack‘
 *
pkt
)

186 
»t
;

188 
	`SDL_LockMu‹x
(
q
->
mu‹x
);

189 
»t
 = 
	`·ck‘_queue_put_´iv©e
(
q
, 
pkt
);

190 
	`SDL_UÆockMu‹x
(
q
->
mu‹x
);

192 ià(
pkt
 !ğ&
æush_pkt
 && 
»t
 < 0)

193 
	`av_·ck‘_uÄef
(
pkt
);

195  
»t
;

196 
	}
}

198 
	$·ck‘_queue_put_nuÎ·ck‘
(
Pack‘Queue
 *
q
, 
¡»am_šdex
)

200 
AVPack‘
 
pkt1
, *
pkt
 = &pkt1;

201 
	`av_š™_·ck‘
(
pkt
);

202 
pkt
->
d©a
 = 
NULL
;

203 
pkt
->
size
 = 0;

204 
pkt
->
¡»am_šdex
 = stream_index;

205  
	`·ck‘_queue_put
(
q
, 
pkt
);

206 
	}
}

209 
	$·ck‘_queue_š™
(
Pack‘Queue
 *
q
)

211 
	`mem£t
(
q
, 0, (
Pack‘Queue
));

212 
q
->
mu‹x
 = 
	`SDL_C»©eMu‹x
();

213 ià(!
q
->
mu‹x
) {

214 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "SDL_C»©eMu‹x(): %s\n", 
	`SDL_G‘E¼Ü
());

215  
	`AVERROR
(
ENOMEM
);

217 
q
->
cÚd
 = 
	`SDL_C»©eCÚd
();

218 ià(!
q
->
cÚd
) {

219 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "SDL_C»©eCÚd(): %s\n", 
	`SDL_G‘E¼Ü
());

220  
	`AVERROR
(
ENOMEM
);

222 
q
->
abÜt_»que¡
 = 1;

224 
	}
}

226 
	$·ck‘_queue_æush
(
Pack‘Queue
 *
q
)

228 
MyAVPack‘Li¡
 *
pkt
, *
pkt1
;

230 
	`SDL_LockMu‹x
(
q
->
mu‹x
);

231 
pkt
 = 
q
->
fœ¡_pkt
;…kt;…kˆğ
pkt1
) {

232 
pkt1
 = 
pkt
->
Ãxt
;

233 
	`av_·ck‘_uÄef
(&
pkt
->pkt);

234 #ifdeà
FFP_MERGE


235 
	`av_ä“p
(&
pkt
);

237 
pkt
->
Ãxt
 = 
q
->
»cyşe_pkt
;

238 
q
->
»cyşe_pkt
 = 
pkt
;

241 
q
->
Ï¡_pkt
 = 
NULL
;

242 
q
->
fœ¡_pkt
 = 
NULL
;

243 
q
->
nb_·ck‘s
 = 0;

244 
q
->
size
 = 0;

245 
q
->
du¿tiÚ
 = 0;

246 
	`SDL_UÆockMu‹x
(
q
->
mu‹x
);

247 
	}
}

249 
	$·ck‘_queue_de¡roy
(
Pack‘Queue
 *
q
)

251 
	`·ck‘_queue_æush
(
q
);

253 
	`SDL_LockMu‹x
(
q
->
mu‹x
);

254 
q
->
»cyşe_pkt
) {

255 
MyAVPack‘Li¡
 *
pkt
 = 
q
->
»cyşe_pkt
;

256 ià(
pkt
)

257 
q
->
»cyşe_pkt
 = 
pkt
->
Ãxt
;

258 
	`av_ä“p
(&
pkt
);

260 
	`SDL_UÆockMu‹x
(
q
->
mu‹x
);

262 
	`SDL_De¡royMu‹x
(
q
->
mu‹x
);

263 
	`SDL_De¡royCÚd
(
q
->
cÚd
);

264 
	}
}

266 
	$·ck‘_queue_abÜt
(
Pack‘Queue
 *
q
)

268 
	`SDL_LockMu‹x
(
q
->
mu‹x
);

270 
q
->
abÜt_»que¡
 = 1;

272 
	`SDL_CÚdSigÇl
(
q
->
cÚd
);

274 
	`SDL_UÆockMu‹x
(
q
->
mu‹x
);

275 
	}
}

277 
	$·ck‘_queue_¡¬t
(
Pack‘Queue
 *
q
)

279 
	`SDL_LockMu‹x
(
q
->
mu‹x
);

280 
q
->
abÜt_»que¡
 = 0;

281 
	`·ck‘_queue_put_´iv©e
(
q
, &
æush_pkt
);

282 
	`SDL_UÆockMu‹x
(
q
->
mu‹x
);

283 
	}
}

286 
	$·ck‘_queue_g‘
(
Pack‘Queue
 *
q
, 
AVPack‘
 *
pkt
, 
block
, *
£rŸl
)

288 
MyAVPack‘Li¡
 *
pkt1
;

289 
»t
;

291 
	`SDL_LockMu‹x
(
q
->
mu‹x
);

294 ià(
q
->
abÜt_»que¡
) {

295 
»t
 = -1;

299 
pkt1
 = 
q
->
fœ¡_pkt
;

300 ià(
pkt1
) {

301 
q
->
fœ¡_pkt
 = 
pkt1
->
Ãxt
;

302 ià(!
q
->
fœ¡_pkt
)

303 
q
->
Ï¡_pkt
 = 
NULL
;

304 
q
->
nb_·ck‘s
--;

305 
q
->
size
 -ğ
pkt1
->
pkt
.size + (*pkt1);

306 
q
->
du¿tiÚ
 -ğ
	`FFMAX
(
pkt1
->
pkt
.du¿tiÚ, 
MIN_PKT_DURATION
);

307 *
pkt
 = 
pkt1
->pkt;

308 ià(
£rŸl
)

309 *
£rŸl
 = 
pkt1
->serial;

310 #ifdeà
FFP_MERGE


311 
	`av_ä“
(
pkt1
);

313 
pkt1
->
Ãxt
 = 
q
->
»cyşe_pkt
;

314 
q
->
»cyşe_pkt
 = 
pkt1
;

316 
»t
 = 1;

318 } ià(!
block
) {

319 
»t
 = 0;

322 
	`SDL_CÚdWa™
(
q
->
cÚd
, q->
mu‹x
);

325 
	`SDL_UÆockMu‹x
(
q
->
mu‹x
);

326  
»t
;

327 
	}
}

329 
	$·ck‘_queue_g‘_Ü_bufãršg
(
FFPÏy”
 *
få
, 
Pack‘Queue
 *
q
, 
AVPack‘
 *
pkt
, *
£rŸl
, *
fšished
)

331 
	`as£¹
(
fšished
);

332 ià(!
få
->
·ck‘_bufãršg
)

333  
	`·ck‘_queue_g‘
(
q
, 
pkt
, 1, 
£rŸl
);

336 
Ãw_·ck‘
 = 
	`·ck‘_queue_g‘
(
q
, 
pkt
, 0, 
£rŸl
);

337 ià(
Ãw_·ck‘
 < 0)

339 ià(
Ãw_·ck‘
 == 0) {

340 ià(
q
->
is_bufãr_šdiÿtÜ
 && !*
fšished
)

341 
	`få_toggË_bufãršg
(
få
, 1);

342 
Ãw_·ck‘
 = 
	`·ck‘_queue_g‘
(
q
, 
pkt
, 1, 
£rŸl
);

343 ià(
Ãw_·ck‘
 < 0)

347 ià(*
fšished
 =ğ*
£rŸl
) {

348 
	`av_·ck‘_uÄef
(
pkt
);

356 
	}
}

358 
	$decod”_š™
(
Decod”
 *
d
, 
AVCodecCÚ‹xt
 *
avùx
, 
Pack‘Queue
 *
queue
, 
SDL_cÚd
 *
em±y_queue_cÚd
) {

359 
	`mem£t
(
d
, 0, (
Decod”
));

360 
d
->
avùx
 =‡vctx;

361 
d
->
queue
 = queue;

362 
d
->
em±y_queue_cÚd
 =ƒmpty_queue_cond;

363 
d
->
¡¬t_±s
 = 
AV_NOPTS_VALUE
;

365 
d
->
fœ¡_äame_decoded_time
 = 
	`SDL_G‘TickHR
();

366 
d
->
fœ¡_äame_decoded
 = 0;

368 
	`SDL_Prof”Re£t
(&
d
->
decode_´of”
, -1);

369 
	}
}

371 
	$decod”_decode_äame
(
FFPÏy”
 *
få
, 
Decod”
 *
d
, 
AVF¿me
 *
äame
, 
AVSubt™Ë
 *
sub
) {

372 
gÙ_äame
 = 0;

375 
»t
 = -1;

377 ià(
d
->
queue
->
abÜt_»que¡
)

380 ià(!
d
->
·ck‘_³ndšg
 || d->
queue
->
£rŸl
 !ğd->
pkt_£rŸl
) {

381 
AVPack‘
 
pkt
;

383 ià(
d
->
queue
->
nb_·ck‘s
 == 0)

384 
	`SDL_CÚdSigÇl
(
d
->
em±y_queue_cÚd
);

385 ià(
	`·ck‘_queue_g‘_Ü_bufãršg
(
få
, 
d
->
queue
, &
pkt
, &d->
pkt_£rŸl
, &d->
fšished
) < 0)

387 ià(
pkt
.
d©a
 =ğ
æush_pkt
.data) {

388 
	`avcodec_æush_bufãrs
(
d
->
avùx
);

389 
d
->
fšished
 = 0;

390 
d
->
Ãxt_±s
 = d->
¡¬t_±s
;

391 
d
->
Ãxt_±s_tb
 = d->
¡¬t_±s_tb
;

393 } 
pkt
.
d©a
 =ğ
æush_pkt
.d©¨|| 
d
->
queue
->
£rŸl
 !ğd->
pkt_£rŸl
);

394 
	`av_·ck‘_uÄef
(&
d
->
pkt
);

395 
d
->
pkt_‹mp
 = d->
pkt
 =…kt;

396 
d
->
·ck‘_³ndšg
 = 1;

399 
d
->
avùx
->
codec_ty³
) {

400 
AVMEDIA_TYPE_VIDEO
: {

401 
»t
 = 
	`avcodec_decode_video2
(
d
->
avùx
, 
äame
, &
gÙ_äame
, &d->
pkt_‹mp
);

402 ià(
gÙ_äame
) {

403 
få
->
¡©
.
vdps
 = 
	`SDL_S³edSam¶”Add
(&få->
vdps_§m¶”
, 
FFP_SHOW_VDPS_AVCODEC
, "vdps[avcodec]");

404 ià(
få
->
decod”_»Üd”_±s
 == -1) {

405 
äame
->
±s
 = 
	`av_äame_g‘_be¡_effÜt_time¡amp
(frame);

406 } ià(!
få
->
decod”_»Üd”_±s
) {

407 
äame
->
±s
 = f¿me->
pkt_dts
;

412 
AVMEDIA_TYPE_AUDIO
:

413 
»t
 = 
	`avcodec_decode_audio4
(
d
->
avùx
, 
äame
, &
gÙ_äame
, &d->
pkt_‹mp
);

414 ià(
gÙ_äame
) {

415 
AVR©iÚ®
 
tb
 = (AVR©iÚ®){1, 
äame
->
§m¶e_¿‹
};

416 ià(
äame
->
±s
 !ğ
AV_NOPTS_VALUE
)

417 
äame
->
±s
 = 
	`av_»sÿË_q
(äame->±s, 
	`av_codec_g‘_pkt_timeba£
(
d
->
avùx
), 
tb
);

418 ià(
d
->
Ãxt_±s
 !ğ
AV_NOPTS_VALUE
)

419 
äame
->
±s
 = 
	`av_»sÿË_q
(
d
->
Ãxt_±s
, d->
Ãxt_±s_tb
, 
tb
);

420 ià(
äame
->
±s
 !ğ
AV_NOPTS_VALUE
) {

421 
d
->
Ãxt_±s
 = 
äame
->
±s
 + f¿me->
nb_§m¶es
;

422 
d
->
Ãxt_±s_tb
 = 
tb
;

426 
AVMEDIA_TYPE_SUBTITLE
:

427 
»t
 = 
	`avcodec_decode_subt™Ë2
(
d
->
avùx
, 
sub
, &
gÙ_äame
, &d->
pkt_‹mp
);

433 ià(
»t
 < 0) {

434 
d
->
·ck‘_³ndšg
 = 0;

436 
d
->
pkt_‹mp
.
dts
 =

437 
d
->
pkt_‹mp
.
±s
 = 
AV_NOPTS_VALUE
;

438 ià(
d
->
pkt_‹mp
.
d©a
) {

439 ià(
d
->
avùx
->
codec_ty³
 !ğ
AVMEDIA_TYPE_AUDIO
)

440 
»t
 = 
d
->
pkt_‹mp
.
size
;

441 
d
->
pkt_‹mp
.
d©a
 +ğ
»t
;

442 
d
->
pkt_‹mp
.
size
 -ğ
»t
;

443 ià(
d
->
pkt_‹mp
.
size
 <= 0)

444 
d
->
·ck‘_³ndšg
 = 0;

446 ià(!
gÙ_äame
) {

447 
d
->
·ck‘_³ndšg
 = 0;

448 
d
->
fšished
 = d->
pkt_£rŸl
;

452 } !
gÙ_äame
 && !
d
->
fšished
);

454  
gÙ_äame
;

455 
	}
}

457 
	$decod”_de¡roy
(
Decod”
 *
d
) {

458 
	`av_·ck‘_uÄef
(&
d
->
pkt
);

459 
	`avcodec_ä“_cÚ‹xt
(&
d
->
avùx
);

460 
	}
}

462 
	$äame_queue_uÄef_™em
(
F¿me
 *
vp
)

464 
	`av_äame_uÄef
(
vp
->
äame
);

465 
	`SDL_VoutUÄefYUVOv”Ïy
(
vp
->
bmp
);

466 
	`avsubt™Ë_ä“
(&
vp
->
sub
);

467 
	}
}

469 
	$äame_queue_š™
(
F¿meQueue
 *
f
, 
Pack‘Queue
 *
pktq
, 
max_size
, 
k“p_Ï¡
)

471 
i
;

472 
	`mem£t
(
f
, 0, (
F¿meQueue
));

473 ià(!(
f
->
mu‹x
 = 
	`SDL_C»©eMu‹x
())) {

474 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "SDL_C»©eMu‹x(): %s\n", 
	`SDL_G‘E¼Ü
());

475  
	`AVERROR
(
ENOMEM
);

477 ià(!(
f
->
cÚd
 = 
	`SDL_C»©eCÚd
())) {

478 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "SDL_C»©eCÚd(): %s\n", 
	`SDL_G‘E¼Ü
());

479  
	`AVERROR
(
ENOMEM
);

481 
f
->
pktq
 =…ktq;

482 
f
->
max_size
 = 
	`FFMIN
(max_size, 
FRAME_QUEUE_SIZE
);

483 
f
->
k“p_Ï¡
 = !!keep_last;

484 
i
 = 0; i < 
f
->
max_size
; i++)

485 ià(!(
f
->
queue
[
i
].
äame
 = 
	`av_äame_®loc
()))

486  
	`AVERROR
(
ENOMEM
);

488 
	}
}

490 
	$äame_queue_de¡Üy
(
F¿meQueue
 *
f
)

492 
i
;

493 
i
 = 0; i < 
f
->
max_size
; i++) {

494 
F¿me
 *
vp
 = &
f
->
queue
[
i
];

495 
	`äame_queue_uÄef_™em
(
vp
);

496 
	`av_äame_ä“
(&
vp
->
äame
);

497 
	`ä“_piùu»
(
vp
);

499 
	`SDL_De¡royMu‹x
(
f
->
mu‹x
);

500 
	`SDL_De¡royCÚd
(
f
->
cÚd
);

501 
	}
}

503 
	$äame_queue_sigÇl
(
F¿meQueue
 *
f
)

505 
	`SDL_LockMu‹x
(
f
->
mu‹x
);

506 
	`SDL_CÚdSigÇl
(
f
->
cÚd
);

507 
	`SDL_UÆockMu‹x
(
f
->
mu‹x
);

508 
	}
}

510 
F¿me
 *
	$äame_queue_³ek
(
F¿meQueue
 *
f
)

512  &
f
->
queue
[(f->
ršdex
 + f->
ršdex_shown
è% f->
max_size
];

513 
	}
}

515 
F¿me
 *
	$äame_queue_³ek_Ãxt
(
F¿meQueue
 *
f
)

517  &
f
->
queue
[(f->
ršdex
 + f->
ršdex_shown
 + 1è% f->
max_size
];

518 
	}
}

520 
F¿me
 *
	$äame_queue_³ek_Ï¡
(
F¿meQueue
 *
f
)

522  &
f
->
queue
[f->
ršdex
];

523 
	}
}

525 
F¿me
 *
	$äame_queue_³ek_wr™abË
(
F¿meQueue
 *
f
)

528 
	`SDL_LockMu‹x
(
f
->
mu‹x
);

529 
f
->
size
 >ğf->
max_size
 &&

530 !
f
->
pktq
->
abÜt_»que¡
) {

532 
	`SDL_CÚdWa™
(
f
->
cÚd
, f->
mu‹x
);

534 
	`SDL_UÆockMu‹x
(
f
->
mu‹x
);

536 ià(
f
->
pktq
->
abÜt_»que¡
)

537  
NULL
;

539  &
f
->
queue
[f->
wšdex
];

540 
	}
}

542 
F¿me
 *
	$äame_queue_³ek_»adabË
(
F¿meQueue
 *
f
)

545 
	`SDL_LockMu‹x
(
f
->
mu‹x
);

546 
f
->
size
 - f->
ršdex_shown
 <= 0 &&

547 !
f
->
pktq
->
abÜt_»que¡
) {

548 
	`SDL_CÚdWa™
(
f
->
cÚd
, f->
mu‹x
);

550 
	`SDL_UÆockMu‹x
(
f
->
mu‹x
);

552 ià(
f
->
pktq
->
abÜt_»que¡
)

553  
NULL
;

555  &
f
->
queue
[(f->
ršdex
 + f->
ršdex_shown
è% f->
max_size
];

556 
	}
}

558 
	$äame_queue_push
(
F¿meQueue
 *
f
)

560 ià(++
f
->
wšdex
 =ğf->
max_size
)

561 
f
->
wšdex
 = 0;

562 
	`SDL_LockMu‹x
(
f
->
mu‹x
);

563 
f
->
size
++;

564 
	`SDL_CÚdSigÇl
(
f
->
cÚd
);

565 
	`SDL_UÆockMu‹x
(
f
->
mu‹x
);

566 
	}
}

568 
	$äame_queue_Ãxt
(
F¿meQueue
 *
f
)

570 ià(
f
->
k“p_Ï¡
 && !f->
ršdex_shown
) {

571 
f
->
ršdex_shown
 = 1;

574 
	`äame_queue_uÄef_™em
(&
f
->
queue
[f->
ršdex
]);

575 ià(++
f
->
ršdex
 =ğf->
max_size
)

576 
f
->
ršdex
 = 0;

577 
	`SDL_LockMu‹x
(
f
->
mu‹x
);

578 
f
->
size
--;

579 
	`SDL_CÚdSigÇl
(
f
->
cÚd
);

580 
	`SDL_UÆockMu‹x
(
f
->
mu‹x
);

581 
	}
}

584 
	$äame_queue_nb_»maššg
(
F¿meQueue
 *
f
)

586  
f
->
size
 - f->
ršdex_shown
;

587 
	}
}

590 #ifdeà
FFP_MERGE


591 
št64_t
 
	$äame_queue_Ï¡_pos
(
F¿meQueue
 *
f
)

593 
F¿me
 *
å
 = &
f
->
queue
[f->
ršdex
];

594 ià(
f
->
ršdex_shown
 && 
å
->
£rŸl
 =ğf->
pktq
->serial)

595  
å
->
pos
;

598 
	}
}

601 
	$decod”_abÜt
(
Decod”
 *
d
, 
F¿meQueue
 *
fq
)

603 
	`·ck‘_queue_abÜt
(
d
->
queue
);

604 
	`äame_queue_sigÇl
(
fq
);

605 
	`SDL_Wa™Th»ad
(
d
->
decod”_tid
, 
NULL
);

606 
d
->
decod”_tid
 = 
NULL
;

607 
	`·ck‘_queue_æush
(
d
->
queue
);

608 
	}
}

619 
	$ä“_piùu»
(
F¿me
 *
vp
)

621 ià(
vp
->
bmp
) {

622 
	`SDL_VoutF»eYUVOv”Ïy
(
vp
->
bmp
);

623 
vp
->
bmp
 = 
NULL
;

625 
	}
}

632 
size_t
 
	$·r£_ass_subt™Ë
(cÚ¡ *
ass
, *
ouut
)

634 *
tok
 = 
NULL
;

635 
tok
 = 
	`¡rchr
(
ass
, ':'); if (tok)ok += 1;

636 
tok
 = 
	`¡rchr
(tok, ','); if (tok)ok += 1;

637 
tok
 = 
	`¡rchr
(tok, ','); if (tok)ok += 1;

638 
tok
 = 
	`¡rchr
(tok, ','); if (tok)ok += 1;

639 
tok
 = 
	`¡rchr
(tok, ','); if (tok)ok += 1;

640 
tok
 = 
	`¡rchr
(tok, ','); if (tok)ok += 1;

641 
tok
 = 
	`¡rchr
(tok, ','); if (tok)ok += 1;

642 
tok
 = 
	`¡rchr
(tok, ','); if (tok)ok += 1;

643 
tok
 = 
	`¡rchr
(tok, ','); if (tok)ok += 1;

644 
tok
 = 
	`¡rchr
(tok, ','); if (tok)ok += 1;

645 ià(
tok
) {

646 *
‹xt
 = 
tok
;

647 
size_t
 
idx
 = 0;

649 *
found
 = 
	`¡r¡r
(
‹xt
, "\\N");

650 ià(
found
) {

651 
size_t
 
n
 = 
found
 - 
‹xt
;

652 
	`memıy
(
ouut
+
idx
, 
‹xt
, 
n
);

653 
ouut
[
idx
 + 
n
] = '\n';

654 
idx
 = 
n
 + 1;

655 
‹xt
 = 
found
 + 2;

658 
size_t
 
Ëá_‹xt_Ën
 = 
	`¡¾’
(
‹xt
);

659 
	`memıy
(
ouut
+
idx
, 
‹xt
, 
Ëá_‹xt_Ën
);

660 ià(
ouut
[
idx
 + 
Ëá_‹xt_Ën
 - 1] == '\n')

661 
ouut
[
idx
 + 
Ëá_‹xt_Ën
 - 1] = '\0';

663 
ouut
[
idx
 + 
Ëá_‹xt_Ën
] = '\0';

667  
	`¡¾’
(
ouut
) + 1;

670 
	}
}

672 
	$video_image_di¥Ïy2
(
FFPÏy”
 *
få
)

674 
VideoS‹
 *
is
 = 
få
->is;

675 
F¿me
 *
vp
;

676 
F¿me
 *
¥
 = 
NULL
;

678 
vp
 = 
	`äame_queue_³ek_Ï¡
(&
is
->
piùq
);

680 
Ï‹¡_£ek_lßd_£rŸl
 = 
	`__©omic_exchªge_n
(&(
is
->Ï‹¡_£ek_lßd_£rŸl), -1, 
memÜy_Üd”_£q_c¡
);

681 ià(
Ï‹¡_£ek_lßd_£rŸl
 =ğ
vp
->
£rŸl
)

682 
få
->
¡©
.
Ï‹¡_£ek_lßd_du¿tiÚ
 = (
	`av_g‘time
(è- 
is
->
Ï‹¡_£ek_lßd_¡¬t_©
) / 1000;

684 ià(
vp
->
bmp
) {

685 ià(
is
->
subt™Ë_¡
) {

686 ià(
	`äame_queue_nb_»maššg
(&
is
->
subpq
) > 0) {

687 
¥
 = 
	`äame_queue_³ek
(&
is
->
subpq
);

689 ià(
vp
->
±s
 >ğ
¥
->± + ((è¥->
sub
.
¡¬t_di¥Ïy_time
 / 1000)) {

690 ià(!
¥
->
u¶ßded
) {

691 ià(
¥
->
sub
.
num_»ùs
 > 0) {

692 
bufã»d_‹xt
[4096];

693 ià(
¥
->
sub
.
»ùs
[0]->
‹xt
) {

694 
	`¡ºıy
(
bufã»d_‹xt
, 
¥
->
sub
.
»ùs
[0]->
‹xt
, 4096);

696 ià(
¥
->
sub
.
»ùs
[0]->
ass
) {

697 
	`·r£_ass_subt™Ë
(
¥
->
sub
.
»ùs
[0]->
ass
, 
bufã»d_‹xt
);

699 
	`få_nÙify_msg4
(
få
, 
FFP_MSG_TIMED_TEXT
, 0, 0, 
bufã»d_‹xt
, (buffered_text));

701 
¥
->
u¶ßded
 = 1;

706 
	`SDL_VoutDi¥ÏyYUVOv”Ïy
(
få
->
vout
, 
vp
->
bmp
);

708 
få
->
¡©
.
vås
 = 
	`SDL_S³edSam¶”Add
(&få->
vås_§m¶”
, 
FFP_SHOW_VFPS_FFPLAY
, "vfps[ffplay]");

709 ià(!
få
->
fœ¡_video_äame_»nd”ed
) {

710 
få
->
fœ¡_video_äame_»nd”ed
 = 1;

711 
	`få_nÙify_msg1
(
få
, 
FFP_MSG_VIDEO_RENDERING_START
);

714 
	}
}

719 
	$¡»am_compÚ’t_şo£
(
FFPÏy”
 *
få
, 
¡»am_šdex
)

721 
VideoS‹
 *
is
 = 
få
->is;

722 
AVFÜm©CÚ‹xt
 *
ic
 = 
is
->ic;

723 
AVCodecP¬am‘”s
 *
codeı¬
;

725 ià(
¡»am_šdex
 < 0 || sŒ—m_šdex >ğ
ic
->
nb_¡»ams
)

727 
codeı¬
 = 
ic
->
¡»ams
[
¡»am_šdex
]->codecpar;

729 
codeı¬
->
codec_ty³
) {

730 
AVMEDIA_TYPE_AUDIO
:

731 
	`decod”_abÜt
(&
is
->
auddec
, &is->
§mpq
);

732 
	`SDL_AoutClo£Audio
(
få
->
aout
);

734 
	`decod”_de¡roy
(&
is
->
auddec
);

735 
	`swr_ä“
(&
is
->
swr_ùx
);

736 
	`av_ä“p
(&
is
->
audio_buf1
);

737 
is
->
audio_buf1_size
 = 0;

738 
is
->
audio_buf
 = 
NULL
;

740 #ifdeà
FFP_MERGE


741 ià(
is
->
rdá
) {

742 
	`av_rdá_’d
(
is
->
rdá
);

743 
	`av_ä“p
(&
is
->
rdá_d©a
);

744 
is
->
rdá
 = 
NULL
;

745 
is
->
rdá_b™s
 = 0;

749 
AVMEDIA_TYPE_VIDEO
:

750 
	`decod”_abÜt
(&
is
->
viddec
, &is->
piùq
);

751 
	`decod”_de¡roy
(&
is
->
viddec
);

753 
AVMEDIA_TYPE_SUBTITLE
:

754 
	`decod”_abÜt
(&
is
->
subdec
, &is->
subpq
);

755 
	`decod”_de¡roy
(&
is
->
subdec
);

761 
ic
->
¡»ams
[
¡»am_šdex
]->
disÿrd
 = 
AVDISCARD_ALL
;

762 
codeı¬
->
codec_ty³
) {

763 
AVMEDIA_TYPE_AUDIO
:

764 
is
->
audio_¡
 = 
NULL
;

765 
is
->
audio_¡»am
 = -1;

767 
AVMEDIA_TYPE_VIDEO
:

768 
is
->
video_¡
 = 
NULL
;

769 
is
->
video_¡»am
 = -1;

771 
AVMEDIA_TYPE_SUBTITLE
:

772 
is
->
subt™Ë_¡
 = 
NULL
;

773 
is
->
subt™Ë_¡»am
 = -1;

778 
	}
}

780 
	$¡»am_şo£
(
FFPÏy”
 *
få
)

782 
VideoS‹
 *
is
 = 
få
->is;

784 
is
->
abÜt_»que¡
 = 1;

785 
	`·ck‘_queue_abÜt
(&
is
->
videoq
);

786 
	`·ck‘_queue_abÜt
(&
is
->
audioq
);

787 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "wait for„ead_tid\n");

788 
	`SDL_Wa™Th»ad
(
is
->
»ad_tid
, 
NULL
);

791 ià(
is
->
audio_¡»am
 >= 0)

792 
	`¡»am_compÚ’t_şo£
(
få
, 
is
->
audio_¡»am
);

793 ià(
is
->
video_¡»am
 >= 0)

794 
	`¡»am_compÚ’t_şo£
(
få
, 
is
->
video_¡»am
);

795 ià(
is
->
subt™Ë_¡»am
 >= 0)

796 
	`¡»am_compÚ’t_şo£
(
få
, 
is
->
subt™Ë_¡»am
);

798 
	`avfÜm©_şo£_šput
(&
is
->
ic
);

800 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "wait for video_refresh_tid\n");

801 
	`SDL_Wa™Th»ad
(
is
->
video_»äesh_tid
, 
NULL
);

803 
	`·ck‘_queue_de¡roy
(&
is
->
videoq
);

804 
	`·ck‘_queue_de¡roy
(&
is
->
audioq
);

805 
	`·ck‘_queue_de¡roy
(&
is
->
subt™Ëq
);

808 
	`äame_queue_de¡Üy
(&
is
->
piùq
);

809 
	`äame_queue_de¡Üy
(&
is
->
§mpq
);

810 
	`äame_queue_de¡Üy
(&
is
->
subpq
);

811 
	`SDL_De¡royCÚd
(
is
->
cÚtšue_»ad_th»ad
);

812 
	`SDL_De¡royMu‹x
(
is
->
¶ay_mu‹x
);

813 #ià!
CONFIG_AVFILTER


814 
	`sws_ä“CÚ‹xt
(
is
->
img_cÚv”t_ùx
);

816 #ifdeà
FFP_MERGE


817 
	`sws_ä“CÚ‹xt
(
is
->
sub_cÚv”t_ùx
);

819 
	`av_ä“
(
is
->
f’ame
);

820 
	`av_ä“
(
is
);

821 
få
->
is
 = 
NULL
;

822 
	}
}

830 
	$video_di¥Ïy2
(
FFPÏy”
 *
få
)

832 
VideoS‹
 *
is
 = 
få
->is;

833 ià(
is
->
video_¡
)

834 
	`video_image_di¥Ïy2
(
få
);

835 
	}
}

837 
	$g‘_şock
(
Clock
 *
c
)

839 ià(*
c
->
queue_£rŸl
 !ğc->
£rŸl
)

840  
NAN
;

841 ià(
c
->
·u£d
) {

842  
c
->
±s
;

844 
time
 = 
	`av_g‘time_»Ïtive
() / 1000000.0;

845  
c
->
±s_driá
 + 
time
 - (tim- c->
Ï¡_upd©ed
è* (1.0 - c->
¥“d
);

847 
	}
}

849 
	$£t_şock_©
(
Clock
 *
c
, 
±s
, 
£rŸl
, 
time
)

851 
c
->
±s
 =…ts;

852 
c
->
Ï¡_upd©ed
 = 
time
;

853 
c
->
±s_driá
 = c->
±s
 - 
time
;

854 
c
->
£rŸl
 = serial;

855 
	}
}

857 
	$£t_şock
(
Clock
 *
c
, 
±s
, 
£rŸl
)

859 
time
 = 
	`av_g‘time_»Ïtive
() / 1000000.0;

860 
	`£t_şock_©
(
c
, 
±s
, 
£rŸl
, 
time
);

861 
	}
}

863 
	$£t_şock_¥“d
(
Clock
 *
c
, 
¥“d
)

865 
	`£t_şock
(
c
, 
	`g‘_şock
(c), c->
£rŸl
);

866 
c
->
¥“d
 = speed;

867 
	}
}

869 
	$š™_şock
(
Clock
 *
c
, *
queue_£rŸl
)

871 
c
->
¥“d
 = 1.0;

872 
c
->
·u£d
 = 0;

873 
c
->
queue_£rŸl
 = queue_serial;

874 
	`£t_şock
(
c
, 
NAN
, -1);

875 
	}
}

877 
	$sync_şock_to_¦ave
(
Clock
 *
c
, Clock *
¦ave
)

879 
şock
 = 
	`g‘_şock
(
c
);

880 
¦ave_şock
 = 
	`g‘_şock
(
¦ave
);

881 ià(!
	`i¢ª
(
¦ave_şock
è&& (i¢ª(
şock
è|| 
	`çbs
(şock - sÏve_şockè> 
AV_NOSYNC_THRESHOLD
))

882 
	`£t_şock
(
c
, 
¦ave_şock
, 
¦ave
->
£rŸl
);

883 
	}
}

885 
	$g‘_ma¡”_sync_ty³
(
VideoS‹
 *
is
) {

886 ià(
is
->
av_sync_ty³
 =ğ
AV_SYNC_VIDEO_MASTER
) {

887 ià(
is
->
video_¡
)

888  
AV_SYNC_VIDEO_MASTER
;

890  
AV_SYNC_AUDIO_MASTER
;

891 } ià(
is
->
av_sync_ty³
 =ğ
AV_SYNC_AUDIO_MASTER
) {

892 ià(
is
->
audio_¡
)

893  
AV_SYNC_AUDIO_MASTER
;

895  
AV_SYNC_EXTERNAL_CLOCK
;

897  
AV_SYNC_EXTERNAL_CLOCK
;

899 
	}
}

902 
	$g‘_ma¡”_şock
(
VideoS‹
 *
is
)

904 
v®
;

906 
	`g‘_ma¡”_sync_ty³
(
is
)) {

907 
AV_SYNC_VIDEO_MASTER
:

908 
v®
 = 
	`g‘_şock
(&
is
->
vidşk
);

910 
AV_SYNC_AUDIO_MASTER
:

911 
v®
 = 
	`g‘_şock
(&
is
->
audşk
);

914 
v®
 = 
	`g‘_şock
(&
is
->
extşk
);

917  
v®
;

918 
	}
}

920 
	$check_ex‹º®_şock_¥“d
(
VideoS‹
 *
is
) {

921 ià((
is
->
video_¡»am
 >ğ0 && is->
videoq
.
nb_·ck‘s
 <ğ
EXTERNAL_CLOCK_MIN_FRAMES
) ||

922 (
is
->
audio_¡»am
 >ğ0 && is->
audioq
.
nb_·ck‘s
 <ğ
EXTERNAL_CLOCK_MIN_FRAMES
)) {

923 
	`£t_şock_¥“d
(&
is
->
extşk
, 
	`FFMAX
(
EXTERNAL_CLOCK_SPEED_MIN
, is->extşk.
¥“d
 - 
EXTERNAL_CLOCK_SPEED_STEP
));

924 } ià((
is
->
video_¡»am
 < 0 || is->
videoq
.
nb_·ck‘s
 > 
EXTERNAL_CLOCK_MAX_FRAMES
) &&

925 (
is
->
audio_¡»am
 < 0 || is->
audioq
.
nb_·ck‘s
 > 
EXTERNAL_CLOCK_MAX_FRAMES
)) {

926 
	`£t_şock_¥“d
(&
is
->
extşk
, 
	`FFMIN
(
EXTERNAL_CLOCK_SPEED_MAX
, is->extşk.
¥“d
 + 
EXTERNAL_CLOCK_SPEED_STEP
));

928 
¥“d
 = 
is
->
extşk
.speed;

929 ià(
¥“d
 != 1.0)

930 
	`£t_şock_¥“d
(&
is
->
extşk
, 
¥“d
 + 
EXTERNAL_CLOCK_SPEED_STEP
 * (1.0 - s³edè/ 
	`çbs
(1.0 - speed));

932 
	}
}

935 
	$¡»am_£ek
(
VideoS‹
 *
is
, 
št64_t
 
pos
, iÁ64_ˆ
»l
, 
£ek_by_by‹s
)

937 ià(!
is
->
£ek_»q
) {

938 
is
->
£ek_pos
 = 
pos
;

939 
is
->
£ek_»l
 = 
»l
;

940 
is
->
£ek_æags
 &ğ~
AVSEEK_FLAG_BYTE
;

941 ià(
£ek_by_by‹s
)

942 
is
->
£ek_æags
 |ğ
AVSEEK_FLAG_BYTE
;

943 
is
->
£ek_»q
 = 1;

944 
	`SDL_CÚdSigÇl
(
is
->
cÚtšue_»ad_th»ad
);

946 
	}
}

949 
	$¡»am_toggË_·u£_l
(
FFPÏy”
 *
få
, 
·u£_Ú
)

951 
VideoS‹
 *
is
 = 
få
->is;

952 ià(
is
->
·u£d
 && !
·u£_Ú
) {

953 
is
->
äame_tim”
 +ğ
	`av_g‘time_»Ïtive
(è/ 1000000.0 - is->
vidşk
.
Ï¡_upd©ed
;

955 #ifdeà
FFP_MERGE


956 ià(
is
->
»ad_·u£_»tuº
 !ğ
	`AVERROR
(
ENOSYS
)) {

957 
is
->
vidşk
.
·u£d
 = 0;

960 
	`£t_şock
(&
is
->
vidşk
, 
	`g‘_şock
(&is->vidşk), is->vidşk.
£rŸl
);

963 
	`£t_şock
(&
is
->
extşk
, 
	`g‘_şock
(&is->extşk), is->extşk.
£rŸl
);

964 
is
->
·u£d
 = is->
audşk
.·u£d = is->
vidşk
.·u£d = is->
extşk
.·u£d = 
·u£_Ú
;

966 
	`SDL_AoutPau£Audio
(
få
->
aout
, 
·u£_Ú
);

967 
	}
}

969 
	$¡»am_upd©e_·u£_l
(
FFPÏy”
 *
få
)

971 
VideoS‹
 *
is
 = 
få
->is;

972 ià(!
is
->
¡•
 && (is->
·u£_»q
 || is->
bufãršg_Ú
)) {

973 
	`¡»am_toggË_·u£_l
(
få
, 1);

975 
	`¡»am_toggË_·u£_l
(
få
, 0);

977 
	}
}

979 
	$toggË_·u£_l
(
FFPÏy”
 *
få
, 
·u£_Ú
)

981 
VideoS‹
 *
is
 = 
få
->is;

982 
is
->
·u£_»q
 = 
·u£_Ú
;

983 
få
->
auto_»sume
 = !
·u£_Ú
;

984 
	`¡»am_upd©e_·u£_l
(
få
);

985 
is
->
¡•
 = 0;

986 
	}
}

988 
	$toggË_·u£
(
FFPÏy”
 *
få
, 
·u£_Ú
)

990 
	`SDL_LockMu‹x
(
få
->
is
->
¶ay_mu‹x
);

991 
	`toggË_·u£_l
(
få
, 
·u£_Ú
);

992 
	`SDL_UÆockMu‹x
(
få
->
is
->
¶ay_mu‹x
);

993 
	}
}

998 
	$¡•_to_Ãxt_äame_l
(
FFPÏy”
 *
få
)

1000 
VideoS‹
 *
is
 = 
få
->is;

1002 ià(
is
->
·u£d
)

1003 
	`¡»am_toggË_·u£_l
(
få
, 0);

1004 
is
->
¡•
 = 1;

1005 
	}
}

1007 
	$compu‹_rg‘_d–ay
(
FFPÏy”
 *
få
, 
d–ay
, 
VideoS‹
 *
is
)

1009 
sync_th»shŞd
, 
diff
 = 0;

1012 ià(
	`g‘_ma¡”_sync_ty³
(
is
è!ğ
AV_SYNC_VIDEO_MASTER
) {

1015 
diff
 = 
	`g‘_şock
(&
is
->
vidşk
è- 
	`g‘_ma¡”_şock
(is);

1020 
sync_th»shŞd
 = 
	`FFMAX
(
AV_SYNC_THRESHOLD_MIN
, 
	`FFMIN
(
AV_SYNC_THRESHOLD_MAX
, 
d–ay
));

1022 ià(!
	`i¢ª
(
diff
è&& 
	`çbs
(diffè< 
AV_NOSYNC_THRESHOLD
) {

1023 ià(
diff
 <ğ-
sync_th»shŞd
)

1024 
d–ay
 = 
	`FFMAX
(0, d–ay + 
diff
);

1025 ià(
diff
 >ğ
sync_th»shŞd
 && 
d–ay
 > 
AV_SYNC_FRAMEDUP_THRESHOLD
)

1026 
d–ay
 = d–ay + 
diff
;

1027 ià(
diff
 >ğ
sync_th»shŞd
)

1028 
d–ay
 = 2 * delay;

1032 ià(
få
) {

1033 
få
->
¡©
.
avd–ay
 = 
d–ay
;

1034 
få
->
¡©
.
avdiff
 = 
diff
;

1036 #ifdeà
FFP_SHOW_AUDIO_DELAY


1037 
	`av_log
(
NULL
, 
AV_LOG_TRACE
, "video: delay=%0.3f A-V=%f\n",

1038 
d–ay
, -
diff
);

1041  
d–ay
;

1042 
	}
}

1044 
	$vp_du¿tiÚ
(
VideoS‹
 *
is
, 
F¿me
 *
vp
, F¿m*
Ãxtvp
) {

1045 ià(
vp
->
£rŸl
 =ğ
Ãxtvp
->serial) {

1046 
du¿tiÚ
 = 
Ãxtvp
->
±s
 - 
vp
->pts;

1047 ià(
	`i¢ª
(
du¿tiÚ
è|| du¿tiÚ <ğ0 || du¿tiÚ > 
is
->
max_äame_du¿tiÚ
)

1048  
vp
->
du¿tiÚ
;

1050  
du¿tiÚ
;

1054 
	}
}

1056 
	$upd©e_video_±s
(
VideoS‹
 *
is
, 
±s
, 
št64_t
 
pos
, 
£rŸl
) {

1058 
	`£t_şock
(&
is
->
vidşk
, 
±s
, 
£rŸl
);

1059 
	`sync_şock_to_¦ave
(&
is
->
extşk
, &is->
vidşk
);

1060 
	}
}

1063 
	$video_»äesh
(
FFPÏy”
 *
İaque
, *
»maššg_time
)

1065 
FFPÏy”
 *
få
 = 
İaque
;

1066 
VideoS‹
 *
is
 = 
få
->is;

1067 
time
;

1069 
F¿me
 *
¥
, *
¥2
;

1071 ià(!
is
->
·u£d
 && 
	`g‘_ma¡”_sync_ty³
(isè=ğ
AV_SYNC_EXTERNAL_CLOCK
 && is->
»®time
)

1072 
	`check_ex‹º®_şock_¥“d
(
is
);

1074 ià(!
få
->
di¥Ïy_di§bË
 && 
is
->
show_mode
 !ğ
SHOW_MODE_VIDEO
 && is->
audio_¡
) {

1075 
time
 = 
	`av_g‘time_»Ïtive
() / 1000000.0;

1076 ià(
is
->
fÜû_»äesh
 || is->
Ï¡_vis_time
 + 
få
->
rdá¥“d
 < 
time
) {

1077 
	`video_di¥Ïy2
(
få
);

1078 
is
->
Ï¡_vis_time
 = 
time
;

1080 *
»maššg_time
 = 
	`FFMIN
(*»maššg_time, 
is
->
Ï¡_vis_time
 + 
få
->
rdá¥“d
 - 
time
);

1083 ià(
is
->
video_¡
) {

1084 
»Œy
:

1085 ià(
	`äame_queue_nb_»maššg
(&
is
->
piùq
) == 0) {

1088 
Ï¡_du¿tiÚ
, 
du¿tiÚ
, 
d–ay
;

1089 
F¿me
 *
vp
, *
Ï¡vp
;

1092 
Ï¡vp
 = 
	`äame_queue_³ek_Ï¡
(&
is
->
piùq
);

1093 
vp
 = 
	`äame_queue_³ek
(&
is
->
piùq
);

1095 ià(
vp
->
£rŸl
 !ğ
is
->
videoq
.serial) {

1096 
	`äame_queue_Ãxt
(&
is
->
piùq
);

1097 
»Œy
;

1100 ià(
Ï¡vp
->
£rŸl
 !ğ
vp
->serial)

1101 
is
->
äame_tim”
 = 
	`av_g‘time_»Ïtive
() / 1000000.0;

1103 ià(
is
->
·u£d
)

1104 
di¥Ïy
;

1107 
Ï¡_du¿tiÚ
 = 
	`vp_du¿tiÚ
(
is
, 
Ï¡vp
, 
vp
);

1108 
d–ay
 = 
	`compu‹_rg‘_d–ay
(
få
, 
Ï¡_du¿tiÚ
, 
is
);

1110 
time
ğ
	`av_g‘time_»Ïtive
()/1000000.0;

1111 ià(
	`i¢ª
(
is
->
äame_tim”
è|| 
time
 < is->frame_timer)

1112 
is
->
äame_tim”
 = 
time
;

1113 ià(
time
 < 
is
->
äame_tim”
 + 
d–ay
) {

1114 *
»maššg_time
 = 
	`FFMIN
(
is
->
äame_tim”
 + 
d–ay
 - 
time
, *remaining_time);

1115 
di¥Ïy
;

1118 
is
->
äame_tim”
 +ğ
d–ay
;

1119 ià(
d–ay
 > 0 && 
time
 - 
is
->
äame_tim”
 > 
AV_SYNC_THRESHOLD_MAX
)

1120 
is
->
äame_tim”
 = 
time
;

1122 
	`SDL_LockMu‹x
(
is
->
piùq
.
mu‹x
);

1123 ià(!
	`i¢ª
(
vp
->
±s
))

1124 
	`upd©e_video_±s
(
is
, 
vp
->
±s
, vp->
pos
, vp->
£rŸl
);

1125 
	`SDL_UÆockMu‹x
(
is
->
piùq
.
mu‹x
);

1127 ià(
	`äame_queue_nb_»maššg
(&
is
->
piùq
) > 1) {

1128 
F¿me
 *
Ãxtvp
 = 
	`äame_queue_³ek_Ãxt
(&
is
->
piùq
);

1129 
du¿tiÚ
 = 
	`vp_du¿tiÚ
(
is
, 
vp
, 
Ãxtvp
);

1130 if(!
is
->
¡•
 && (
få
->
äamedrİ
 > 0 || (få->äamedrİ && 
	`g‘_ma¡”_sync_ty³
(isè!ğ
AV_SYNC_VIDEO_MASTER
)è&& 
time
 > is->
äame_tim”
 + 
du¿tiÚ
) {

1131 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "x›jšbaØ»nd”šgimdrİ videØäame.queue_nb_»maššg =%d\n",
	`äame_queue_nb_»maššg
(&
is
->
piùq
));

1132 
	`äame_queue_Ãxt
(&
is
->
piùq
);

1133 
»Œy
;

1137 ià(
is
->
subt™Ë_¡
) {

1138 
	`äame_queue_nb_»maššg
(&
is
->
subpq
) > 0) {

1139 
¥
 = 
	`äame_queue_³ek
(&
is
->
subpq
);

1141 ià(
	`äame_queue_nb_»maššg
(&
is
->
subpq
) > 1)

1142 
¥2
 = 
	`äame_queue_³ek_Ãxt
(&
is
->
subpq
);

1144 
¥2
 = 
NULL
;

1146 ià(
¥
->
£rŸl
 !ğ
is
->
subt™Ëq
.serial

1147 || (
is
->
vidşk
.
±s
 > (
¥
->± + ((è¥->
sub
.
’d_di¥Ïy_time
 / 1000)))

1148 || (
¥2
 && 
is
->
vidşk
.
±s
 > (¥2->± + ((è¥2->
sub
.
¡¬t_di¥Ïy_time
 / 1000))))

1150 ià(
¥
->
u¶ßded
) {

1151 
	`få_nÙify_msg4
(
få
, 
FFP_MSG_TIMED_TEXT
, 0, 0, "", 1);

1153 
	`äame_queue_Ãxt
(&
is
->
subpq
);

1160 
	`äame_queue_Ãxt
(&
is
->
piùq
);

1161 
is
->
fÜû_»äesh
 = 1;

1163 
	`SDL_LockMu‹x
(
få
->
is
->
¶ay_mu‹x
);

1164 ià(
is
->
¡•
) {

1165 
is
->
¡•
 = 0;

1166 ià(!
is
->
·u£d
)

1167 
	`¡»am_upd©e_·u£_l
(
få
);

1169 
	`SDL_UÆockMu‹x
(
få
->
is
->
¶ay_mu‹x
);

1171 
di¥Ïy
:

1173 ià(!
få
->
di¥Ïy_di§bË
 && 
is
->
fÜû_»äesh
 && is->
show_mode
 =ğ
SHOW_MODE_VIDEO
 && is->
piùq
.
ršdex_shown
)

1174 
	`video_di¥Ïy2
(
få
);

1176 
is
->
fÜû_»äesh
 = 0;

1177 ià(
få
->
show_¡©us
) {

1178 
št64_t
 
Ï¡_time
;

1179 
št64_t
 
cur_time
;

1180 
aqsize
, 
vqsize
, 
sqsize
 
__unu£d
;

1181 
av_diff
;

1183 
cur_time
 = 
	`av_g‘time_»Ïtive
();

1184 ià(!
Ï¡_time
 || (
cur_time
 -†ast_time) >= 30000) {

1185 
aqsize
 = 0;

1186 
vqsize
 = 0;

1187 
sqsize
 = 0;

1188 ià(
is
->
audio_¡
)

1189 
aqsize
 = 
is
->
audioq
.
size
;

1190 ià(
is
->
video_¡
)

1191 
vqsize
 = 
is
->
videoq
.
size
;

1192 #ifdeà
FFP_MERGE


1193 ià(
is
->
subt™Ë_¡
)

1194 
sqsize
 = 
is
->
subt™Ëq
.
size
;

1196 
sqsize
 = 0;

1198 
av_diff
 = 0;

1199 ià(
is
->
audio_¡
 && is->
video_¡
)

1200 
av_diff
 = 
	`g‘_şock
(&
is
->
audşk
è- g‘_şock(&is->
vidşk
);

1201 ià(
is
->
video_¡
)

1202 
av_diff
 = 
	`g‘_ma¡”_şock
(
is
è- 
	`g‘_şock
(&is->
vidşk
);

1203 ià(
is
->
audio_¡
)

1204 
av_diff
 = 
	`g‘_ma¡”_şock
(
is
è- 
	`g‘_şock
(&is->
audşk
);

1205 
	`av_log
(
NULL
, 
AV_LOG_INFO
,

1206 "%7.2à%s:%7.3àfd=%4d‡q=%5dKB vq=%5dKB sq=%5dB f=%"
PRId64
"/%"PRId64" \r",

1207 
	`g‘_ma¡”_şock
(
is
),

1208 (
is
->
audio_¡
 && is->
video_¡
) ? "A-V" : (is->video_st ? "M-V" : (is->audio_st ? "M-A" : " ")),

1209 
av_diff
,

1210 
is
->
äame_drİs_—¾y
 + is->
äame_drİs_Ï‹
,

1211 
aqsize
 / 1024,

1212 
vqsize
 / 1024,

1213 
sqsize
,

1214 
is
->
video_¡
 ? is->
viddec
.
avùx
->
±s_cÜ»ùiÚ_num_çuÉy_dts
 : 0,

1215 
is
->
video_¡
 ? is->
viddec
.
avùx
->
±s_cÜ»ùiÚ_num_çuÉy_±s
 : 0);

1216 
	`fæush
(
¡dout
);

1217 
Ï¡_time
 = 
cur_time
;

1220 
	}
}

1224 
	$®loc_piùu»
(
FFPÏy”
 *
få
, 
äame_fÜm©
)

1226 
VideoS‹
 *
is
 = 
få
->is;

1227 
F¿me
 *
vp
;

1228 #ifdeà
FFP_MERGE


1229 
sdl_fÜm©
;

1232 
vp
 = &
is
->
piùq
.
queue
[is->piùq.
wšdex
];

1234 
	`ä“_piùu»
(
vp
);

1236 #ifdeà
FFP_MERGE


1237 
	`video_İ’
(
is
, 
vp
);

1240 
	`SDL_VoutS‘Ov”ÏyFÜm©
(
få
->
vout
, få->
ov”Ïy_fÜm©
);

1241 
vp
->
bmp
 = 
	`SDL_Vout_C»©eOv”Ïy
(vp->
width
, vp->
height
,

1242 
äame_fÜm©
,

1243 
få
->
vout
);

1244 #ifdeà
FFP_MERGE


1245 ià(
vp
->
fÜm©
 =ğ
AV_PIX_FMT_YUV420P
)

1246 
sdl_fÜm©
 = 
SDL_PIXELFORMAT_YV12
;

1248 
sdl_fÜm©
 = 
SDL_PIXELFORMAT_ARGB8888
;

1250 ià(
	`»®loc_‹xtu»
(&
vp
->
bmp
, 
sdl_fÜm©
, vp->
width
, vp->
height
, 
SDL_BLENDMODE_NONE
, 0) < 0) {

1253 ià(!
vp
->
bmp
 || (!vp->bmp->
is_´iv©e
 && vp->bmp->
p™ches
[0] < vp->
width
)) {

1257 
	`av_log
(
NULL
, 
AV_LOG_FATAL
,

1260 "tØ»duûhimagsize.\n", 
vp
->
width
, vp->
height
 );

1261 
	`ä“_piùu»
(
vp
);

1264 
	`SDL_LockMu‹x
(
is
->
piùq
.
mu‹x
);

1265 
vp
->
®loÿ‹d
 = 1;

1266 
	`SDL_CÚdSigÇl
(
is
->
piùq
.
cÚd
);

1267 
	`SDL_UÆockMu‹x
(
is
->
piùq
.
mu‹x
);

1268 
	}
}

1270 
	$queue_piùu»
(
FFPÏy”
 *
få
, 
AVF¿me
 *
¤c_äame
, 
±s
, 
du¿tiÚ
, 
št64_t
 
pos
, 
£rŸl
)

1272 
VideoS‹
 *
is
 = 
få
->is;

1273 
F¿me
 *
vp
;

1275 #ià
	`defšed
(
DEBUG_SYNC
)

1276 
	`´štf
("frame_type=%c…ts=%0.3f\n",

1277 
	`av_g‘_piùu»_ty³_ch¬
(
¤c_äame
->
più_ty³
), 
±s
);

1280 ià(!(
vp
 = 
	`äame_queue_³ek_wr™abË
(&
is
->
piùq
)))

1283 
vp
->
§r
 = 
¤c_äame
->
§m¶e_a¥eù_¿tio
;

1284 #ifdeà
FFP_MERGE


1285 
vp
->
u¶ßded
 = 0;

1289 ià(!
vp
->
bmp
 || !vp->
®loÿ‹d
 ||

1290 
vp
->
width
 !ğ
¤c_äame
->width ||

1291 
vp
->
height
 !ğ
¤c_äame
->height ||

1292 
vp
->
fÜm©
 !ğ
¤c_äame
->format) {

1294 ià(
vp
->
width
 !ğ
¤c_äame
->width || vp->
height
 != src_frame->height)

1295 
	`få_nÙify_msg3
(
få
, 
FFP_MSG_VIDEO_SIZE_CHANGED
, 
¤c_äame
->
width
, src_äame->
height
);

1297 
vp
->
®loÿ‹d
 = 0;

1298 
vp
->
width
 = 
¤c_äame
->width;

1299 
vp
->
height
 = 
¤c_äame
->height;

1300 
vp
->
fÜm©
 = 
¤c_äame
->format;

1304 
	`®loc_piùu»
(
få
, 
¤c_äame
->
fÜm©
);

1306 ià(
is
->
videoq
.
abÜt_»que¡
)

1311 ià(
vp
->
bmp
) {

1313 
	`SDL_VoutLockYUVOv”Ïy
(
vp
->
bmp
);

1315 #ifdeà
FFP_MERGE


1316 #ià
CONFIG_AVFILTER


1318 
	`av_image_cİy
(
d©a
, 
lšesize
, (cÚ¡ 
ušt8_t
 **)
¤c_äame
->data, src_frame->linesize,

1319 
¤c_äame
->
fÜm©
, 
vp
->
width
, vp->
height
);

1325 ià(
	`SDL_VoutFlF¿meYUVOv”Ïy
(
vp
->
bmp
, 
¤c_äame
) < 0) {

1326 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Cannot initializehe conversion context\n");

1327 
	`ex™
(1);

1330 
	`SDL_VoutUÆockYUVOv”Ïy
(
vp
->
bmp
);

1332 
vp
->
±s
 =…ts;

1333 
vp
->
du¿tiÚ
 = duration;

1334 
vp
->
pos
 =…os;

1335 
vp
->
£rŸl
 = serial;

1336 
vp
->
§r
 = 
¤c_äame
->
§m¶e_a¥eù_¿tio
;

1337 
vp
->
bmp
->
§r_num
 = vp->
§r
.
num
;

1338 
vp
->
bmp
->
§r_d’
 = vp->
§r
.
d’
;

1340 #ifdeà
FFP_MERGE


1341 
	`av_äame_move_»f
(
vp
->
äame
, 
¤c_äame
);

1343 ifĞ
±s
 > 
is
->
cut_ÿched_du¿tiÚ_ba£
){

1344 if(
is
->
pkt_ÿched_du¿tiÚ
 > 
MIN_CACHED_DURATION
)

1345 
is
->
pkt_ÿched_du¿tiÚ
 -ğ
REDUCE_CACHED_DURATION_SIZE
;

1346 
is
->
cut_ÿched_du¿tiÚ_ba£
 +ğ
REDUCE_CACHED_DURATION_INTERVAL
;

1347 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "\À± ğ%àcut_ÿched_du¿tiÚ_ba£ = %Îd…kt_ÿched_du¿tiÚ = %d \n",
±s
,
is
->
cut_ÿched_du¿tiÚ_ba£
,is->
pkt_ÿched_du¿tiÚ
);

1350 
	`äame_queue_push
(&
is
->
piùq
);

1352 ià(!
is
->
viddec
.
fœ¡_äame_decoded
) {

1353 
	`ALOGD
("Video: first frame decoded\n");

1354 
is
->
viddec
.
fœ¡_äame_decoded_time
 = 
	`SDL_G‘TickHR
();

1355 
is
->
viddec
.
fœ¡_äame_decoded
 = 1;

1359 
	}
}

1361 
	$g‘_video_äame
(
FFPÏy”
 *
få
, 
AVF¿me
 *
äame
)

1363 
VideoS‹
 *
is
 = 
få
->is;

1364 
gÙ_piùu»
;

1366 
	`få_video_¡©i¡ic_l
(
få
);

1367 ià((
gÙ_piùu»
 = 
	`decod”_decode_äame
(
få
, &
is
->
viddec
, 
äame
, 
NULL
)) < 0)

1370 ià(
gÙ_piùu»
) {

1371 
d±s
 = 
NAN
;

1373 ià(
äame
->
±s
 !ğ
AV_NOPTS_VALUE
)

1374 
d±s
 = 
	`av_q2d
(
is
->
video_¡
->
time_ba£
è* 
äame
->
±s
;

1376 
äame
->
§m¶e_a¥eù_¿tio
 = 
	`av_guess_§m¶e_a¥eù_¿tio
(
is
->
ic
, is->
video_¡
, frame);

1378 ià(
få
->
äamedrİ
>0 || (få->äamedrİ && 
	`g‘_ma¡”_sync_ty³
(
is
è!ğ
AV_SYNC_VIDEO_MASTER
)) {

1379 ià(
äame
->
±s
 !ğ
AV_NOPTS_VALUE
) {

1380 
diff
 = 
d±s
 - 
	`g‘_ma¡”_şock
(
is
);

1381 ià(!
	`i¢ª
(
diff
è&& 
	`çbs
(diffè< 
AV_NOSYNC_THRESHOLD
 &&

1382 
diff
 - 
is
->
äame_Ï¡_f‹r_d–ay
 < 0 &&

1383 
is
->
viddec
.
pkt_£rŸl
 =ğis->
vidşk
.
£rŸl
 &&

1384 
is
->
videoq
.
nb_·ck‘s
) {

1385 
is
->
äame_drİs_—¾y
++;

1386 
is
->
cÚtšuous_äame_drİs_—¾y
++;

1387 ià(
is
->
cÚtšuous_äame_drİs_—¾y
 > 
få
->
äamedrİ
) {

1388 
is
->
cÚtšuous_äame_drİs_—¾y
 = 0;

1390 
	`av_äame_uÄef
(
äame
);

1391 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "g‘_video_äamdrİ f¿mcÚtšuo_äame_drİ_—¾y=%d difàğ%f\n",
is
->
cÚtšuous_äame_drİs_—¾y
,
diff
);

1392 
gÙ_piùu»
 = 0;

1399  
gÙ_piùu»
;

1400 
	}
}

1402 #ià
CONFIG_AVFILTER


1403 
	$cÚfigu»_f‹rg¿ph
(
AVF‹rG¿ph
 *
g¿ph
, cÚ¡ *
f‹rg¿ph
,

1404 
AVF‹rCÚ‹xt
 *
sourû_ùx
, AVF‹rCÚ‹xˆ*
sšk_ùx
)

1406 
»t
, 
i
;

1407 
nb_f‹rs
 = 
g¿ph
->nb_filters;

1408 
AVF‹rInOut
 *
ouuts
 = 
NULL
, *
šputs
 = NULL;

1410 ià(
f‹rg¿ph
) {

1411 
ouuts
 = 
	`avf‹r_šout_®loc
();

1412 
šputs
 = 
	`avf‹r_šout_®loc
();

1413 ià(!
ouuts
 || !
šputs
) {

1414 
»t
 = 
	`AVERROR
(
ENOMEM
);

1415 
ç
;

1418 
ouuts
->
Çme
 = 
	`av_¡rdup
("in");

1419 
ouuts
->
f‹r_ùx
 = 
sourû_ùx
;

1420 
ouuts
->
·d_idx
 = 0;

1421 
ouuts
->
Ãxt
 = 
NULL
;

1423 
šputs
->
Çme
 = 
	`av_¡rdup
("out");

1424 
šputs
->
f‹r_ùx
 = 
sšk_ùx
;

1425 
šputs
->
·d_idx
 = 0;

1426 
šputs
->
Ãxt
 = 
NULL
;

1428 ià((
»t
 = 
	`avf‹r_g¿ph_·r£_±r
(
g¿ph
, 
f‹rg¿ph
, &
šputs
, &
ouuts
, 
NULL
)) < 0)

1429 
ç
;

1431 ià((
»t
 = 
	`avf‹r_lšk
(
sourû_ùx
, 0, 
sšk_ùx
, 0)) < 0)

1432 
ç
;

1436 
i
 = 0; i < 
g¿ph
->
nb_f‹rs
 -‚b_filters; i++)

1437 
	`FFSWAP
(
AVF‹rCÚ‹xt
*, 
g¿ph
->
f‹rs
[
i
], g¿ph->f‹rs[˜+ 
nb_f‹rs
]);

1439 
»t
 = 
	`avf‹r_g¿ph_cÚfig
(
g¿ph
, 
NULL
);

1440 
ç
:

1441 
	`avf‹r_šout_ä“
(&
ouuts
);

1442 
	`avf‹r_šout_ä“
(&
šputs
);

1443  
»t
;

1444 
	}
}

1446 
	$cÚfigu»_video_f‹rs
(
FFPÏy”
 *
få
, 
AVF‹rG¿ph
 *
g¿ph
, 
VideoS‹
 *
is
, cÚ¡ *
vf‹rs
, 
AVF¿me
 *
äame
)

1448 cÚ¡ 
AVPix–FÜm©
 
pix_fmts
[] = { 
AV_PIX_FMT_YUV420P
, 
AV_PIX_FMT_BGRA
, 
AV_PIX_FMT_NONE
 };

1449 
sws_æags_¡r
[512] = "";

1450 
bufãr¤c_¬gs
[256];

1451 
»t
;

1452 
AVF‹rCÚ‹xt
 *
ft_¤c
 = 
NULL
, *
ft_out
 = NULL, *
Ï¡_f‹r
 = NULL;

1453 
AVCodecP¬am‘”s
 *
codeı¬
 = 
is
->
video_¡
->codecpar;

1454 
AVR©iÚ®
 
ä
 = 
	`av_guess_äame_¿‹
(
is
->
ic
, is->
video_¡
, 
NULL
);

1455 
AVDiùiÚ¬yEÁry
 *
e
 = 
NULL
;

1457 (
e
 = 
	`av_diù_g‘
(
få
->
sws_diù
, "",ƒ, 
AV_DICT_IGNORE_SUFFIX
))) {

1458 ià(!
	`¡rcmp
(
e
->
key
, "sws_flags")) {

1459 
	`av_¡¾ÿtf
(
sws_æags_¡r
, (sws_æags_¡r), "%s=%s:", "æags", 
e
->
v®ue
);

1461 
	`av_¡¾ÿtf
(
sws_æags_¡r
, (sws_æags_¡r), "%s=%s:", 
e
->
key
,ƒ->
v®ue
);

1463 ià(
	`¡¾’
(
sws_æags_¡r
))

1464 
sws_æags_¡r
[
	`¡¾’
(sws_flags_str)-1] = '\0';

1466 
g¿ph
->
sÿË_sws_İts
 = 
	`av_¡rdup
(
sws_æags_¡r
);

1468 
	`¢´štf
(
bufãr¤c_¬gs
, (buffersrc_args),

1470 
äame
->
width
, f¿me->
height
, f¿me->
fÜm©
,

1471 
is
->
video_¡
->
time_ba£
.
num
, is->video_¡->time_ba£.
d’
,

1472 
codeı¬
->
§m¶e_a¥eù_¿tio
.
num
, 
	`FFMAX
(codeı¬->§m¶e_a¥eù_¿tio.
d’
, 1));

1473 ià(
ä
.
num
 && fr.
d’
)

1474 
	`av_¡¾ÿtf
(
bufãr¤c_¬gs
, (bufãr¤c_¬gs), ":äame_¿‹=%d/%d", 
ä
.
num
, fr.
d’
);

1476 ià((
»t
 = 
	`avf‹r_g¿ph_ü—‹_f‹r
(&
ft_¤c
,

1477 
	`avf‹r_g‘_by_Çme
("buffer"),

1478 "fåÏy_bufãr", 
bufãr¤c_¬gs
, 
NULL
,

1479 
g¿ph
)) < 0)

1480 
ç
;

1482 
»t
 = 
	`avf‹r_g¿ph_ü—‹_f‹r
(&
ft_out
,

1483 
	`avf‹r_g‘_by_Çme
("buffersink"),

1484 "fåÏy_bufãrsšk", 
NULL
, NULL, 
g¿ph
);

1485 ià(
»t
 < 0)

1486 
ç
;

1488 ià((
»t
 = 
	`av_İt_£t_št_li¡
(
ft_out
, "pix_fmts", 
pix_fmts
, 
AV_PIX_FMT_NONE
, 
AV_OPT_SEARCH_CHILDREN
)) < 0)

1489 
ç
;

1491 
Ï¡_f‹r
 = 
ft_out
;

1495 
	#INSERT_FILT
(
Çme
, 
¬g
) do { \

1496 
AVF‹rCÚ‹xt
 *
ft_ùx
; \

1498 
»t
 = 
	`avf‹r_g¿ph_ü—‹_f‹r
(&
ft_ùx
, \

1499 
	`avf‹r_g‘_by_Çme
(
Çme
), \

1500 "fåÏy_" 
Çme
, 
¬g
, 
NULL
, 
g¿ph
); \

1501 ià(
»t
 < 0) \

1502 
ç
; \

1504 
»t
 = 
	`avf‹r_lšk
(
ft_ùx
, 0, 
Ï¡_f‹r
, 0); \

1505 ià(
»t
 < 0) \

1506 
ç
; \

1508 
Ï¡_f‹r
 = 
ft_ùx
; \

1509 } 0)

	)

1511 ià(
få
->
autÜÙ©e
) {

1512 
th‘a
 = 
	`g‘_rÙ©iÚ
(
is
->
video_¡
);

1514 ià(
	`çbs
(
th‘a
 - 90) < 1.0) {

1515 
	`INSERT_FILT
("transpose", "clock");

1516 } ià(
	`çbs
(
th‘a
 - 180) < 1.0) {

1517 
	`INSERT_FILT
("hæ", 
NULL
);

1518 
	`INSERT_FILT
("væ", 
NULL
);

1519 } ià(
	`çbs
(
th‘a
 - 270) < 1.0) {

1520 
	`INSERT_FILT
("transpose", "cclock");

1521 } ià(
	`çbs
(
th‘a
) > 1.0) {

1522 
rÙ©e_buf
[64];

1523 
	`¢´štf
(
rÙ©e_buf
, ÔÙ©e_buf), "%f*PI/180", 
th‘a
);

1524 
	`INSERT_FILT
("rÙ©e", 
rÙ©e_buf
);

1528 #ifdeà
FFP_AVFILTER_PLAYBACK_RATE


1529 ià(
	`çbsf
(
få
->
pf_¶ayback_¿‹
) > 0.00001 &&

1530 
	`çbsf
(
få
->
pf_¶ayback_¿‹
 - 1.0f) > 0.00001) {

1531 
£ts_buf
[256];

1532 
¿‹
 = 1.0à/ 
få
->
pf_¶ayback_¿‹
;

1533 
¿‹
 = 
	`av_şf_c
(rate, 0.5f, 2.0f);

1534 
	`av_log
(
få
, 
AV_LOG_INFO
, "vf_¿‹=%f(1/%f)\n", få->
pf_¶ayback_¿‹
, 
¿‹
);

1535 
	`¢´štf
(
£ts_buf
, (£ts_buf), "%f*PTS", 
¿‹
);

1536 
	`INSERT_FILT
("£ts", 
£ts_buf
);

1540 ià((
»t
 = 
	`cÚfigu»_f‹rg¿ph
(
g¿ph
, 
vf‹rs
, 
ft_¤c
, 
Ï¡_f‹r
)) < 0)

1541 
ç
;

1543 
is
->
š_video_f‹r
 = 
ft_¤c
;

1544 
is
->
out_video_f‹r
 = 
ft_out
;

1546 
ç
:

1547  
»t
;

1548 
	}
}

1550 
	$cÚfigu»_audio_f‹rs
(
FFPÏy”
 *
få
, cÚ¡ *
af‹rs
, 
fÜû_ouut_fÜm©
)

1552 
VideoS‹
 *
is
 = 
få
->is;

1553 cÚ¡ 
AVSam¶eFÜm©
 
§m¶e_fmts
[] = { 
AV_SAMPLE_FMT_S16
, 
AV_SAMPLE_FMT_NONE
 };

1554 
§m¶e_¿‹s
[2] = { 0, -1 };

1555 
št64_t
 
chªÃl_Ïyouts
[2] = { 0, -1 };

1556 
chªÃls
[2] = { 0, -1 };

1557 
AVF‹rCÚ‹xt
 *
ft_a¤c
 = 
NULL
, *
ft_asšk
 = NULL;

1558 
¬e§m¶e_swr_İts
[512] = "";

1559 
AVDiùiÚ¬yEÁry
 *
e
 = 
NULL
;

1560 
a¤c_¬gs
[256];

1561 
»t
;

1562 
af‹rs_¬gs
[4096];

1564 
	`avf‹r_g¿ph_ä“
(&
is
->
ag¿ph
);

1565 ià(!(
is
->
ag¿ph
 = 
	`avf‹r_g¿ph_®loc
()))

1566  
	`AVERROR
(
ENOMEM
);

1568 (
e
 = 
	`av_diù_g‘
(
få
->
swr_İts
, "",ƒ, 
AV_DICT_IGNORE_SUFFIX
)))

1569 
	`av_¡¾ÿtf
(
¬e§m¶e_swr_İts
, ×»§m¶e_swr_İts), "%s=%s:", 
e
->
key
,ƒ->
v®ue
);

1570 ià(
	`¡¾’
(
¬e§m¶e_swr_İts
))

1571 
¬e§m¶e_swr_İts
[
	`¡¾’
(aresample_swr_opts)-1] = '\0';

1572 
	`av_İt_£t
(
is
->
ag¿ph
, "¬e§m¶e_swr_İts", 
¬e§m¶e_swr_İts
, 0);

1574 
»t
 = 
	`¢´štf
(
a¤c_¬gs
, (asrc_args),

1576 
is
->
audio_f‹r_¤c
.
äeq
, 
	`av_g‘_§m¶e_fmt_Çme
(is->audio_f‹r_¤c.
fmt
),

1577 
is
->
audio_f‹r_¤c
.
chªÃls
,

1578 1, 
is
->
audio_f‹r_¤c
.
äeq
);

1579 ià(
is
->
audio_f‹r_¤c
.
chªÃl_Ïyout
)

1580 
	`¢´štf
(
a¤c_¬gs
 + 
»t
, (asrc_args) -„et,

1581 ":chªÃl_Ïyout=0x%"
PRIx64
, 
is
->
audio_f‹r_¤c
.
chªÃl_Ïyout
);

1583 
»t
 = 
	`avf‹r_g¿ph_ü—‹_f‹r
(&
ft_a¤c
,

1584 
	`avf‹r_g‘_by_Çme
("abuffer"), "ffplay_abuffer",

1585 
a¤c_¬gs
, 
NULL
, 
is
->
ag¿ph
);

1586 ià(
»t
 < 0)

1587 
’d
;

1590 
»t
 = 
	`avf‹r_g¿ph_ü—‹_f‹r
(&
ft_asšk
,

1591 
	`avf‹r_g‘_by_Çme
("abuffersink"), "ffplay_abuffersink",

1592 
NULL
, NULL, 
is
->
ag¿ph
);

1593 ià(
»t
 < 0)

1594 
’d
;

1596 ià((
»t
 = 
	`av_İt_£t_št_li¡
(
ft_asšk
, "§m¶e_fmts", 
§m¶e_fmts
, 
AV_SAMPLE_FMT_NONE
, 
AV_OPT_SEARCH_CHILDREN
)) < 0)

1597 
’d
;

1598 ià((
»t
 = 
	`av_İt_£t_št
(
ft_asšk
, "®l_chªÃl_couÁs", 1, 
AV_OPT_SEARCH_CHILDREN
)) < 0)

1599 
’d
;

1601 ià(
fÜû_ouut_fÜm©
) {

1602 
chªÃl_Ïyouts
[0] = 
is
->
audio_tgt
.
chªÃl_Ïyout
;

1603 
chªÃls
 [0] = 
is
->
audio_tgt
.channels;

1604 
§m¶e_¿‹s
 [0] = 
is
->
audio_tgt
.
äeq
;

1605 ià((
»t
 = 
	`av_İt_£t_št
(
ft_asšk
, "®l_chªÃl_couÁs", 0, 
AV_OPT_SEARCH_CHILDREN
)) < 0)

1606 
’d
;

1607 ià((
»t
 = 
	`av_İt_£t_št_li¡
(
ft_asšk
, "chªÃl_Ïyouts", 
chªÃl_Ïyouts
, -1, 
AV_OPT_SEARCH_CHILDREN
)) < 0)

1608 
’d
;

1609 ià((
»t
 = 
	`av_İt_£t_št_li¡
(
ft_asšk
, "chªÃl_couÁs" , 
chªÃls
 , -1, 
AV_OPT_SEARCH_CHILDREN
)) < 0)

1610 
’d
;

1611 ià((
»t
 = 
	`av_İt_£t_št_li¡
(
ft_asšk
, "§m¶e_¿‹s" , 
§m¶e_¿‹s
 , -1, 
AV_OPT_SEARCH_CHILDREN
)) < 0)

1612 
’d
;

1615 
af‹rs_¬gs
[0] = 0;

1616 ià(
af‹rs
)

1617 
	`¢´štf
(
af‹rs_¬gs
, ×f‹rs_¬gs), "%s", 
af‹rs
);

1619 #ifdeà
FFP_AVFILTER_PLAYBACK_RATE


1620 ià(
	`çbsf
(
få
->
pf_¶ayback_¿‹
) > 0.00001 &&

1621 
	`çbsf
(
få
->
pf_¶ayback_¿‹
 - 1.0f) > 0.00001) {

1622 ià(
af‹rs_¬gs
[0])

1623 
	`av_¡¾ÿtf
(
af‹rs_¬gs
, (afilters_args), ",");

1625 
	`av_log
(
få
, 
AV_LOG_INFO
, "af_¿‹=%f\n", få->
pf_¶ayback_¿‹
);

1626 
	`av_¡¾ÿtf
(
af‹rs_¬gs
, ×f‹rs_¬gs), "©empo=%f", 
få
->
pf_¶ayback_¿‹
);

1630 ià((
»t
 = 
	`cÚfigu»_f‹rg¿ph
(
is
->
ag¿ph
, 
af‹rs_¬gs
[0] ?‡f‹rs_¬g : 
NULL
, 
ft_a¤c
, 
ft_asšk
)) < 0)

1631 
’d
;

1633 
is
->
š_audio_f‹r
 = 
ft_a¤c
;

1634 
is
->
out_audio_f‹r
 = 
ft_asšk
;

1636 
’d
:

1637 ià(
»t
 < 0)

1638 
	`avf‹r_g¿ph_ä“
(&
is
->
ag¿ph
);

1639  
»t
;

1640 
	}
}

1643 
	$audio_th»ad
(*
¬g
)

1645 
FFPÏy”
 *
få
 = 
¬g
;

1646 
VideoS‹
 *
is
 = 
få
->is;

1647 
AVF¿me
 *
äame
 = 
	`av_äame_®loc
();

1648 
F¿me
 *
af
;

1649 #ià
CONFIG_AVFILTER


1650 
Ï¡_£rŸl
 = -1;

1651 
št64_t
 
dec_chªÃl_Ïyout
;

1652 
»cÚfigu»
;

1654 
gÙ_äame
 = 0;

1655 
AVR©iÚ®
 
tb
;

1656 
»t
 = 0;

1658 ià(!
äame
)

1659  
	`AVERROR
(
ENOMEM
);

1662 
	`få_audio_¡©i¡ic_l
(
få
);

1663 ià((
gÙ_äame
 = 
	`decod”_decode_äame
(
få
, &
is
->
auddec
, 
äame
, 
NULL
)) < 0)

1664 
the_’d
;

1666 ià(
gÙ_äame
) {

1667 
tb
 = (
AVR©iÚ®
){1, 
äame
->
§m¶e_¿‹
};

1669 #ià
CONFIG_AVFILTER


1670 
dec_chªÃl_Ïyout
 = 
	`g‘_v®id_chªÃl_Ïyout
(
äame
->
chªÃl_Ïyout
, 
	`av_äame_g‘_chªÃls
(frame));

1672 
»cÚfigu»
 =

1673 
	`cmp_audio_fmts
(
is
->
audio_f‹r_¤c
.
fmt
, is->audio_f‹r_¤c.
chªÃls
,

1674 
äame
->
fÜm©
, 
	`av_äame_g‘_chªÃls
(frame)) ||

1675 
is
->
audio_f‹r_¤c
.
chªÃl_Ïyout
 !ğ
dec_chªÃl_Ïyout
 ||

1676 
is
->
audio_f‹r_¤c
.
äeq
 !ğ
äame
->
§m¶e_¿‹
 ||

1677 
is
->
auddec
.
pkt_£rŸl
 !ğ
Ï¡_£rŸl
 ||

1678 
få
->
af_chªged
;

1680 ià(
»cÚfigu»
) {

1681 
	`SDL_LockMu‹x
(
få
->
af_mu‹x
);

1682 
få
->
af_chªged
 = 0;

1683 
buf1
[1024], 
buf2
[1024];

1684 
	`av_g‘_chªÃl_Ïyout_¡ršg
(
buf1
, (buf1), -1, 
is
->
audio_f‹r_¤c
.
chªÃl_Ïyout
);

1685 
	`av_g‘_chªÃl_Ïyout_¡ršg
(
buf2
, (buf2), -1, 
dec_chªÃl_Ïyout
);

1686 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
,

1688 
is
->
audio_f‹r_¤c
.
äeq
, is->audio_f‹r_¤c.
chªÃls
, 
	`av_g‘_§m¶e_fmt_Çme
(is->audio_f‹r_¤c.
fmt
), 
buf1
, 
Ï¡_£rŸl
,

1689 
äame
->
§m¶e_¿‹
, 
	`av_äame_g‘_chªÃls
(äame), 
	`av_g‘_§m¶e_fmt_Çme
(äame->
fÜm©
), 
buf2
, 
is
->
auddec
.
pkt_£rŸl
);

1691 
is
->
audio_f‹r_¤c
.
fmt
 = 
äame
->
fÜm©
;

1692 
is
->
audio_f‹r_¤c
.
chªÃls
 = 
	`av_äame_g‘_chªÃls
(
äame
);

1693 
is
->
audio_f‹r_¤c
.
chªÃl_Ïyout
 = 
dec_chªÃl_Ïyout
;

1694 
is
->
audio_f‹r_¤c
.
äeq
 = 
äame
->
§m¶e_¿‹
;

1695 
Ï¡_£rŸl
 = 
is
->
auddec
.
pkt_£rŸl
;

1697 ià((
»t
 = 
	`cÚfigu»_audio_f‹rs
(
få
, få->
af‹rs
, 1)) < 0) {

1698 
	`SDL_UÆockMu‹x
(
få
->
af_mu‹x
);

1699 
the_’d
;

1701 
	`SDL_UÆockMu‹x
(
få
->
af_mu‹x
);

1704 ià((
»t
 = 
	`av_bufãr¤c_add_äame
(
is
->
š_audio_f‹r
, 
äame
)) < 0)

1705 
the_’d
;

1707 (
»t
 = 
	`av_bufãrsšk_g‘_äame_æags
(
is
->
out_audio_f‹r
, 
äame
, 0)) >= 0) {

1708 
tb
 = 
is
->
out_audio_f‹r
->
šputs
[0]->
time_ba£
;

1710 ià(!(
af
 = 
	`äame_queue_³ek_wr™abË
(&
is
->
§mpq
)))

1711 
the_’d
;

1713 
af
->
±s
 = (
äame
->± =ğ
AV_NOPTS_VALUE
è? 
NAN
 : f¿me->± * 
	`av_q2d
(
tb
);

1714 
af
->
pos
 = 
	`av_äame_g‘_pkt_pos
(
äame
);

1715 
af
->
£rŸl
 = 
is
->
auddec
.
pkt_£rŸl
;

1716 
af
->
du¿tiÚ
 = 
	`av_q2d
((
AVR©iÚ®
){
äame
->
nb_§m¶es
, f¿me->
§m¶e_¿‹
});

1718 
	`av_äame_move_»f
(
af
->
äame
, frame);

1719 
	`äame_queue_push
(&
is
->
§mpq
);

1721 #ià
CONFIG_AVFILTER


1722 ià(
is
->
audioq
.
£rŸl
 !ğis->
auddec
.
pkt_£rŸl
)

1725 ià(
»t
 =ğ
AVERROR_EOF
)

1726 
is
->
auddec
.
fšished
 = is->auddec.
pkt_£rŸl
;

1729 } 
»t
 >ğ0 ||„‘ =ğ
	`AVERROR
(
EAGAIN
è||„‘ =ğ
AVERROR_EOF
);

1730 
the_’d
:

1731 #ià
CONFIG_AVFILTER


1732 
	`avf‹r_g¿ph_ä“
(&
is
->
ag¿ph
);

1734 
	`av_äame_ä“
(&
äame
);

1735  
»t
;

1736 
	}
}

1738 
decod”_¡¬t
(
Decod”
 *
d
, (*
â
)(*), *
¬g
, cÚ¡ *
Çme
)

1740 
	`·ck‘_queue_¡¬t
(
d
->
queue
);

1741 
d
->
decod”_tid
 = 
	`SDL_C»©eTh»adEx
(&d->
_decod”_tid
, 
â
, 
¬g
, 
Çme
);

1742 ià(!
d
->
decod”_tid
) {

1743 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "SDL_C»©eTh»ad(): %s\n", 
	`SDL_G‘E¼Ü
());

1744  
	`AVERROR
(
ENOMEM
);

1747 
	}
}

1749 
	$fåÏy_video_th»ad
(*
¬g
)

1751 
FFPÏy”
 *
få
 = 
¬g
;

1752 
VideoS‹
 *
is
 = 
få
->is;

1753 
AVF¿me
 *
äame
 = 
	`av_äame_®loc
();

1754 
±s
;

1755 
du¿tiÚ
;

1756 
»t
;

1757 
AVR©iÚ®
 
tb
 = 
is
->
video_¡
->
time_ba£
;

1758 
AVR©iÚ®
 
äame_¿‹
 = 
	`av_guess_äame_¿‹
(
is
->
ic
, is->
video_¡
, 
NULL
);

1760 #ià
CONFIG_AVFILTER


1761 
AVF‹rG¿ph
 *
g¿ph
 = 
	`avf‹r_g¿ph_®loc
();

1762 
AVF‹rCÚ‹xt
 *
ft_out
 = 
NULL
, *
ft_š
 = NULL;

1763 
Ï¡_w
 = 0;

1764 
Ï¡_h
 = 0;

1765 
AVPix–FÜm©
 
Ï¡_fÜm©
 = -2;

1766 
Ï¡_£rŸl
 = -1;

1767 
Ï¡_vf‹r_idx
 = 0;

1768 ià(!
g¿ph
) {

1769 
	`av_äame_ä“
(&
äame
);

1770  
	`AVERROR
(
ENOMEM
);

1774 
	`få_nÙify_msg2
(
få
, 
FFP_MSG_VIDEO_ROTATION_CHANGED
, 
	`få_g‘_video_rÙ©e_deg»es
(ffp));

1777 ià(!
äame
) {

1778 #ià
CONFIG_AVFILTER


1779 
	`avf‹r_g¿ph_ä“
(&
g¿ph
);

1781  
	`AVERROR
(
ENOMEM
);

1785 
»t
 = 
	`g‘_video_äame
(
få
, 
äame
);

1786 ià(
»t
 < 0)

1787 
the_’d
;

1788 ià(!
»t
)

1791 #ià
CONFIG_AVFILTER


1792 iàĞ
Ï¡_w
 !ğ
äame
->
width


1793 || 
Ï¡_h
 !ğ
äame
->
height


1794 || 
Ï¡_fÜm©
 !ğ
äame
->
fÜm©


1795 || 
Ï¡_£rŸl
 !ğ
is
->
viddec
.
pkt_£rŸl


1796 || 
få
->
vf_chªged


1797 || 
Ï¡_vf‹r_idx
 !ğ
is
->
vf‹r_idx
) {

1798 
	`SDL_LockMu‹x
(
få
->
vf_mu‹x
);

1799 
få
->
vf_chªged
 = 0;

1800 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
,

1802 
Ï¡_w
, 
Ï¡_h
,

1803 (cÚ¡ *)
	`av_x_if_nuÎ
(
	`av_g‘_pix_fmt_Çme
(
Ï¡_fÜm©
), "nÚe"), 
Ï¡_£rŸl
,

1804 
äame
->
width
, f¿me->
height
,

1805 (cÚ¡ *)
	`av_x_if_nuÎ
(
	`av_g‘_pix_fmt_Çme
(
äame
->
fÜm©
), "nÚe"), 
is
->
viddec
.
pkt_£rŸl
);

1806 
	`avf‹r_g¿ph_ä“
(&
g¿ph
);

1807 
g¿ph
 = 
	`avf‹r_g¿ph_®loc
();

1808 ià((
»t
 = 
	`cÚfigu»_video_f‹rs
(
få
, 
g¿ph
, 
is
, få->
vf‹rs_li¡
 ? få->vf‹rs_li¡[is->
vf‹r_idx
] : 
NULL
, 
äame
)) < 0) {

1810 
	`SDL_UÆockMu‹x
(
få
->
vf_mu‹x
);

1811 
the_’d
;

1813 
ft_š
 = 
is
->
š_video_f‹r
;

1814 
ft_out
 = 
is
->
out_video_f‹r
;

1815 
Ï¡_w
 = 
äame
->
width
;

1816 
Ï¡_h
 = 
äame
->
height
;

1817 
Ï¡_fÜm©
 = 
äame
->
fÜm©
;

1818 
Ï¡_£rŸl
 = 
is
->
viddec
.
pkt_£rŸl
;

1819 
Ï¡_vf‹r_idx
 = 
is
->
vf‹r_idx
;

1820 
äame_¿‹
 = 
ft_out
->
šputs
[0]->frame_rate;

1821 
	`SDL_UÆockMu‹x
(
få
->
vf_mu‹x
);

1824 
»t
 = 
	`av_bufãr¤c_add_äame
(
ft_š
, 
äame
);

1825 ià(
»t
 < 0)

1826 
the_’d
;

1828 
»t
 >= 0) {

1829 
is
->
äame_Ï¡_»tuºed_time
 = 
	`av_g‘time_»Ïtive
() / 1000000.0;

1831 
»t
 = 
	`av_bufãrsšk_g‘_äame_æags
(
ft_out
, 
äame
, 0);

1832 ià(
»t
 < 0) {

1833 ià(
»t
 =ğ
AVERROR_EOF
)

1834 
is
->
viddec
.
fšished
 = is->viddec.
pkt_£rŸl
;

1835 
»t
 = 0;

1839 
is
->
äame_Ï¡_f‹r_d–ay
 = 
	`av_g‘time_»Ïtive
(è/ 1000000.0 - is->
äame_Ï¡_»tuºed_time
;

1840 ià(
	`çbs
(
is
->
äame_Ï¡_f‹r_d–ay
è> 
AV_NOSYNC_THRESHOLD
 / 10.0)

1841 
is
->
äame_Ï¡_f‹r_d–ay
 = 0;

1842 
tb
 = 
ft_out
->
šputs
[0]->
time_ba£
;

1844 
du¿tiÚ
 = (
äame_¿‹
.
num
 && f¿me_¿‹.
d’
 ? 
	`av_q2d
((
AVR©iÚ®
){frame_rate.den, frame_rate.num}) : 0);

1845 
±s
 = (
äame
->± =ğ
AV_NOPTS_VALUE
è? 
NAN
 : f¿me->± * 
	`av_q2d
(
tb
);

1846 
»t
 = 
	`queue_piùu»
(
få
, 
äame
, 
±s
, 
du¿tiÚ
, 
	`av_äame_g‘_pkt_pos
(äame), 
is
->
viddec
.
pkt_£rŸl
);

1847 
	`av_äame_uÄef
(
äame
);

1848 #ià
CONFIG_AVFILTER


1852 ià(
»t
 < 0)

1853 
the_’d
;

1855 
the_’d
:

1856 #ià
CONFIG_AVFILTER


1857 
	`avf‹r_g¿ph_ä“
(&
g¿ph
);

1859 
	`av_äame_ä“
(&
äame
);

1861 
	}
}

1863 
	$video_th»ad
(*
¬g
)

1865 
FFPÏy”
 *
få
 = (FFPÏy” *)
¬g
;

1866 
»t
 = 0;

1868 ià(
få
->
node_vdec
) {

1869 
»t
 = 
	`få’ode_run_sync
(
få
->
node_vdec
);

1871  
»t
;

1872 
	}
}

1874 
	$subt™Ë_th»ad
(*
¬g
)

1876 
FFPÏy”
 *
få
 = 
¬g
;

1877 
VideoS‹
 *
is
 = 
få
->is;

1878 
F¿me
 *
¥
;

1879 
gÙ_subt™Ë
;

1880 
±s
;

1883 ià(!(
¥
 = 
	`äame_queue_³ek_wr™abË
(&
is
->
subpq
)))

1886 ià((
gÙ_subt™Ë
 = 
	`decod”_decode_äame
(
få
, &
is
->
subdec
, 
NULL
, &
¥
->
sub
)) < 0)

1889 
±s
 = 0;

1890 #ifdeà
FFP_MERGE


1891 ià(
gÙ_subt™Ë
 && 
¥
->
sub
.
fÜm©
 == 0) {

1893 ià(
gÙ_subt™Ë
) {

1895 ià(
¥
->
sub
.
±s
 !ğ
AV_NOPTS_VALUE
)

1896 
±s
 = 
¥
->
sub
.± / ()
AV_TIME_BASE
;

1897 
¥
->
±s
 =…ts;

1898 
¥
->
£rŸl
 = 
is
->
subdec
.
pkt_£rŸl
;

1899 
¥
->
width
 = 
is
->
subdec
.
avùx
->width;

1900 
¥
->
height
 = 
is
->
subdec
.
avùx
->height;

1901 
¥
->
u¶ßded
 = 0;

1904 
	`äame_queue_push
(&
is
->
subpq
);

1905 #ifdeà
FFP_MERGE


1906 } ià(
gÙ_subt™Ë
) {

1907 
	`avsubt™Ë_ä“
(&
¥
->
sub
);

1912 
	}
}

1915 
	$upd©e_§m¶e_di¥Ïy
(
VideoS‹
 *
is
, *
§m¶es
, 
§m¶es_size
)

1917 
size
, 
Ën
;

1919 
size
 = 
§m¶es_size
 / ();

1920 
size
 > 0) {

1921 
Ën
 = 
SAMPLE_ARRAY_SIZE
 - 
is
->
§m¶e_¬¿y_šdex
;

1922 ià(
Ën
 > 
size
)

1923 
Ën
 = 
size
;

1924 
	`memıy
(
is
->
§m¶e_¬¿y
 + is->
§m¶e_¬¿y_šdex
, 
§m¶es
, 
Ën
 * ());

1925 
§m¶es
 +ğ
Ën
;

1926 
is
->
§m¶e_¬¿y_šdex
 +ğ
Ën
;

1927 ià(
is
->
§m¶e_¬¿y_šdex
 >ğ
SAMPLE_ARRAY_SIZE
)

1928 
is
->
§m¶e_¬¿y_šdex
 = 0;

1929 
size
 -ğ
Ën
;

1931 
	}
}

1935 
	$synchrÚize_audio
(
VideoS‹
 *
is
, 
nb_§m¶es
)

1937 
wª‹d_nb_§m¶es
 = 
nb_§m¶es
;

1940 ià(
	`g‘_ma¡”_sync_ty³
(
is
è!ğ
AV_SYNC_AUDIO_MASTER
) {

1941 
diff
, 
avg_diff
;

1942 
mš_nb_§m¶es
, 
max_nb_§m¶es
;

1944 
diff
 = 
	`g‘_şock
(&
is
->
audşk
è- 
	`g‘_ma¡”_şock
(is);

1946 ià(!
	`i¢ª
(
diff
è&& 
	`çbs
(diffè< 
AV_NOSYNC_THRESHOLD
) {

1947 
is
->
audio_diff_cum
 = 
diff
 + is->
audio_diff_avg_cÛf
 * is->audio_diff_cum;

1948 ià(
is
->
audio_diff_avg_couÁ
 < 
AUDIO_DIFF_AVG_NB
) {

1950 
is
->
audio_diff_avg_couÁ
++;

1953 
avg_diff
 = 
is
->
audio_diff_cum
 * (1.0 - is->
audio_diff_avg_cÛf
);

1955 ià(
	`çbs
(
avg_diff
è>ğ
is
->
audio_diff_th»shŞd
) {

1956 
wª‹d_nb_§m¶es
 = 
nb_§m¶es
 + ()(
diff
 * 
is
->
audio_¤c
.
äeq
);

1957 
mš_nb_§m¶es
 = ((
nb_§m¶es
 * (100 - 
SAMPLE_CORRECTION_PERCENT_MAX
) / 100));

1958 
max_nb_§m¶es
 = ((
nb_§m¶es
 * (100 + 
SAMPLE_CORRECTION_PERCENT_MAX
) / 100));

1959 
wª‹d_nb_§m¶es
 = 
	`av_ş
(wª‹d_nb_§m¶es, 
mš_nb_§m¶es
, 
max_nb_§m¶es
);

1961 
	`av_log
(
NULL
, 
AV_LOG_TRACE
, "diff=%f‡diff=%f sample_diff=%d‡pts=%0.3f %f\n",

1962 
diff
, 
avg_diff
, 
wª‹d_nb_§m¶es
 - 
nb_§m¶es
,

1963 
is
->
audio_şock
, is->
audio_diff_th»shŞd
);

1968 
is
->
audio_diff_avg_couÁ
 = 0;

1969 
is
->
audio_diff_cum
 = 0;

1973  
wª‹d_nb_§m¶es
;

1974 
	}
}

1983 
	$audio_decode_äame
(
FFPÏy”
 *
få
)

1985 
VideoS‹
 *
is
 = 
få
->is;

1986 
d©a_size
, 
»§m¶ed_d©a_size
;

1987 
št64_t
 
dec_chªÃl_Ïyout
;

1988 
av_unu£d
 
audio_şock0
;

1989 
wª‹d_nb_§m¶es
;

1990 
F¿me
 *
af
;

1992 ià(
is
->
·u£d
 || is->
¡•
)

1995 ià(
få
->
sync_av_¡¬t
 &&

1996 
is
->
video_¡
 &&

1997 !
is
->
viddec
.
fœ¡_äame_decoded
 &&

1998 
is
->
viddec
.
fšished
 !ğis->
videoq
.
£rŸl
) {

2000 
Ušt64
 
now
 = 
	`SDL_G‘TickHR
();

2001 ià(
now
 < 
is
->
viddec
.
fœ¡_äame_decoded_time
 ||

2002 
now
 > 
is
->
viddec
.
fœ¡_äame_decoded_time
 + 2000) {

2003 
is
->
viddec
.
fœ¡_äame_decoded
 = 1;

2011 #ià
	`defšed
(
_WIN32
è|| defšed(
__APPLE__
)

2012 
	`äame_queue_nb_»maššg
(&
is
->
§mpq
) == 0) {

2013 ià((
	`av_g‘time_»Ïtive
(è- 
få
->
audio_ÿÎback_time
è> 1000000LL * 
is
->
audio_hw_buf_size
 / is->
audio_tgt
.
by‹s_³r_£c
 / 2)

2015 
	`av_u¦“p
 (1000);

2018 ià(!(
af
 = 
	`äame_queue_³ek_»adabË
(&
is
->
§mpq
)))

2020 
	`äame_queue_Ãxt
(&
is
->
§mpq
);

2021 } 
af
->
£rŸl
 !ğ
is
->
audioq
.serial);

2023 
d©a_size
 = 
	`av_§m¶es_g‘_bufãr_size
(
NULL
, 
	`av_äame_g‘_chªÃls
(
af
->
äame
),

2024 
af
->
äame
->
nb_§m¶es
,

2025 
af
->
äame
->
fÜm©
, 1);

2027 
dec_chªÃl_Ïyout
 =

2028 (
af
->
äame
->
chªÃl_Ïyout
 && 
	`av_äame_g‘_chªÃls
×f->äameè=ğ
	`av_g‘_chªÃl_Ïyout_nb_chªÃls
(af->frame->channel_layout)) ?

2029 
af
->
äame
->
chªÃl_Ïyout
 : 
	`av_g‘_deçuÉ_chªÃl_Ïyout
(
	`av_äame_g‘_chªÃls
(af->frame));

2030 
wª‹d_nb_§m¶es
 = 
	`synchrÚize_audio
(
is
, 
af
->
äame
->
nb_§m¶es
);

2032 ià(
af
->
äame
->
fÜm©
 !ğ
is
->
audio_¤c
.
fmt
 ||

2033 
dec_chªÃl_Ïyout
 !ğ
is
->
audio_¤c
.
chªÃl_Ïyout
 ||

2034 
af
->
äame
->
§m¶e_¿‹
 !ğ
is
->
audio_¤c
.
äeq
 ||

2035 (
wª‹d_nb_§m¶es
 !ğ
af
->
äame
->
nb_§m¶es
 && !
is
->
swr_ùx
)) {

2036 
AVDiùiÚ¬y
 *
swr_İts
 = 
NULL
;

2037 
	`swr_ä“
(&
is
->
swr_ùx
);

2038 
is
->
swr_ùx
 = 
	`swr_®loc_£t_İts
(
NULL
,

2039 
is
->
audio_tgt
.
chªÃl_Ïyout
, is->audio_tgt.
fmt
, is->audio_tgt.
äeq
,

2040 
dec_chªÃl_Ïyout
, 
af
->
äame
->
fÜm©
,‡f->äame->
§m¶e_¿‹
,

2041 0, 
NULL
);

2042 ià(!
is
->
swr_ùx
) {

2043 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

2045 
af
->
äame
->
§m¶e_¿‹
, 
	`av_g‘_§m¶e_fmt_Çme
×f->äame->
fÜm©
), 
	`av_äame_g‘_chªÃls
(af->frame),

2046 
is
->
audio_tgt
.
äeq
, 
	`av_g‘_§m¶e_fmt_Çme
(is->audio_tgt.
fmt
), is->audio_tgt.
chªÃls
);

2049 
	`av_diù_cİy
(&
swr_İts
, 
få
->swr_opts, 0);

2050 ià(
af
->
äame
->
chªÃl_Ïyout
 =ğ
AV_CH_LAYOUT_5POINT1_BACK
)

2051 
	`av_İt_£t_doubË
(
is
->
swr_ùx
, "ûÁ”_mix_Ëv–", 
få
->
´e£t_5_1_ûÁ”_mix_Ëv–
, 0);

2052 
	`av_İt_£t_diù
(
is
->
swr_ùx
, &
swr_İts
);

2053 
	`av_diù_ä“
(&
swr_İts
);

2055 ià(
	`swr_š™
(
is
->
swr_ùx
) < 0) {

2056 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

2058 
af
->
äame
->
§m¶e_¿‹
, 
	`av_g‘_§m¶e_fmt_Çme
×f->äame->
fÜm©
), 
	`av_äame_g‘_chªÃls
(af->frame),

2059 
is
->
audio_tgt
.
äeq
, 
	`av_g‘_§m¶e_fmt_Çme
(is->audio_tgt.
fmt
), is->audio_tgt.
chªÃls
);

2060 
	`swr_ä“
(&
is
->
swr_ùx
);

2063 
is
->
audio_¤c
.
chªÃl_Ïyout
 = 
dec_chªÃl_Ïyout
;

2064 
is
->
audio_¤c
.
chªÃls
 = 
	`av_äame_g‘_chªÃls
(
af
->
äame
);

2065 
is
->
audio_¤c
.
äeq
 = 
af
->
äame
->
§m¶e_¿‹
;

2066 
is
->
audio_¤c
.
fmt
 = 
af
->
äame
->
fÜm©
;

2069 ià(
is
->
swr_ùx
) {

2070 cÚ¡ 
ušt8_t
 **
š
 = (cÚ¡ ušt8_ˆ**)
af
->
äame
->
ex‹nded_d©a
;

2071 
ušt8_t
 **
out
 = &
is
->
audio_buf1
;

2072 
out_couÁ
 = ()((
št64_t
)
wª‹d_nb_§m¶es
 * 
is
->
audio_tgt
.
äeq
 / 
af
->
äame
->
§m¶e_¿‹
 + 256);

2073 
out_size
 = 
	`av_§m¶es_g‘_bufãr_size
(
NULL
, 
is
->
audio_tgt
.
chªÃls
, 
out_couÁ
, is->audio_tgt.
fmt
, 0);

2074 
Ën2
;

2075 ià(
out_size
 < 0) {

2076 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "av_samples_get_buffer_size() failed\n");

2079 ià(
wª‹d_nb_§m¶es
 !ğ
af
->
äame
->
nb_§m¶es
) {

2080 ià(
	`swr_£t_com³n§tiÚ
(
is
->
swr_ùx
, (
wª‹d_nb_§m¶es
 - 
af
->
äame
->
nb_§m¶es
è* is->
audio_tgt
.
äeq
 /‡f->äame->
§m¶e_¿‹
,

2081 
wª‹d_nb_§m¶es
 * 
is
->
audio_tgt
.
äeq
 / 
af
->
äame
->
§m¶e_¿‹
) < 0) {

2082 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "swr_set_compensation() failed\n");

2086 
	`av_ç¡_m®loc
(&
is
->
audio_buf1
, &is->
audio_buf1_size
, 
out_size
);

2087 ià(!
is
->
audio_buf1
)

2088  
	`AVERROR
(
ENOMEM
);

2089 
Ën2
 = 
	`swr_cÚv”t
(
is
->
swr_ùx
, 
out
, 
out_couÁ
, 
š
, 
af
->
äame
->
nb_§m¶es
);

2090 ià(
Ën2
 < 0) {

2091 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "swr_convert() failed\n");

2094 ià(
Ën2
 =ğ
out_couÁ
) {

2095 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "audio buffer is…robablyoo small\n");

2096 ià(
	`swr_š™
(
is
->
swr_ùx
) < 0)

2097 
	`swr_ä“
(&
is
->
swr_ùx
);

2099 
is
->
audio_buf
 = is->
audio_buf1
;

2100 
»§m¶ed_d©a_size
 = 
Ën2
 * 
is
->
audio_tgt
.
chªÃls
 * 
	`av_g‘_by‹s_³r_§m¶e
(is->audio_tgt.
fmt
);

2102 
is
->
audio_buf
 = 
af
->
äame
->
d©a
[0];

2103 
»§m¶ed_d©a_size
 = 
d©a_size
;

2106 
audio_şock0
 = 
is
->
audio_şock
;

2108 ià(!
	`i¢ª
(
af
->
±s
))

2109 
is
->
audio_şock
 = 
af
->
±s
 + (èaf->
äame
->
nb_§m¶es
 /‡f->äame->
§m¶e_¿‹
;

2111 
is
->
audio_şock
 = 
NAN
;

2112 
is
->
audio_şock_£rŸl
 = 
af
->
£rŸl
;

2113 #ifdeà
FFP_SHOW_AUDIO_DELAY


2115 
Ï¡_şock
;

2116 
	`´štf
("audio: delay=%0.3f clock=%0.3f clock0=%0.3f\n",

2117 
is
->
audio_şock
 - 
Ï¡_şock
,

2118 
is
->
audio_şock
, 
audio_şock0
);

2119 
Ï¡_şock
 = 
is
->
audio_şock
;

2122 ià(!
is
->
auddec
.
fœ¡_äame_decoded
) {

2123 
	`ALOGD
("avcodec/Audio: first frame decoded\n");

2124 
is
->
auddec
.
fœ¡_äame_decoded_time
 = 
	`SDL_G‘TickHR
();

2125 
is
->
auddec
.
fœ¡_äame_decoded
 = 1;

2127 ià(!
få
->
fœ¡_audio_äame_»nd”ed
) {

2128 
få
->
fœ¡_audio_äame_»nd”ed
 = 1;

2129 
	`få_nÙify_msg1
(
få
, 
FFP_MSG_AUDIO_RENDERING_START
);

2131  
»§m¶ed_d©a_size
;

2132 
	}
}

2135 
	$sdl_audio_ÿÎback
(*
İaque
, 
Ušt8
 *
¡»am
, 
Ën
)

2137 
FFPÏy”
 *
få
 = 
İaque
;

2138 
VideoS‹
 *
is
 = 
få
->is;

2139 
audio_size
, 
Ën1
;

2140 ià(!
få
 || !
is
) {

2141 
	`mem£t
(
¡»am
, 0, 
Ën
);

2145 
få
->
audio_ÿÎback_time
 = 
	`av_g‘time_»Ïtive
();

2147 ià(
få
->
pf_¶ayback_¿‹_chªged
) {

2148 
få
->
pf_¶ayback_¿‹_chªged
 = 0;

2149 
	`SDL_AoutS‘PÏybackR©e
(
få
->
aout
, få->
pf_¶ayback_¿‹
);

2151 ià(
få
->
pf_¶ayback_vŞume_chªged
) {

2152 
få
->
pf_¶ayback_vŞume_chªged
 = 0;

2153 
	`SDL_AoutS‘PÏybackVŞume
(
få
->
aout
, få->
pf_¶ayback_vŞume
);

2156 
Ën
 > 0) {

2157 ià(
is
->
audio_buf_šdex
 >ğis->
audio_buf_size
) {

2158 
audio_size
 = 
	`audio_decode_äame
(
få
);

2159 ià(
audio_size
 < 0) {

2161 
is
->
audio_buf
 = 
NULL
;

2162 
is
->
audio_buf_size
 = 
SDL_AUDIO_MIN_BUFFER_SIZE
 / is->
audio_tgt
.
äame_size
 * is->audio_tgt.frame_size;

2164 ià(
is
->
show_mode
 !ğ
SHOW_MODE_VIDEO
)

2165 
	`upd©e_§m¶e_di¥Ïy
(
is
, (
št16_t
 *)is->
audio_buf
, 
audio_size
);

2166 
is
->
audio_buf_size
 = 
audio_size
;

2168 
is
->
audio_buf_šdex
 = 0;

2170 ià(
is
->
auddec
.
pkt_£rŸl
 !ğis->
audioq
.
£rŸl
) {

2171 
is
->
audio_buf_šdex
 = is->
audio_buf_size
;

2172 
	`mem£t
(
¡»am
, 0, 
Ën
);

2175 
	`SDL_AoutFlushAudio
(
få
->
aout
);

2178 
Ën1
 = 
is
->
audio_buf_size
 - is->
audio_buf_šdex
;

2179 ià(
Ën1
 > 
Ën
)

2180 
Ën1
 = 
Ën
;

2181 ià(!
is
->
mu‹d
 && is->
audio_buf
 && is->
audio_vŞume
 =ğ
SDL_MIX_MAXVOLUME
)

2182 
	`memıy
(
¡»am
, (
ušt8_t
 *)
is
->
audio_buf
 + is->
audio_buf_šdex
, 
Ën1
);

2184 
	`mem£t
(
¡»am
, 0, 
Ën1
);

2185 ià(!
is
->
mu‹d
 && is->
audio_buf
)

2186 
	`SDL_MixAudio
(
¡»am
, (
ušt8_t
 *)
is
->
audio_buf
 + is->
audio_buf_šdex
, 
Ën1
, is->
audio_vŞume
);

2188 
Ën
 -ğ
Ën1
;

2189 
¡»am
 +ğ
Ën1
;

2190 
is
->
audio_buf_šdex
 +ğ
Ën1
;

2192 
is
->
audio_wr™e_buf_size
 = is->
audio_buf_size
 - is->
audio_buf_šdex
;

2194 ià(!
	`i¢ª
(
is
->
audio_şock
)) {

2195 
	`£t_şock_©
(&
is
->
audşk
, is->
audio_şock
 - ()(is->
audio_wr™e_buf_size
è/ is->
audio_tgt
.
by‹s_³r_£c
 - 
	`SDL_AoutG‘L©’cySecÚds
(
få
->
aout
), is->
audio_şock_£rŸl
, få->
audio_ÿÎback_time
 / 1000000.0);

2196 
	`sync_şock_to_¦ave
(&
is
->
extşk
, &is->
audşk
);

2198 
	}
}

2200 
	$audio_İ’
(
FFPÏy”
 *
İaque
, 
št64_t
 
wª‹d_chªÃl_Ïyout
, 
wª‹d_nb_chªÃls
, 
wª‹d_§m¶e_¿‹
, 
AudioP¬ams
 *
audio_hw_·¿ms
)

2202 
FFPÏy”
 *
få
 = 
İaque
;

2203 
VideoS‹
 *
is
 = 
få
->is;

2204 
SDL_AudioS³c
 
wª‹d_¥ec
, 
¥ec
;

2205 cÚ¡ *
’v
;

2206 cÚ¡ 
Ãxt_nb_chªÃls
[] = {0, 0, 1, 6, 2, 6, 4, 6};

2207 #ifdeà
FFP_MERGE


2208 cÚ¡ 
Ãxt_§m¶e_¿‹s
[] = {0, 44100, 48000, 96000, 192000};

2210 cÚ¡ 
Ãxt_§m¶e_¿‹s
[] = {0, 44100, 48000};

2211 
Ãxt_§m¶e_¿‹_idx
 = 
	`FF_ARRAY_ELEMS
(
Ãxt_§m¶e_¿‹s
) - 1;

2213 
’v
 = 
	`SDL_g‘’v
("SDL_AUDIO_CHANNELS");

2214 ià(
’v
) {

2215 
wª‹d_nb_chªÃls
 = 
	`©oi
(
’v
);

2216 
wª‹d_chªÃl_Ïyout
 = 
	`av_g‘_deçuÉ_chªÃl_Ïyout
(
wª‹d_nb_chªÃls
);

2218 ià(!
wª‹d_chªÃl_Ïyout
 || 
wª‹d_nb_chªÃls
 !ğ
	`av_g‘_chªÃl_Ïyout_nb_chªÃls
(wanted_channel_layout)) {

2219 
wª‹d_chªÃl_Ïyout
 = 
	`av_g‘_deçuÉ_chªÃl_Ïyout
(
wª‹d_nb_chªÃls
);

2220 
wª‹d_chªÃl_Ïyout
 &ğ~
AV_CH_LAYOUT_STEREO_DOWNMIX
;

2222 
wª‹d_nb_chªÃls
 = 
	`av_g‘_chªÃl_Ïyout_nb_chªÃls
(
wª‹d_chªÃl_Ïyout
);

2223 
wª‹d_¥ec
.
chªÃls
 = 
wª‹d_nb_chªÃls
;

2224 
wª‹d_¥ec
.
äeq
 = 
wª‹d_§m¶e_¿‹
;

2225 ià(
wª‹d_¥ec
.
äeq
 <ğ0 || wª‹d_¥ec.
chªÃls
 <= 0) {

2226 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Invalid sample„ate or channel count!\n");

2229 
Ãxt_§m¶e_¿‹_idx
 && 
Ãxt_§m¶e_¿‹s
[Ãxt_§m¶e_¿‹_idx] >ğ
wª‹d_¥ec
.
äeq
)

2230 
Ãxt_§m¶e_¿‹_idx
--;

2231 
wª‹d_¥ec
.
fÜm©
 = 
AUDIO_S16SYS
;

2232 
wª‹d_¥ec
.
s’û
 = 0;

2233 
wª‹d_¥ec
.
§m¶es
 = 
	`FFMAX
(
SDL_AUDIO_MIN_BUFFER_SIZE
, 2 << 
	`av_log2
(wª‹d_¥ec.
äeq
 / 
	`SDL_AoutG‘AudioP”SecÚdC®lBacks
(
få
->
aout
)));

2234 
wª‹d_¥ec
.
ÿÎback
 = 
sdl_audio_ÿÎback
;

2235 
wª‹d_¥ec
.
u£rd©a
 = 
İaque
;

2236 
	`SDL_AoutO³nAudio
(
få
->
aout
, &
wª‹d_¥ec
, &
¥ec
) < 0) {

2238 ià(
is
->
abÜt_»que¡
)

2240 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "SDL_OpenAudio (%d channels, %d Hz): %s\n",

2241 
wª‹d_¥ec
.
chªÃls
, wª‹d_¥ec.
äeq
, 
	`SDL_G‘E¼Ü
());

2242 
wª‹d_¥ec
.
chªÃls
 = 
Ãxt_nb_chªÃls
[
	`FFMIN
(7, wanted_spec.channels)];

2243 ià(!
wª‹d_¥ec
.
chªÃls
) {

2244 
wª‹d_¥ec
.
äeq
 = 
Ãxt_§m¶e_¿‹s
[
Ãxt_§m¶e_¿‹_idx
--];

2245 
wª‹d_¥ec
.
chªÃls
 = 
wª‹d_nb_chªÃls
;

2246 ià(!
wª‹d_¥ec
.
äeq
) {

2247 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

2252 
wª‹d_chªÃl_Ïyout
 = 
	`av_g‘_deçuÉ_chªÃl_Ïyout
(
wª‹d_¥ec
.
chªÃls
);

2254 ià(
¥ec
.
fÜm©
 !ğ
AUDIO_S16SYS
) {

2255 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

2256 "SDL‡dvi£d‡udiØfÜm© %d i nÙ suµÜ‹d!\n", 
¥ec
.
fÜm©
);

2259 ià(
¥ec
.
chªÃls
 !ğ
wª‹d_¥ec
.channels) {

2260 
wª‹d_chªÃl_Ïyout
 = 
	`av_g‘_deçuÉ_chªÃl_Ïyout
(
¥ec
.
chªÃls
);

2261 ià(!
wª‹d_chªÃl_Ïyout
) {

2262 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

2263 "SDL‡dvi£d chªÃÈcouÁ %d i nÙ suµÜ‹d!\n", 
¥ec
.
chªÃls
);

2268 
audio_hw_·¿ms
->
fmt
 = 
AV_SAMPLE_FMT_S16
;

2269 
audio_hw_·¿ms
->
äeq
 = 
¥ec
.freq;

2270 
audio_hw_·¿ms
->
chªÃl_Ïyout
 = 
wª‹d_chªÃl_Ïyout
;

2271 
audio_hw_·¿ms
->
chªÃls
 = 
¥ec
.channels;

2272 
audio_hw_·¿ms
->
äame_size
 = 
	`av_§m¶es_g‘_bufãr_size
(
NULL
,‡udio_hw_·¿ms->
chªÃls
, 1,‡udio_hw_·¿ms->
fmt
, 1);

2273 
audio_hw_·¿ms
->
by‹s_³r_£c
 = 
	`av_§m¶es_g‘_bufãr_size
(
NULL
,‡udio_hw_·¿ms->
chªÃls
,‡udio_hw_·¿ms->
äeq
,‡udio_hw_·¿ms->
fmt
, 1);

2274 ià(
audio_hw_·¿ms
->
by‹s_³r_£c
 <ğ0 ||‡udio_hw_·¿ms->
äame_size
 <= 0) {

2275 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "av_samples_get_buffer_size failed\n");

2279 
	`SDL_AoutS‘DeçuÉL©’cySecÚds
(
få
->
aout
, (()(2 * 
¥ec
.
size
)è/ 
audio_hw_·¿ms
->
by‹s_³r_£c
);

2280  
¥ec
.
size
;

2281 
	}
}

2284 
	$¡»am_compÚ’t_İ’
(
FFPÏy”
 *
få
, 
¡»am_šdex
)

2286 
VideoS‹
 *
is
 = 
få
->is;

2287 
AVFÜm©CÚ‹xt
 *
ic
 = 
is
->ic;

2288 
AVCodecCÚ‹xt
 *
avùx
;

2289 
AVCodec
 *
codec
 = 
NULL
;

2290 cÚ¡ *
fÜûd_codec_Çme
 = 
NULL
;

2291 
AVDiùiÚ¬y
 *
İts
 = 
NULL
;

2292 
AVDiùiÚ¬yEÁry
 *
t
 = 
NULL
;

2293 
§m¶e_¿‹
, 
nb_chªÃls
;

2294 
št64_t
 
chªÃl_Ïyout
;

2295 
»t
 = 0;

2296 
¡»am_low»s
 = 
få
->
low»s
;

2298 ià(
¡»am_šdex
 < 0 || sŒ—m_šdex >ğ
ic
->
nb_¡»ams
)

2300 
avùx
 = 
	`avcodec_®loc_cÚ‹xt3
(
NULL
);

2301 ià(!
avùx
)

2302  
	`AVERROR
(
ENOMEM
);

2304 
»t
 = 
	`avcodec_·¿m‘”s_to_cÚ‹xt
(
avùx
, 
ic
->
¡»ams
[
¡»am_šdex
]->
codeı¬
);

2305 ià(
»t
 < 0)

2306 
ç
;

2307 
	`av_codec_£t_pkt_timeba£
(
avùx
, 
ic
->
¡»ams
[
¡»am_šdex
]->
time_ba£
);

2309 
codec
 = 
	`avcodec_fšd_decod”
(
avùx
->
codec_id
);

2311 
avùx
->
codec_ty³
) {

2312 
AVMEDIA_TYPE_AUDIO
 : 
is
->
Ï¡_audio_¡»am
 = 
¡»am_šdex
; 
fÜûd_codec_Çme
 = 
få
->
audio_codec_Çme
; ;

2313 
AVMEDIA_TYPE_SUBTITLE
: 
is
->
Ï¡_subt™Ë_¡»am
 = 
¡»am_šdex
; 
fÜûd_codec_Çme
 = 
få
->
subt™Ë_codec_Çme
; ;

2314 
AVMEDIA_TYPE_VIDEO
 : 
is
->
Ï¡_video_¡»am
 = 
¡»am_šdex
; 
fÜûd_codec_Çme
 = 
få
->
video_codec_Çme
; ;

2317 ià(
fÜûd_codec_Çme
)

2318 
codec
 = 
	`avcodec_fšd_decod”_by_Çme
(
fÜûd_codec_Çme
);

2319 ià(!
codec
) {

2320 ià(
fÜûd_codec_Çme
è
	`av_log
(
NULL
, 
AV_LOG_WARNING
,

2321 "NØcodeøcould bfound w™h‚am'%s'\n", 
fÜûd_codec_Çme
);

2322 
	`av_log
(
NULL
, 
AV_LOG_WARNING
,

2323 "NØcodeøcould bfound w™h id %d\n", 
avùx
->
codec_id
);

2324 
»t
 = 
	`AVERROR
(
EINVAL
);

2325 
ç
;

2328 
avùx
->
codec_id
 = 
codec
->
id
;

2329 if(
¡»am_low»s
 > 
	`av_codec_g‘_max_low»s
(
codec
)){

2330 
	`av_log
(
avùx
, 
AV_LOG_WARNING
, "The maximum value for†owres supported byhe decoder is %d\n",

2331 
	`av_codec_g‘_max_low»s
(
codec
));

2332 
¡»am_low»s
 = 
	`av_codec_g‘_max_low»s
(
codec
);

2334 
	`av_codec_£t_low»s
(
avùx
, 
¡»am_low»s
);

2336 #ià
FF_API_EMU_EDGE


2337 if(
¡»am_low»s
è
avùx
->
æags
 |ğ
CODEC_FLAG_EMU_EDGE
;

2339 ià(
få
->
ç¡
)

2340 
avùx
->
æags2
 |ğ
AV_CODEC_FLAG2_FAST
;

2341 #ià
FF_API_EMU_EDGE


2342 if(
codec
->
ÿ·b™›s
 & 
AV_CODEC_CAP_DR1
)

2343 
avùx
->
æags
 |ğ
CODEC_FLAG_EMU_EDGE
;

2346 
İts
 = 
	`f‹r_codec_İts
(
få
->
codec_İts
, 
avùx
->
codec_id
, 
ic
, ic->
¡»ams
[
¡»am_šdex
], 
codec
);

2347 ià(!
	`av_diù_g‘
(
İts
, "th»ads", 
NULL
, 0))

2348 
	`av_diù_£t
(&
İts
, "threads", "auto", 0);

2349 ià(
¡»am_low»s
)

2350 
	`av_diù_£t_št
(&
İts
, "low»s", 
¡»am_low»s
, 0);

2351 ià(
avùx
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
 ||‡vùx->codec_ty³ =ğ
AVMEDIA_TYPE_AUDIO
)

2352 
	`av_diù_£t
(&
İts
, "refcounted_frames", "1", 0);

2353 ià((
»t
 = 
	`avcodec_İ’2
(
avùx
, 
codec
, &
İts
)) < 0) {

2354 
ç
;

2356 ià((
t
 = 
	`av_diù_g‘
(
İts
, "", 
NULL
, 
AV_DICT_IGNORE_SUFFIX
))) {

2357 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "O±iÚ % nÙ found.\n", 
t
->
key
);

2358 #ifdeà
FFP_MERGE


2359 
»t
 = 
AVERROR_OPTION_NOT_FOUND
;

2360 
ç
;

2364 
is
->
eof
 = 0;

2365 
ic
->
¡»ams
[
¡»am_šdex
]->
disÿrd
 = 
AVDISCARD_DEFAULT
;

2366 
avùx
->
codec_ty³
) {

2367 
AVMEDIA_TYPE_AUDIO
:

2368 #ià
CONFIG_AVFILTER


2370 
AVF‹rLšk
 *
lšk
;

2372 
is
->
audio_f‹r_¤c
.
äeq
 = 
avùx
->
§m¶e_¿‹
;

2373 
is
->
audio_f‹r_¤c
.
chªÃls
 = 
avùx
->channels;

2374 
is
->
audio_f‹r_¤c
.
chªÃl_Ïyout
 = 
	`g‘_v®id_chªÃl_Ïyout
(
avùx
->chªÃl_Ïyout,‡vùx->
chªÃls
);

2375 
is
->
audio_f‹r_¤c
.
fmt
 = 
avùx
->
§m¶e_fmt
;

2376 
	`SDL_LockMu‹x
(
få
->
af_mu‹x
);

2377 ià((
»t
 = 
	`cÚfigu»_audio_f‹rs
(
få
, få->
af‹rs
, 0)) < 0) {

2378 
	`SDL_UÆockMu‹x
(
få
->
af_mu‹x
);

2379 
ç
;

2381 
få
->
af_chªged
 = 0;

2382 
	`SDL_UÆockMu‹x
(
få
->
af_mu‹x
);

2383 
lšk
 = 
is
->
out_audio_f‹r
->
šputs
[0];

2384 
§m¶e_¿‹
 = 
lšk
->sample_rate;

2385 
nb_chªÃls
 = 
	`avf‹r_lšk_g‘_chªÃls
(
lšk
);

2386 
chªÃl_Ïyout
 = 
lšk
->channel_layout;

2389 
§m¶e_¿‹
 = 
avùx
->sample_rate;

2390 
nb_chªÃls
 = 
avùx
->
chªÃls
;

2391 
chªÃl_Ïyout
 = 
avùx
->channel_layout;

2395 ià((
»t
 = 
	`audio_İ’
(
få
, 
chªÃl_Ïyout
, 
nb_chªÃls
, 
§m¶e_¿‹
, &
is
->
audio_tgt
)) < 0)

2396 
ç
;

2397 
	`få_£t_audio_codec_šfo
(
få
, 
AVCODEC_MODULE_NAME
, 
	`avcodec_g‘_Çme
(
avùx
->
codec_id
));

2398 
is
->
audio_hw_buf_size
 = 
»t
;

2399 
is
->
audio_¤c
 = is->
audio_tgt
;

2400 
is
->
audio_buf_size
 = 0;

2401 
is
->
audio_buf_šdex
 = 0;

2404 
is
->
audio_diff_avg_cÛf
 = 
	`exp
(
	`log
(0.01è/ 
AUDIO_DIFF_AVG_NB
);

2405 
is
->
audio_diff_avg_couÁ
 = 0;

2408 
is
->
audio_diff_th»shŞd
 = 2.0 * is->
audio_hw_buf_size
 / is->
audio_tgt
.
by‹s_³r_£c
;

2410 
is
->
audio_¡»am
 = 
¡»am_šdex
;

2411 
is
->
audio_¡
 = 
ic
->
¡»ams
[
¡»am_šdex
];

2413 
	`decod”_š™
(&
is
->
auddec
, 
avùx
, &is->
audioq
, is->
cÚtšue_»ad_th»ad
);

2414 ià((
is
->
ic
->
ifÜm©
->
æags
 & (
AVFMT_NOBINSEARCH
 | 
AVFMT_NOGENSEARCH
 | 
AVFMT_NO_BYTE_SEEK
)è&& !is->ic->ifÜm©->
»ad_£ek
) {

2415 
is
->
auddec
.
¡¬t_±s
 = is->
audio_¡
->
¡¬t_time
;

2416 
is
->
auddec
.
¡¬t_±s_tb
 = is->
audio_¡
->
time_ba£
;

2418 ià((
»t
 = 
	`decod”_¡¬t
(&
is
->
auddec
, 
audio_th»ad
, 
få
, "ff_audio_dec")) < 0)

2419 
out
;

2420 
	`SDL_AoutPau£Audio
(
få
->
aout
, 0);

2422 
AVMEDIA_TYPE_VIDEO
:

2423 
is
->
video_¡»am
 = 
¡»am_šdex
;

2424 
is
->
video_¡
 = 
ic
->
¡»ams
[
¡»am_šdex
];

2426 
	`decod”_š™
(&
is
->
viddec
, 
avùx
, &is->
videoq
, is->
cÚtšue_»ad_th»ad
);

2427 
få
->
node_vdec
 = 
	`få–še_İ’_video_decod”
(få->
p–še
, ffp);

2428 ià(!
få
->
node_vdec
)

2429 
ç
;

2430 ià((
»t
 = 
	`decod”_¡¬t
(&
is
->
viddec
, 
video_th»ad
, 
få
, "ff_video_dec")) < 0)

2431 
out
;

2432 
is
->
queue_©chm’ts_»q
 = 1;

2434 ià(
få
->
max_ås
 >= 0) {

2435 if(
is
->
video_¡
->
avg_äame_¿‹
.
d’
 && is->video_¡->avg_äame_¿‹.
num
) {

2436 
ås
 = 
	`av_q2d
(
is
->
video_¡
->
avg_äame_¿‹
);

2437 
	`SDL_Prof”Re£t
(&
is
->
viddec
.
decode_´of”
, 
ås
 + 0.5);

2438 ià(
ås
 > 
få
->
max_ås
 && fps < 130.0) {

2439 
is
->
is_video_high_ås
 = 1;

2440 
	`av_log
(
få
, 
AV_LOG_WARNING
, "ås: %làÑoØhigh)\n", 
ås
);

2442 
	`av_log
(
få
, 
AV_LOG_WARNING
, "ås: %làÒÜm®)\n", 
ås
);

2445 if(
is
->
video_¡
->
r_äame_¿‹
.
d’
 && is->video_¡->r_äame_¿‹.
num
) {

2446 
tbr
 = 
	`av_q2d
(
is
->
video_¡
->
r_äame_¿‹
);

2447 ià(
tbr
 > 
få
->
max_ås
 &&br < 130.0) {

2448 
is
->
is_video_high_ås
 = 1;

2449 
	`av_log
(
få
, 
AV_LOG_WARNING
, "ås: %làÑoØhigh)\n", 
tbr
);

2451 
	`av_log
(
få
, 
AV_LOG_WARNING
, "ås: %làÒÜm®)\n", 
tbr
);

2456 ià(
is
->
is_video_high_ås
) {

2457 
avùx
->
sk_äame
 = 
	`FFMAX
×vùx->sk_äame, 
AVDISCARD_NONREF
);

2458 
avùx
->
sk_loİ_f‹r
 = 
	`FFMAX
×vùx->sk_loİ_f‹r, 
AVDISCARD_NONREF
);

2459 
avùx
->
sk_idù
 = 
	`FFMAX
×vùx->
sk_loİ_f‹r
, 
AVDISCARD_NONREF
);

2463 
AVMEDIA_TYPE_SUBTITLE
:

2464 ià(!
få
->
subt™Ë
) ;

2466 
is
->
subt™Ë_¡»am
 = 
¡»am_šdex
;

2467 
is
->
subt™Ë_¡
 = 
ic
->
¡»ams
[
¡»am_šdex
];

2469 
	`få_£t_subt™Ë_codec_šfo
(
få
, 
AVCODEC_MODULE_NAME
, 
	`avcodec_g‘_Çme
(
avùx
->
codec_id
));

2471 
	`decod”_š™
(&
is
->
subdec
, 
avùx
, &is->
subt™Ëq
, is->
cÚtšue_»ad_th»ad
);

2472 ià((
»t
 = 
	`decod”_¡¬t
(&
is
->
subdec
, 
subt™Ë_th»ad
, 
få
, "ff_subtitle_dec")) < 0)

2473 
out
;

2478 
out
;

2480 
ç
:

2481 
	`avcodec_ä“_cÚ‹xt
(&
avùx
);

2482 
out
:

2483 
	`av_diù_ä“
(&
İts
);

2485  
»t
;

2486 
	}
}

2488 
	$decode_š‹¼u±_cb
(*
ùx
)

2490 
VideoS‹
 *
is
 = 
ùx
;

2492 #ifdeà
START_READ_FRAME_TIME


2493 if(
is
->
¡¬t_»ad_äame_time
 > 0){

2494 
»ad_time_du¿tiÚ
 = (
	`av_g‘time_»Ïtive
(è/ 1000.0è- 
is
->
¡¬t_»ad_äame_time
;

2495 if(
»ad_time_du¿tiÚ
 > 
MIN_CACHED_DURATION
 && 
is
->
¡¬t_»ad_äame_time
 !ğis->
Ï¡_¡¬t_»ad_äame_time
){

2497 
is
->
pkt_ÿched_du¿tiÚ
 = 
	`FFMIN
(is->pkt_ÿched_du¿tiÚ + 
MIN_CACHED_DURATION
,
MAX_CACHED_DURATION
);

2498 
is
->
cut_ÿched_du¿tiÚ_ba£
 +ğ2*
REDUCE_CACHED_DURATION_INTERVAL
;

2500 
	`av_log
(
NULL
,
AV_LOG_WARNING
,"decode_š‹¼u± s¹_»ad_äame_timğ%Îd„—d_time_du¿tiÚ = %àpkt_ÿched_du¿tiÚ = %d \n",
is
->
¡¬t_»ad_äame_time
,
»ad_time_du¿tiÚ
,is->
pkt_ÿched_du¿tiÚ
);

2501 
is
->
Ï¡_¡¬t_»ad_äame_time
 = is->
¡¬t_»ad_äame_time
;

2505  
is
->
abÜt_»que¡
;

2506 
	}
}

2508 
	$¡»am_has_’ough_·ck‘s
(
AVSŒ—m
 *
¡
, 
¡»am_id
, 
Pack‘Queue
 *
queue
, 
mš_äames
) {

2509  
¡»am_id
 < 0 ||

2510 
queue
->
abÜt_»que¡
 ||

2511 (
¡
->
di¥os™iÚ
 & 
AV_DISPOSITION_ATTACHED_PIC
) ||

2512 #ifdeà
FFP_MERGE


2513 
queue
->
nb_·ck‘s
 > 
MIN_FRAMES
 && (!queue->
du¿tiÚ
 || 
	`av_q2d
(
¡
->
time_ba£
) * queue->duration > 1.0);

2515 
queue
->
nb_·ck‘s
 > 
mš_äames
;

2516 
	}
}

2518 
	$is_»®time
(
AVFÜm©CÚ‹xt
 *
s
)

2520 ifĞ!
	`¡rcmp
(
s
->
ifÜm©
->
Çme
, "rtp")

2521 || !
	`¡rcmp
(
s
->
ifÜm©
->
Çme
, "rtsp")

2522 || !
	`¡rcmp
(
s
->
ifÜm©
->
Çme
, "sdp")

2526 if(
s
->
pb
 && ( !
	`¡ºcmp
(s->
f’ame
, "rtp:", 4)

2527 || !
	`¡ºcmp
(
s
->
f’ame
, "udp:", 4)

2532 
	}
}

2534 #ifdeà
PKT_CACHED_DURATION


2535 
	$drİ_queue_uÁ_±s
(
Pack‘Queue
 *
q
, 
št64_t
 
drİ_to_±s
) {

2536 
MyAVPack‘Li¡
 *
pkt1
 = 
NULL
;

2537 
d–_nb_·ck‘s
 = 0;

2539 
pkt1
 = 
q
->
fœ¡_pkt
;

2540 ià(!
pkt1
) {

2546 ià((
pkt1
->
pkt
.
æags
 & 
AV_PKT_FLAG_KEY
è&&…kt1->pkt.
±s
 >ğ
drİ_to_±s
) {

2550 
q
->
fœ¡_pkt
 = 
pkt1
->
Ãxt
;

2551 ià(!
q
->
fœ¡_pkt
)

2552 
q
->
Ï¡_pkt
 = 
NULL
;

2553 
q
->
nb_·ck‘s
--;

2554 ++
d–_nb_·ck‘s
;

2555 
q
->
size
 -ğ
pkt1
->
pkt
.size + (*pkt1);

2556 ià(
pkt1
->
pkt
.
du¿tiÚ
 > 0)

2557 
q
->
du¿tiÚ
 -ğ
pkt1
->
pkt
.duration;

2558 
	`av_ä“_·ck‘
(&
pkt1
->
pkt
);

2559 #ifdeà
FFP_MERGE


2560 
	`av_ä“
(
pkt1
);

2562 
pkt1
->
Ãxt
 = 
q
->
»cyşe_pkt
;

2563 
q
->
»cyşe_pkt
 = 
pkt1
;

2566 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "233 d–_nb_·ck‘ ğ%d.\n", 
d–_nb_·ck‘s
);

2567 
	}
}

2568 
	$cÚŒŞ_video_queue_du¿tiÚ
(
FFPÏy”
 *
få
, 
VideoS‹
 *
is
) {

2569 
time_ba£_v®id
 = 0;

2570 
št64_t
 
ÿched_du¿tiÚ
 = -1;

2571 
nb_·ck‘s
 = 0;

2572 
št64_t
 
du¿tiÚ
 = 0;

2573 
št64_t
 
drİ_to_±s
 = 0;

2576 
	`SDL_LockMu‹x
(
is
->
videoq
.
mu‹x
);

2578 
time_ba£_v®id
 = 
is
->
video_¡
->
time_ba£
.
d’
 > 0 && is->video_¡->time_ba£.
num
 > 0;

2579 
nb_·ck‘s
 = 
is
->
videoq
.nb_packets;

2583 ià(
time_ba£_v®id
) {

2584 ià(
is
->
videoq
.
fœ¡_pkt
 && is->videoq.
Ï¡_pkt
) {

2585 
du¿tiÚ
 = 
is
->
videoq
.
Ï¡_pkt
->
pkt
.
±s
 - is->videoq.
fœ¡_pkt
->pkt.pts;

2586 
ÿched_du¿tiÚ
 = 
du¿tiÚ
 * 
	`av_q2d
(
is
->
video_¡
->
time_ba£
) * 1000;

2590 ià(
ÿched_du¿tiÚ
 > 
is
->
pkt_ÿched_du¿tiÚ
) {

2592 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "233 videØÿched_du¿tiÚ = %Îd,‚b_·ck‘ ğ%d.\n", 
ÿched_du¿tiÚ
, 
nb_·ck‘s
);

2593 
drİ_to_±s
 = 
is
->
videoq
.
Ï¡_pkt
->
pkt
.
±s
 - (
du¿tiÚ
 / 2);

2594 
	`drİ_queue_uÁ_±s
(&
is
->
videoq
, 
drİ_to_±s
);

2598 
	`SDL_UÆockMu‹x
(
is
->
videoq
.
mu‹x
);

2599 
	}
}

2600 
	$cÚŒŞ_audio_queue_du¿tiÚ
(
FFPÏy”
 *
få
, 
VideoS‹
 *
is
) {

2601 
time_ba£_v®id
 = 0;

2602 
št64_t
 
ÿched_du¿tiÚ
 = -1;

2603 
nb_·ck‘s
 = 0;

2604 
št64_t
 
du¿tiÚ
 = 0;

2605 
št64_t
 
drİ_to_±s
 = 0;

2608 
	`SDL_LockMu‹x
(
is
->
audioq
.
mu‹x
);

2610 
time_ba£_v®id
 = 
is
->
audio_¡
->
time_ba£
.
d’
 > 0 && is->audio_¡->time_ba£.
num
 > 0;

2611 
nb_·ck‘s
 = 
is
->
audioq
.nb_packets;

2614 ià(
time_ba£_v®id
) {

2615 ià(
is
->
audioq
.
fœ¡_pkt
 && is->audioq.
Ï¡_pkt
) {

2616 
du¿tiÚ
 = 
is
->
audioq
.
Ï¡_pkt
->
pkt
.
±s
 - is->audioq.
fœ¡_pkt
->pkt.pts;

2617 
ÿched_du¿tiÚ
 = 
du¿tiÚ
 * 
	`av_q2d
(
is
->
audio_¡
->
time_ba£
) * 1000;

2621 ià(
ÿched_du¿tiÚ
 > 
is
->
pkt_ÿched_du¿tiÚ
) {

2623 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "233‡udiØÿched_du¿tiÚ = %Îd,‚b_·ck‘ ğ%d.\n", 
ÿched_du¿tiÚ
, 
nb_·ck‘s
);

2624 
drİ_to_±s
 = 
is
->
audioq
.
Ï¡_pkt
->
pkt
.
±s
 - (
du¿tiÚ
 * 9.0 / 10.0);

2625 
	`drİ_queue_uÁ_±s
(&
is
->
audioq
, 
drİ_to_±s
);

2627 if(
is
->
cut_ÿched_du¿tiÚ_ba£
 =ğ2 * 
REDUCE_CACHED_DURATION_INTERVAL
 &&

2628 
is
->
pkt_ÿched_du¿tiÚ
 > 
MIN_CACHED_DURATION
 && 
ÿched_du¿tiÚ
 < MIN_CACHED_DURATION){

2629 
is
->
pkt_ÿched_du¿tiÚ
 = 
MIN_CACHED_DURATION
;

2630 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "best‚etwork status„educe cached durationo 1.5s\n");

2634 
	`SDL_UÆockMu‹x
(
is
->
audioq
.
mu‹x
);

2635 
	}
}

2636 
	$cÚŒŞ_queue_du¿tiÚ
(
FFPÏy”
 *
få
, 
VideoS‹
 *
is
) {

2637 ià(
is
->
pkt_ÿched_du¿tiÚ
 <= 0) {

2641 ià(
is
->
audio_¡
) {

2642  
	`cÚŒŞ_audio_queue_du¿tiÚ
(
få
, 
is
);

2644 ià(
is
->
video_¡
) {

2645  
	`cÚŒŞ_video_queue_du¿tiÚ
(
få
, 
is
);

2647 
	}
}

2651 
	$»ad_th»ad
(*
¬g
)

2653 
FFPÏy”
 *
få
 = 
¬g
;

2654 
VideoS‹
 *
is
 = 
få
->is;

2655 
AVFÜm©CÚ‹xt
 *
ic
 = 
NULL
;

2656 
”r
, 
i
, 
»t
 
__unu£d
;

2657 
¡_šdex
[
AVMEDIA_TYPE_NB
];

2658 
AVPack‘
 
pkt1
, *
pkt
 = &pkt1;

2659 
št64_t
 
¡»am_¡¬t_time
;

2660 
com¶‘ed
 = 0;

2661 
pkt_š_¶ay_¿nge
 = 0;

2662 
AVDiùiÚ¬yEÁry
 *
t
;

2663 
AVDiùiÚ¬y
 **
İts
;

2664 
Üig_nb_¡»ams
;

2665 
SDL_mu‹x
 *
wa™_mu‹x
 = 
	`SDL_C»©eMu‹x
();

2666 
sÿn_®l_pmts_£t
 = 0;

2667 
št64_t
 
pkt_ts
;

2668 
Ï¡_”rÜ
 = 0;

2669 
št64_t
 
´ev_io_tick_couÁ”
 = 0;

2670 
št64_t
 
io_tick_couÁ”
 = 0;

2672 ià(!
wa™_mu‹x
) {

2673 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "SDL_C»©eMu‹x(): %s\n", 
	`SDL_G‘E¼Ü
());

2674 
»t
 = 
	`AVERROR
(
ENOMEM
);

2675 
ç
;

2678 
	`mem£t
(
¡_šdex
, -1, (st_index));

2679 
is
->
Ï¡_video_¡»am
 = is->
video_¡»am
 = -1;

2680 
is
->
Ï¡_audio_¡»am
 = is->
audio_¡»am
 = -1;

2681 
is
->
Ï¡_subt™Ë_¡»am
 = is->
subt™Ë_¡»am
 = -1;

2682 
is
->
eof
 = 0;

2684 
ic
 = 
	`avfÜm©_®loc_cÚ‹xt
();

2685 ià(!
ic
) {

2686 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Could‚ot‡llocate context.\n");

2687 
»t
 = 
	`AVERROR
(
ENOMEM
);

2688 
ç
;

2690 
ic
->
š‹¼u±_ÿÎback
.
ÿÎback
 = 
decode_š‹¼u±_cb
;

2691 
ic
->
š‹¼u±_ÿÎback
.
İaque
 = 
is
;

2692 ià(!
	`av_diù_g‘
(
få
->
fÜm©_İts
, "sÿn_®l_pmts", 
NULL
, 
AV_DICT_MATCH_CASE
)) {

2693 
	`av_diù_£t
(&
få
->
fÜm©_İts
, "sÿn_®l_pmts", "1", 
AV_DICT_DONT_OVERWRITE
);

2694 
sÿn_®l_pmts_£t
 = 1;

2696 ià(
	`av_¡ri¡¬t
(
is
->
f’ame
, "¹mp", 
NULL
) ||

2697 
	`av_¡ri¡¬t
(
is
->
f’ame
, "¹¥", 
NULL
)) {

2699 
	`av_log
(
få
, 
AV_LOG_WARNING
, "remove 'timeout' option for„tmp.\n");

2700 
	`av_diù_£t
(&
få
->
fÜm©_İts
, "timeout", 
NULL
, 0);

2702 ià(
få
->
ifÜm©_Çme
)

2703 
is
->
ifÜm©
 = 
	`av_fšd_šput_fÜm©
(
få
->
ifÜm©_Çme
);

2704 
”r
 = 
	`avfÜm©_İ’_šput
(&
ic
, 
is
->
f’ame
, is->
ifÜm©
, &
få
->
fÜm©_İts
);

2705 ià(
”r
 < 0) {

2706 
	`´št_”rÜ
(
is
->
f’ame
, 
”r
);

2707 
»t
 = -1;

2708 
ç
;

2710 ià(
sÿn_®l_pmts_£t
)

2711 
	`av_diù_£t
(&
få
->
fÜm©_İts
, "sÿn_®l_pmts", 
NULL
, 
AV_DICT_MATCH_CASE
);

2713 ià((
t
 = 
	`av_diù_g‘
(
få
->
fÜm©_İts
, "", 
NULL
, 
AV_DICT_IGNORE_SUFFIX
))) {

2714 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "O±iÚ % nÙ found.\n", 
t
->
key
);

2715 #ifdeà
FFP_MERGE


2716 
»t
 = 
AVERROR_OPTION_NOT_FOUND
;

2717 
ç
;

2720 
is
->
ic
 = ic;

2722 ià(
få
->
g’±s
)

2723 
ic
->
æags
 |ğ
AVFMT_FLAG_GENPTS
;

2725 
	`av_fÜm©_šjeù_glob®_side_d©a
(
ic
);

2727 
İts
 = 
	`£tup_fšd_¡»am_šfo_İts
(
ic
, 
få
->
codec_İts
);

2728 
Üig_nb_¡»ams
 = 
ic
->
nb_¡»ams
;

2730 
”r
 = 
	`avfÜm©_fšd_¡»am_šfo
(
ic
, 
İts
);

2733 
i
 = 0; i < 
Üig_nb_¡»ams
; i++)

2734 
	`av_diù_ä“
(&
İts
[
i
]);

2735 
	`av_ä“p
(&
İts
);

2737 ià(
”r
 < 0) {

2738 
	`av_log
(
NULL
, 
AV_LOG_WARNING
,

2739 "%s: could‚Ù fšd codeø·¿m‘”s\n", 
is
->
f’ame
);

2740 
»t
 = -1;

2741 
ç
;

2744 ià(
ic
->
pb
)

2745 
ic
->
pb
->
eof_»ached
 = 0;

2747 ià(
få
->
£ek_by_by‹s
 < 0)

2748 
få
->
£ek_by_by‹s
 = !!(
ic
->
ifÜm©
->
æags
 & 
AVFMT_TS_DISCONT
è&& 
	`¡rcmp
("ogg", ic->ifÜm©->
Çme
);

2750 
is
->
max_äame_du¿tiÚ
 = (
ic
->
ifÜm©
->
æags
 & 
AVFMT_TS_DISCONT
) ? 10.0 : 3600.0;

2751 
is
->
max_äame_du¿tiÚ
 = 10.0;

2752 
	`av_log
(
få
, 
AV_LOG_INFO
, "max_äame_du¿tiÚ: %.3f\n", 
is
->
max_äame_du¿tiÚ
);

2754 #ifdeà
FFP_MERGE


2755 ià(!
wšdow_t™Ë
 && (
t
 = 
	`av_diù_g‘
(
ic
->
m‘ad©a
, "t™Ë", 
NULL
, 0)))

2756 
wšdow_t™Ë
 = 
	`av_a¥rštf
("% - %s", 
t
->
v®ue
, 
šput_f’ame
);

2760 ià(
få
->
¡¬t_time
 !ğ
AV_NOPTS_VALUE
) {

2761 
št64_t
 
time¡amp
;

2763 
time¡amp
 = 
få
->
¡¬t_time
;

2765 ià(
ic
->
¡¬t_time
 !ğ
AV_NOPTS_VALUE
)

2766 
time¡amp
 +ğ
ic
->
¡¬t_time
;

2767 
»t
 = 
	`avfÜm©_£ek_fe
(
ic
, -1, 
INT64_MIN
, 
time¡amp
, 
INT64_MAX
, 0);

2768 ià(
»t
 < 0) {

2769 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "%s: could‚ot seeko…osition %0.3f\n",

2770 
is
->
f’ame
, ()
time¡amp
 / 
AV_TIME_BASE
);

2776 
is
->
»®time
 = 0;

2777 #ifdeà
PKT_CACHED_DURATION


2778 
AVDiùiÚ¬yEÁry
 *
e
 = 
	`av_diù_g‘
(
få
->
¶ay”_İts
, "pkt_ÿched_du¿tiÚ", 
NULL
, 0);

2779 ià(
e
) {

2780 
max_ÿched_du¿tiÚ
 = 
	`©oi
(
e
->
v®ue
);

2781 ià(
max_ÿched_du¿tiÚ
) {

2782 
is
->
pkt_ÿched_du¿tiÚ
 = 
DEFAULT_CACHED_DURATION
;

2783 
is
->
cut_ÿched_du¿tiÚ_ba£
 = 
REDUCE_CACHED_DURATION_INTERVAL
;

2786 
is
->
pkt_ÿched_du¿tiÚ
 = 0;

2791 ià(
Œue
 || 
få
->
show_¡©us
)

2792 
	`av_dump_fÜm©
(
ic
, 0, 
is
->
f’ame
, 0);

2794 
video_¡»am_couÁ
 = 0;

2795 
h264_¡»am_couÁ
 = 0;

2796 
fœ¡_h264_¡»am
 = -1;

2797 
i
 = 0; i < 
ic
->
nb_¡»ams
; i++) {

2798 
AVSŒ—m
 *
¡
 = 
ic
->
¡»ams
[
i
];

2799 
AVMedŸTy³
 
ty³
 = 
¡
->
codeı¬
->
codec_ty³
;

2800 
¡
->
disÿrd
 = 
AVDISCARD_ALL
;

2801 ià(
ty³
 >ğ0 && 
få
->
wª‹d_¡»am_¥ec
[ty³] && 
¡_šdex
[type] == -1)

2802 ià(
	`avfÜm©_m©ch_¡»am_¥ecif›r
(
ic
, 
¡
, 
få
->
wª‹d_¡»am_¥ec
[
ty³
]) > 0)

2803 
¡_šdex
[
ty³
] = 
i
;

2807 ià(
ty³
 =ğ
AVMEDIA_TYPE_VIDEO
) {

2808 
AVCodecID
 
codec_id
 = 
¡
->
codeı¬
->codec_id;

2809 
video_¡»am_couÁ
++;

2810 ià(
codec_id
 =ğ
AV_CODEC_ID_H264
) {

2811 
h264_¡»am_couÁ
++;

2812 ià(
fœ¡_h264_¡»am
 < 0)

2813 
fœ¡_h264_¡»am
 = 
i
;

2817 ià(
video_¡»am_couÁ
 > 1 && 
¡_šdex
[
AVMEDIA_TYPE_VIDEO
] < 0) {

2818 
¡_šdex
[
AVMEDIA_TYPE_VIDEO
] = 
fœ¡_h264_¡»am
;

2819 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "muÉË videØ¡»am found,…»ã¸fœ¡ h264 sŒ—m: %d\n", 
fœ¡_h264_¡»am
);

2821 ià(!
få
->
video_di§bË
)

2822 
¡_šdex
[
AVMEDIA_TYPE_VIDEO
] =

2823 
	`av_fšd_be¡_¡»am
(
ic
, 
AVMEDIA_TYPE_VIDEO
,

2824 
¡_šdex
[
AVMEDIA_TYPE_VIDEO
], -1, 
NULL
, 0);

2825 ià(!
få
->
audio_di§bË
)

2826 
¡_šdex
[
AVMEDIA_TYPE_AUDIO
] =

2827 
	`av_fšd_be¡_¡»am
(
ic
, 
AVMEDIA_TYPE_AUDIO
,

2828 
¡_šdex
[
AVMEDIA_TYPE_AUDIO
],

2829 
¡_šdex
[
AVMEDIA_TYPE_VIDEO
],

2830 
NULL
, 0);

2831 ià(!
få
->
video_di§bË
 && !få->
subt™Ë_di§bË
)

2832 
¡_šdex
[
AVMEDIA_TYPE_SUBTITLE
] =

2833 
	`av_fšd_be¡_¡»am
(
ic
, 
AVMEDIA_TYPE_SUBTITLE
,

2834 
¡_šdex
[
AVMEDIA_TYPE_SUBTITLE
],

2835 (
¡_šdex
[
AVMEDIA_TYPE_AUDIO
] >= 0 ?

2836 
¡_šdex
[
AVMEDIA_TYPE_AUDIO
] :

2837 
¡_šdex
[
AVMEDIA_TYPE_VIDEO
]),

2838 
NULL
, 0);

2840 
is
->
show_mode
 = 
få
->show_mode;

2841 #ifdeà
FFP_MERGE


2842 ià(
¡_šdex
[
AVMEDIA_TYPE_VIDEO
] >= 0) {

2843 
AVSŒ—m
 *
¡
 = 
ic
->
¡»ams
[
¡_šdex
[
AVMEDIA_TYPE_VIDEO
]];

2844 
AVCodecP¬am‘”s
 *
codeı¬
 = 
¡
->codecpar;

2845 
AVR©iÚ®
 
§r
 = 
	`av_guess_§m¶e_a¥eù_¿tio
(
ic
, 
¡
, 
NULL
);

2846 ià(
codeı¬
->
width
)

2847 
	`£t_deçuÉ_wšdow_size
(
codeı¬
->
width
, codeı¬->
height
, 
§r
);

2852 ià(
¡_šdex
[
AVMEDIA_TYPE_AUDIO
] >= 0) {

2853 
	`¡»am_compÚ’t_İ’
(
få
, 
¡_šdex
[
AVMEDIA_TYPE_AUDIO
]);

2856 
»t
 = -1;

2857 ià(
¡_šdex
[
AVMEDIA_TYPE_VIDEO
] >= 0) {

2858 
»t
 = 
	`¡»am_compÚ’t_İ’
(
få
, 
¡_šdex
[
AVMEDIA_TYPE_VIDEO
]);

2860 ià(
is
->
show_mode
 =ğ
SHOW_MODE_NONE
)

2861 
is
->
show_mode
 = 
»t
 >ğ0 ? 
SHOW_MODE_VIDEO
 : 
SHOW_MODE_RDFT
;

2863 ià(
¡_šdex
[
AVMEDIA_TYPE_SUBTITLE
] >= 0) {

2864 
	`¡»am_compÚ’t_İ’
(
få
, 
¡_šdex
[
AVMEDIA_TYPE_SUBTITLE
]);

2867 
	`ijkm‘a_£t_avfÜm©_cÚ‹xt_l
(
få
->
m‘a
, 
ic
);

2868 
få
->
¡©
.
b™_¿‹
 = 
ic
->bit_rate;

2869 ià(
¡_šdex
[
AVMEDIA_TYPE_VIDEO
] >= 0)

2870 
	`ijkm‘a_£t_št64_l
(
få
->
m‘a
, 
IJKM_KEY_VIDEO_STREAM
, 
¡_šdex
[
AVMEDIA_TYPE_VIDEO
]);

2871 ià(
¡_šdex
[
AVMEDIA_TYPE_AUDIO
] >= 0)

2872 
	`ijkm‘a_£t_št64_l
(
få
->
m‘a
, 
IJKM_KEY_AUDIO_STREAM
, 
¡_šdex
[
AVMEDIA_TYPE_AUDIO
]);

2873 ià(
¡_šdex
[
AVMEDIA_TYPE_SUBTITLE
] >= 0)

2874 
	`ijkm‘a_£t_št64_l
(
få
->
m‘a
, 
IJKM_KEY_TIMEDTEXT_STREAM
, 
¡_šdex
[
AVMEDIA_TYPE_SUBTITLE
]);

2876 ià(
is
->
video_¡»am
 < 0 && is->
audio_¡»am
 < 0) {

2877 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Failedo open file '%s' or configure filtergraph\n",

2878 
is
->
f’ame
);

2879 
»t
 = -1;

2880 
ç
;

2882 ià(
is
->
audio_¡»am
 >= 0) {

2883 
is
->
audioq
.
is_bufãr_šdiÿtÜ
 = 1;

2884 
is
->
bufãr_šdiÿtÜ_queue
 = &is->
audioq
;

2885 } ià(
is
->
video_¡»am
 >= 0) {

2886 
is
->
videoq
.
is_bufãr_šdiÿtÜ
 = 1;

2887 
is
->
bufãr_šdiÿtÜ_queue
 = &is->
videoq
;

2889 
	`as£¹
("invalid streams");

2892 ià(
få
->
šfš™e_bufãr
 < 0 && 
is
->
»®time
)

2893 
få
->
šfš™e_bufãr
 = 1;

2895 ià(!
få
->
¡¬t_Ú_´•¬ed
)

2896 
	`toggË_·u£
(
få
, 1);

2897 ià(
is
->
video_¡
 && is->video_¡->
codeı¬
) {

2898 
AVCodecP¬am‘”s
 *
codeı¬
 = 
is
->
video_¡
->codecpar;

2899 
	`få_nÙify_msg3
(
få
, 
FFP_MSG_VIDEO_SIZE_CHANGED
, 
codeı¬
->
width
, codeı¬->
height
);

2900 
	`få_nÙify_msg3
(
få
, 
FFP_MSG_SAR_CHANGED
, 
codeı¬
->
§m¶e_a¥eù_¿tio
.
num
, codeı¬->§m¶e_a¥eù_¿tio.
d’
);

2902 
få
->
´•¬ed
 = 
Œue
;

2903 
	`få_nÙify_msg1
(
få
, 
FFP_MSG_PREPARED
);

2904 ià(!
få
->
¡¬t_Ú_´•¬ed
) {

2905 
is
->
·u£_»q
 && !is->
abÜt_»que¡
) {

2906 
	`SDL_D–ay
(100);

2909 ià(
få
->
auto_»sume
) {

2910 
	`få_nÙify_msg1
(
få
, 
FFP_REQ_START
);

2911 
få
->
auto_»sume
 = 0;

2914 ià(
få
->
£ek_©_¡¬t
 > 0) {

2915 
	`få_£ek_to_l
(
få
, ()(få->
£ek_©_¡¬t
));

2919 ià(
is
->
abÜt_»que¡
)

2921 #ifdeà
FFP_MERGE


2922 ià(
is
->
·u£d
 !ğis->
Ï¡_·u£d
) {

2923 
is
->
Ï¡_·u£d
 = is->
·u£d
;

2924 ià(
is
->
·u£d
)

2925 
is
->
»ad_·u£_»tuº
 = 
	`av_»ad_·u£
(
ic
);

2927 
	`av_»ad_¶ay
(
ic
);

2930 #ià
CONFIG_RTSP_DEMUXER
 || 
CONFIG_MMSH_PROTOCOL


2931 ià(
is
->
·u£d
 &&

2932 (!
	`¡rcmp
(
ic
->
ifÜm©
->
Çme
, "rtsp") ||

2933 (
ic
->
pb
 && !
	`¡ºcmp
(
få
->
šput_f’ame
, "mmsh:", 5)))) {

2936 
	`SDL_D–ay
(10);

2940 ià(
is
->
£ek_»q
) {

2941 
št64_t
 
£ek_rg‘
 = 
is
->
£ek_pos
;

2942 
št64_t
 
£ek_mš
 = 
is
->
£ek_»l
 > 0 ? 
£ek_rg‘
 - is->£ek_»È+ 2: 
INT64_MIN
;

2943 
št64_t
 
£ek_max
 = 
is
->
£ek_»l
 < 0 ? 
£ek_rg‘
 - is->£ek_»È- 2: 
INT64_MAX
;

2947 
	`få_toggË_bufãršg
(
få
, 1);

2948 
	`få_nÙify_msg3
(
få
, 
FFP_MSG_BUFFERING_UPDATE
, 0, 0);

2949 
»t
 = 
	`avfÜm©_£ek_fe
(
is
->
ic
, -1, 
£ek_mš
, 
£ek_rg‘
, 
£ek_max
, is->
£ek_æags
);

2950 ià(
»t
 < 0) {

2951 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

2952 "%s:ƒ¼Ü wh£ekšg\n", 
is
->
ic
->
f’ame
);

2954 ià(
is
->
audio_¡»am
 >= 0) {

2955 
	`·ck‘_queue_æush
(&
is
->
audioq
);

2956 
	`·ck‘_queue_put
(&
is
->
audioq
, &
æush_pkt
);

2958 ià(
is
->
subt™Ë_¡»am
 >= 0) {

2959 
	`·ck‘_queue_æush
(&
is
->
subt™Ëq
);

2960 
	`·ck‘_queue_put
(&
is
->
subt™Ëq
, &
æush_pkt
);

2962 ià(
is
->
video_¡»am
 >= 0) {

2963 ià(
få
->
node_vdec
) {

2964 
	`få’ode_æush
(
få
->
node_vdec
);

2966 
	`·ck‘_queue_æush
(&
is
->
videoq
);

2967 
	`·ck‘_queue_put
(&
is
->
videoq
, &
æush_pkt
);

2969 ià(
is
->
£ek_æags
 & 
AVSEEK_FLAG_BYTE
) {

2970 
	`£t_şock
(&
is
->
extşk
, 
NAN
, 0);

2972 
	`£t_şock
(&
is
->
extşk
, 
£ek_rg‘
 / ()
AV_TIME_BASE
, 0);

2975 
is
->
Ï‹¡_£ek_lßd_£rŸl
 = is->
videoq
.
£rŸl
;

2976 
is
->
Ï‹¡_£ek_lßd_¡¬t_©
 = 
	`av_g‘time
();

2978 
få
->
dcc
.
cu¼’t_high_w©”_m¬k_š_ms
 = få->dcc.
fœ¡_high_w©”_m¬k_š_ms
;

2979 
is
->
£ek_»q
 = 0;

2980 
is
->
queue_©chm’ts_»q
 = 1;

2981 
is
->
eof
 = 0;

2982 #ifdeà
FFP_MERGE


2983 ià(
is
->
·u£d
)

2984 
	`¡•_to_Ãxt_äame
(
is
);

2986 
com¶‘ed
 = 0;

2987 
	`SDL_LockMu‹x
(
få
->
is
->
¶ay_mu‹x
);

2988 ià(
få
->
auto_»sume
) {

2989 
is
->
·u£_»q
 = 0;

2990 ià(
få
->
·ck‘_bufãršg
)

2991 
is
->
bufãršg_Ú
 = 1;

2992 
få
->
auto_»sume
 = 0;

2993 
	`¡»am_upd©e_·u£_l
(
få
);

2995 ià(
is
->
·u£_»q
)

2996 
	`¡•_to_Ãxt_äame_l
(
få
);

2997 
	`SDL_UÆockMu‹x
(
få
->
is
->
¶ay_mu‹x
);

2998 
	`få_nÙify_msg3
(
få
, 
FFP_MSG_SEEK_COMPLETE
, ()
	`fáime_to_mli£cÚds
(
£ek_rg‘
), 
»t
);

2999 
	`få_toggË_bufãršg
(
få
, 1);

3001 ià(
is
->
queue_©chm’ts_»q
) {

3002 ià(
is
->
video_¡
 && (is->video_¡->
di¥os™iÚ
 & 
AV_DISPOSITION_ATTACHED_PIC
)) {

3003 
AVPack‘
 
cİy
;

3004 ià((
»t
 = 
	`av_cİy_·ck‘
(&
cİy
, &
is
->
video_¡
->
©ched_pic
)) < 0)

3005 
ç
;

3006 
	`·ck‘_queue_put
(&
is
->
videoq
, &
cİy
);

3007 
	`·ck‘_queue_put_nuÎ·ck‘
(&
is
->
videoq
, is->
video_¡»am
);

3009 
is
->
queue_©chm’ts_»q
 = 0;

3013 ià(
få
->
šfš™e_bufãr
<1 && !
is
->
£ek_»q
 &&

3014 #ifdeà
FFP_MERGE


3015 (
is
->
audioq
.
size
 + is->
videoq
.siz+ is->
subt™Ëq
.siz> 
MAX_QUEUE_SIZE


3017 (
is
->
audioq
.
size
 + is->
videoq
.siz+ is->
subt™Ëq
.siz> 
få
->
dcc
.
max_bufãr_size


3019 || ( 
	`¡»am_has_’ough_·ck‘s
(
is
->
audio_¡
, is->
audio_¡»am
, &is->
audioq
, 
MIN_FRAMES
)

3020 && 
	`¡»am_has_’ough_·ck‘s
(
is
->
video_¡
, is->
video_¡»am
, &is->
videoq
, 
MIN_FRAMES
)

3021 && 
	`¡»am_has_’ough_·ck‘s
(
is
->
subt™Ë_¡
, is->
subt™Ë_¡»am
, &is->
subt™Ëq
, 
MIN_FRAMES
)))) {

3022 ià(!
is
->
eof
) {

3023 
	`få_toggË_bufãršg
(
få
, 0);

3026 
	`SDL_LockMu‹x
(
wa™_mu‹x
);

3027 
	`SDL_CÚdWa™Timeout
(
is
->
cÚtšue_»ad_th»ad
, 
wa™_mu‹x
, 10);

3028 
	`SDL_UÆockMu‹x
(
wa™_mu‹x
);

3031 ià((!
is
->
·u£d
 || 
com¶‘ed
) &&

3032 (!
is
->
audio_¡
 || (is->
auddec
.
fšished
 =ğis->
audioq
.
£rŸl
 && 
	`äame_queue_nb_»maššg
(&is->
§mpq
) == 0)) &&

3033 (!
is
->
video_¡
 || (is->
viddec
.
fšished
 =ğis->
videoq
.
£rŸl
 && 
	`äame_queue_nb_»maššg
(&is->
piùq
) == 0))) {

3034 ià(
få
->
loİ
 != 1 && (!ffp->loop || --ffp->loop)) {

3035 
	`¡»am_£ek
(
is
, 
få
->
¡¬t_time
 !ğ
AV_NOPTS_VALUE
 ? ffp->start_time : 0, 0, 0);

3036 } ià(
få
->
autÛx™
) {

3037 
»t
 = 
AVERROR_EOF
;

3038 
ç
;

3040 
	`få_¡©i¡ic_l
(
få
);

3041 ià(
com¶‘ed
) {

3042 
	`av_log
(
få
, 
AV_LOG_INFO
, "ffp_toggle_buffering:ƒof\n");

3043 
	`SDL_LockMu‹x
(
wa™_mu‹x
);

3045 !
is
->
abÜt_»que¡
 && !is->
£ek_»q
)

3046 
	`SDL_CÚdWa™Timeout
(
is
->
cÚtšue_»ad_th»ad
, 
wa™_mu‹x
, 100);

3047 
	`SDL_UÆockMu‹x
(
wa™_mu‹x
);

3048 ià(!
is
->
abÜt_»que¡
)

3051 
com¶‘ed
 = 1;

3052 
få
->
auto_»sume
 = 0;

3055 
	`få_toggË_bufãršg
(
få
, 0);

3056 
	`toggË_·u£
(
få
, 1);

3057 ià(
få
->
”rÜ
) {

3058 
	`av_log
(
få
, 
AV_LOG_INFO
, "få_toggË_bufãršg:ƒ¼Ü: %d\n", få->
”rÜ
);

3059 
	`få_nÙify_msg1
(
få
, 
FFP_MSG_ERROR
);

3061 
	`av_log
(
få
, 
AV_LOG_INFO
, "ffp_toggle_buffering: completed: OK\n");

3062 
	`få_nÙify_msg1
(
få
, 
FFP_MSG_COMPLETED
);

3067 
pkt
->
æags
 = 0;

3068 #ifdeà
START_READ_FRAME_TIME


3069 
is
->
¡¬t_»ad_äame_time
 = 
	`av_g‘time_»Ïtive
() / 1000;

3071 
»t
 = 
	`av_»ad_äame
(
ic
, 
pkt
);

3072 #ifdeà
START_READ_FRAME_TIME


3073 
is
->
¡¬t_»ad_äame_time
 = 0;

3075 ià(
»t
 < 0) {

3076 
pb_eof
 = 0;

3077 
pb_”rÜ
 = 0;

3078 ià((
»t
 =ğ
AVERROR_EOF
 || 
	`avio_ãof
(
ic
->
pb
)è&& !
is
->
eof
) {

3079 
pb_eof
 = 1;

3082 ià(
ic
->
pb
 && ic->pb->
”rÜ
) {

3083 
pb_eof
 = 1;

3084 
pb_”rÜ
 = 
ic
->
pb
->
”rÜ
;

3086 ià(
»t
 =ğ
AVERROR_EXIT
) {

3087 
pb_eof
 = 1;

3088 
pb_”rÜ
 = 
AVERROR_EXIT
;

3091 ià(
pb_eof
) {

3092 ià(
is
->
video_¡»am
 >= 0)

3093 
	`·ck‘_queue_put_nuÎ·ck‘
(&
is
->
videoq
, is->
video_¡»am
);

3094 ià(
is
->
audio_¡»am
 >= 0)

3095 
	`·ck‘_queue_put_nuÎ·ck‘
(&
is
->
audioq
, is->
audio_¡»am
);

3096 ià(
is
->
subt™Ë_¡»am
 >= 0)

3097 
	`·ck‘_queue_put_nuÎ·ck‘
(&
is
->
subt™Ëq
, is->
subt™Ë_¡»am
);

3098 
is
->
eof
 = 1;

3100 ià(
pb_”rÜ
) {

3101 ià(
is
->
video_¡»am
 >= 0)

3102 
	`·ck‘_queue_put_nuÎ·ck‘
(&
is
->
videoq
, is->
video_¡»am
);

3103 ià(
is
->
audio_¡»am
 >= 0)

3104 
	`·ck‘_queue_put_nuÎ·ck‘
(&
is
->
audioq
, is->
audio_¡»am
);

3105 ià(
is
->
subt™Ë_¡»am
 >= 0)

3106 
	`·ck‘_queue_put_nuÎ·ck‘
(&
is
->
subt™Ëq
, is->
subt™Ë_¡»am
);

3107 
is
->
eof
 = 1;

3108 
få
->
”rÜ
 = 
pb_”rÜ
;

3109 
	`av_log
(
få
, 
AV_LOG_ERROR
, "av_»ad_äam”rÜ: %x(%c,%c,%c,%c): %s\n", få->
”rÜ
,

3110 (è(0xfà& (
få
->
”rÜ
 >> 24)),

3111 (è(0xfà& (
få
->
”rÜ
 >> 16)),

3112 (è(0xfà& (
få
->
”rÜ
 >> 8)),

3113 (è(0xfà& (
få
->
”rÜ
)),

3114 
	`få_g‘_”rÜ_¡ršg
(
få
->
”rÜ
));

3117 
få
->
”rÜ
 = 0;

3119 ià(
is
->
eof
) {

3120 
	`få_toggË_bufãršg
(
få
, 0);

3121 
	`SDL_D–ay
(100);

3123 
	`SDL_LockMu‹x
(
wa™_mu‹x
);

3124 
	`SDL_CÚdWa™Timeout
(
is
->
cÚtšue_»ad_th»ad
, 
wa™_mu‹x
, 10);

3125 
	`SDL_UÆockMu‹x
(
wa™_mu‹x
);

3126 
	`få_¡©i¡ic_l
(
få
);

3129 
is
->
eof
 = 0;

3132 ià(
pkt
->
æags
 & 
AV_PKT_FLAG_DISCONTINUITY
) {

3133 ià(
is
->
audio_¡»am
 >= 0) {

3134 
	`·ck‘_queue_put
(&
is
->
audioq
, &
æush_pkt
);

3136 ià(
is
->
subt™Ë_¡»am
 >= 0) {

3137 
	`·ck‘_queue_put
(&
is
->
subt™Ëq
, &
æush_pkt
);

3139 ià(
is
->
video_¡»am
 >= 0) {

3140 
	`·ck‘_queue_put
(&
is
->
videoq
, &
æush_pkt
);

3145 
¡»am_¡¬t_time
 = 
ic
->
¡»ams
[
pkt
->
¡»am_šdex
]->
¡¬t_time
;

3146 
pkt_ts
 = 
pkt
->
±s
 =ğ
AV_NOPTS_VALUE
 ?…kt->
dts
 :…kt->pts;

3147 
pkt_š_¶ay_¿nge
 = 
få
->
du¿tiÚ
 =ğ
AV_NOPTS_VALUE
 ||

3148 (
pkt_ts
 - (
¡»am_¡¬t_time
 !ğ
AV_NOPTS_VALUE
 ? stream_start_time : 0)) *

3149 
	`av_q2d
(
ic
->
¡»ams
[
pkt
->
¡»am_šdex
]->
time_ba£
) -

3150 ()(
få
->
¡¬t_time
 !ğ
AV_NOPTS_VALUE
 ? ffp->start_time : 0) / 1000000

3151 <ğ(()
få
->
du¿tiÚ
 / 1000000);

3154 #ifdeà
PKT_CACHED_DURATION


3155 if((
pkt
->
æags
 & 
AV_PKT_FLAG_KEY
è&& !
is
->
·u£d
 && is->
pkt_ÿched_du¿tiÚ
 > 0 ) {

3156 
	`cÚŒŞ_queue_du¿tiÚ
(
få
, 
is
);

3159 ià(
pkt
->
¡»am_šdex
 =ğ
is
->
audio_¡»am
 && 
pkt_š_¶ay_¿nge
) {

3161 
	`·ck‘_queue_put
(&
is
->
audioq
, 
pkt
);

3162 } ià(
pkt
->
¡»am_šdex
 =ğ
is
->
video_¡»am
 && 
pkt_š_¶ay_¿nge


3163 && !(
is
->
video_¡
 && (is->video_¡->
di¥os™iÚ
 & 
AV_DISPOSITION_ATTACHED_PIC
))) {

3164 
	`·ck‘_queue_put
(&
is
->
videoq
, 
pkt
);

3165 } ià(
pkt
->
¡»am_šdex
 =ğ
is
->
subt™Ë_¡»am
 && 
pkt_š_¶ay_¿nge
) {

3166 
	`·ck‘_queue_put
(&
is
->
subt™Ëq
, 
pkt
);

3168 
	`av_·ck‘_uÄef
(
pkt
);

3171 
	`få_¡©i¡ic_l
(
få
);

3173 ià(
få
->
·ck‘_bufãršg
) {

3174 
io_tick_couÁ”
 = 
	`SDL_G‘TickHR
();

3175 ià(
	`abs
(()(
io_tick_couÁ”
 - 
´ev_io_tick_couÁ”
)è> 
BUFFERING_CHECK_PER_MILLISECONDS
) {

3176 
´ev_io_tick_couÁ”
 = 
io_tick_couÁ”
;

3177 
	`få_check_bufãršg_l
(
få
);

3182 
»t
 = 0;

3183 
ç
:

3184 ià(
ic
 && !
is
->ic)

3185 
	`avfÜm©_şo£_šput
(&
ic
);

3187 ià(!
få
->
´•¬ed
 || !
is
->
abÜt_»que¡
) {

3188 
få
->
Ï¡_”rÜ
 =†ast_error;

3189 
	`få_nÙify_msg2
(
få
, 
FFP_MSG_ERROR
, 
Ï¡_”rÜ
);

3191 
	`SDL_De¡royMu‹x
(
wa™_mu‹x
);

3193 
	}
}

3195 
video_»äesh_th»ad
(*
¬g
);

3196 
VideoS‹
 *
	$¡»am_İ’
(
FFPÏy”
 *
få
, cÚ¡ *
f’ame
, 
AVIÅutFÜm©
 *
ifÜm©
)

3198 
	`as£¹
(!
få
->
is
);

3199 
VideoS‹
 *
is
;

3201 
is
 = 
	`av_m®locz
((
VideoS‹
));

3202 ià(!
is
)

3203  
NULL
;

3204 
is
->
f’ame
 = 
	`av_¡rdup
(filename);

3205 ià(!
is
->
f’ame
)

3206 
ç
;

3207 
is
->
ifÜm©
 = iformat;

3208 
is
->
ytİ
 = 0;

3209 
is
->
xËá
 = 0;

3212 ià(
	`äame_queue_š™
(&
is
->
piùq
, &is->
videoq
, 
få
->
piùq_size
, 1) < 0)

3213 
ç
;

3214 ià(
	`äame_queue_š™
(&
is
->
subpq
, &is->
subt™Ëq
, 
SUBPICTURE_QUEUE_SIZE
, 0) < 0)

3215 
ç
;

3216 ià(
	`äame_queue_š™
(&
is
->
§mpq
, &is->
audioq
, 
SAMPLE_QUEUE_SIZE
, 1) < 0)

3217 
ç
;

3219 ià(
	`·ck‘_queue_š™
(&
is
->
videoq
) < 0 ||

3220 
	`·ck‘_queue_š™
(&
is
->
audioq
) < 0 ||

3221 
	`·ck‘_queue_š™
(&
is
->
subt™Ëq
) < 0)

3222 
ç
;

3224 ià(!(
is
->
cÚtšue_»ad_th»ad
 = 
	`SDL_C»©eCÚd
())) {

3225 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "SDL_C»©eCÚd(): %s\n", 
	`SDL_G‘E¼Ü
());

3226 
ç
;

3229 
	`š™_şock
(&
is
->
vidşk
, &is->
videoq
.
£rŸl
);

3230 
	`š™_şock
(&
is
->
audşk
, &is->
audioq
.
£rŸl
);

3231 
	`š™_şock
(&
is
->
extşk
, &is->extşk.
£rŸl
);

3232 
is
->
audio_şock_£rŸl
 = -1;

3233 
is
->
audio_vŞume
 = 
SDL_MIX_MAXVOLUME
;

3234 
is
->
mu‹d
 = 0;

3235 
is
->
av_sync_ty³
 = 
få
->av_sync_type;

3237 
is
->
¶ay_mu‹x
 = 
	`SDL_C»©eMu‹x
();

3238 
få
->
is
 = is;

3239 
is
->
·u£_»q
 = !
få
->
¡¬t_Ú_´•¬ed
;

3241 
is
->
video_»äesh_tid
 = 
	`SDL_C»©eTh»adEx
(&is->
_video_»äesh_tid
, 
video_»äesh_th»ad
, 
få
, "ff_vout");

3242 ià(!
is
->
video_»äesh_tid
) {

3243 
	`av_ä“p
(&
få
->
is
);

3244  
NULL
;

3247 
is
->
»ad_tid
 = 
	`SDL_C»©eTh»adEx
(&is->
_»ad_tid
, 
»ad_th»ad
, 
få
, "ff_read");

3248 ià(!
is
->
»ad_tid
) {

3249 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "SDL_C»©eTh»ad(): %s\n", 
	`SDL_G‘E¼Ü
());

3250 
ç
:

3251 
is
->
abÜt_»que¡
 = 
Œue
;

3252 ià(
is
->
video_»äesh_tid
)

3253 
	`SDL_Wa™Th»ad
(
is
->
video_»äesh_tid
, 
NULL
);

3254 
	`¡»am_şo£
(
få
);

3255  
NULL
;

3257  
is
;

3258 
	}
}

3280 
	$video_»äesh_th»ad
(*
¬g
)

3282 
FFPÏy”
 *
få
 = 
¬g
;

3283 
VideoS‹
 *
is
 = 
få
->is;

3284 
»maššg_time
 = 0.0;

3285 !
is
->
abÜt_»que¡
) {

3286 ià(
»maššg_time
 > 0.0)

3287 
	`av_u¦“p
(()(
št64_t
)(
»maššg_time
 * 1000000.0));

3288 
»maššg_time
 = 
REFRESH_RATE
;

3289 ià(
is
->
show_mode
 !ğ
SHOW_MODE_NONE
 && (!is->
·u£d
 || is->
fÜû_»äesh
))

3290 
	`video_»äesh
(
få
, &
»maššg_time
);

3294 
	}
}

3296 
	$lockmgr
(**
mtx
, 
AVLockOp
 
İ
)

3298 
İ
) {

3299 
AV_LOCK_CREATE
:

3300 *
mtx
 = 
	`SDL_C»©eMu‹x
();

3301 ià(!*
mtx
) {

3302 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "SDL_C»©eMu‹x(): %s\n", 
	`SDL_G‘E¼Ü
());

3306 
AV_LOCK_OBTAIN
:

3307  !!
	`SDL_LockMu‹x
(*
mtx
);

3308 
AV_LOCK_RELEASE
:

3309  !!
	`SDL_UÆockMu‹x
(*
mtx
);

3310 
AV_LOCK_DESTROY
:

3311 
	`SDL_De¡royMu‹x
(*
mtx
);

3315 
	}
}

3323 
boŞ
 
	gg_ffm³g_glob®_š™ed
 = 
çl£
;

3325 
šlše
 
	$log_Ëv–_av_to_ijk
(
av_Ëv–
)

3327 
ijk_Ëv–
 = 
IJK_LOG_VERBOSE
;

3328 ià(
av_Ëv–
 <ğ
AV_LOG_PANIC
è
ijk_Ëv–
 = 
IJK_LOG_FATAL
;

3329 ià(
av_Ëv–
 <ğ
AV_LOG_FATAL
è
ijk_Ëv–
 = 
IJK_LOG_FATAL
;

3330 ià(
av_Ëv–
 <ğ
AV_LOG_ERROR
è
ijk_Ëv–
 = 
IJK_LOG_ERROR
;

3331 ià(
av_Ëv–
 <ğ
AV_LOG_WARNING
è
ijk_Ëv–
 = 
IJK_LOG_WARN
;

3332 ià(
av_Ëv–
 <ğ
AV_LOG_INFO
è
ijk_Ëv–
 = 
IJK_LOG_INFO
;

3334 ià(
av_Ëv–
 <ğ
AV_LOG_VERBOSE
è
ijk_Ëv–
 = 
IJK_LOG_INFO
;

3335 ià(
av_Ëv–
 <ğ
AV_LOG_DEBUG
è
ijk_Ëv–
 = 
IJK_LOG_DEBUG
;

3336 ià(
av_Ëv–
 <ğ
AV_LOG_TRACE
è
ijk_Ëv–
 = 
IJK_LOG_VERBOSE
;

3337 
ijk_Ëv–
 = 
IJK_LOG_VERBOSE
;

3338  
ijk_Ëv–
;

3339 
	}
}

3341 
šlše
 
	$log_Ëv–_ijk_to_av
(
ijk_Ëv–
)

3343 
av_Ëv–
 = 
IJK_LOG_VERBOSE
;

3344 ià(
ijk_Ëv–
 >ğ
IJK_LOG_SILENT
è
av_Ëv–
 = 
AV_LOG_QUIET
;

3345 ià(
ijk_Ëv–
 >ğ
IJK_LOG_FATAL
è
av_Ëv–
 = 
AV_LOG_FATAL
;

3346 ià(
ijk_Ëv–
 >ğ
IJK_LOG_ERROR
è
av_Ëv–
 = 
AV_LOG_ERROR
;

3347 ià(
ijk_Ëv–
 >ğ
IJK_LOG_WARN
è
av_Ëv–
 = 
AV_LOG_WARNING
;

3348 ià(
ijk_Ëv–
 >ğ
IJK_LOG_INFO
è
av_Ëv–
 = 
AV_LOG_INFO
;

3350 ià(
ijk_Ëv–
 >ğ
IJK_LOG_DEBUG
è
av_Ëv–
 = 
AV_LOG_DEBUG
;

3351 ià(
ijk_Ëv–
 >ğ
IJK_LOG_VERBOSE
è
av_Ëv–
 = 
AV_LOG_TRACE
;

3352 ià(
ijk_Ëv–
 >ğ
IJK_LOG_DEFAULT
è
av_Ëv–
 = 
AV_LOG_TRACE
;

3353 ià(
ijk_Ëv–
 >ğ
IJK_LOG_UNKNOWN
è
av_Ëv–
 = 
AV_LOG_TRACE
;

3354 
av_Ëv–
 = 
AV_LOG_TRACE
;

3355  
av_Ëv–
;

3356 
	}
}

3358 
	$få_log_ÿÎback_br›f
(*
±r
, 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
vl
)

3360 ià(
Ëv–
 > 
	`av_log_g‘_Ëv–
())

3363 
fålv
 
__unu£d
 = 
	`log_Ëv–_av_to_ijk
(
Ëv–
);

3364 
	`VLOG
(
fålv
, 
IJK_LOG_TAG
, 
fmt
, 
vl
);

3365 
	}
}

3367 
	$få_log_ÿÎback_»pÜt
(*
±r
, 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
vl
)

3369 ià(
Ëv–
 > 
	`av_log_g‘_Ëv–
())

3372 
fålv
 
__unu£d
 = 
	`log_Ëv–_av_to_ijk
(
Ëv–
);

3374 
va_li¡
 
vl2
;

3375 
lše
[1024];

3376 
´št_´efix
 = 1;

3378 
	`va_cİy
(
vl2
, 
vl
);

3380 
	`av_log_fÜm©_lše
(
±r
, 
Ëv–
, 
fmt
, 
vl2
, 
lše
, Öše), &
´št_´efix
);

3381 
	`va_’d
(
vl2
);

3383 
	`ALOG
(
fålv
, 
IJK_LOG_TAG
, "%s", 
lše
);

3384 
	}
}

3386 
ijkav_»gi¡”_®l
();

3387 
	$få_glob®_š™
()

3389 ià(
g_ffm³g_glob®_š™ed
)

3393 
	`avcodec_»gi¡”_®l
();

3394 #ià
CONFIG_AVDEVICE


3395 
	`avdeviû_»gi¡”_®l
();

3397 #ià
CONFIG_AVFILTER


3398 
	`avf‹r_»gi¡”_®l
();

3400 
	`av_»gi¡”_®l
();

3402 
	`ijkav_»gi¡”_®l
();

3404 
	`avfÜm©_ÃtwÜk_š™
();

3406 
	`av_lockmgr_»gi¡”
(
lockmgr
);

3407 
	`av_log_£t_ÿÎback
(
få_log_ÿÎback_br›f
);

3409 
	`av_š™_·ck‘
(&
æush_pkt
);

3410 
æush_pkt
.
d©a
 = (
ušt8_t
 *)&flush_pkt;

3412 
g_ffm³g_glob®_š™ed
 = 
Œue
;

3413 
	}
}

3415 
	$få_glob®_unš™
()

3417 ià(!
g_ffm³g_glob®_š™ed
)

3420 
	`av_lockmgr_»gi¡”
(
NULL
);

3424 
	`avfÜm©_ÃtwÜk_deš™
();

3426 
g_ffm³g_glob®_š™ed
 = 
çl£
;

3427 
	}
}

3429 
	$få_glob®_£t_log_»pÜt
(
u£_»pÜt
)

3431 ià(
u£_»pÜt
) {

3432 
	`av_log_£t_ÿÎback
(
få_log_ÿÎback_»pÜt
);

3434 
	`av_log_£t_ÿÎback
(
få_log_ÿÎback_br›f
);

3436 
	}
}

3438 
	$få_glob®_£t_log_Ëv–
(
log_Ëv–
)

3440 
av_Ëv–
 = 
	`log_Ëv–_ijk_to_av
(
log_Ëv–
);

3441 
	`av_log_£t_Ëv–
(
av_Ëv–
);

3442 
	}
}

3444 
ijk_šjeù_ÿÎback
 
	gs_šjeù_ÿÎback
;

3445 
	$šjeù_ÿÎback
(*
İaque
, 
ty³
, *
d©a
, 
size_t
 
d©a_size
)

3447 ià(
s_šjeù_ÿÎback
)

3448  
	`s_šjeù_ÿÎback
(
İaque
, 
ty³
, 
d©a
, 
d©a_size
);

3450 
	}
}

3452 
	$få_glob®_£t_šjeù_ÿÎback
(
ijk_šjeù_ÿÎback
 
cb
)

3454 
s_šjeù_ÿÎback
 = 
cb
;

3455 
	}
}

3457 
få_io_¡©_»gi¡”
((*
cb
)(cÚ¡ *
u¾
, 
ty³
, 
by‹s
))

3460 
	}
}

3462 
få_io_¡©_com¶‘e_»gi¡”
((*
cb
)(cÚ¡ *
u¾
,

3463 
št64_t
 
»ad_by‹s
, iÁ64_ˆ
tÙ®_size
,

3464 
št64_t
 
–·£d_time
, iÁ64_ˆ
tÙ®_du¿tiÚ
))

3467 
	}
}

3469 cÚ¡ *
	$få_cÚ‹xt_to_Çme
(*
±r
)

3472 
	}
}

3475 *
	$få_cÚ‹xt_chd_Ãxt
(*
obj
, *
´ev
)

3477  
NULL
;

3478 
	}
}

3480 cÚ¡ 
AVCÏss
 *
	$få_cÚ‹xt_chd_şass_Ãxt
(cÚ¡ 
AVCÏss
 *
´ev
)

3482  
NULL
;

3483 
	}
}

3485 cÚ¡ 
AVCÏss
 
	gfå_cÚ‹xt_şass
 = {

3486 .
şass_Çme
 = "FFPlayer",

3487 .
	g™em_Çme
 = 
få_cÚ‹xt_to_Çme
,

3488 .
	gİtiÚ
 = 
få_cÚ‹xt_İtiÚs
,

3489 .
	gv”siÚ
 = 
LIBAVUTIL_VERSION_INT
,

3490 .
	gchd_Ãxt
 = 
få_cÚ‹xt_chd_Ãxt
,

3491 .
	gchd_şass_Ãxt
 = 
få_cÚ‹xt_chd_şass_Ãxt
,

3494 cÚ¡ *
	$ijk_v”siÚ_šfo
()

3496  
IJKPLAYER_VERSION
;

3497 
	}
}

3499 
FFPÏy”
 *
	$få_ü—‹
()

3501 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "av_v”siÚ_šfo: %s\n", 
	`av_v”siÚ_šfo
());

3502 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "ijk_v”siÚ_šfo: %s\n", 
	`ijk_v”siÚ_šfo
());

3504 
FFPÏy”
* 
få
 = (FFPÏy”*è
	`av_m®locz
((FFPlayer));

3505 ià(!
få
)

3506  
NULL
;

3508 
	`msg_queue_š™
(&
få
->
msg_queue
);

3509 
få
->
af_mu‹x
 = 
	`SDL_C»©eMu‹x
();

3510 
få
->
vf_mu‹x
 = 
	`SDL_C»©eMu‹x
();

3512 
	`få_»£t_š‹º®
(
få
);

3513 
få
->
av_şass
 = &
få_cÚ‹xt_şass
;

3514 
få
->
m‘a
 = 
	`ijkm‘a_ü—‹
();

3516 
	`av_İt_£t_deçuÉs
(
få
);

3518  
få
;

3519 
	}
}

3521 
	$få_de¡roy
(
FFPÏy”
 *
få
)

3523 ià(!
få
)

3526 ià(
få
->
is
) {

3527 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "ffp_destroy_ffplayer: force stream_close()");

3528 
	`¡»am_şo£
(
få
);

3529 
få
->
is
 = 
NULL
;

3532 
	`SDL_VoutF»eP
(&
få
->
vout
);

3533 
	`SDL_AoutF»eP
(&
få
->
aout
);

3534 
	`få’ode_ä“_p
(&
få
->
node_vdec
);

3535 
	`få–še_ä“_p
(&
få
->
p–še
);

3536 
	`ijkm‘a_de¡roy_p
(&
få
->
m‘a
);

3537 
	`få_»£t_š‹º®
(
få
);

3539 
	`SDL_De¡royMu‹xP
(&
få
->
af_mu‹x
);

3540 
	`SDL_De¡royMu‹xP
(&
få
->
vf_mu‹x
);

3542 
	`msg_queue_de¡roy
(&
få
->
msg_queue
);

3545 
	`av_ä“
(
få
);

3546 
	}
}

3548 
	$få_de¡roy_p
(
FFPÏy”
 **
pfå
)

3550 ià(!
pfå
)

3553 
	`få_de¡roy
(*
pfå
);

3554 *
pfå
 = 
NULL
;

3555 
	}
}

3557 
AVDiùiÚ¬y
 **
	$få_g‘_İt_diù
(
FFPÏy”
 *
få
, 
İt_ÿ‹gÜy
)

3559 
	`as£¹
(
få
);

3561 
İt_ÿ‹gÜy
) {

3562 
FFP_OPT_CATEGORY_FORMAT
:  &
få
->
fÜm©_İts
;

3563 
FFP_OPT_CATEGORY_CODEC
:  &
få
->
codec_İts
;

3564 
FFP_OPT_CATEGORY_SWS
:  &
få
->
sws_diù
;

3565 
FFP_OPT_CATEGORY_PLAYER
:  &
få
->
¶ay”_İts
;

3566 
FFP_OPT_CATEGORY_SWR
:  &
få
->
swr_İts
;

3568 
	`av_log
(
få
, 
AV_LOG_ERROR
, "unknowÀİtiÚ c©egÜy %d\n", 
İt_ÿ‹gÜy
);

3569  
NULL
;

3571 
	}
}

3573 
	$­p_func_ev’t
(
AVAµliÿtiÚCÚ‹xt
 *
h
, 
mes§ge
 ,*
d©a
, 
size_t
 
size
)

3575 ià(!
h
 || !h->
İaque
 || !
d©a
)

3578 
FFPÏy”
 *
få
 = (FFPÏy” *)
h
->
İaque
;

3579 ià(!
få
->
šjeù_İaque
)

3581 ià(
mes§ge
 =ğ
AVAPP_EVENT_IO_TRAFFIC
 && (
AVAµIOT¿ffic
è=ğ
size
) {

3582 
AVAµIOT¿ffic
 *
ev’t
 = (AVAµIOT¿ffiø*)(
šŒ_t
)
d©a
;

3583 ià(
ev’t
->
by‹s
 > 0) {

3584 
få
->
¡©
.
by‹_couÁ
 +ğ
ev’t
->
by‹s
;

3585 
	`SDL_S³edSam¶”2Add
(&
få
->
¡©
.
tı_»ad_§m¶”
, 
ev’t
->
by‹s
);

3587 } ià(
mes§ge
 =ğ
AVAPP_EVENT_ASYNC_STATISTIC
 && (
AVAµAsyncSti¡ic
è=ğ
size
) {

3588 
AVAµAsyncSti¡ic
 *
¡©i¡ic
 = (AVAµAsyncSti¡iø*è(
šŒ_t
)
d©a
;

3589 
få
->
¡©
.
buf_backw¬ds
 = 
¡©i¡ic
->buf_backwards;

3590 
få
->
¡©
.
buf_fÜw¬ds
 = 
¡©i¡ic
->buf_forwards;

3591 
få
->
¡©
.
buf_ÿ·c™y
 = 
¡©i¡ic
->buf_capacity;

3593  
	`šjeù_ÿÎback
(
få
->
šjeù_İaque
, 
mes§ge
 , 
d©a
, 
size
);

3594 
	}
}

3596 
	$ijkio_­p_func_ev’t
(
IjkIOAµliÿtiÚCÚ‹xt
 *
h
, 
mes§ge
 ,*
d©a
, 
size_t
 
size
)

3598 ià(!
h
 || !h->
İaque
 || !
d©a
)

3601 
FFPÏy”
 *
få
 = (FFPÏy” *)
h
->
İaque
;

3602 ià(!
få
->
ijkio_šjeù_İaque
)

3605 ià(
mes§ge
 =ğ
IJKIOAPP_EVENT_CACHE_STATISTIC
 && (
IjkIOAµCacheSti¡ic
è=ğ
size
) {

3606 
IjkIOAµCacheSti¡ic
 *
¡©i¡ic
 = (IjkIOAµCacheSti¡iø*è(
šŒ_t
)
d©a
;

3607 
få
->
¡©
.
ÿche_physiÿl_pos
 = 
¡©i¡ic
->cache_physical_pos;

3608 
få
->
¡©
.
ÿche_buf_fÜw¬ds
 = 
¡©i¡ic
->cache_buf_forwards;

3609 
få
->
¡©
.
ÿche_fe_pos
 = 
¡©i¡ic
->cache_file_pos;

3610 
få
->
¡©
.
ÿche_couÁ_by‹s
 = 
¡©i¡ic
->cache_count_bytes;

3613  
	`šjeù_ÿÎback
(
få
->
šjeù_İaque
, 
IJKIOAPP_EVENT_CACHE_STATISTIC
, 
d©a
, 
size
);

3614 
	}
}

3616 *
	$få_£t_ijkio_šjeù_İaque
(
FFPÏy”
 *
få
, *
İaque
)

3618 ià(!
få
)

3619  
NULL
;

3620 *
´ev_w—k_thiz
 = 
få
->
ijkio_šjeù_İaque
;

3621 
få
->
ijkio_šjeù_İaque
 = 
İaque
;

3623 
	`ijkio_mªag”_de¡royp
(&
få
->
ijkio_mªag”_ùx
);

3624 
	`ijkio_mªag”_ü—‹
(&
få
->
ijkio_mªag”_ùx
, ffp);

3625 
	`ijkio_mªag”_£t_ÿÎback
(
få
->
ijkio_mªag”_ùx
, 
ijkio_­p_func_ev’t
);

3626 
	`få_£t_İtiÚ_št
(
få
, 
FFP_OPT_CATEGORY_FORMAT
, "ijkiomªag”", (
št64_t
)(
šŒ_t
)få->
ijkio_mªag”_ùx
);

3628  
´ev_w—k_thiz
;

3629 
	}
}

3631 *
	$få_£t_šjeù_İaque
(
FFPÏy”
 *
få
, *
İaque
)

3633 ià(!
få
)

3634  
NULL
;

3635 *
´ev_w—k_thiz
 = 
få
->
šjeù_İaque
;

3636 
få
->
šjeù_İaque
 = 
İaque
;

3638 
	`av_­¶iÿtiÚ_şo£p
(&
få
->
­p_ùx
);

3639 
	`av_­¶iÿtiÚ_İ’
(&
få
->
­p_ùx
, ffp);

3640 
	`få_£t_İtiÚ_št
(
få
, 
FFP_OPT_CATEGORY_FORMAT
, "ijk­¶iÿtiÚ", (
št64_t
)(
šŒ_t
)få->
­p_ùx
);

3642 
få
->
­p_ùx
->
func_Ú_­p_ev’t
 = 
­p_func_ev’t
;

3643  
´ev_w—k_thiz
;

3644 
	}
}

3646 
	$få_£t_İtiÚ
(
FFPÏy”
 *
få
, 
İt_ÿ‹gÜy
, cÚ¡ *
Çme
, cÚ¡ *
v®ue
)

3648 ià(!
få
)

3651 
AVDiùiÚ¬y
 **
diù
 = 
	`få_g‘_İt_diù
(
få
, 
İt_ÿ‹gÜy
);

3652 
	`av_diù_£t
(
diù
, 
Çme
, 
v®ue
, 0);

3653 
	}
}

3655 
	$få_£t_İtiÚ_št
(
FFPÏy”
 *
få
, 
İt_ÿ‹gÜy
, cÚ¡ *
Çme
, 
št64_t
 
v®ue
)

3657 ià(!
få
)

3660 
AVDiùiÚ¬y
 **
diù
 = 
	`få_g‘_İt_diù
(
få
, 
İt_ÿ‹gÜy
);

3661 
	`av_diù_£t_št
(
diù
, 
Çme
, 
v®ue
, 0);

3662 
	}
}

3664 
	$få_£t_ov”Ïy_fÜm©
(
FFPÏy”
 *
få
, 
chroma_fourcc
)

3666 
chroma_fourcc
) {

3667 
SDL_FCC__GLES2
:

3668 
SDL_FCC_I420
:

3669 
SDL_FCC_YV12
:

3670 
SDL_FCC_RV16
:

3671 
SDL_FCC_RV24
:

3672 
SDL_FCC_RV32
:

3673 
få
->
ov”Ïy_fÜm©
 = 
chroma_fourcc
;

3675 #ifdeà
__APPLE__


3676 
SDL_FCC_I444P10LE
:

3677 
få
->
ov”Ïy_fÜm©
 = 
chroma_fourcc
;

3681 
	`av_log
(
få
, 
AV_LOG_ERROR
, "få_£t_ov”Ïy_fÜm©: unknowÀchrom¨fourcc: %d\n", 
chroma_fourcc
);

3684 
	}
}

3686 
	$få_g‘_video_codec_šfo
(
FFPÏy”
 *
få
, **
codec_šfo
)

3688 ià(!
codec_šfo
)

3692 ià(
få
->
video_codec_šfo
) {

3693 *
codec_šfo
 = 
	`¡rdup
(
få
->
video_codec_šfo
);

3695 *
codec_šfo
 = 
NULL
;

3698 
	}
}

3700 
	$få_g‘_audio_codec_šfo
(
FFPÏy”
 *
få
, **
codec_šfo
)

3702 ià(!
codec_šfo
)

3706 ià(
få
->
audio_codec_šfo
) {

3707 *
codec_šfo
 = 
	`¡rdup
(
få
->
audio_codec_šfo
);

3709 *
codec_šfo
 = 
NULL
;

3712 
	}
}

3714 
	$få_show_diù
(
FFPÏy”
 *
få
, cÚ¡ *
g
, 
AVDiùiÚ¬y
 *
diù
)

3716 
AVDiùiÚ¬yEÁry
 *
t
 = 
NULL
;

3718 (
t
 = 
	`av_diù_g‘
(
diù
, "",, 
AV_DICT_IGNORE_SUFFIX
))) {

3719 
	`av_log
(
få
, 
AV_LOG_INFO
, "%-*s: %-* ğ%s\n", 12, 
g
, 28, 
t
->
key
,->
v®ue
);

3721 
	}
}

3723 
	#FFP_VERSION_MODULE_NAME_LENGTH
 13

	)

3724 
	$få_show_v”siÚ_¡r
(
FFPÏy”
 *
få
, cÚ¡ *
moduË
, cÚ¡ *
v”siÚ
)

3726 
	`av_log
(
få
, 
AV_LOG_INFO
, "%-*s: %s\n", 
FFP_VERSION_MODULE_NAME_LENGTH
, 
moduË
, 
v”siÚ
);

3727 
	}
}

3729 
	$få_show_v”siÚ_št
(
FFPÏy”
 *
få
, cÚ¡ *
moduË
, 
v”siÚ
)

3731 
	`av_log
(
få
, 
AV_LOG_INFO
, "%-*s: %u.%u.%u\n",

3732 
FFP_VERSION_MODULE_NAME_LENGTH
, 
moduË
,

3733 ()
	`IJKVERSION_GET_MAJOR
(
v”siÚ
),

3734 ()
	`IJKVERSION_GET_MINOR
(
v”siÚ
),

3735 ()
	`IJKVERSION_GET_MICRO
(
v”siÚ
));

3736 
	}
}

3738 
	$få_´•¬e_async_l
(
FFPÏy”
 *
få
, cÚ¡ *
fe_Çme
)

3740 
	`as£¹
(
få
);

3741 
	`as£¹
(!
få
->
is
);

3742 
	`as£¹
(
fe_Çme
);

3744 ià(
	`av_¡ri¡¬t
(
fe_Çme
, "¹mp", 
NULL
) ||

3745 
	`av_¡ri¡¬t
(
fe_Çme
, "¹¥", 
NULL
)) {

3747 
	`av_log
(
få
, 
AV_LOG_WARNING
, "remove 'timeout' option for„tmp.\n");

3748 
	`av_diù_£t
(&
få
->
fÜm©_İts
, "timeout", 
NULL
, 0);

3752 ià(
	`¡¾’
(
fe_Çme
) + 1 > 1024) {

3753 
	`av_log
(
få
, 
AV_LOG_ERROR
, "% toØlÚg u¾\n", 
__func__
);

3754 ià(
	`avio_fšd_´ÙocŞ_Çme
("ijklongurl:")) {

3755 
	`av_diù_£t
(&
få
->
fÜm©_İts
, "ijklÚgu¾-u¾", 
fe_Çme
, 0);

3756 
fe_Çme
 = "ijklongurl:";

3760 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "===== versions =====\n");

3761 
	`få_show_v”siÚ_¡r
(
få
, "ijk¶ay”", 
	`ijk_v”siÚ_šfo
());

3762 
	`få_show_v”siÚ_¡r
(
få
, "FFm³g", 
	`av_v”siÚ_šfo
());

3763 
	`få_show_v”siÚ_št
(
få
, "libavut", 
	`avut_v”siÚ
());

3764 
	`få_show_v”siÚ_št
(
få
, "libavcodec", 
	`avcodec_v”siÚ
());

3765 
	`få_show_v”siÚ_št
(
få
, "libavfÜm©", 
	`avfÜm©_v”siÚ
());

3766 
	`få_show_v”siÚ_št
(
få
, "libswsÿË", 
	`swsÿË_v”siÚ
());

3767 
	`få_show_v”siÚ_št
(
få
, "libsw»§m¶e", 
	`sw»§m¶e_v”siÚ
());

3768 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "===== options =====\n");

3769 
	`få_show_diù
(
få
, "¶ay”-İts", få->
¶ay”_İts
);

3770 
	`få_show_diù
(
få
, "fÜm©-İts", få->
fÜm©_İts
);

3771 
	`få_show_diù
(
få
, "codec-İt ", få->
codec_İts
);

3772 
	`få_show_diù
(
få
, "sws-İt  ", få->
sws_diù
);

3773 
	`få_show_diù
(
få
, "swr-İt  ", få->
swr_İts
);

3774 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "===================\n");

3776 
	`av_İt_£t_diù
(
få
, &få->
¶ay”_İts
);

3777 ià(!
få
->
aout
) {

3778 
få
->
aout
 = 
	`få–še_İ’_audio_ouut
(få->
p–še
, ffp);

3779 ià(!
få
->
aout
)

3783 #ià
CONFIG_AVFILTER


3784 ià(
få
->
vf‹r0
) {

3785 
	`GROW_ARRAY
(
få
->
vf‹rs_li¡
, få->
nb_vf‹rs
);

3786 
få
->
vf‹rs_li¡
[få->
nb_vf‹rs
 - 1] = få->
vf‹r0
;

3790 
VideoS‹
 *
is
 = 
	`¡»am_İ’
(
få
, 
fe_Çme
, 
NULL
);

3791 ià(!
is
) {

3792 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "ffp_prepare_async_l: stream_open failed OOM");

3793  
EIJK_OUT_OF_MEMORY
;

3796 
få
->
is
 = is;

3797 
få
->
šput_f’ame
 = 
	`av_¡rdup
(
fe_Çme
);

3799 
	}
}

3801 
	$få_¡¬t_äom_l
(
FFPÏy”
 *
få
, 
m£c
)

3803 
	`as£¹
(
få
);

3804 
VideoS‹
 *
is
 = 
få
->is;

3805 ià(!
is
)

3806  
EIJK_NULL_IS_PTR
;

3808 
få
->
auto_»sume
 = 1;

3809 
	`få_toggË_bufãršg
(
få
, 1);

3810 
	`få_£ek_to_l
(
få
, 
m£c
);

3812 
	}
}

3814 
	$få_¡¬t_l
(
FFPÏy”
 *
få
)

3816 
	`as£¹
(
få
);

3817 
VideoS‹
 *
is
 = 
få
->is;

3818 ià(!
is
)

3819  
EIJK_NULL_IS_PTR
;

3821 
	`toggË_·u£
(
få
, 0);

3823 
	}
}

3825 
	$få_·u£_l
(
FFPÏy”
 *
få
)

3827 
	`as£¹
(
få
);

3828 
VideoS‹
 *
is
 = 
få
->is;

3829 ià(!
is
)

3830  
EIJK_NULL_IS_PTR
;

3832 
	`toggË_·u£
(
få
, 1);

3834 
	}
}

3836 
	$få_is_·u£d_l
(
FFPÏy”
 *
få
)

3838 
	`as£¹
(
få
);

3839 
VideoS‹
 *
is
 = 
få
->is;

3840 ià(!
is
)

3843  
is
->
·u£d
;

3844 
	}
}

3846 
	$få_¡İ_l
(
FFPÏy”
 *
få
)

3848 
	`as£¹
(
få
);

3849 
VideoS‹
 *
is
 = 
få
->is;

3850 ià(
is
) {

3851 
is
->
abÜt_»que¡
 = 1;

3852 
	`toggË_·u£
(
få
, 1);

3855 
	`msg_queue_abÜt
(&
få
->
msg_queue
);

3857 
	}
}

3859 
	$få_wa™_¡İ_l
(
FFPÏy”
 *
få
)

3861 
	`as£¹
(
få
);

3863 ià(
få
->
is
) {

3864 
	`få_¡İ_l
(
få
);

3865 
	`¡»am_şo£
(
få
);

3866 
få
->
is
 = 
NULL
;

3869 
	}
}

3871 
	$få_£ek_to_l
(
FFPÏy”
 *
få
, 
m£c
)

3873 
	`as£¹
(
få
);

3874 
VideoS‹
 *
is
 = 
få
->is;

3875 ià(!
is
)

3876  
EIJK_NULL_IS_PTR
;

3878 
št64_t
 
£ek_pos
 = 
	`mli£cÚds_to_fáime
(
m£c
);

3879 
št64_t
 
¡¬t_time
 = 
is
->
ic
->start_time;

3880 ià(
¡¬t_time
 > 0 && s¹_tim!ğ
AV_NOPTS_VALUE
)

3881 
£ek_pos
 +ğ
¡¬t_time
;

3886 
	`av_log
(
få
, 
AV_LOG_DEBUG
, "¡»am_£ek %"
PRId64
"(%dè+ %"PRId64", \n", 
£ek_pos
, ()
m£c
, 
¡¬t_time
);

3887 
	`¡»am_£ek
(
is
, 
£ek_pos
, 0, 0);

3889 
	}
}

3891 
	$få_g‘_cu¼’t_pos™iÚ_l
(
FFPÏy”
 *
få
)

3893 
	`as£¹
(
få
);

3894 
VideoS‹
 *
is
 = 
få
->is;

3895 ià(!
is
 || !is->
ic
)

3898 
št64_t
 
¡¬t_time
 = 
is
->
ic
->start_time;

3899 
št64_t
 
¡¬t_diff
 = 0;

3900 ià(
¡¬t_time
 > 0 && s¹_tim!ğ
AV_NOPTS_VALUE
)

3901 
¡¬t_diff
 = 
	`fáime_to_mli£cÚds
(
¡¬t_time
);

3903 
št64_t
 
pos
 = 0;

3904 
pos_şock
 = 
	`g‘_ma¡”_şock
(
is
);

3905 ià(
	`i¢ª
(
pos_şock
)) {

3906 
pos
 = 
	`fáime_to_mli£cÚds
(
is
->
£ek_pos
);

3908 
pos
 = 
pos_şock
 * 1000;

3915 ià(
få
->
no_time_adju¡
) {

3916  ()
pos
;

3919 ià(
pos
 < 0 ||…o < 
¡¬t_diff
)

3922 
št64_t
 
adju¡_pos
 = 
pos
 - 
¡¬t_diff
;

3923  ()
adju¡_pos
;

3924 
	}
}

3926 
	$få_g‘_du¿tiÚ_l
(
FFPÏy”
 *
få
)

3928 
	`as£¹
(
få
);

3929 
VideoS‹
 *
is
 = 
få
->is;

3930 ià(!
is
 || !is->
ic
)

3933 
št64_t
 
du¿tiÚ
 = 
	`fáime_to_mli£cÚds
(
is
->
ic
->duration);

3934 ià(
du¿tiÚ
 < 0)

3937  ()
du¿tiÚ
;

3938 
	}
}

3940 
	$få_g‘_¶ayabË_du¿tiÚ_l
(
FFPÏy”
 *
få
)

3942 
	`as£¹
(
få
);

3943 ià(!
få
)

3946  ()
få
->
¶ayabË_du¿tiÚ_ms
;

3947 
	}
}

3949 
	$få_£t_loİ
(
FFPÏy”
 *
få
, 
loİ
)

3951 
	`as£¹
(
få
);

3952 ià(!
få
)

3954 
få
->
loİ
 =†oop;

3955 
	}
}

3957 
	$få_g‘_loİ
(
FFPÏy”
 *
få
)

3959 
	`as£¹
(
få
);

3960 ià(!
få
)

3962  
få
->
loİ
;

3963 
	}
}

3965 
	$få_·ck‘_queue_š™
(
Pack‘Queue
 *
q
)

3967  
	`·ck‘_queue_š™
(
q
);

3968 
	}
}

3970 
	$få_·ck‘_queue_de¡roy
(
Pack‘Queue
 *
q
)

3972  
	`·ck‘_queue_de¡roy
(
q
);

3973 
	}
}

3975 
	$få_·ck‘_queue_abÜt
(
Pack‘Queue
 *
q
)

3977  
	`·ck‘_queue_abÜt
(
q
);

3978 
	}
}

3980 
	$få_·ck‘_queue_¡¬t
(
Pack‘Queue
 *
q
)

3982  
	`·ck‘_queue_¡¬t
(
q
);

3983 
	}
}

3985 
	$få_·ck‘_queue_æush
(
Pack‘Queue
 *
q
)

3987  
	`·ck‘_queue_æush
(
q
);

3988 
	}
}

3990 
	$få_·ck‘_queue_g‘
(
Pack‘Queue
 *
q
, 
AVPack‘
 *
pkt
, 
block
, *
£rŸl
)

3992  
	`·ck‘_queue_g‘
(
q
, 
pkt
, 
block
, 
£rŸl
);

3993 
	}
}

3995 
	$få_·ck‘_queue_g‘_Ü_bufãršg
(
FFPÏy”
 *
få
, 
Pack‘Queue
 *
q
, 
AVPack‘
 *
pkt
, *
£rŸl
, *
fšished
)

3997  
	`·ck‘_queue_g‘_Ü_bufãršg
(
få
, 
q
, 
pkt
, 
£rŸl
, 
fšished
);

3998 
	}
}

4000 
	$få_·ck‘_queue_put
(
Pack‘Queue
 *
q
, 
AVPack‘
 *
pkt
)

4002  
	`·ck‘_queue_put
(
q
, 
pkt
);

4003 
	}
}

4005 
boŞ
 
	$få_is_æush_·ck‘
(
AVPack‘
 *
pkt
)

4007 ià(!
pkt
)

4008  
çl£
;

4010  
pkt
->
d©a
 =ğ
æush_pkt
.data;

4011 
	}
}

4013 
F¿me
 *
	$få_äame_queue_³ek_wr™abË
(
F¿meQueue
 *
f
)

4015  
	`äame_queue_³ek_wr™abË
(
f
);

4016 
	}
}

4018 
	$få_äame_queue_push
(
F¿meQueue
 *
f
)

4020  
	`äame_queue_push
(
f
);

4021 
	}
}

4023 
	$få_queue_piùu»
(
FFPÏy”
 *
få
, 
AVF¿me
 *
¤c_äame
, 
±s
, 
du¿tiÚ
, 
št64_t
 
pos
, 
£rŸl
)

4025  
	`queue_piùu»
(
få
, 
¤c_äame
, 
±s
, 
du¿tiÚ
, 
pos
, 
£rŸl
);

4026 
	}
}

4028 
	$få_g‘_ma¡”_sync_ty³
(
VideoS‹
 *
is
)

4030  
	`g‘_ma¡”_sync_ty³
(
is
);

4031 
	}
}

4033 
	$få_g‘_ma¡”_şock
(
VideoS‹
 *
is
)

4035  
	`g‘_ma¡”_şock
(
is
);

4036 
	}
}

4038 
	$få_toggË_bufãršg_l
(
FFPÏy”
 *
få
, 
bufãršg_Ú
)

4040 ià(!
få
->
·ck‘_bufãršg
)

4043 
VideoS‹
 *
is
 = 
få
->is;

4044 ià(
bufãršg_Ú
 && !
is
->buffering_on) {

4045 
	`av_log
(
få
, 
AV_LOG_DEBUG
, "ffp_toggle_buffering_l: start\n");

4046 
is
->
bufãršg_Ú
 = 1;

4047 
	`¡»am_upd©e_·u£_l
(
få
);

4048 
	`få_nÙify_msg1
(
få
, 
FFP_MSG_BUFFERING_START
);

4049 } ià(!
bufãršg_Ú
 && 
is
->buffering_on){

4050 
	`av_log
(
få
, 
AV_LOG_DEBUG
, "ffp_toggle_buffering_l:ƒnd\n");

4051 
is
->
bufãršg_Ú
 = 0;

4052 
	`¡»am_upd©e_·u£_l
(
få
);

4053 
	`få_nÙify_msg1
(
få
, 
FFP_MSG_BUFFERING_END
);

4055 
	}
}

4057 
	$få_toggË_bufãršg
(
FFPÏy”
 *
få
, 
¡¬t_bufãršg
)

4059 
	`SDL_LockMu‹x
(
få
->
is
->
¶ay_mu‹x
);

4060 
	`få_toggË_bufãršg_l
(
få
, 
¡¬t_bufãršg
);

4061 
	`SDL_UÆockMu‹x
(
få
->
is
->
¶ay_mu‹x
);

4062 
	}
}

4064 
	$få_Œack_¡©i¡ic_l
(
FFPÏy”
 *
få
, 
AVSŒ—m
 *
¡
, 
Pack‘Queue
 *
q
, 
FFT¿ckCacheSti¡ic
 *
ÿche
)

4066 
	`as£¹
(
ÿche
);

4068 ià(
q
) {

4069 
ÿche
->
by‹s
 = 
q
->
size
;

4070 
ÿche
->
·ck‘s
 = 
q
->
nb_·ck‘s
;

4073 ià(
q
 && 
¡
 && st->
time_ba£
.
d’
 > 0 && st->time_ba£.
num
 > 0) {

4074 
ÿche
->
du¿tiÚ
 = 
q
->du¿tiÚ * 
	`av_q2d
(
¡
->
time_ba£
) * 1000;

4076 
	}
}

4078 
	$få_audio_¡©i¡ic_l
(
FFPÏy”
 *
få
)

4080 
VideoS‹
 *
is
 = 
få
->is;

4081 
	`få_Œack_¡©i¡ic_l
(
få
, 
is
->
audio_¡
, &is->
audioq
, &få->
¡©
.
audio_ÿche
);

4082 
	}
}

4084 
	$få_video_¡©i¡ic_l
(
FFPÏy”
 *
få
)

4086 
VideoS‹
 *
is
 = 
få
->is;

4087 
	`få_Œack_¡©i¡ic_l
(
få
, 
is
->
video_¡
, &is->
videoq
, &få->
¡©
.
video_ÿche
);

4088 
	}
}

4090 
	$få_¡©i¡ic_l
(
FFPÏy”
 *
få
)

4092 
	`få_audio_¡©i¡ic_l
(
få
);

4093 
	`få_video_¡©i¡ic_l
(
få
);

4094 
	}
}

4096 
	$få_check_bufãršg_l
(
FFPÏy”
 *
få
)

4098 
VideoS‹
 *
is
 = 
få
->is;

4099 
hwm_š_ms
 = 
få
->
dcc
.
cu¼’t_high_w©”_m¬k_š_ms
;

4100 
buf_size_³rûÁ
 = -1;

4101 
buf_time_³rûÁ
 = -1;

4102 
hwm_š_by‹s
 = 
få
->
dcc
.
high_w©”_m¬k_š_by‹s
;

4103 
Ãed_¡¬t_bufãršg
 = 0;

4104 
audio_time_ba£_v®id
 = 0;

4105 
video_time_ba£_v®id
 = 0;

4106 
št64_t
 
buf_time_pos™iÚ
 = -1;

4108 if(
is
->
audio_¡
)

4109 
audio_time_ba£_v®id
 = 
is
->
audio_¡
->
time_ba£
.
d’
 > 0 && is->audio_¡->time_ba£.
num
 > 0;

4110 if(
is
->
video_¡
)

4111 
video_time_ba£_v®id
 = 
is
->
video_¡
->
time_ba£
.
d’
 > 0 && is->video_¡->time_ba£.
num
 > 0;

4113 ià(
hwm_š_ms
 > 0) {

4114 
ÿched_du¿tiÚ_š_ms
 = -1;

4115 
št64_t
 
audio_ÿched_du¿tiÚ
 = -1;

4116 
št64_t
 
video_ÿched_du¿tiÚ
 = -1;

4118 ià(
is
->
audio_¡
 && 
audio_time_ba£_v®id
) {

4119 
audio_ÿched_du¿tiÚ
 = 
få
->
¡©
.
audio_ÿche
.
du¿tiÚ
;

4120 #ifdeà
FFP_SHOW_DEMUX_CACHE


4121 
audio_ÿched_³rûÁ
 = ()
	`av_»sÿË
(
audio_ÿched_du¿tiÚ
, 1005, 
hwm_š_ms
 * 10);

4122 
	`av_log
(
få
, 
AV_LOG_DEBUG
, "audiØÿche=%%%d mli:(%d/%dèby‹s:(%d/%dè·ck‘:(%d/%d)\n", 
audio_ÿched_³rûÁ
,

4123 ()
audio_ÿched_du¿tiÚ
, 
hwm_š_ms
,

4124 
is
->
audioq
.
size
, 
hwm_š_by‹s
,

4125 
is
->
audioq
.
nb_·ck‘s
, 
MIN_FRAMES
);

4129 ià(
is
->
video_¡
 && 
video_time_ba£_v®id
) {

4130 
video_ÿched_du¿tiÚ
 = 
få
->
¡©
.
video_ÿche
.
du¿tiÚ
;

4131 #ifdeà
FFP_SHOW_DEMUX_CACHE


4132 
video_ÿched_³rûÁ
 = ()
	`av_»sÿË
(
video_ÿched_du¿tiÚ
, 1005, 
hwm_š_ms
 * 10);

4133 
	`av_log
(
få
, 
AV_LOG_DEBUG
, "videØÿche=%%%d mli:(%d/%dèby‹s:(%d/%dè·ck‘:(%d/%d)\n", 
video_ÿched_³rûÁ
,

4134 ()
video_ÿched_du¿tiÚ
, 
hwm_š_ms
,

4135 
is
->
videoq
.
size
, 
hwm_š_by‹s
,

4136 
is
->
videoq
.
nb_·ck‘s
, 
MIN_FRAMES
);

4140 ià(
video_ÿched_du¿tiÚ
 > 0 && 
audio_ÿched_du¿tiÚ
 > 0) {

4141 
ÿched_du¿tiÚ_š_ms
 = ()
	`IJKMIN
(
video_ÿched_du¿tiÚ
, 
audio_ÿched_du¿tiÚ
);

4142 } ià(
video_ÿched_du¿tiÚ
 > 0) {

4143 
ÿched_du¿tiÚ_š_ms
 = ()
video_ÿched_du¿tiÚ
;

4144 } ià(
audio_ÿched_du¿tiÚ
 > 0) {

4145 
ÿched_du¿tiÚ_š_ms
 = ()
audio_ÿched_du¿tiÚ
;

4148 ià(
ÿched_du¿tiÚ_š_ms
 >= 0) {

4149 
buf_time_pos™iÚ
 = 
	`få_g‘_cu¼’t_pos™iÚ_l
(
få
è+ 
ÿched_du¿tiÚ_š_ms
;

4150 
få
->
¶ayabË_du¿tiÚ_ms
 = 
buf_time_pos™iÚ
;

4152 
buf_time_³rûÁ
 = ()
	`av_»sÿË
(
ÿched_du¿tiÚ_š_ms
, 1005, 
hwm_š_ms
 * 10);

4153 #ifdeà
FFP_SHOW_DEMUX_CACHE


4154 
	`av_log
(
få
, 
AV_LOG_DEBUG
, "timÿche=%%%d (%d/%d)\n", 
buf_time_³rûÁ
, 
ÿched_du¿tiÚ_š_ms
, 
hwm_š_ms
);

4156 #ifdeà
FFP_NOTIFY_BUF_TIME


4157 
	`få_nÙify_msg3
(
få
, 
FFP_MSG_BUFFERING_TIME_UPDATE
, 
ÿched_du¿tiÚ_š_ms
, 
hwm_š_ms
);

4162 
ÿched_size
 = 
is
->
audioq
.
size
 + is->
videoq
.size;

4163 ià(
hwm_š_by‹s
 > 0) {

4164 
buf_size_³rûÁ
 = ()
	`av_»sÿË
(
ÿched_size
, 1005, 
hwm_š_by‹s
 * 10);

4165 #ifdeà
FFP_SHOW_DEMUX_CACHE


4166 
	`av_log
(
få
, 
AV_LOG_DEBUG
, "sizÿche=%%%d (%d/%d)\n", 
buf_size_³rûÁ
, 
ÿched_size
, 
hwm_š_by‹s
);

4168 #ifdeà
FFP_NOTIFY_BUF_BYTES


4169 
	`få_nÙify_msg3
(
få
, 
FFP_MSG_BUFFERING_BYTES_UPDATE
, 
ÿched_size
, 
hwm_š_by‹s
);

4173 
buf_³rûÁ
 = -1;

4174 ià(
buf_time_³rûÁ
 >= 0) {

4176 ià(
buf_time_³rûÁ
 >= 100)

4177 
Ãed_¡¬t_bufãršg
 = 1;

4178 
buf_³rûÁ
 = 
buf_time_³rûÁ
;

4180 ià(
buf_size_³rûÁ
 >= 100)

4181 
Ãed_¡¬t_bufãršg
 = 1;

4182 
buf_³rûÁ
 = 
buf_size_³rûÁ
;

4185 ià(
buf_time_³rûÁ
 >ğ0 && 
buf_size_³rûÁ
 >= 0) {

4186 
buf_³rûÁ
 = 
	`FFMIN
(
buf_time_³rûÁ
, 
buf_size_³rûÁ
);

4188 ià(
buf_³rûÁ
) {

4189 #ifdeà
FFP_SHOW_BUF_POS


4190 
	`av_log
(
få
, 
AV_LOG_DEBUG
, "buàpos=%"
PRId64
", %%%d\n", 
buf_time_pos™iÚ
, 
buf_³rûÁ
);

4192 
	`få_nÙify_msg3
(
få
, 
FFP_MSG_BUFFERING_UPDATE
, ()
buf_time_pos™iÚ
, 
buf_³rûÁ
);

4195 ià(
Ãed_¡¬t_bufãršg
) {

4196 ià(
hwm_š_ms
 < 
få
->
dcc
.
Ãxt_high_w©”_m¬k_š_ms
) {

4197 
hwm_š_ms
 = 
få
->
dcc
.
Ãxt_high_w©”_m¬k_š_ms
;

4199 
hwm_š_ms
 *= 2;

4202 ià(
hwm_š_ms
 > 
få
->
dcc
.
Ï¡_high_w©”_m¬k_š_ms
)

4203 
hwm_š_ms
 = 
få
->
dcc
.
Ï¡_high_w©”_m¬k_š_ms
;

4205 
få
->
dcc
.
cu¼’t_high_w©”_m¬k_š_ms
 = 
hwm_š_ms
;

4207 ià(
is
->
bufãr_šdiÿtÜ_queue
 && is->bufãr_šdiÿtÜ_queue->
nb_·ck‘s
 > 0) {

4208 iàĞ(
is
->
audioq
.
nb_·ck‘s
 > 
MIN_MIN_FRAMES
 || is->
audio_¡»am
 < 0 || is->audioq.
abÜt_»que¡
)

4209 && (
is
->
videoq
.
nb_·ck‘s
 > 
MIN_MIN_FRAMES
 || is->
video_¡»am
 < 0 || is->videoq.
abÜt_»que¡
)) {

4210 
	`få_toggË_bufãršg
(
få
, 0);

4214 
	}
}

4216 
	$få_video_th»ad
(
FFPÏy”
 *
få
)

4218  
	`fåÏy_video_th»ad
(
få
);

4219 
	}
}

4221 
	$få_£t_video_codec_šfo
(
FFPÏy”
 *
få
, cÚ¡ *
moduË
, cÚ¡ *
codec
)

4223 
	`av_ä“p
(&
få
->
video_codec_šfo
);

4224 
få
->
video_codec_šfo
 = 
	`av_a¥rštf
("%s, %s", 
moduË
 ? moduË : "", 
codec
 ? codec : "");

4225 
	`av_log
(
få
, 
AV_LOG_INFO
, "VideoCodec: %s\n", få->
video_codec_šfo
);

4226 
	}
}

4228 
	$få_£t_audio_codec_šfo
(
FFPÏy”
 *
få
, cÚ¡ *
moduË
, cÚ¡ *
codec
)

4230 
	`av_ä“p
(&
få
->
audio_codec_šfo
);

4231 
få
->
audio_codec_šfo
 = 
	`av_a¥rštf
("%s, %s", 
moduË
 ? moduË : "", 
codec
 ? codec : "");

4232 
	`av_log
(
få
, 
AV_LOG_INFO
, "AudioCodec: %s\n", få->
audio_codec_šfo
);

4233 
	}
}

4235 
	$få_£t_subt™Ë_codec_šfo
(
FFPÏy”
 *
få
, cÚ¡ *
moduË
, cÚ¡ *
codec
)

4237 
	`av_ä“p
(&
få
->
subt™Ë_codec_šfo
);

4238 
få
->
subt™Ë_codec_šfo
 = 
	`av_a¥rštf
("%s, %s", 
moduË
 ? moduË : "", 
codec
 ? codec : "");

4239 
	`av_log
(
få
, 
AV_LOG_INFO
, "Subt™ËCodec: %s\n", få->
subt™Ë_codec_šfo
);

4240 
	}
}

4242 
	$få_£t_¶ayback_¿‹
(
FFPÏy”
 *
få
, 
¿‹
)

4244 ià(!
få
)

4247 
få
->
pf_¶ayback_¿‹
 = 
¿‹
;

4248 
få
->
pf_¶ayback_¿‹_chªged
 = 1;

4249 
	}
}

4251 
	$få_£t_¶ayback_vŞume
(
FFPÏy”
 *
få
, 
vŞume
)

4253 ià(!
få
)

4255 
få
->
pf_¶ayback_vŞume
 = 
vŞume
;

4256 
få
->
pf_¶ayback_vŞume_chªged
 = 1;

4257 
	}
}

4259 
	$få_g‘_video_rÙ©e_deg»es
(
FFPÏy”
 *
få
)

4261 
VideoS‹
 *
is
 = 
få
->is;

4262 ià(!
is
)

4265 
th‘a
 = 
	`abs
(()((
št64_t
)
	`round
(
	`çbs
(
	`g‘_rÙ©iÚ
(
is
->
video_¡
))) % 360));

4266 
th‘a
) {

4273 
th‘a
 = 0;

4276 
	`ALOGW
("UnknowÀrÙ©deg»ss: %d\n", 
th‘a
);

4277 
th‘a
 = 0;

4281  
th‘a
;

4282 
	}
}

4284 
	$få_£t_¡»am_£Ëùed
(
FFPÏy”
 *
få
, 
¡»am
, 
£Ëùed
)

4286 
VideoS‹
 *
is
 = 
få
->is;

4287 
AVFÜm©CÚ‹xt
 *
ic
 = 
NULL
;

4288 
AVCodecP¬am‘”s
 *
codeı¬
 = 
NULL
;

4289 ià(!
is
)

4291 
ic
 = 
is
->ic;

4292 ià(!
ic
)

4295 ià(
¡»am
 < 0 || sŒ—m >ğ
ic
->
nb_¡»ams
) {

4296 
	`av_log
(
få
, 
AV_LOG_ERROR
, "šv®id sŒ—m index %d >ğ¡»am‚umb” (%d)\n", 
¡»am
, 
ic
->
nb_¡»ams
);

4300 
codeı¬
 = 
ic
->
¡»ams
[
¡»am
]->codecpar;

4302 ià(
£Ëùed
) {

4303 
codeı¬
->
codec_ty³
) {

4304 
AVMEDIA_TYPE_VIDEO
:

4305 ià(
¡»am
 !ğ
is
->
video_¡»am
 && is->video_stream >= 0)

4306 
	`¡»am_compÚ’t_şo£
(
få
, 
is
->
video_¡»am
);

4308 
AVMEDIA_TYPE_AUDIO
:

4309 ià(
¡»am
 !ğ
is
->
audio_¡»am
 && is->audio_stream >= 0)

4310 
	`¡»am_compÚ’t_şo£
(
få
, 
is
->
audio_¡»am
);

4312 
AVMEDIA_TYPE_SUBTITLE
:

4313 ià(
¡»am
 !ğ
is
->
subt™Ë_¡»am
 && is->subtitle_stream >= 0)

4314 
	`¡»am_compÚ’t_şo£
(
få
, 
is
->
subt™Ë_¡»am
);

4317 
	`av_log
(
få
, 
AV_LOG_ERROR
, "£Ëù inv®id sŒ—m %d oàvideØty³ %d\n", 
¡»am
, 
codeı¬
->
codec_ty³
);

4320  
	`¡»am_compÚ’t_İ’
(
få
, 
¡»am
);

4322 
codeı¬
->
codec_ty³
) {

4323 
AVMEDIA_TYPE_VIDEO
:

4324 ià(
¡»am
 =ğ
is
->
video_¡»am
)

4325 
	`¡»am_compÚ’t_şo£
(
få
, 
is
->
video_¡»am
);

4327 
AVMEDIA_TYPE_AUDIO
:

4328 ià(
¡»am
 =ğ
is
->
audio_¡»am
)

4329 
	`¡»am_compÚ’t_şo£
(
få
, 
is
->
audio_¡»am
);

4331 
AVMEDIA_TYPE_SUBTITLE
:

4332 ià(
¡»am
 =ğ
is
->
subt™Ë_¡»am
)

4333 
	`¡»am_compÚ’t_şo£
(
få
, 
is
->
subt™Ë_¡»am
);

4336 
	`av_log
(
få
, 
AV_LOG_ERROR
, "£Ëù inv®id sŒ—m %d oàaudiØty³ %d\n", 
¡»am
, 
codeı¬
->
codec_ty³
);

4341 
	}
}

4343 
	$få_g‘_´İ”ty_æßt
(
FFPÏy”
 *
få
, 
id
, 
deçuÉ_v®ue
)

4345 
id
) {

4346 
FFP_PROP_FLOAT_VIDEO_DECODE_FRAMES_PER_SECOND
:

4347  
få
 ? få->
¡©
.
vdps
 : 
deçuÉ_v®ue
;

4348 
FFP_PROP_FLOAT_VIDEO_OUTPUT_FRAMES_PER_SECOND
:

4349  
få
 ? få->
¡©
.
vås
 : 
deçuÉ_v®ue
;

4350 
FFP_PROP_FLOAT_PLAYBACK_RATE
:

4351  
få
 ? få->
pf_¶ayback_¿‹
 : 
deçuÉ_v®ue
;

4352 
FFP_PROP_FLOAT_AVDELAY
:

4353  
få
 ? få->
¡©
.
avd–ay
 : 
deçuÉ_v®ue
;

4354 
FFP_PROP_FLOAT_AVDIFF
:

4355  
få
 ? få->
¡©
.
avdiff
 : 
deçuÉ_v®ue
;

4356 
FFP_PROP_FLOAT_PLAYBACK_VOLUME
:

4357  
få
 ? få->
pf_¶ayback_vŞume
 : 
deçuÉ_v®ue
;

4359  
deçuÉ_v®ue
;

4361 
	}
}

4363 
	$få_£t_´İ”ty_æßt
(
FFPÏy”
 *
få
, 
id
, 
v®ue
)

4365 
id
) {

4366 
FFP_PROP_FLOAT_PLAYBACK_RATE
:

4367 
	`få_£t_¶ayback_¿‹
(
få
, 
v®ue
);

4369 
FFP_PROP_FLOAT_PLAYBACK_VOLUME
:

4370 
	`få_£t_¶ayback_vŞume
(
få
, 
v®ue
);

4375 
	}
}

4377 
št64_t
 
	$få_g‘_´İ”ty_št64
(
FFPÏy”
 *
få
, 
id
, 
št64_t
 
deçuÉ_v®ue
)

4379 
id
) {

4380 
FFP_PROP_INT64_SELECTED_VIDEO_STREAM
:

4381 ià(!
få
 || !få->
is
)

4382  
deçuÉ_v®ue
;

4383  
få
->
is
->
video_¡»am
;

4384 
FFP_PROP_INT64_SELECTED_AUDIO_STREAM
:

4385 ià(!
få
 || !få->
is
)

4386  
deçuÉ_v®ue
;

4387  
få
->
is
->
audio_¡»am
;

4388 
FFP_PROP_INT64_SELECTED_TIMEDTEXT_STREAM
:

4389 ià(!
få
 || !få->
is
)

4390  
deçuÉ_v®ue
;

4391  
få
->
is
->
subt™Ë_¡»am
;

4392 
FFP_PROP_INT64_VIDEO_DECODER
:

4393 ià(!
få
)

4394  
deçuÉ_v®ue
;

4395  
få
->
¡©
.
vdec_ty³
;

4396 
FFP_PROP_INT64_AUDIO_DECODER
:

4397  
FFP_PROPV_DECODER_AVCODEC
;

4399 
FFP_PROP_INT64_VIDEO_CACHED_DURATION
:

4400 ià(!
få
)

4401  
deçuÉ_v®ue
;

4402  
få
->
¡©
.
video_ÿche
.
du¿tiÚ
;

4403 
FFP_PROP_INT64_AUDIO_CACHED_DURATION
:

4404 ià(!
få
)

4405  
deçuÉ_v®ue
;

4406  
få
->
¡©
.
audio_ÿche
.
du¿tiÚ
;

4407 
FFP_PROP_INT64_VIDEO_CACHED_BYTES
:

4408 ià(!
få
)

4409  
deçuÉ_v®ue
;

4410  
få
->
¡©
.
video_ÿche
.
by‹s
;

4411 
FFP_PROP_INT64_AUDIO_CACHED_BYTES
:

4412 ià(!
få
)

4413  
deçuÉ_v®ue
;

4414  
få
->
¡©
.
audio_ÿche
.
by‹s
;

4415 
FFP_PROP_INT64_VIDEO_CACHED_PACKETS
:

4416 ià(!
få
)

4417  
deçuÉ_v®ue
;

4418  
få
->
¡©
.
video_ÿche
.
·ck‘s
;

4419 
FFP_PROP_INT64_AUDIO_CACHED_PACKETS
:

4420 ià(!
få
)

4421  
deçuÉ_v®ue
;

4422  
få
->
¡©
.
audio_ÿche
.
·ck‘s
;

4423 
FFP_PROP_INT64_BIT_RATE
:

4424  
få
 ? få->
¡©
.
b™_¿‹
 : 
deçuÉ_v®ue
;

4425 
FFP_PROP_INT64_TCP_SPEED
:

4426  
få
 ? 
	`SDL_S³edSam¶”2G‘S³ed
(&få->
¡©
.
tı_»ad_§m¶”
è: 
deçuÉ_v®ue
;

4427 
FFP_PROP_INT64_ASYNC_STATISTIC_BUF_BACKWARDS
:

4428 ià(!
få
)

4429  
deçuÉ_v®ue
;

4430  
få
->
¡©
.
buf_backw¬ds
;

4431 
FFP_PROP_INT64_ASYNC_STATISTIC_BUF_FORWARDS
:

4432 ià(!
få
)

4433  
deçuÉ_v®ue
;

4434  
få
->
¡©
.
buf_fÜw¬ds
;

4435 
FFP_PROP_INT64_ASYNC_STATISTIC_BUF_CAPACITY
:

4436 ià(!
få
)

4437  
deçuÉ_v®ue
;

4438  
få
->
¡©
.
buf_ÿ·c™y
;

4439 
FFP_PROP_INT64_LATEST_SEEK_LOAD_DURATION
:

4440  
få
 ? få->
¡©
.
Ï‹¡_£ek_lßd_du¿tiÚ
 : 
deçuÉ_v®ue
;

4441 
FFP_PROP_INT64_TRAFFIC_STATISTIC_BYTE_COUNT
:

4442  
få
 ? få->
¡©
.
by‹_couÁ
 : 
deçuÉ_v®ue
;

4443 
FFP_PROP_INT64_CACHE_STATISTIC_PHYSICAL_POS
:

4444 ià(!
få
)

4445  
deçuÉ_v®ue
;

4446  
få
->
¡©
.
ÿche_physiÿl_pos
;

4447 
FFP_PROP_INT64_CACHE_STATISTIC_BUF_FORWARDS
:

4448 ià(!
få
)

4449  
deçuÉ_v®ue
;

4450  
få
->
¡©
.
ÿche_buf_fÜw¬ds
;

4452 
FFP_PROP_INT64_CACHE_STATISTIC_FILE_POS
:

4453 ià(!
få
)

4454  
deçuÉ_v®ue
;

4455  
få
->
¡©
.
ÿche_fe_pos
;

4456 
FFP_PROP_INT64_CACHE_STATISTIC_COUNT_BYTES
:

4457 ià(!
få
)

4458  
deçuÉ_v®ue
;

4459  
få
->
¡©
.
ÿche_couÁ_by‹s
;

4461  
deçuÉ_v®ue
;

4463 
	}
}

4465 
	$få_£t_´İ”ty_št64
(
FFPÏy”
 *
få
, 
id
, 
št64_t
 
v®ue
)

4467 
id
) {

4473 
	}
}

4475 
IjkMedŸM‘a
 *
	$få_g‘_m‘a_l
(
FFPÏy”
 *
få
)

4477 ià(!
få
)

4478  
NULL
;

4480  
få
->
m‘a
;

4481 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffplay.h

25 #iâdeà
FFPLAY__FF_FFPLAY_H


26 
	#FFPLAY__FF_FFPLAY_H


	)

28 
	~"ff_fåÏy_def.h
"

29 
	~"ff_fã¼Ü.h
"

30 
	~"ff_ffmsg.h
"

32 
få_glob®_š™
();

33 
få_glob®_unš™
();

34 
få_glob®_£t_log_»pÜt
(
u£_»pÜt
);

35 
få_glob®_£t_log_Ëv–
(
log_Ëv–
);

36 
få_glob®_£t_šjeù_ÿÎback
(
ijk_šjeù_ÿÎback
 
cb
);

37 
få_io_¡©_»gi¡”
((*
cb
)(cÚ¡ *
u¾
, 
ty³
, 
by‹s
));

38 
	`få_io_¡©_com¶‘e_»gi¡”
((*
cb
)(cÚ¡ *
u¾
,

39 
št64_t
 
»ad_by‹s
, iÁ64_ˆ
tÙ®_size
,

40 
št64_t
 
–·£d_time
, iÁ64_ˆ
tÙ®_du¿tiÚ
));

42 
FFPÏy”
 *
	`få_ü—‹
();

43 
	`få_de¡roy
(
FFPÏy”
 *
få
);

44 
	`få_de¡roy_p
(
FFPÏy”
 **
pfå
);

45 
	`få_»£t
(
FFPÏy”
 *
få
);

49 *
	`få_£t_šjeù_İaque
(
FFPÏy”
 *
få
, *
İaque
);

50 *
	`få_£t_ijkio_šjeù_İaque
(
FFPÏy”
 *
få
, *
İaque
);

51 
	`få_£t_İtiÚ
(
FFPÏy”
 *
få
, 
İt_ÿ‹gÜy
, cÚ¡ *
Çme
, cÚ¡ *
v®ue
);

52 
	`få_£t_İtiÚ_št
(
FFPÏy”
 *
få
, 
İt_ÿ‹gÜy
, cÚ¡ *
Çme
, 
št64_t
 
v®ue
);

54 
	`få_g‘_video_codec_šfo
(
FFPÏy”
 *
få
, **
codec_šfo
);

55 
	`få_g‘_audio_codec_šfo
(
FFPÏy”
 *
få
, **
codec_šfo
);

58 
	`få_´•¬e_async_l
(
FFPÏy”
 *
få
, cÚ¡ *
fe_Çme
);

59 
	`få_¡¬t_äom_l
(
FFPÏy”
 *
få
, 
m£c
);

60 
	`få_¡¬t_l
(
FFPÏy”
 *
få
);

61 
	`få_·u£_l
(
FFPÏy”
 *
få
);

62 
	`få_is_·u£d_l
(
FFPÏy”
 *
få
);

63 
	`få_¡İ_l
(
FFPÏy”
 *
få
);

64 
	`få_wa™_¡İ_l
(
FFPÏy”
 *
få
);

67 
	`få_£ek_to_l
(
FFPÏy”
 *
få
, 
m£c
);

68 
	`få_g‘_cu¼’t_pos™iÚ_l
(
FFPÏy”
 *
få
);

69 
	`få_g‘_du¿tiÚ_l
(
FFPÏy”
 *
få
);

70 
	`få_g‘_¶ayabË_du¿tiÚ_l
(
FFPÏy”
 *
få
);

71 
	`få_£t_loİ
(
FFPÏy”
 *
få
, 
loİ
);

72 
	`få_g‘_loİ
(
FFPÏy”
 *
få
);

75 
	`få_·ck‘_queue_š™
(
Pack‘Queue
 *
q
);

76 
	`få_·ck‘_queue_de¡roy
(
Pack‘Queue
 *
q
);

77 
	`få_·ck‘_queue_abÜt
(
Pack‘Queue
 *
q
);

78 
	`få_·ck‘_queue_¡¬t
(
Pack‘Queue
 *
q
);

79 
	`få_·ck‘_queue_æush
(
Pack‘Queue
 *
q
);

80 
	`få_·ck‘_queue_g‘
(
Pack‘Queue
 *
q
, 
AVPack‘
 *
pkt
, 
block
, *
£rŸl
);

81 
	`få_·ck‘_queue_g‘_Ü_bufãršg
(
FFPÏy”
 *
få
, 
Pack‘Queue
 *
q
, 
AVPack‘
 *
pkt
, *
£rŸl
, *
fšished
);

82 
	`få_·ck‘_queue_put
(
Pack‘Queue
 *
q
, 
AVPack‘
 *
pkt
);

83 
boŞ
 
	`få_is_æush_·ck‘
(
AVPack‘
 *
pkt
);

85 
F¿me
 *
	`få_äame_queue_³ek_wr™abË
(
F¿meQueue
 *
f
);

86 
	`få_äame_queue_push
(
F¿meQueue
 *
f
);

88 
	`få_queue_piùu»
(
FFPÏy”
 *
få
, 
AVF¿me
 *
¤c_äame
, 
±s
, 
du¿tiÚ
, 
št64_t
 
pos
, 
£rŸl
);

90 
	`få_g‘_ma¡”_sync_ty³
(
VideoS‹
 *
is
);

91 
	`få_g‘_ma¡”_şock
(
VideoS‹
 *
is
);

93 
	`få_toggË_bufãršg_l
(
FFPÏy”
 *
få
, 
¡¬t_bufãršg
);

94 
	`få_toggË_bufãršg
(
FFPÏy”
 *
få
, 
¡¬t_bufãršg
);

95 
	`få_check_bufãršg_l
(
FFPÏy”
 *
få
);

96 
	`få_Œack_¡©i¡ic_l
(
FFPÏy”
 *
få
, 
AVSŒ—m
 *
¡
, 
Pack‘Queue
 *
q
, 
FFT¿ckCacheSti¡ic
 *
ÿche
);

97 
	`få_audio_¡©i¡ic_l
(
FFPÏy”
 *
få
);

98 
	`få_video_¡©i¡ic_l
(
FFPÏy”
 *
få
);

99 
	`få_¡©i¡ic_l
(
FFPÏy”
 *
få
);

101 
	`få_video_th»ad
(
FFPÏy”
 *
få
);

103 
	`få_£t_video_codec_šfo
(
FFPÏy”
 *
få
, cÚ¡ *
moduË
, cÚ¡ *
codec
);

104 
	`få_£t_audio_codec_šfo
(
FFPÏy”
 *
få
, cÚ¡ *
moduË
, cÚ¡ *
codec
);

105 
	`få_£t_subt™Ë_codec_šfo
(
FFPÏy”
 *
få
, cÚ¡ *
moduË
, cÚ¡ *
codec
);

107 
	`få_£t_¶ayback_¿‹
(
FFPÏy”
 *
få
, 
¿‹
);

108 
	`få_£t_¶ayback_vŞume
(
FFPÏy”
 *
få
, 
vŞume
);

109 
	`få_g‘_video_rÙ©e_deg»es
(
FFPÏy”
 *
få
);

110 
	`få_£t_¡»am_£Ëùed
(
FFPÏy”
 *
få
, 
¡»am
, 
£Ëùed
);

112 
	`få_g‘_´İ”ty_æßt
(
FFPÏy”
 *
få
, 
id
, 
deçuÉ_v®ue
);

113 
	`få_£t_´İ”ty_æßt
(
FFPÏy”
 *
få
, 
id
, 
v®ue
);

114 
št64_t
 
	`få_g‘_´İ”ty_št64
(
FFPÏy”
 *
få
, 
id
, iÁ64_ˆ
deçuÉ_v®ue
);

115 
	`få_£t_´İ”ty_št64
(
FFPÏy”
 *
få
, 
id
, 
št64_t
 
v®ue
);

118 
IjkMedŸM‘a
 *
	`få_g‘_m‘a_l
(
FFPÏy”
 *
få
);

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffplay_debug.h

24 #iâdeà
FFPLAY__FF_FFPLAY_DEBUG_H


25 
	#FFPLAY__FF_FFPLAY_DEBUG_H


	)

27 
	#FFP_XPS_PERIOD
 (3)

	)

29 
	#FFP_SHOW_VPS_DPS
 (0)

	)

30 
	#FFP_SHOW_VFPS_FFPLAY
 (
FFP_SHOW_VPS_DPS
)

	)

31 
	#FFP_SHOW_VDPS_AVCODEC
 (
FFP_SHOW_VPS_DPS
)

	)

32 
	#FFP_SHOW_VDPS_VIDEOTOOLBOX
 (
FFP_SHOW_VPS_DPS
)

	)

33 
	#FFP_SHOW_VDPS_MEDIACODEC
 (
FFP_SHOW_VPS_DPS
)

	)

51 
	#PKT_CACHED_DURATION


	)

52 
	#START_READ_FRAME_TIME


	)

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffplay_def.h

23 #iâdeà
FFPLAY__FF_FFPLAY_DEF_H


24 
	#FFPLAY__FF_FFPLAY_DEF_H


	)

31 
	~"cÚfig.h
"

32 
	~<š‰y³s.h
>

33 
	~<m©h.h
>

34 
	~<lim™s.h
>

35 
	~<sigÇl.h
>

36 
	~<¡dšt.h
>

38 
	~"libavut/av¡ršg.h
"

39 
	~"libavut/ev®.h
"

40 
	~"libavut/m©hem©ics.h
"

41 
	~"libavut/pixdesc.h
"

42 
	~"libavut/imguts.h
"

43 
	~"libavut/diù.h
"

44 
	~"libavut/·r£uts.h
"

45 
	~"libavut/§m¶efmt.h
"

46 
	~"libavut/avas£¹.h
"

47 
	~"libavut/time.h
"

48 
	~"libavfÜm©/avfÜm©.h
"

50 
	~"libswsÿË/swsÿË.h
"

51 
	~"libavut/İt.h
"

52 
	~"libavcodec/avfá.h
"

53 
	~"libsw»§m¶e/sw»§m¶e.h
"

55 #ià
CONFIG_AVFILTER


56 
	~"libavf‹r/avf‹r.h
"

57 
	~"libavf‹r/bufãrsšk.h
"

58 
	~"libavf‹r/bufãr¤c.h
"

61 
	~<¡dboŞ.h
>

62 
	~"ijkavfÜm©/ijkiomªag”.h
"

63 
	~"ijkavfÜm©/ijkißµliÿtiÚ.h
"

64 
	~"ff_ffšc.h
"

65 
	~"ff_ffmsg_queue.h
"

66 
	~"ff_få’ode.h
"

67 
	~"ijkm‘a.h
"

70 
	~"ff_fåÏy_debug.h
"

72 
	#DEFAULT_HIGH_WATER_MARK_IN_BYTES
 (256 * 1024)

	)

79 
	#DEFAULT_FIRST_HIGH_WATER_MARK_IN_MS
 (100)

	)

80 
	#DEFAULT_NEXT_HIGH_WATER_MARK_IN_MS
 (1 * 1000)

	)

81 
	#DEFAULT_LAST_HIGH_WATER_MARK_IN_MS
 (2 * 1000)

	)

83 
	#BUFFERING_CHECK_PER_BYTES
 (512)

	)

84 
	#BUFFERING_CHECK_PER_MILLISECONDS
 (500)

	)

86 
	#MAX_QUEUE_SIZE
 (15 * 1024 * 1024)

	)

87 #ifdeà
FFP_MERGE


88 
	#MIN_FRAMES
 25

	)

90 
	#DEFAULT_MIN_FRAMES
 50000

	)

91 
	#MIN_MIN_FRAMES
 5

	)

92 
	#MAX_MIN_FRAMES
 50000

	)

93 
	#MIN_FRAMES
 (
få
->
dcc
.
mš_äames
)

	)

94 
	#EXTERNAL_CLOCK_MIN_FRAMES
 2

	)

95 
	#EXTERNAL_CLOCK_MAX_FRAMES
 10

	)

98 
	#SDL_AUDIO_MIN_BUFFER_SIZE
 512

	)

100 
	#SDL_AUDIO_MAX_CALLBACKS_PER_SEC
 30

	)

103 
	#SDL_VOLUME_STEP
 (
SDL_MIX_MAXVOLUME
 / 50)

	)

106 
	#AV_SYNC_THRESHOLD_MIN
 0.04

	)

108 
	#AV_SYNC_THRESHOLD_MAX
 0.1

	)

110 
	#AV_SYNC_FRAMEDUP_THRESHOLD
 0.15

	)

112 
	#AV_NOSYNC_THRESHOLD
 100.0

	)

115 
	#SAMPLE_CORRECTION_PERCENT_MAX
 10

	)

118 
	#EXTERNAL_CLOCK_SPEED_MIN
 0.900

	)

119 
	#EXTERNAL_CLOCK_SPEED_MAX
 1.010

	)

120 
	#EXTERNAL_CLOCK_SPEED_STEP
 0.001

	)

123 
	#AUDIO_DIFF_AVG_NB
 20

	)

126 
	#REFRESH_RATE
 0.01

	)

130 
	#SAMPLE_ARRAY_SIZE
 (8 * 65536)

	)

132 
	#MIN_PKT_DURATION
 15

	)

134 #ifdeà
FFP_MERGE


135 
	#CURSOR_HIDE_DELAY
 1000000

	)

137 
	#USE_ONEPASS_SUBTITLE_RENDER
 1

	)

139 
	gsws_æags
 = 
SWS_BICUBIC
;

142 
	sMyAVPack‘Li¡
 {

143 
AVPack‘
 
	mpkt
;

144 
MyAVPack‘Li¡
 *
	mÃxt
;

145 
	m£rŸl
;

146 } 
	tMyAVPack‘Li¡
;

148 
	sPack‘Queue
 {

149 
MyAVPack‘Li¡
 *
	mfœ¡_pkt
, *
	mÏ¡_pkt
;

150 
	mnb_·ck‘s
;

151 
	msize
;

152 
št64_t
 
	mdu¿tiÚ
;

153 
	mabÜt_»que¡
;

154 
	m£rŸl
;

155 
SDL_mu‹x
 *
	mmu‹x
;

156 
SDL_cÚd
 *
	mcÚd
;

157 
MyAVPack‘Li¡
 *
	m»cyşe_pkt
;

158 
	m»cyşe_couÁ
;

159 
	m®loc_couÁ
;

161 
	mis_bufãr_šdiÿtÜ
;

162 } 
	tPack‘Queue
;

165 
	#VIDEO_PICTURE_QUEUE_SIZE_MIN
 (2)

	)

166 
	#VIDEO_PICTURE_QUEUE_SIZE_MAX
 (16)

	)

167 
	#VIDEO_PICTURE_QUEUE_SIZE_DEFAULT
 (
VIDEO_PICTURE_QUEUE_SIZE_MIN
)

	)

168 
	#SUBPICTURE_QUEUE_SIZE
 16

	)

169 
	#SAMPLE_QUEUE_SIZE
 9

	)

170 
	#FRAME_QUEUE_SIZE
 
	`FFMAX
(
SAMPLE_QUEUE_SIZE
, FFMAX(
VIDEO_PICTURE_QUEUE_SIZE_MAX
, 
SUBPICTURE_QUEUE_SIZE
))

	)

172 
	#VIDEO_MAX_FPS_DEFAULT
 30

	)

175 
	#MIN_CACHED_DURATION
 1500

	)

176 
	#DEFAULT_CACHED_DURATION
 5000

	)

177 
	#MAX_CACHED_DURATION
 8000

	)

179 
	#REDUCE_CACHED_DURATION_INTERVAL
 10

	)

181 
	#REDUCE_CACHED_DURATION_SIZE
 100

	)

183 
	sAudioP¬ams
 {

184 
	mäeq
;

185 
	mchªÃls
;

186 
št64_t
 
	mchªÃl_Ïyout
;

187 
AVSam¶eFÜm©
 
	mfmt
;

188 
	mäame_size
;

189 
	mby‹s_³r_£c
;

190 } 
	tAudioP¬ams
;

192 
	sClock
 {

193 
	m±s
;

194 
	m±s_driá
;

195 
	mÏ¡_upd©ed
;

196 
	m¥“d
;

197 
	m£rŸl
;

198 
	m·u£d
;

199 *
	mqueue_£rŸl
;

200 } 
	tClock
;

203 
	sF¿me
 {

204 
AVF¿me
 *
	mäame
;

205 
AVSubt™Ë
 
	msub
;

206 
	m£rŸl
;

207 
	m±s
;

208 
	mdu¿tiÚ
;

209 
št64_t
 
	mpos
;

210 #ifdeà
FFP_MERGE


211 
SDL_Textu»
 *
	mbmp
;

213 
SDL_VoutOv”Ïy
 *
	mbmp
;

215 
	m®loÿ‹d
;

216 
	mwidth
;

217 
	mheight
;

218 
	mfÜm©
;

219 
AVR©iÚ®
 
	m§r
;

220 
	mu¶ßded
;

221 } 
	tF¿me
;

223 
	sF¿meQueue
 {

224 
F¿me
 
	mqueue
[
FRAME_QUEUE_SIZE
];

225 
	mršdex
;

226 
	mwšdex
;

227 
	msize
;

228 
	mmax_size
;

229 
	mk“p_Ï¡
;

230 
	mršdex_shown
;

231 
SDL_mu‹x
 *
	mmu‹x
;

232 
SDL_cÚd
 *
	mcÚd
;

233 
Pack‘Queue
 *
	mpktq
;

234 } 
	tF¿meQueue
;

237 
	mAV_SYNC_AUDIO_MASTER
,

238 
	mAV_SYNC_VIDEO_MASTER
,

239 
	mAV_SYNC_EXTERNAL_CLOCK
,

242 
	sDecod”
 {

243 
AVPack‘
 
	mpkt
;

244 
AVPack‘
 
	mpkt_‹mp
;

245 
Pack‘Queue
 *
	mqueue
;

246 
AVCodecCÚ‹xt
 *
	mavùx
;

247 
	mpkt_£rŸl
;

248 
	mfšished
;

249 
	m·ck‘_³ndšg
;

250 
	mbfsc_»t
;

251 
ušt8_t
 *
	mbfsc_d©a
;

253 
SDL_cÚd
 *
	mem±y_queue_cÚd
;

254 
št64_t
 
	m¡¬t_±s
;

255 
AVR©iÚ®
 
	m¡¬t_±s_tb
;

256 
št64_t
 
	mÃxt_±s
;

257 
AVR©iÚ®
 
	mÃxt_±s_tb
;

258 
SDL_Th»ad
 *
	mdecod”_tid
;

259 
SDL_Th»ad
 
	m_decod”_tid
;

261 
SDL_Prof”
 
	mdecode_´of”
;

262 
Ušt64
 
	mfœ¡_äame_decoded_time
;

263 
	mfœ¡_äame_decoded
;

264 } 
	tDecod”
;

266 
	sVideoS‹
 {

267 
SDL_Th»ad
 *
	m»ad_tid
;

268 
SDL_Th»ad
 
	m_»ad_tid
;

269 
AVIÅutFÜm©
 *
	mifÜm©
;

270 
	mabÜt_»que¡
;

271 
	mfÜû_»äesh
;

272 
	m·u£d
;

273 
	mÏ¡_·u£d
;

274 
	mqueue_©chm’ts_»q
;

275 
	m£ek_»q
;

276 
	m£ek_æags
;

277 
št64_t
 
	m£ek_pos
;

278 
št64_t
 
	m£ek_»l
;

279 #ifdeà
FFP_MERGE


280 
	m»ad_·u£_»tuº
;

282 
AVFÜm©CÚ‹xt
 *
	mic
;

283 
	m»®time
;

285 
Clock
 
	maudşk
;

286 
Clock
 
	mvidşk
;

287 
Clock
 
	mextşk
;

289 
F¿meQueue
 
	mpiùq
;

290 
F¿meQueue
 
	msubpq
;

291 
F¿meQueue
 
	m§mpq
;

293 
Decod”
 
	mauddec
;

294 
Decod”
 
	mviddec
;

295 
Decod”
 
	msubdec
;

297 
	maudio_¡»am
;

299 
	mav_sync_ty³
;

301 
	maudio_şock
;

302 
	maudio_şock_£rŸl
;

303 
	maudio_diff_cum
;

304 
	maudio_diff_avg_cÛf
;

305 
	maudio_diff_th»shŞd
;

306 
	maudio_diff_avg_couÁ
;

307 
AVSŒ—m
 *
	maudio_¡
;

308 
Pack‘Queue
 
	maudioq
;

309 
	maudio_hw_buf_size
;

310 
ušt8_t
 *
	maudio_buf
;

311 
ušt8_t
 *
	maudio_buf1
;

312 
	maudio_buf_size
;

313 
	maudio_buf1_size
;

314 
	maudio_buf_šdex
;

315 
	maudio_wr™e_buf_size
;

316 
	maudio_vŞume
;

317 
	mmu‹d
;

318 
AudioP¬ams
 
	maudio_¤c
;

319 #ià
CONFIG_AVFILTER


320 
AudioP¬ams
 
	maudio_f‹r_¤c
;

322 
AudioP¬ams
 
	maudio_tgt
;

323 
SwrCÚ‹xt
 *
	mswr_ùx
;

324 
	mäame_drİs_—¾y
;

325 
	mäame_drİs_Ï‹
;

326 
	mcÚtšuous_äame_drİs_—¾y
;

328 
	eShowMode
 {

329 
	mSHOW_MODE_NONE
 = -1, 
	mSHOW_MODE_VIDEO
 = 0, 
	mSHOW_MODE_WAVES
, 
	mSHOW_MODE_RDFT
, 
	mSHOW_MODE_NB


330 } 
	mshow_mode
;

331 
št16_t
 
	m§m¶e_¬¿y
[
SAMPLE_ARRAY_SIZE
];

332 
	m§m¶e_¬¿y_šdex
;

333 
	mÏ¡_i_¡¬t
;

334 #ifdeà
FFP_MERGE


335 
RDFTCÚ‹xt
 *
	mrdá
;

336 
	mrdá_b™s
;

337 
FFTSam¶e
 *
	mrdá_d©a
;

338 
	mxpos
;

340 
	mÏ¡_vis_time
;

341 #ifdeà
FFP_MERGE


342 
SDL_Textu»
 *
	mvis_‹xtu»
;

343 
SDL_Textu»
 *
	msub_‹xtu»
;

346 
	msubt™Ë_¡»am
;

347 
AVSŒ—m
 *
	msubt™Ë_¡
;

348 
Pack‘Queue
 
	msubt™Ëq
;

350 
	mäame_tim”
;

351 
	mäame_Ï¡_»tuºed_time
;

352 
	mäame_Ï¡_f‹r_d–ay
;

353 
	mvideo_¡»am
;

354 
AVSŒ—m
 *
	mvideo_¡
;

355 
Pack‘Queue
 
	mvideoq
;

356 
	mmax_äame_du¿tiÚ
;

357 
SwsCÚ‹xt
 *
	mimg_cÚv”t_ùx
;

358 #ifdeà
FFP_SUB


359 
SwsCÚ‹xt
 *
	msub_cÚv”t_ùx
;

361 
	meof
;

363 *
	mf’ame
;

364 
	mwidth
, 
	mheight
, 
	mxËá
, 
	mytİ
;

365 
	m¡•
;

367 #ià
CONFIG_AVFILTER


368 
	mvf‹r_idx
;

369 
AVF‹rCÚ‹xt
 *
	mš_video_f‹r
;

370 
AVF‹rCÚ‹xt
 *
	mout_video_f‹r
;

371 
AVF‹rCÚ‹xt
 *
	mš_audio_f‹r
;

372 
AVF‹rCÚ‹xt
 *
	mout_audio_f‹r
;

373 
AVF‹rG¿ph
 *
	mag¿ph
;

376 
	mÏ¡_video_¡»am
, 
	mÏ¡_audio_¡»am
, 
	mÏ¡_subt™Ë_¡»am
;

378 
SDL_cÚd
 *
	mcÚtšue_»ad_th»ad
;

381 
SDL_mu‹x
 *
	m¶ay_mu‹x
;

382 
SDL_Th»ad
 *
	mvideo_»äesh_tid
;

383 
SDL_Th»ad
 
	m_video_»äesh_tid
;

385 
	mbufãršg_Ú
;

386 
	m·u£_»q
;

388 
	mdrİpšg_äame
;

389 
	mis_video_high_ås
;

390 
	mis_video_high_»s
;

392 
Pack‘Queue
 *
	mbufãr_šdiÿtÜ_queue
;

394 vŞ©
	mÏ‹¡_£ek_lßd_£rŸl
;

395 vŞ©
št64_t
 
	mÏ‹¡_£ek_lßd_¡¬t_©
;

400 #ifdeà
PKT_CACHED_DURATION


401 
	mpkt_ÿched_du¿tiÚ
;

402 
št64_t
 
	mcut_ÿched_du¿tiÚ_ba£
;

406 #ifdeà
START_READ_FRAME_TIME


407 
št64_t
 
	m¡¬t_»ad_äame_time
;

408 
št64_t
 
	mÏ¡_¡¬t_»ad_äame_time
;

411 } 
	tVideoS‹
;

414 #ifdeà
FFP_MERGE


415 
AVIÅutFÜm©
 *
	gfe_ifÜm©
;

416 cÚ¡ *
	gšput_f’ame
;

417 cÚ¡ *
	gwšdow_t™Ë
;

418 
	gdeçuÉ_width
 = 640;

419 
	gdeçuÉ_height
 = 480;

420 
	gsü“n_width
 = 0;

421 
	gsü“n_height
 = 0;

422 
	gaudio_di§bË
;

423 
	gvideo_di§bË
;

424 
	gsubt™Ë_di§bË
;

425 cÚ¡ * 
	gwª‹d_¡»am_¥ec
[
AVMEDIA_TYPE_NB
] = {0};

426 
	g£ek_by_by‹s
 = -1;

427 
	gdi¥Ïy_di§bË
;

428 
	gshow_¡©us
 = 1;

429 
	gav_sync_ty³
 = 
AV_SYNC_AUDIO_MASTER
;

430 
št64_t
 
	g¡¬t_time
 = 
AV_NOPTS_VALUE
;

431 
št64_t
 
	gdu¿tiÚ
 = 
AV_NOPTS_VALUE
;

432 
	gç¡
 = 0;

433 
	gg’±s
 = 0;

434 
	glow»s
 = 0;

435 
	gdecod”_»Üd”_±s
 = -1;

436 
	gautÛx™
;

437 
	gex™_Ú_keydown
;

438 
	gex™_Ú_mou£down
;

439 
	gloİ
 = 1;

440 
	gäamedrİ
 = -1;

441 
	gšfš™e_bufãr
 = -1;

442 
ShowMode
 
	gshow_mode
 = 
SHOW_MODE_NONE
;

443 cÚ¡ *
	gaudio_codec_Çme
;

444 cÚ¡ *
	gsubt™Ë_codec_Çme
;

445 cÚ¡ *
	gvideo_codec_Çme
;

446 
	grdá¥“d
 = 0.02;

447 
št64_t
 
	gcursÜ_Ï¡_shown
;

448 
	gcursÜ_hidd’
 = 0;

449 #ià
CONFIG_AVFILTER


450 cÚ¡ **
	gvf‹rs_li¡
 = 
NULL
;

451 
	gnb_vf‹rs
 = 0;

452 *
	gaf‹rs
 = 
NULL
;

454 
	gautÜÙ©e
 = 1;

457 
	gis_fuÎ_sü“n
;

458 
št64_t
 
	gaudio_ÿÎback_time
;

460 
AVPack‘
 
	gæush_pkt
;

461 
AVPack‘
 
	geof_pkt
;

463 
	#FF_ALLOC_EVENT
 (
SDL_USEREVENT
)

	)

464 
	#FF_QUIT_EVENT
 (
SDL_USEREVENT
 + 2)

	)

466 
SDL_Wšdow
 *
	gwšdow
;

467 
SDL_R’d””
 *
	g»nd””
;

474 
	sFFT¿ckCacheSti¡ic


476 
št64_t
 
	mdu¿tiÚ
;

477 
št64_t
 
	mby‹s
;

478 
št64_t
 
	m·ck‘s
;

479 } 
	tFFT¿ckCacheSti¡ic
;

481 
	sFFSti¡ic


483 
št64_t
 
	mvdec_ty³
;

485 
	mvås
;

486 
	mvdps
;

487 
	mavd–ay
;

488 
	mavdiff
;

489 
št64_t
 
	mb™_¿‹
;

491 
FFT¿ckCacheSti¡ic
 
	mvideo_ÿche
;

492 
FFT¿ckCacheSti¡ic
 
	maudio_ÿche
;

494 
št64_t
 
	mbuf_backw¬ds
;

495 
št64_t
 
	mbuf_fÜw¬ds
;

496 
št64_t
 
	mbuf_ÿ·c™y
;

497 
SDL_S³edSam¶”2
 
	mtı_»ad_§m¶”
;

498 
št64_t
 
	mÏ‹¡_£ek_lßd_du¿tiÚ
;

499 
št64_t
 
	mby‹_couÁ
;

500 
št64_t
 
	mÿche_physiÿl_pos
;

501 
št64_t
 
	mÿche_buf_fÜw¬ds
;

502 
št64_t
 
	mÿche_fe_pos
;

503 
št64_t
 
	mÿche_couÁ_by‹s
;

504 } 
	tFFSti¡ic
;

506 
	#FFP_TCP_READ_SAMPLE_RANGE
 2000

	)

507 
šlše
 
	$få_»£t_¡©i¡ic
(
FFSti¡ic
 *
dcc
)

509 
	`mem£t
(
dcc
, 0, (
FFSti¡ic
));

510 
	`SDL_S³edSam¶”2Re£t
(&
dcc
->
tı_»ad_§m¶”
, 
FFP_TCP_READ_SAMPLE_RANGE
);

511 
	}
}

513 
	sFFDemuxCacheCÚŒŞ


515 
	mmš_äames
;

516 
	mmax_bufãr_size
;

517 
	mhigh_w©”_m¬k_š_by‹s
;

519 
	mfœ¡_high_w©”_m¬k_š_ms
;

520 
	mÃxt_high_w©”_m¬k_š_ms
;

521 
	mÏ¡_high_w©”_m¬k_š_ms
;

522 
	mcu¼’t_high_w©”_m¬k_š_ms
;

523 } 
	tFFDemuxCacheCÚŒŞ
;

525 
šlše
 
	$få_»£t_demux_ÿche_cÚŒŞ
(
FFDemuxCacheCÚŒŞ
 *
dcc
)

527 
dcc
->
mš_äames
 = 
DEFAULT_MIN_FRAMES
;

528 
dcc
->
max_bufãr_size
 = 
MAX_QUEUE_SIZE
;

529 
dcc
->
high_w©”_m¬k_š_by‹s
 = 
DEFAULT_HIGH_WATER_MARK_IN_BYTES
;

531 
dcc
->
fœ¡_high_w©”_m¬k_š_ms
 = 
DEFAULT_FIRST_HIGH_WATER_MARK_IN_MS
;

532 
dcc
->
Ãxt_high_w©”_m¬k_š_ms
 = 
DEFAULT_NEXT_HIGH_WATER_MARK_IN_MS
;

533 
dcc
->
Ï¡_high_w©”_m¬k_š_ms
 = 
DEFAULT_LAST_HIGH_WATER_MARK_IN_MS
;

534 
dcc
->
cu¼’t_high_w©”_m¬k_š_ms
 = 
DEFAULT_FIRST_HIGH_WATER_MARK_IN_MS
;

535 
	}
}

538 
	gIjkMedŸM‘a
;

539 
	gIJKFF_P–še
;

540 
	sFFPÏy”
 {

541 cÚ¡ 
AVCÏss
 *
	mav_şass
;

544 
VideoS‹
 *
	mis
;

547 
AVDiùiÚ¬y
 *
	mfÜm©_İts
;

548 
AVDiùiÚ¬y
 *
	mcodec_İts
;

549 
AVDiùiÚ¬y
 *
	msws_diù
;

550 
AVDiùiÚ¬y
 *
	m¶ay”_İts
;

551 
AVDiùiÚ¬y
 *
	mswr_İts
;

552 
AVDiùiÚ¬y
 *
	mswr_´e£t_İts
;

555 #ifdeà
FFP_MERGE


556 
AVIÅutFÜm©
 *
	mfe_ifÜm©
;

558 *
	mšput_f’ame
;

559 #ifdeà
FFP_MERGE


560 cÚ¡ *
	mwšdow_t™Ë
;

561 
	mfs_sü“n_width
;

562 
	mfs_sü“n_height
;

563 
	mdeçuÉ_width
;

564 
	mdeçuÉ_height
;

565 
	msü“n_width
;

566 
	msü“n_height
;

568 
	maudio_di§bË
;

569 
	mvideo_di§bË
;

570 
	msubt™Ë_di§bË
;

571 cÚ¡ * 
	mwª‹d_¡»am_¥ec
[
AVMEDIA_TYPE_NB
];

572 
	m£ek_by_by‹s
;

573 
	mdi¥Ïy_di§bË
;

574 
	mshow_¡©us
;

575 
	mav_sync_ty³
;

576 
št64_t
 
	m¡¬t_time
;

577 
št64_t
 
	mdu¿tiÚ
;

578 
	mç¡
;

579 
	mg’±s
;

580 
	mlow»s
;

581 
	mdecod”_»Üd”_±s
;

582 
	mautÛx™
;

583 #ifdeà
FFP_MERGE


584 
	mex™_Ú_keydown
;

585 
	mex™_Ú_mou£down
;

587 
	mloİ
;

588 
	mäamedrİ
;

589 
št64_t
 
	m£ek_©_¡¬t
;

590 
	msubt™Ë
;

591 
	mšfš™e_bufãr
;

592 
ShowMode
 
	mshow_mode
;

593 *
	maudio_codec_Çme
;

594 *
	msubt™Ë_codec_Çme
;

595 *
	mvideo_codec_Çme
;

596 
	mrdá¥“d
;

597 #ifdeà
FFP_MERGE


598 
št64_t
 
	mcursÜ_Ï¡_shown
;

599 
	mcursÜ_hidd’
;

601 #ià
CONFIG_AVFILTER


602 cÚ¡ **
	mvf‹rs_li¡
;

603 
	mnb_vf‹rs
;

604 *
	maf‹rs
;

605 *
	mvf‹r0
;

607 
	mautÜÙ©e
;

609 
	msws_æags
;

612 #ifdeà
FFP_MERGE


613 
	mis_fuÎ_sü“n
;

615 
št64_t
 
	maudio_ÿÎback_time
;

616 #ifdeà
FFP_MERGE


617 
SDL_Surçû
 *
	msü“n
;

621 
SDL_Aout
 *
	maout
;

622 
SDL_Vout
 *
	mvout
;

623 
IJKFF_P–še
 *
	mp–še
;

624 
IJKFF_P’ode
 *
	mnode_vdec
;

625 
	m§r_num
;

626 
	m§r_d’
;

628 *
	mvideo_codec_šfo
;

629 *
	maudio_codec_šfo
;

630 *
	msubt™Ë_codec_šfo
;

631 
Ušt32
 
	mov”Ïy_fÜm©
;

633 
	mÏ¡_”rÜ
;

634 
	m´•¬ed
;

635 
	mauto_»sume
;

636 
	m”rÜ
;

637 
	m”rÜ_couÁ
;

638 
	m¡¬t_Ú_´•¬ed
;

639 
	mfœ¡_video_äame_»nd”ed
;

640 
	mfœ¡_audio_äame_»nd”ed
;

641 
	msync_av_¡¬t
;

643 
Mes§geQueue
 
	mmsg_queue
;

645 
št64_t
 
	m¶ayabË_du¿tiÚ_ms
;

647 
	m·ck‘_bufãršg
;

648 
	mpiùq_size
;

649 
	mmax_ås
;

651 
	mvideÙoŞbox
;

652 
	mvtb_max_äame_width
;

653 
	mvtb_async
;

654 
	mvtb_wa™_async
;

655 
	mvtb_hªdË_»sŞutiÚ_chªge
;

657 
	mmedŸcodec_®l_videos
;

658 
	mmedŸcodec_avc
;

659 
	mmedŸcodec_hevc
;

660 
	mmedŸcodec_m³g2
;

661 
	mmedŸcodec_m³g4
;

662 
	mmedŸcodec_hªdË_»sŞutiÚ_chªge
;

663 
	mmedŸcodec_auto_rÙ©e
;

665 
	mİ’¦es
;

667 *
	mifÜm©_Çme
;

669 
	mno_time_adju¡
;

670 
	m´e£t_5_1_ûÁ”_mix_Ëv–
;

672 
IjkMedŸM‘a
 *
	mm‘a
;

674 
SDL_S³edSam¶”
 
	mvås_§m¶”
;

675 
SDL_S³edSam¶”
 
	mvdps_§m¶”
;

678 
SDL_mu‹x
 *
	mvf_mu‹x
;

679 
SDL_mu‹x
 *
	maf_mu‹x
;

680 
	mvf_chªged
;

681 
	maf_chªged
;

682 
	mpf_¶ayback_¿‹
;

683 
	mpf_¶ayback_¿‹_chªged
;

684 
	mpf_¶ayback_vŞume
;

685 
	mpf_¶ayback_vŞume_chªged
;

687 *
	mšjeù_İaque
;

688 *
	mijkio_šjeù_İaque
;

689 
FFSti¡ic
 
	m¡©
;

690 
FFDemuxCacheCÚŒŞ
 
	mdcc
;

692 
AVAµliÿtiÚCÚ‹xt
 *
	m­p_ùx
;

693 
IjkIOMªag”CÚ‹xt
 *
	mijkio_mªag”_ùx
;

695 } 
	tFFPÏy”
;

697 
	#fáime_to_mli£cÚds
(
ts
è(
	`av_»sÿË
Ñs, 1000, 
AV_TIME_BASE
))

	)

698 
	#mli£cÚds_to_fáime
(
ms
è(
	`av_»sÿË
(ms, 
AV_TIME_BASE
, 1000))

	)

700 
šlše
 
	$få_»£t_š‹º®
(
FFPÏy”
 *
få
)

703 
	`av_İt_ä“
(
få
);

706 
	`av_diù_ä“
(&
få
->
fÜm©_İts
);

707 
	`av_diù_ä“
(&
få
->
codec_İts
);

708 
	`av_diù_ä“
(&
få
->
sws_diù
);

709 
	`av_diù_ä“
(&
få
->
¶ay”_İts
);

710 
	`av_diù_ä“
(&
få
->
swr_İts
);

711 
	`av_diù_ä“
(&
få
->
swr_´e£t_İts
);

714 
	`av_ä“p
(&
få
->
šput_f’ame
);

715 
få
->
audio_di§bË
 = 0;

716 
få
->
video_di§bË
 = 0;

717 
	`mem£t
(
få
->
wª‹d_¡»am_¥ec
, 0, (ffp->wanted_stream_spec));

718 
få
->
£ek_by_by‹s
 = -1;

719 
få
->
di¥Ïy_di§bË
 = 0;

720 
få
->
show_¡©us
 = 0;

721 
få
->
av_sync_ty³
 = 
AV_SYNC_AUDIO_MASTER
;

722 
få
->
¡¬t_time
 = 
AV_NOPTS_VALUE
;

723 
få
->
du¿tiÚ
 = 
AV_NOPTS_VALUE
;

724 
få
->
ç¡
 = 1;

725 
få
->
g’±s
 = 0;

726 
få
->
low»s
 = 0;

727 
få
->
decod”_»Üd”_±s
 = -1;

728 
få
->
autÛx™
 = 0;

729 
få
->
loİ
 = 1;

730 
få
->
äamedrİ
 = 0;

731 
få
->
£ek_©_¡¬t
 = 0;

732 
få
->
šfš™e_bufãr
 = -1;

733 
få
->
show_mode
 = 
SHOW_MODE_NONE
;

734 
	`av_ä“p
(&
få
->
audio_codec_Çme
);

735 
	`av_ä“p
(&
få
->
video_codec_Çme
);

736 
få
->
rdá¥“d
 = 0.02;

737 #ià
CONFIG_AVFILTER


738 
	`av_ä“p
(&
få
->
vf‹rs_li¡
);

739 
få
->
nb_vf‹rs
 = 0;

740 
få
->
af‹rs
 = 
NULL
;

741 
få
->
vf‹r0
 = 
NULL
;

743 
få
->
autÜÙ©e
 = 1;

745 
få
->
sws_æags
 = 
SWS_FAST_BILINEAR
;

748 
få
->
audio_ÿÎback_time
 = 0;

751 
få
->
aout
 = 
NULL
;

752 
få
->
vout
 = 
NULL
;

753 
få
->
p–še
 = 
NULL
;

754 
få
->
node_vdec
 = 
NULL
;

755 
få
->
§r_num
 = 0;

756 
få
->
§r_d’
 = 0;

758 
	`av_ä“p
(&
få
->
video_codec_šfo
);

759 
	`av_ä“p
(&
få
->
audio_codec_šfo
);

760 
	`av_ä“p
(&
få
->
subt™Ë_codec_šfo
);

761 
få
->
ov”Ïy_fÜm©
 = 
SDL_FCC_RV32
;

763 
få
->
Ï¡_”rÜ
 = 0;

764 
få
->
´•¬ed
 = 0;

765 
få
->
auto_»sume
 = 0;

766 
få
->
”rÜ
 = 0;

767 
få
->
”rÜ_couÁ
 = 0;

768 
få
->
¡¬t_Ú_´•¬ed
 = 1;

769 
få
->
fœ¡_video_äame_»nd”ed
 = 0;

770 
få
->
sync_av_¡¬t
 = 1;

772 
få
->
¶ayabË_du¿tiÚ_ms
 = 0;

774 
få
->
·ck‘_bufãršg
 = 1;

775 
få
->
piùq_size
 = 
VIDEO_PICTURE_QUEUE_SIZE_DEFAULT
;

776 
få
->
max_ås
 = 31;

778 
få
->
videÙoŞbox
 = 0;

779 
få
->
vtb_max_äame_width
 = 0;

780 
få
->
vtb_async
 = 0;

781 
få
->
vtb_hªdË_»sŞutiÚ_chªge
 = 0;

782 
få
->
vtb_wa™_async
 = 0;

784 
få
->
medŸcodec_®l_videos
 = 0;

785 
få
->
medŸcodec_avc
 = 0;

786 
få
->
medŸcodec_hevc
 = 0;

787 
få
->
medŸcodec_m³g2
 = 0;

788 
få
->
medŸcodec_hªdË_»sŞutiÚ_chªge
 = 0;

789 
få
->
medŸcodec_auto_rÙ©e
 = 0;

791 
få
->
İ’¦es
 = 0;

793 
få
->
ifÜm©_Çme
 = 
NULL
;

795 
få
->
no_time_adju¡
 = 0;

797 
	`ijkm‘a_»£t
(
få
->
m‘a
);

799 
	`SDL_S³edSam¶”Re£t
(&
få
->
vås_§m¶”
);

800 
	`SDL_S³edSam¶”Re£t
(&
få
->
vdps_§m¶”
);

803 
få
->
vf_chªged
 = 0;

804 
få
->
af_chªged
 = 0;

805 
få
->
pf_¶ayback_¿‹
 = 1.0f;

806 
få
->
pf_¶ayback_¿‹_chªged
 = 0;

807 
få
->
pf_¶ayback_vŞume
 = 1.0f;

808 
få
->
pf_¶ayback_vŞume_chªged
 = 0;

810 
	`av_­¶iÿtiÚ_şo£p
(&
få
->
­p_ùx
);

811 
	`ijkio_mªag”_de¡royp
(&
få
->
ijkio_mªag”_ùx
);

813 
	`msg_queue_æush
(&
få
->
msg_queue
);

815 
få
->
šjeù_İaque
 = 
NULL
;

816 
få
->
ijkio_šjeù_İaque
 = 
NULL
;

817 
	`få_»£t_¡©i¡ic
(&
få
->
¡©
);

818 
	`få_»£t_demux_ÿche_cÚŒŞ
(&
få
->
dcc
);

819 
	}
}

821 
šlše
 
	$få_nÙify_msg1
(
FFPÏy”
 *
få
, 
wh©
) {

822 
	`msg_queue_put_sim¶e3
(&
få
->
msg_queue
, 
wh©
, 0, 0);

823 
	}
}

825 
šlše
 
	$få_nÙify_msg2
(
FFPÏy”
 *
få
, 
wh©
, 
¬g1
) {

826 
	`msg_queue_put_sim¶e3
(&
få
->
msg_queue
, 
wh©
, 
¬g1
, 0);

827 
	}
}

829 
šlše
 
	$få_nÙify_msg3
(
FFPÏy”
 *
få
, 
wh©
, 
¬g1
, 
¬g2
) {

830 
	`msg_queue_put_sim¶e3
(&
få
->
msg_queue
, 
wh©
, 
¬g1
, 
¬g2
);

831 
	}
}

833 
šlše
 
	$få_nÙify_msg4
(
FFPÏy”
 *
få
, 
wh©
, 
¬g1
, 
¬g2
, *
obj
, 
obj_Ën
) {

834 
	`msg_queue_put_sim¶e4
(&
få
->
msg_queue
, 
wh©
, 
¬g1
, 
¬g2
, 
obj
, 
obj_Ën
);

835 
	}
}

837 
šlše
 
	$få_»move_msg
(
FFPÏy”
 *
få
, 
wh©
) {

838 
	`msg_queue_»move
(&
få
->
msg_queue
, 
wh©
);

839 
	}
}

841 
šlše
 cÚ¡ *
	$få_g‘_”rÜ_¡ršg
(
”rÜ
) {

842 
”rÜ
) {

843 
	`AVERROR
(
ENOMEM
):  "AVERROR(ENOMEM)";

844 
	`AVERROR
(
EINVAL
):  "AVERROR(EINVAL)";

845 
	`AVERROR
(
EAGAIN
):  "AVERROR(EAGAIN)";

846 
	`AVERROR
(
ETIMEDOUT
):  "AVERROR(ETIMEDOUT)";

847 
AVERROR_EOF
:  "AVERROR_EOF";

848 
AVERROR_EXIT
:  "AVERROR_EXIT";

851 
	}
}

853 
	#FFTRACE
 
ALOGW


	)

855 
	#AVCODEC_MODULE_NAME
 "avcodec"

	)

856 
	#MEDIACODEC_MODULE_NAME
 "MedŸCodec"

	)

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffplay_options.h

24 #iâdeà
FFPLAY__FF_FFPLAY_OPTIONS_H


25 
	#FFPLAY__FF_FFPLAY_OPTIONS_H


	)

27 
	#OPTION_OFFSET
(
x
è
	`off£tof
(
FFPÏy”
, x)

	)

28 
	#OPTION_INT
(
deçuÉ__
, 
mš__
, 
max__
) \

29 .
ty³
 = 
AV_OPT_TYPE_INT
, \

30 { .
i64
 = 
deçuÉ__
 }, \

31 .
mš
 = 
mš__
, \

32 .
max
 = 
max__
, \

33 .
æags
 = 
AV_OPT_FLAG_DECODING_PARAM


	)

34 
	#OPTION_INT64
(
deçuÉ__
, 
mš__
, 
max__
) \

35 .
ty³
 = 
AV_OPT_TYPE_INT64
, \

36 { .
i64
 = 
deçuÉ__
 }, \

37 .
mš
 = 
mš__
, \

38 .
max
 = 
max__
, \

39 .
æags
 = 
AV_OPT_FLAG_DECODING_PARAM


	)

40 
	#OPTION_DOUBLE
(
deçuÉ__
, 
mš__
, 
max__
) \

41 .
ty³
 = 
AV_OPT_TYPE_DOUBLE
, \

42 { .
dbl
 = 
deçuÉ__
 }, \

43 .
mš
 = 
mš__
, \

44 .
max
 = 
max__
, \

45 .
æags
 = 
AV_OPT_FLAG_DECODING_PARAM


	)

46 
	#OPTION_CONST
(
deçuÉ__
) \

47 .
ty³
 = 
AV_OPT_TYPE_CONST
, \

48 { .
i64
 = 
deçuÉ__
 }, \

49 .
mš
 = 
INT_MIN
, \

50 .
max
 = 
INT_MAX
, \

51 .
æags
 = 
AV_OPT_FLAG_DECODING_PARAM


	)

53 
	#OPTION_STR
(
deçuÉ__
) \

54 .
ty³
 = 
AV_OPT_TYPE_STRING
, \

55 { .
¡r
 = 
deçuÉ__
 }, \

56 .
mš
 = 0, \

57 .
max
 = 0, \

58 .
æags
 = 
AV_OPT_FLAG_DECODING_PARAM


	)

60 cÚ¡ 
AVO±iÚ
 
	gfå_cÚ‹xt_İtiÚs
[] = {

64 
OPTION_OFFSET
(
audio_di§bË
), 
OPTION_INT
(0, 0, 1) },

66 
OPTION_OFFSET
(
video_di§bË
), 
OPTION_INT
(0, 0, 1) },

70 
OPTION_OFFSET
(
di¥Ïy_di§bË
), 
OPTION_INT
(0, 0, 1) },

73 
OPTION_OFFSET
(
ç¡
), 
OPTION_INT
(0, 0, 1) },

76 
OPTION_OFFSET
(
loİ
), 
OPTION_INT
(1, 
INT_MIN
, 
INT_MAX
) },

78 
OPTION_OFFSET
(
šfš™e_bufãr
), 
OPTION_INT
(0, 0, 1) },

80 
OPTION_OFFSET
(
äamedrİ
), 
OPTION_INT
(0, -1, 120) },

82 
OPTION_OFFSET
(
£ek_©_¡¬t
), 
OPTION_INT64
(0, 0, 
INT_MAX
) },

84 
OPTION_OFFSET
(
subt™Ë
), 
OPTION_INT
(0, 0, 1) },

86 #ià
CONFIG_AVFILTER


88 
OPTION_OFFSET
(
af‹rs
), 
OPTION_STR
(
NULL
) },

90 
OPTION_OFFSET
(
vf‹r0
), 
OPTION_STR
(
NULL
) },

93 
OPTION_OFFSET
(
rdá¥“d
), 
OPTION_INT
(0, 0, 
INT_MAX
) },

99 
OPTION_OFFSET
(
max_ås
), 
OPTION_INT
(31, -1, 121) },

102 
OPTION_OFFSET
(
ov”Ïy_fÜm©
), 
OPTION_INT
(
SDL_FCC_RV32
, 
INT_MIN
, 
INT_MAX
),

103 .
un™
 = "overlay-format" },

104 { "fcc-_es2", "", 0, 
OPTION_CONST
(
SDL_FCC__GLES2
), .
	gun™
 = "overlay-format" },

105 { "fcc-i420", "", 0, 
OPTION_CONST
(
SDL_FCC_I420
), .
	gun™
 = "overlay-format" },

106 { "fcc-yv12", "", 0, 
OPTION_CONST
(
SDL_FCC_YV12
), .
	gun™
 = "overlay-format" },

107 { "fcc-rv16", "", 0, 
OPTION_CONST
(
SDL_FCC_RV16
), .
	gun™
 = "overlay-format" },

108 { "fcc-rv24", "", 0, 
OPTION_CONST
(
SDL_FCC_RV24
), .
	gun™
 = "overlay-format" },

109 { "fcc-rv32", "", 0, 
OPTION_CONST
(
SDL_FCC_RV32
), .
	gun™
 = "overlay-format" },

112 
OPTION_OFFSET
(
¡¬t_Ú_´•¬ed
), 
OPTION_INT
(1, 0, 1) },

115 
OPTION_OFFSET
(
piùq_size
), 
OPTION_INT
(
VIDEO_PICTURE_QUEUE_SIZE_DEFAULT
,

116 
VIDEO_PICTURE_QUEUE_SIZE_MIN
,

117 
VIDEO_PICTURE_QUEUE_SIZE_MAX
) },

120 
OPTION_OFFSET
(
dcc
.
max_bufãr_size
), 
OPTION_INT
(
MAX_QUEUE_SIZE
, 0, MAX_QUEUE_SIZE) },

122 
OPTION_OFFSET
(
dcc
.
mš_äames
), 
OPTION_INT
(
DEFAULT_MIN_FRAMES
, 
MIN_MIN_FRAMES
, 
MAX_MIN_FRAMES
) },

124 
OPTION_OFFSET
(
dcc
.
fœ¡_high_w©”_m¬k_š_ms
),

125 
OPTION_INT
(
DEFAULT_FIRST_HIGH_WATER_MARK_IN_MS
,

126 
DEFAULT_FIRST_HIGH_WATER_MARK_IN_MS
,

127 
DEFAULT_LAST_HIGH_WATER_MARK_IN_MS
) },

129 
OPTION_OFFSET
(
dcc
.
Ãxt_high_w©”_m¬k_š_ms
),

130 
OPTION_INT
(
DEFAULT_NEXT_HIGH_WATER_MARK_IN_MS
,

131 
DEFAULT_FIRST_HIGH_WATER_MARK_IN_MS
,

132 
DEFAULT_LAST_HIGH_WATER_MARK_IN_MS
) },

134 
OPTION_OFFSET
(
dcc
.
Ï¡_high_w©”_m¬k_š_ms
),

135 
OPTION_INT
(
DEFAULT_LAST_HIGH_WATER_MARK_IN_MS
,

136 
DEFAULT_FIRST_HIGH_WATER_MARK_IN_MS
,

137 
DEFAULT_LAST_HIGH_WATER_MARK_IN_MS
) },

140 
OPTION_OFFSET
(
·ck‘_bufãršg
), 
OPTION_INT
(1, 0, 1) },

142 
OPTION_OFFSET
(
sync_av_¡¬t
), 
OPTION_INT
(1, 0, 1) },

144 
OPTION_OFFSET
(
ifÜm©_Çme
), 
OPTION_STR
(
NULL
) },

146 
OPTION_OFFSET
(
no_time_adju¡
), 
OPTION_INT
(0, 0, 1) },

148 
OPTION_OFFSET
(
´e£t_5_1_ûÁ”_mix_Ëv–
), 
OPTION_DOUBLE
(
M_SQRT1_2
, -32, 32) },

152 
OPTION_OFFSET
(
videÙoŞbox
), 
OPTION_INT
(0, 0, 1) },

154 
OPTION_OFFSET
(
vtb_max_äame_width
), 
OPTION_INT
(0, 0, 
INT_MAX
) },

156 
OPTION_OFFSET
(
vtb_async
), 
OPTION_INT
(0, 0, 1) },

158 
OPTION_OFFSET
(
vtb_wa™_async
), 
OPTION_INT
(1, 0, 1) },

160 
OPTION_OFFSET
(
vtb_hªdË_»sŞutiÚ_chªge
), 
OPTION_INT
(0, 0, 1) },

164 
OPTION_OFFSET
(
medŸcodec_avc
), 
OPTION_INT
(0, 0, 1) },

166 
OPTION_OFFSET
(
medŸcodec_auto_rÙ©e
), 
OPTION_INT
(0, 0, 1) },

168 
OPTION_OFFSET
(
medŸcodec_®l_videos
), 
OPTION_INT
(0, 0, 1) },

170 
OPTION_OFFSET
(
medŸcodec_avc
), 
OPTION_INT
(0, 0, 1) },

172 
OPTION_OFFSET
(
medŸcodec_hevc
), 
OPTION_INT
(0, 0, 1) },

174 
OPTION_OFFSET
(
medŸcodec_m³g2
), 
OPTION_INT
(0, 0, 1) },

176 
OPTION_OFFSET
(
medŸcodec_m³g4
), 
OPTION_INT
(0, 0, 1) },

178 
OPTION_OFFSET
(
medŸcodec_hªdË_»sŞutiÚ_chªge
), 
OPTION_INT
(0, 0, 1) },

180 
OPTION_OFFSET
(
İ’¦es
), 
OPTION_INT
(0, 0, 1) },

182 { 
	gNULL
 }

185 #undeà
OPTION_STR


186 #undeà
OPTION_CONST


187 #undeà
OPTION_INT


188 #undeà
OPTION_OFFSET


	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/allformats.c

24 
	~"libavfÜm©/avfÜm©.h
"

25 
	~"libavfÜm©/u¾.h
"

26 
	~"libavfÜm©/v”siÚ.h
"

28 
	#IJK_REGISTER_DEMUXER
(
x
) \

30 
AVIÅutFÜm©
 
ijkff_
##
x
##
_demux”
; \

31 
	`ijkav_»gi¡”_šput_fÜm©
(&
ijkff_
##
x
##
_demux”
); \

32 }

	)

34 
	#IJK_REGISTER_PROTOCOL
(
x
) \

36 
URLPrÙocŞ
 
ijkimp_ff_
##
x
##
_´ÙocŞ
; \

37 
ijkav_»gi¡”_
##
x
##
	`_´ÙocŞ
(
URLPrÙocŞ
 *
´ÙocŞ
, 
´ÙocŞ_size
);\

38 
ijkav_»gi¡”_
##
x
##
	`_´ÙocŞ
(&
ijkimp_ff_
##x##
_´ÙocŞ
, (
URLPrÙocŞ
)); \

39 }

	)

41 
AVIÅutFÜm©
 *
	$ijkav_fšd_šput_fÜm©
(cÚ¡ *
ifÜm©_Çme
)

43 
AVIÅutFÜm©
 *
fmt
 = 
NULL
;

44 ià(!
ifÜm©_Çme
)

45  
NULL
;

46 (
fmt
 = 
	`av_ifÜm©_Ãxt
(fmt))) {

47 ià(!
fmt
->
Çme
)

49 ià(!
	`¡rcmp
(
ifÜm©_Çme
, 
fmt
->
Çme
))

50  
fmt
;

52  
NULL
;

53 
	}
}

55 
	$ijkav_»gi¡”_šput_fÜm©
(
AVIÅutFÜm©
 *
ifÜm©
)

57 ià(
	`ijkav_fšd_šput_fÜm©
(
ifÜm©
->
Çme
)) {

58 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "sk demux” : % (du¶iÿ‹d)\n", 
ifÜm©
->
Çme
);

60 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "»gi¡” demux” : %s\n", 
ifÜm©
->
Çme
);

61 
	`av_»gi¡”_šput_fÜm©
(
ifÜm©
);

63 
	}
}

66 
	$ijkav_»gi¡”_®l
()

68 
š™Ÿlized
;

70 ià(
š™Ÿlized
)

72 
š™Ÿlized
 = 1;

74 
	`av_»gi¡”_®l
();

77 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "===== custom modules begin =====\n");

78 #ifdeà
__ANDROID__


79 
	`IJK_REGISTER_PROTOCOL
(
ijkmedŸd©asourû
);

81 
	`IJK_REGISTER_PROTOCOL
(
ijkio
);

82 
	`IJK_REGISTER_PROTOCOL
(
async
);

83 
	`IJK_REGISTER_PROTOCOL
(
ijklÚgu¾
);

84 
	`IJK_REGISTER_PROTOCOL
(
ijktıhook
);

85 
	`IJK_REGISTER_PROTOCOL
(
ijkh‰phook
);

86 
	`IJK_REGISTER_PROTOCOL
(
ijk£gm’t
);

88 
	`IJK_REGISTER_DEMUXER
(
ijklivehook
);

89 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "===== custom modulesƒnd =====\n");

90 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkasync.c

31 
	~"libavut/avas£¹.h
"

32 
	~"libavut/av¡ršg.h
"

33 
	~"libavut/”rÜ.h
"

34 
	~"libavut/fifo.h
"

35 
	~"libavut/log.h
"

36 
	~"libavut/İt.h
"

37 
	~"libavut/th»ad.h
"

38 
	~"libavut/time.h
"

39 
	~"libavfÜm©/u¾.h
"

40 
	~<¡dšt.h
>

42 
	~"libavut/­¶iÿtiÚ.h
"

44 #ià
HAVE_UNISTD_H


45 
	~<uni¡d.h
>

48 
	#SHORT_SEEK_THRESHOLD
 (256 * 1024)

	)

50 
	sRšgBufãr


52 
AVFifoBufãr
 *
	mfifo
;

53 
	m»ad_back_ÿ·c™y
;

55 
	m»ad_pos
;

56 } 
	tRšgBufãr
;

58 
	sCÚ‹xt
 {

59 
AVCÏss
 *
	mşass
;

60 
URLCÚ‹xt
 *
	mšÃr
;

62 
	m£ek_»que¡
;

63 
št64_t
 
	m£ek_pos
;

64 
	m£ek_wh’û
;

65 
	m£ek_com¶‘ed
;

66 
št64_t
 
	m£ek_»t
;

68 
	mšÃr_io_”rÜ
;

69 
	mio_”rÜ
;

70 
	mio_eof_»ached
;

72 
št64_t
 
	mlogiÿl_pos
;

73 
št64_t
 
	mlogiÿl_size
;

74 
RšgBufãr
 
	mršg
;

76 
±h»ad_cÚd_t
 
	mcÚd_wakeup_maš
;

77 
±h»ad_cÚd_t
 
	mcÚd_wakeup_background
;

78 
±h»ad_mu‹x_t
 
	mmu‹x
;

79 
±h»ad_t
 
	masync_bufãr_th»ad
;

81 
	mabÜt_»que¡
;

82 
AVIOIÁ”ru±CB
 
	mš‹¼u±_ÿÎback
;

85 
št64_t
 
	mfÜw¬ds_ÿ·c™y
;

86 
št64_t
 
	mbackw¬ds_ÿ·c™y
;

87 
št64_t
 
	m­p_ùx_šŒ
;

88 
AVAµliÿtiÚCÚ‹xt
 *
	m­p_ùx
;

89 } 
	tCÚ‹xt
;

91 
	$ršg_š™
(
RšgBufãr
 *
ršg
, 
št64_t
 
ÿ·c™y
, iÁ64_ˆ
»ad_back_ÿ·c™y
)

93 
	`mem£t
(
ršg
, 0, (
RšgBufãr
));

94 
ršg
->
fifo
 = 
	`av_fifo_®loc
(()(
ÿ·c™y
 + 
»ad_back_ÿ·c™y
));

95 ià(!
ršg
->
fifo
)

96  
	`AVERROR
(
ENOMEM
);

98 
ršg
->
»ad_back_ÿ·c™y
 = ()read_back_capacity;

100 
	}
}

102 
	$ršg_de¡roy
(
RšgBufãr
 *
ršg
)

104 
	`av_fifo_ä“p
(&
ršg
->
fifo
);

105 
	}
}

107 
	$ršg_»£t
(
RšgBufãr
 *
ršg
)

109 
	`av_fifo_»£t
(
ršg
->
fifo
);

110 
ršg
->
»ad_pos
 = 0;

111 
	}
}

113 
	$ršg_size
(
RšgBufãr
 *
ršg
)

115  
	`av_fifo_size
(
ršg
->
fifo
è-„šg->
»ad_pos
;

116 
	}
}

118 
	$ršg_¥aû
(
RšgBufãr
 *
ršg
)

120  
	`av_fifo_¥aû
(
ršg
->
fifo
);

121 
	}
}

123 
ršg_g’”ic_»ad
(
RšgBufãr
 *
ršg
, *
de¡
, 
buf_size
, (*
func
)(*, *, ))

125 
»t
;

127 
	`av_as£¹2
(
buf_size
 <ğ
	`ršg_size
(
ršg
));

128 
»t
 = 
	`av_fifo_g’”ic_³ek_©
(
ršg
->
fifo
, 
de¡
,„šg->
»ad_pos
, 
buf_size
, 
func
);

129 
ršg
->
»ad_pos
 +ğ
buf_size
;

131 ià(
ršg
->
»ad_pos
 >„šg->
»ad_back_ÿ·c™y
) {

132 
	`av_fifo_d¿š
(
ršg
->
fifo
,„šg->
»ad_pos
 -„šg->
»ad_back_ÿ·c™y
);

133 
ršg
->
»ad_pos
 =„šg->
»ad_back_ÿ·c™y
;

136  
»t
;

137 
	}
}

139 
ršg_g’”ic_wr™e
(
RšgBufãr
 *
ršg
, *
¤c
, 
size
, (*
func
)(*, *, ))

141 
	`av_as£¹2
(
size
 <ğ
	`ršg_¥aû
(
ršg
));

142  
	`av_fifo_g’”ic_wr™e
(
ršg
->
fifo
, 
¤c
, 
size
, 
func
);

143 
	}
}

145 
	$ršg_size_of_»ad_back
(
RšgBufãr
 *
ršg
)

147  
ršg
->
»ad_pos
;

148 
	}
}

150 
	$ršg_d¿š
(
RšgBufãr
 *
ršg
, 
off£t
)

152 
	`av_as£¹2
(
off£t
 >ğ-
	`ršg_size_of_»ad_back
(
ršg
));

153 
	`av_as£¹2
(
off£t
 <ğ-
	`ršg_size
(
ršg
));

154 
ršg
->
»ad_pos
 +ğ
off£t
;

156 
	}
}

158 
	$async_check_š‹¼u±
(*
¬g
)

160 
URLCÚ‹xt
 *
h
 = 
¬g
;

161 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

163 ià(
c
->
abÜt_»que¡
)

166 ià(
	`ff_check_š‹¼u±
(&
c
->
š‹¼u±_ÿÎback
))

167 
c
->
abÜt_»que¡
 = 1;

169  
c
->
abÜt_»que¡
;

170 
	}
}

172 
	$w¿µed_u¾_»ad
(*
¤c
, *
d¡
, 
size
)

174 
URLCÚ‹xt
 *
h
 = 
¤c
;

175 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

176 
»t
;

178 
»t
 = 
	`ffu¾_»ad
(
c
->
šÃr
, 
d¡
, 
size
);

179 
c
->
šÃr_io_”rÜ
 = 
»t
 < 0 ?„et : 0;

181  
»t
;

182 
	}
}

184 
	$ÿÎ_šjeù_¡©i¡ic
(
URLCÚ‹xt
 *
h
)

186 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

188 ià(
c
->
­p_ùx
) {

189 
AVAµAsyncSti¡ic
 
¡©i¡ic
 = {0};

190 
¡©i¡ic
.
size
 = (statistic);

191 
¡©i¡ic
.
buf_fÜw¬ds
 = 
	`ršg_size
(&
c
->
ršg
);

192 
¡©i¡ic
.
buf_backw¬ds
 = 
	`ršg_size_of_»ad_back
(&
c
->
ršg
);

193 
¡©i¡ic
.
buf_ÿ·c™y
 = 
c
->
fÜw¬ds_ÿ·c™y
 + c->
backw¬ds_ÿ·c™y
;

194 
	`av_­¶iÿtiÚ_Ú_async_¡©i¡ic
(
c
->
­p_ùx
, &
¡©i¡ic
);

196 
	}
}

198 
	$ÿÎ_šjeù_async_fl_¥“d
(
URLCÚ‹xt
 *
h
, 
is_fuÎ_¥“d
, 
št64_t
 
by‹s
, iÁ64_ˆ
–­£d_miüo
)

200 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

201 
št64_t
 
–­£d_mli
 = 
–­£d_miüo
 / 1000;

203 ià(
c
->
­p_ùx
 && 
by‹s
 > 0 && 
–­£d_mli
 > 0) {

204 
AVAµAsyncR—dS³ed
 
¥“d
 = {0};

205 
¥“d
.
size
 = (speed);

206 
¥“d
.
is_fuÎ_¥“d
 = is_full_speed;

207 
¥“d
.
io_by‹s
 = 
by‹s
;

208 
¥“d
.
–­£d_mli
 =ƒlapsed_milli;

209 
	`av_­¶iÿtiÚ_Ú_async_»ad_¥“d
(
c
->
­p_ùx
, &
¥“d
);

211 
	}
}

213 *
	$async_bufãr_sk
(*
¬g
)

215 
URLCÚ‹xt
 *
h
 = 
¬g
;

216 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

217 
RšgBufãr
 *
ršg
 = &
c
->ring;

218 
»t
 = 0;

219 
št64_t
 
£ek_»t
;

220 
is_fuÎ_¥“d
 = 1;

221 
št64_t
 
couÁ_by‹s
 = 0;

222 
št64_t
 
couÁ_¡¬t_time_miüo
 = 
	`av_g‘time_»Ïtive
();

225 
fifo_¥aû
, 
to_cİy
;

227 
	`±h»ad_mu‹x_lock
(&
c
->
mu‹x
);

228 ià(
	`async_check_š‹¼u±
(
h
)) {

229 
c
->
io_eof_»ached
 = 1;

230 
c
->
io_”rÜ
 = 
AVERROR_EXIT
;

231 
	`±h»ad_cÚd_sigÇl
(&
c
->
cÚd_wakeup_maš
);

232 
	`±h»ad_mu‹x_uÆock
(&
c
->
mu‹x
);

236 ià(
c
->
£ek_»que¡
) {

237 
£ek_»t
 = 
	`ffu¾_£ek
(
c
->
šÃr
, c->
£ek_pos
, c->
£ek_wh’û
);

238 ià(
£ek_»t
 < 0) {

239 
c
->
io_eof_»ached
 = 1;

240 
c
->
io_”rÜ
 = ()
£ek_»t
;

242 
c
->
io_eof_»ached
 = 0;

243 
c
->
io_”rÜ
 = 0;

246 
c
->
£ek_com¶‘ed
 = 1;

247 
c
->
£ek_»t
 = seek_ret;

248 
c
->
£ek_»que¡
 = 0;

250 
	`ršg_»£t
(
ršg
);

252 
	`±h»ad_cÚd_sigÇl
(&
c
->
cÚd_wakeup_maš
);

253 
	`±h»ad_mu‹x_uÆock
(&
c
->
mu‹x
);

255 
is_fuÎ_¥“d
 = 0;

259 
fifo_¥aû
 = 
	`ršg_¥aû
(
ršg
);

260 ià(
c
->
io_eof_»ached
 || 
fifo_¥aû
 <= 0) {

261 
	`±h»ad_cÚd_sigÇl
(&
c
->
cÚd_wakeup_maš
);

262 
	`±h»ad_cÚd_wa™
(&
c
->
cÚd_wakeup_background
, &c->
mu‹x
);

263 
	`±h»ad_mu‹x_uÆock
(&
c
->
mu‹x
);

264 
is_fuÎ_¥“d
 = 0;

267 
	`±h»ad_mu‹x_uÆock
(&
c
->
mu‹x
);

269 
to_cİy
 = 
	`FFMIN
(4096, 
fifo_¥aû
);

270 
»t
 = 
	`ršg_g’”ic_wr™e
(
ršg
, (*)
h
, 
to_cİy
, (*)
w¿µed_u¾_»ad
);

271 ià(
»t
 > 0) {

272 
couÁ_by‹s
 +ğ
»t
;

273 ià(
couÁ_by‹s
 > 
	`FFMIN
((1 * 1024 * 1024), 
c
->
fÜw¬ds_ÿ·c™y
)) {

274 
št64_t
 
now
 = 
	`av_g‘time_»Ïtive
();

275 
	`ÿÎ_šjeù_async_fl_¥“d
(
h
, 
is_fuÎ_¥“d
, 
couÁ_by‹s
, 
now
 - 
couÁ_¡¬t_time_miüo
);

276 
is_fuÎ_¥“d
 = 1;

277 
couÁ_by‹s
 = 0;

278 
couÁ_¡¬t_time_miüo
 = 
now
;

282 
	`±h»ad_mu‹x_lock
(&
c
->
mu‹x
);

283 ià(
»t
 <= 0) {

284 
c
->
io_eof_»ached
 = 1;

285 ià(
c
->
šÃr_io_”rÜ
 < 0)

286 
c
->
io_”rÜ
 = c->
šÃr_io_”rÜ
;

289 
	`±h»ad_cÚd_sigÇl
(&
c
->
cÚd_wakeup_maš
);

290 
	`±h»ad_mu‹x_uÆock
(&
c
->
mu‹x
);

292 
	`ÿÎ_šjeù_¡©i¡ic
(
h
);

295  
NULL
;

296 
	}
}

298 
	$async_İ’
(
URLCÚ‹xt
 *
h
, cÚ¡ *
¬g
, 
æags
, 
AVDiùiÚ¬y
 **
İtiÚs
)

300 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

301 
»t
;

302 
AVIOIÁ”ru±CB
 
š‹¼u±_ÿÎback
 = {.
ÿÎback
 = 
async_check_š‹¼u±
, .
İaque
 = 
h
};

304 
	`av_¡r¡¬t
(
¬g
, "async:", &arg);

306 
»t
 = 
	`ršg_š™
(&
c
->
ršg
, c->
fÜw¬ds_ÿ·c™y
, c->
backw¬ds_ÿ·c™y
);

307 ià(
»t
 < 0)

308 
fifo_ç
;

310 ià(
c
->
­p_ùx_šŒ
) {

311 
c
->
­p_ùx
 = (
AVAµliÿtiÚCÚ‹xt
 *)(
šŒ_t
)c->
­p_ùx_šŒ
;

312 
	`av_diù_£t_št
(
İtiÚs
, "ijk­¶iÿtiÚ", 
c
->
­p_ùx_šŒ
, 0);

315 
c
->
š‹¼u±_ÿÎback
 = 
h
->interrupt_callback;

316 
»t
 = 
	`ffu¾_İ’_wh™–i¡
(&
c
->
šÃr
, 
¬g
, 
æags
, &
š‹¼u±_ÿÎback
, 
İtiÚs
, 
h
->
´ÙocŞ_wh™–i¡
, h->
´ÙocŞ_bÏckli¡
, h);

317 ià(
»t
 != 0) {

318 
	`av_log
(
h
, 
AV_LOG_ERROR
, "ffu¾_İ’_wh™–i¡ faed : %s, %s\n", 
	`av_”r2¡r
(
»t
), 
¬g
);

319 
u¾_ç
;

322 
c
->
logiÿl_size
 = 
	`ffu¾_size
(c->
šÃr
);

323 
h
->
is_¡»amed
 = 
c
->
šÃr
->is_streamed;

325 
»t
 = 
	`±h»ad_mu‹x_š™
(&
c
->
mu‹x
, 
NULL
);

326 ià(
»t
 != 0) {

327 
	`av_log
(
h
, 
AV_LOG_ERROR
, "±h»ad_mu‹x_š™ faed : %s\n", 
	`av_”r2¡r
(
»t
));

328 
mu‹x_ç
;

331 
»t
 = 
	`±h»ad_cÚd_š™
(&
c
->
cÚd_wakeup_maš
, 
NULL
);

332 ià(
»t
 != 0) {

333 
	`av_log
(
h
, 
AV_LOG_ERROR
, "±h»ad_cÚd_š™ faed : %s\n", 
	`av_”r2¡r
(
»t
));

334 
cÚd_wakeup_maš_ç
;

337 
»t
 = 
	`±h»ad_cÚd_š™
(&
c
->
cÚd_wakeup_background
, 
NULL
);

338 ià(
»t
 != 0) {

339 
	`av_log
(
h
, 
AV_LOG_ERROR
, "±h»ad_cÚd_š™ faed : %s\n", 
	`av_”r2¡r
(
»t
));

340 
cÚd_wakeup_background_ç
;

343 
»t
 = 
	`±h»ad_ü—‹
(&
c
->
async_bufãr_th»ad
, 
NULL
, 
async_bufãr_sk
, 
h
);

344 ià(
»t
) {

345 
	`av_log
(
h
, 
AV_LOG_ERROR
, "±h»ad_ü—‹ faed : %s\n", 
	`av_”r2¡r
(
»t
));

346 
th»ad_ç
;

351 
th»ad_ç
:

352 
	`±h»ad_cÚd_de¡roy
(&
c
->
cÚd_wakeup_background
);

353 
cÚd_wakeup_background_ç
:

354 
	`±h»ad_cÚd_de¡roy
(&
c
->
cÚd_wakeup_maš
);

355 
cÚd_wakeup_maš_ç
:

356 
	`±h»ad_mu‹x_de¡roy
(&
c
->
mu‹x
);

357 
mu‹x_ç
:

358 
	`ffu¾_şo£
(
c
->
šÃr
);

359 
u¾_ç
:

360 
	`ršg_de¡roy
(&
c
->
ršg
);

361 
fifo_ç
:

362  
»t
;

363 
	}
}

365 
	$async_şo£
(
URLCÚ‹xt
 *
h
)

367 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

368 
»t
;

370 
	`±h»ad_mu‹x_lock
(&
c
->
mu‹x
);

371 
c
->
abÜt_»que¡
 = 1;

372 
	`±h»ad_cÚd_sigÇl
(&
c
->
cÚd_wakeup_background
);

373 
	`±h»ad_mu‹x_uÆock
(&
c
->
mu‹x
);

375 
»t
 = 
	`±h»ad_još
(
c
->
async_bufãr_th»ad
, 
NULL
);

376 ià(
»t
 != 0)

377 
	`av_log
(
h
, 
AV_LOG_ERROR
, "±h»ad_još(): %s\n", 
	`av_”r2¡r
(
»t
));

379 
	`±h»ad_cÚd_de¡roy
(&
c
->
cÚd_wakeup_background
);

380 
	`±h»ad_cÚd_de¡roy
(&
c
->
cÚd_wakeup_maš
);

381 
	`±h»ad_mu‹x_de¡roy
(&
c
->
mu‹x
);

382 
	`ffu¾_şo£
(
c
->
šÃr
);

383 
	`ršg_de¡roy
(&
c
->
ršg
);

386 
	}
}

388 
async_»ad_š‹º®
(
URLCÚ‹xt
 *
h
, *
de¡
, 
size
, 
»ad_com¶‘e
,

389 (*
func
)(*, *, ))

391 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

392 
RšgBufãr
 *
ršg
 = &
c
->ring;

393 
to_»ad
 = 
size
;

394 
»t
 = 0;

396 
	`±h»ad_mu‹x_lock
(&
c
->
mu‹x
);

398 
to_»ad
 > 0) {

399 
fifo_size
, 
to_cİy
;

400 ià(
	`async_check_š‹¼u±
(
h
)) {

401 
»t
 = 
AVERROR_EXIT
;

404 
fifo_size
 = 
	`ršg_size
(
ršg
);

405 
to_cİy
 = 
	`FFMIN
(
to_»ad
, 
fifo_size
);

406 ià(
to_cİy
 > 0) {

407 
	`ršg_g’”ic_»ad
(
ršg
, 
de¡
, 
to_cİy
, 
func
);

408 ià(!
func
)

409 
de¡
 = (
ušt8_t
 *)de¡ + 
to_cİy
;

410 
c
->
logiÿl_pos
 +ğ
to_cİy
;

411 
to_»ad
 -ğ
to_cİy
;

412 
»t
 = 
size
 - 
to_»ad
;

414 ià(
to_»ad
 <ğ0 || !
»ad_com¶‘e
)

416 } ià(
c
->
io_eof_»ached
) {

417 ià(
»t
 <= 0) {

418 ià(
c
->
io_”rÜ
)

419 
»t
 = 
c
->
io_”rÜ
;

421 
»t
 = 
AVERROR_EOF
;

425 
	`±h»ad_cÚd_sigÇl
(&
c
->
cÚd_wakeup_background
);

426 
	`±h»ad_cÚd_wa™
(&
c
->
cÚd_wakeup_maš
, &c->
mu‹x
);

429 
	`±h»ad_cÚd_sigÇl
(&
c
->
cÚd_wakeup_background
);

430 
	`±h»ad_mu‹x_uÆock
(&
c
->
mu‹x
);

432 
	`ÿÎ_šjeù_¡©i¡ic
(
h
);

433  
»t
;

434 
	}
}

436 
	$async_»ad
(
URLCÚ‹xt
 *
h
, *
buf
, 
size
)

438  
	`async_»ad_š‹º®
(
h
, 
buf
, 
size
, 0, 
NULL
);

439 
	}
}

441 
	$fifo_do_nÙ_cİy_func
(* 
de¡
, * 
¤c
, 
size
) {

443 
	}
}

445 
št64_t
 
	$async_£ek
(
URLCÚ‹xt
 *
h
, 
št64_t
 
pos
, 
wh’û
)

447 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

448 
RšgBufãr
 *
ršg
 = &
c
->ring;

449 
št64_t
 
»t
;

450 
št64_t
 
Ãw_logiÿl_pos
;

451 
fifo_size
;

452 
fifo_size_of_»ad_back
;

454 ià(
wh’û
 =ğ
AVSEEK_SIZE
) {

455 
	`av_log
(
h
, 
AV_LOG_TRACE
, "async_£ek: AVSEEK_SIZE: %"
PRId64
"\n", (
št64_t
)
c
->
logiÿl_size
);

456  
c
->
logiÿl_size
;

457 } ià(
wh’û
 =ğ
SEEK_CUR
) {

458 
	`av_log
(
h
, 
AV_LOG_TRACE
, "async_£ek: %"
PRId64
"\n", 
pos
);

459 
Ãw_logiÿl_pos
 = 
pos
 + 
c
->
logiÿl_pos
;

460 } ià(
wh’û
 =ğ
SEEK_SET
){

461 
	`av_log
(
h
, 
AV_LOG_TRACE
, "async_£ek: %"
PRId64
"\n", 
pos
);

462 
Ãw_logiÿl_pos
 = 
pos
;

464  
	`AVERROR
(
EINVAL
);

466 ià(
Ãw_logiÿl_pos
 < 0)

467  
	`AVERROR
(
EINVAL
);

469 
fifo_size
 = 
	`ršg_size
(
ršg
);

470 
fifo_size_of_»ad_back
 = 
	`ršg_size_of_»ad_back
(
ršg
);

471 ià(
Ãw_logiÿl_pos
 =ğ
c
->
logiÿl_pos
) {

473  
c
->
logiÿl_pos
;

474 } ià((
Ãw_logiÿl_pos
 >ğ(
c
->
logiÿl_pos
 - 
fifo_size_of_»ad_back
)) &&

475 (
Ãw_logiÿl_pos
 < (
c
->
logiÿl_pos
 + 
fifo_size
 + 
SHORT_SEEK_THRESHOLD
))) {

476 
pos_d–
 = ()(
Ãw_logiÿl_pos
 - 
c
->
logiÿl_pos
);

478 
	`av_log
(
h
, 
AV_LOG_TRACE
, "async_£ek: fask_£ek %"
PRId64
" from %d dist:%d/%d\n",

479 
Ãw_logiÿl_pos
, ()
c
->
logiÿl_pos
,

480 ()(
Ãw_logiÿl_pos
 - 
c
->
logiÿl_pos
), 
fifo_size
);

482 ià(
pos_d–
 > 0) {

484 
	`async_»ad_š‹º®
(
h
, 
NULL
, 
pos_d–
, 1, 
fifo_do_nÙ_cİy_func
);

487 
	`ršg_d¿š
(
ršg
, 
pos_d–
);

488 
	`ÿÎ_šjeù_¡©i¡ic
(
h
);

489 
c
->
logiÿl_pos
 = 
Ãw_logiÿl_pos
;

492  
c
->
logiÿl_pos
;

493 } ià(
c
->
logiÿl_size
 <= 0) {

495  
	`AVERROR
(
EINVAL
);

496 } ià(
Ãw_logiÿl_pos
 > 
c
->
logiÿl_size
) {

498  
	`AVERROR
(
EINVAL
);

501 
	`±h»ad_mu‹x_lock
(&
c
->
mu‹x
);

503 
c
->
£ek_»que¡
 = 1;

504 
c
->
£ek_pos
 = 
Ãw_logiÿl_pos
;

505 
c
->
£ek_wh’û
 = 
SEEK_SET
;

506 
c
->
£ek_com¶‘ed
 = 0;

507 
c
->
£ek_»t
 = 0;

510 ià(
	`async_check_š‹¼u±
(
h
)) {

511 
»t
 = 
AVERROR_EXIT
;

514 ià(
c
->
£ek_com¶‘ed
) {

515 ià(
c
->
£ek_»t
 >= 0)

516 
c
->
logiÿl_pos
 = c->
£ek_»t
;

517 
»t
 = 
c
->
£ek_»t
;

520 
	`±h»ad_cÚd_sigÇl
(&
c
->
cÚd_wakeup_background
);

521 
	`±h»ad_cÚd_wa™
(&
c
->
cÚd_wakeup_maš
, &c->
mu‹x
);

524 
	`±h»ad_mu‹x_uÆock
(&
c
->
mu‹x
);

526 
	`ÿÎ_šjeù_¡©i¡ic
(
h
);

527  
»t
;

528 
	}
}

530 
	#OFFSET
(
x
è
	`off£tof
(
CÚ‹xt
, x)

	)

531 
	#D
 
AV_OPT_FLAG_DECODING_PARAM


	)

533 cÚ¡ 
AVO±iÚ
 
	gİtiÚs
[] = {

535 
OFFSET
(
fÜw¬ds_ÿ·c™y
), 
AV_OPT_TYPE_INT64
, {.
i64
 = 128 * 1024}, 128 * 1024, 128 * 1024 * 1024, 
	gD
 },

537 
OFFSET
(
backw¬ds_ÿ·c™y
), 
	gAV_OPT_TYPE_INT64
, {.
	gi64
 = 128 * 1024}, 128 * 1024, 128 * 1024 * 1024, 
	gD
 },

538 { "ijk­¶iÿtiÚ", "AVAµliÿtiÚCÚ‹xt", 
OFFSET
(
­p_ùx_šŒ
), 
	gAV_OPT_TYPE_INT64
, { .
	gi64
 = 0 }, 
	gINT64_MIN
, 
	gINT64_MAX
, .
	gæags
 = 
D
 },

539 {
	gNULL
},

542 #undeà
D


543 #undeà
OFFSET


545 cÚ¡ 
AVCÏss
 
	gasync_cÚ‹xt_şass
 = {

546 .
şass_Çme
 = "Async",

547 .
	g™em_Çme
 = 
av_deçuÉ_™em_Çme
,

548 .
	gİtiÚ
 = 
İtiÚs
,

549 .
	gv”siÚ
 = 
LIBAVUTIL_VERSION_INT
,

552 cÚ¡ 
URLPrÙocŞ
 
	gijkimp_ff_async_´ÙocŞ
 = {

553 .
Çme
 = "async",

554 .
	gu¾_İ’2
 = 
async_İ’
,

555 .
	gu¾_»ad
 = 
async_»ad
,

556 .
	gu¾_£ek
 = 
async_£ek
,

557 .
	gu¾_şo£
 = 
async_şo£
,

558 .
	g´iv_d©a_size
 = (
CÚ‹xt
),

559 .
	g´iv_d©a_şass
 = &
async_cÚ‹xt_şass
,

564 
	#TEST_SEEK_POS
 (1536)

	)

565 
	#TEST_STREAM_SIZE
 (2048)

	)

567 
	sTe¡CÚ‹xt
 {

568 
AVCÏss
 *
	mşass
;

569 
št64_t
 
	mlogiÿl_pos
;

570 
št64_t
 
	mlogiÿl_size
;

573 
	mİt_»ad_”rÜ
;

574 } 
	tTe¡CÚ‹xt
;

576 
	$async_‹¡_İ’
(
URLCÚ‹xt
 *
h
, cÚ¡ *
¬g
, 
æags
, 
AVDiùiÚ¬y
 **
İtiÚs
)

578 
Te¡CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

579 
c
->
logiÿl_pos
 = 0;

580 
c
->
logiÿl_size
 = 
TEST_STREAM_SIZE
;

582 
	}
}

584 
	$async_‹¡_şo£
(
URLCÚ‹xt
 *
h
)

587 
	}
}

589 
	$async_‹¡_»ad
(
URLCÚ‹xt
 *
h
, *
buf
, 
size
)

591 
Te¡CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

592 
i
;

593 
»ad_Ën
 = 0;

595 ià(
c
->
İt_»ad_”rÜ
)

596  
c
->
İt_»ad_”rÜ
;

598 ià(
c
->
logiÿl_pos
 >ğc->
logiÿl_size
)

599  
AVERROR_EOF
;

601 
i
 = 0; i < 
size
; ++i) {

602 
buf
[
i
] = 
c
->
logiÿl_pos
 & 0xFF;

604 
c
->
logiÿl_pos
++;

605 
»ad_Ën
++;

607 ià(
c
->
logiÿl_pos
 >ğc->
logiÿl_size
)

611  
»ad_Ën
;

612 
	}
}

614 
št64_t
 
	$async_‹¡_£ek
(
URLCÚ‹xt
 *
h
, 
št64_t
 
pos
, 
wh’û
)

616 
Te¡CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

617 
št64_t
 
Ãw_logiÿl_pos
;

619 ià(
wh’û
 =ğ
AVSEEK_SIZE
) {

620  
c
->
logiÿl_size
;

621 } ià(
wh’û
 =ğ
SEEK_CUR
) {

622 
Ãw_logiÿl_pos
 = 
pos
 + 
c
->
logiÿl_pos
;

623 } ià(
wh’û
 =ğ
SEEK_SET
){

624 
Ãw_logiÿl_pos
 = 
pos
;

626  
	`AVERROR
(
EINVAL
);

628 ià(
Ãw_logiÿl_pos
 < 0)

629  
	`AVERROR
(
EINVAL
);

631 
c
->
logiÿl_pos
 = 
Ãw_logiÿl_pos
;

632  
Ãw_logiÿl_pos
;

633 
	}
}

635 
	#OFFSET
(
x
è
	`off£tof
(
Te¡CÚ‹xt
, x)

	)

636 
	#D
 
AV_OPT_FLAG_DECODING_PARAM


	)

638 cÚ¡ 
AVO±iÚ
 
	gasync_‹¡_İtiÚs
[] = {

640 
OFFSET
(
İt_»ad_”rÜ
), 
AV_OPT_TYPE_INT
, { .
i64
 = 0 }, 
	gINT_MIN
, 
	gINT_MAX
, .
	gæags
 = 
D
 },

641 {
	gNULL
},

644 #undeà
D


645 #undeà
OFFSET


647 cÚ¡ 
AVCÏss
 
	gasync_‹¡_cÚ‹xt_şass
 = {

648 .
şass_Çme
 = "Async-Test",

649 .
	g™em_Çme
 = 
av_deçuÉ_™em_Çme
,

650 .
	gİtiÚ
 = 
async_‹¡_İtiÚs
,

651 .
	gv”siÚ
 = 
LIBAVUTIL_VERSION_INT
,

654 cÚ¡ 
URLPrÙocŞ
 
	gff_async_‹¡_´ÙocŞ
 = {

655 .
Çme
 = "async-test",

656 .
	gu¾_İ’2
 = 
async_‹¡_İ’
,

657 .
	gu¾_»ad
 = 
async_‹¡_»ad
,

658 .
	gu¾_£ek
 = 
async_‹¡_£ek
,

659 .
	gu¾_şo£
 = 
async_‹¡_şo£
,

660 .
	g´iv_d©a_size
 = (
Te¡CÚ‹xt
),

661 .
	g´iv_d©a_şass
 = &
async_‹¡_cÚ‹xt_şass
,

664 
	$maš
()

666 
URLCÚ‹xt
 *
h
 = 
NULL
;

667 
i
;

668 
»t
;

669 
št64_t
 
size
;

670 
št64_t
 
pos
;

671 
št64_t
 
»ad_Ën
;

672 
buf
[4096];

673 
AVDiùiÚ¬y
 *
İts
 = 
NULL
;

675 
	`ffu¾_»gi¡”_´ÙocŞ
(&
ijkimp_ff_async_´ÙocŞ
);

676 
	`ffu¾_»gi¡”_´ÙocŞ
(&
ff_async_‹¡_´ÙocŞ
);

681 
»t
 = 
	`ffu¾_İ’
(&
h
, "async:async-‹¡:", 
AVIO_FLAG_READ
, 
NULL
, NULL);

682 
	`´štf
("İ’: %d\n", 
»t
);

684 
size
 = 
	`ffu¾_size
(
h
);

685 
	`´štf
("size: %"
PRId64
"\n", 
size
);

687 
pos
 = 
	`ffu¾_£ek
(
h
, 0, 
SEEK_CUR
);

688 
»ad_Ën
 = 0;

690 
»t
 = 
	`ffu¾_»ad
(
h
, 
buf
, (buf));

691 ià(
»t
 =ğ
AVERROR_EOF
) {

692 
	`´štf
("»ad-”rÜ: AVERROR_EOF‡ˆ%"
PRId64
"\n", 
	`ffu¾_£ek
(
h
, 0, 
SEEK_CUR
));

695 ià(
»t
 == 0)

697 ià(
»t
 < 0) {

698 
	`´štf
("»ad-”rÜ: %d‡ˆ%"
PRId64
"\n", 
»t
, 
	`ffu¾_£ek
(
h
, 0, 
SEEK_CUR
));

699 
ç
;

701 
i
 = 0; i < 
»t
; ++i) {

702 ià(
buf
[
i
] !ğ(
pos
 & 0xFF)) {

703 
	`´štf
("»ad-mism©ch:‡ùu® %d,ƒx³ùšg %d,‡ˆ%"
PRId64
"\n",

704 ()
buf
[
i
], ()(
pos
 & 0xFF),…os);

707 
pos
++;

711 
»ad_Ën
 +ğ
»t
;

713 
	`´štf
("»ad: %"
PRId64
"\n", 
»ad_Ën
);

718 
»t
 = 
	`ffu¾_»ad
(
h
, 
buf
, 1);

719 
	`´štf
("»ad: %d\n", 
»t
);

721 
pos
 = 
	`ffu¾_£ek
(
h
, 
TEST_SEEK_POS
, 
SEEK_SET
);

722 
	`´štf
("£ek: %"
PRId64
"\n", 
pos
);

724 
»ad_Ën
 = 0;

726 
»t
 = 
	`ffu¾_»ad
(
h
, 
buf
, (buf));

727 ià(
»t
 =ğ
AVERROR_EOF
)

729 ià(
»t
 == 0)

731 ià(
»t
 < 0) {

732 
	`´štf
("»ad-”rÜ: %d‡ˆ%"
PRId64
"\n", 
»t
, 
	`ffu¾_£ek
(
h
, 0, 
SEEK_CUR
));

733 
ç
;

735 
i
 = 0; i < 
»t
; ++i) {

736 ià(
buf
[
i
] !ğ(
pos
 & 0xFF)) {

737 
	`´štf
("»ad-mism©ch:‡ùu® %d,ƒx³ùšg %d,‡ˆ%"
PRId64
"\n",

738 ()
buf
[
i
], ()(
pos
 & 0xFF),…os);

741 
pos
++;

745 
»ad_Ën
 +ğ
»t
;

747 
	`´štf
("»ad: %"
PRId64
"\n", 
»ad_Ën
);

749 
»t
 = 
	`ffu¾_»ad
(
h
, 
buf
, 1);

750 
	`´štf
("»ad: %d\n", 
»t
);

755 
	`ffu¾_şo£
(
h
);

756 
	`av_diù_£t_št
(&
İts
, "async-test-read-error", -10000, 0);

757 
»t
 = 
	`ffu¾_İ’
(&
h
, "async:async-‹¡:", 
AVIO_FLAG_READ
, 
NULL
, &
İts
);

758 
	`´štf
("İ’: %d\n", 
»t
);

760 
»t
 = 
	`ffu¾_»ad
(
h
, 
buf
, 1);

761 
	`´štf
("»ad: %d\n", 
»t
);

763 
ç
:

764 
	`av_diù_ä“
(&
İts
);

765 
	`ffu¾_şo£
(
h
);

767 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkavformat.h

25 #iâdeà
AVFORMAT_IJKAVFORMAT_H


26 
	#AVFORMAT_IJKAVFORMAT_H


	)

28 
	#AV_PKT_FLAG_DISCONTINUITY
 0x0100

	)

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkio.c

22 
	~<as£¹.h
>

23 
	~"libavfÜm©/avfÜm©.h
"

24 
	~"libavfÜm©/u¾.h
"

25 
	~"libavut/av¡ršg.h
"

26 
	~"libavut/log.h
"

27 
	~"libavut/İt.h
"

29 
	~"ijkiomªag”.h
"

30 
	~"ijk¶ay”/ijkavut/ijkdiù.h
"

32 
	sCÚ‹xt
 {

33 
AVCÏss
 *
	mşass
;

34 
št64_t
 *
	mio_mªag”_ùx
;

35 } 
	tCÚ‹xt
;

37 
	$ijkio_cİy_İtiÚs
(
IjkAVDiùiÚ¬y
 **
d¡
, 
AVDiùiÚ¬y
 *
¤c
) {

38 
AVDiùiÚ¬yEÁry
 *
t
 = 
NULL
;

40 (
t
 = 
	`av_diù_g‘
(
¤c
, "",, 
AV_DICT_IGNORE_SUFFIX
))) {

41 
»t
 = 
	`ijk_av_diù_£t
(
d¡
, 
t
->
key
,->
v®ue
, 0);

42 ià(
»t
 < 0)

43  
»t
;

47 
	}
}

49 
	$ijkio_İ’
(
URLCÚ‹xt
 *
h
, cÚ¡ *
¬g
, 
æags
, 
AVDiùiÚ¬y
 **
İtiÚs
)

51 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

52 
»t
 = -1;

54 ià(!
c
 || !c->
io_mªag”_ùx
)

57 
IjkIOMªag”CÚ‹xt
 *
mªag”_ùx
 = (IjkIOMªag”CÚ‹xˆ*)(
c
->
io_mªag”_ùx
);

58 
mªag”_ùx
->
ijkio_š‹¼u±_ÿÎback
 = (
IjkAVIOIÁ”ru±CB
 *)&(
h
->
š‹¼u±_ÿÎback
);

60 
	`av_¡r¡¬t
(
¬g
, "ijkio:", &arg);

61 
IjkAVDiùiÚ¬y
 *
İts
 = 
NULL
;

62 
	`ijkio_cİy_İtiÚs
(&
İts
, *
İtiÚs
);

64 
mªag”_ùx
->
cur_ffm³g_ùx
 = 
c
;

66 
»t
 = 
	`ijkio_mªag”_io_İ’
(
mªag”_ùx
, 
¬g
, 
æags
, &
İts
);

67 
	`ijk_av_diù_ä“
(&
İts
);

69 ià(
»t
 < 0) {

70 
	`ijkio_mªag”_io_şo£
(
mªag”_ùx
);

73  
»t
;

74 
	}
}

76 
	$ijkio_»ad
(
URLCÚ‹xt
 *
h
, *
buf
, 
size
)

78 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

80 ià(!
c
 || !c->
io_mªag”_ùx
)

83 ((
IjkIOMªag”CÚ‹xt
 *)(
c
->
io_mªag”_ùx
))->
cur_ffm³g_ùx
 = c;

84  
	`ijkio_mªag”_io_»ad
((
IjkIOMªag”CÚ‹xt
 *)(
c
->
io_mªag”_ùx
), 
buf
, 
size
);

85 
	}
}

87 
št64_t
 
	$ijkio_£ek
(
URLCÚ‹xt
 *
h
, 
št64_t
 
off£t
, 
wh’û
)

89 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

91 ià(!
c
 || !c->
io_mªag”_ùx
)

94 ((
IjkIOMªag”CÚ‹xt
 *)(
c
->
io_mªag”_ùx
))->
cur_ffm³g_ùx
 = c;

95  
	`ijkio_mªag”_io_£ek
((
IjkIOMªag”CÚ‹xt
 *)(
c
->
io_mªag”_ùx
), 
off£t
, 
wh’û
);

96 
	}
}

98 
	$ijkio_şo£
(
URLCÚ‹xt
 *
h
)

100 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

102 ià(!
c
 || !c->
io_mªag”_ùx
)

105 ((
IjkIOMªag”CÚ‹xt
 *)(
c
->
io_mªag”_ùx
))->
cur_ffm³g_ùx
 = c;

106  
	`ijkio_mªag”_io_şo£
((
IjkIOMªag”CÚ‹xt
 *)(
c
->
io_mªag”_ùx
));

107 
	}
}

109 
	#OFFSET
(
x
è
	`off£tof
(
CÚ‹xt
, x)

	)

110 
	#D
 
AV_OPT_FLAG_DECODING_PARAM


	)

112 cÚ¡ 
AVO±iÚ
 
	gİtiÚs
[] = {

113 { "ijkiomªag”", "IjkIOMªag”CÚ‹xt", 
OFFSET
(
io_mªag”_ùx
), 
AV_OPT_TYPE_INT64
, { .
i64
 = 0 }, 
	gINT64_MIN
, 
	gINT64_MAX
, .
	gæags
 = 
D
 },

116 #undeà
D


117 #undeà
OFFSET


119 cÚ¡ 
AVCÏss
 
	gijkio_cÚ‹xt_şass
 = {

120 .
şass_Çme
 = "IjkIo",

121 .
	g™em_Çme
 = 
av_deçuÉ_™em_Çme
,

122 .
	gİtiÚ
 = 
İtiÚs
,

123 .
	gv”siÚ
 = 
LIBAVUTIL_VERSION_INT
,

126 
URLPrÙocŞ
 
	gijkimp_ff_ijkio_´ÙocŞ
 = {

127 .
Çme
 = "ijkio",

128 .
	gu¾_İ’2
 = 
ijkio_İ’
,

129 .
	gu¾_»ad
 = 
ijkio_»ad
,

130 .
	gu¾_£ek
 = 
ijkio_£ek
,

131 .
	gu¾_şo£
 = 
ijkio_şo£
,

132 .
	g´iv_d©a_size
 = (
CÚ‹xt
),

133 .
	g´iv_d©a_şass
 = &
ijkio_cÚ‹xt_şass
,

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkioandroidio.c

21 
	~"ijkiou¾.h
"

22 
	~"libavfÜm©/avfÜm©.h
"

23 
	~"libavfÜm©/u¾.h
"

24 
	~"libavut/av¡ršg.h
"

25 
	~"libavut/log.h
"

26 
	~"libavut/İt.h
"

28 
	~"ijkavfÜm©/ijkavfÜm©.h
"

29 
	~"ijk¶ay”/ijkavut/İt.h
"

30 
	~"ijk¶ay”/ijkavut/ijkuts.h
"

32 
	~"j4a/şass/tv/dªmaku/ijk/medŸ/¶ay”/misc/IIjkIOH‰p.h
"

33 
	~"ijksdl/ªdroid/ijksdl_ªdroid_jni.h
"

34 
	~<as£¹.h
>

36 
	sIjkIOAndroidioCÚ‹xt
 {

37 
jobjeù
 
	mijkio_h‰p
;

38 
jby‹A¼ay
 
	mjbufãr
;

39 
	mjbufãr_ÿ·c™y
;

40 
URLCÚ‹xt
 *
	mšÃr
;

41 } 
	tIjkIOAndroidioCÚ‹xt
;

43 
	$ijkio_ªdroidio_İ’
(
IjkURLCÚ‹xt
 *
h
, cÚ¡ *
u¾
, 
æags
, 
IjkAVDiùiÚ¬y
 **
İtiÚs
) {

44 
IjkIOAndroidioCÚ‹xt
 *
c
ğ
h
->
´iv_d©a
;

45 
JNIEnv
 *
’v
 = 
NULL
;

46 
jobjeù
 
ijkio_h‰p
 = 
NULL
;

47 *
fš®
 = 
NULL
;

49 ià(!
c
)

52 
	`av_¡r¡¬t
(
u¾
, "androidio:http:", &url);

54 
ijkio_h‰p
 = (
jobjeù
è(
šŒ_t
è
	`¡¹Şl
(
u¾
, &
fš®
, 10);

55 ià(!
ijkio_h‰p
)

56  
	`AVERROR
(
EINVAL
);

58 ià(
JNI_OK
 !ğ
	`SDL_JNI_S‘upTh»adEnv
(&
’v
)) {

59 
	`av_log
(
h
, 
AV_LOG_ERROR
, "%s: SDL_JNI_S‘upTh»adEnv: faed", 
__func__
);

60  
	`AVERROR
(
EINVAL
);

63 
jšt
 
»t
 = 
	`J4AC_IIjkIOH‰p__İ’
(
’v
, 
ijkio_h‰p
);

64 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
)) {

65  
	`AVERROR
(
EINVAL
);

66 } ià(
»t
 < 0) {

67  
»t
;

70 
c
->
ijkio_h‰p
 = (*
’v
)->
	`NewGlob®Ref
(env, ijkio_http);

71 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
è|| !
c
->
ijkio_h‰p
) {

72  
	`AVERROR
(
ENOMEM
);

76 
	}
}

78 
jobjeù
 
	$jbufãr_grow
(
JNIEnv
 *
’v
, 
IjkURLCÚ‹xt
 *
h
, 
Ãw_ÿ·c™y
) {

79 
IjkIOAndroidioCÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

80 ià(!
c
)

81  
NULL
;

83 ià(
c
->
jbufãr
 && c->
jbufãr_ÿ·c™y
 >ğ
Ãw_ÿ·c™y
)

84  
c
->
jbufãr
;

86 
Ãw_ÿ·c™y
 = 
	`FFMAX
Òew_ÿ·c™y, 
c
->
jbufãr_ÿ·c™y
 * 2);

88 
	`J4A_D–‘eGlob®Ref__p
(
’v
, &
c
->
jbufãr
);

89 
c
->
jbufãr_ÿ·c™y
 = 0;

91 
c
->
jbufãr
 = 
	`J4A_NewBy‹A¼ay__asGlob®Ref__ÿtchAÎ
(
’v
, 
Ãw_ÿ·c™y
);

92 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
è|| !
c
->
jbufãr
) {

93 
c
->
jbufãr
 = 
NULL
;

94  
NULL
;

97 
c
->
jbufãr_ÿ·c™y
 = 
Ãw_ÿ·c™y
;

98  
c
->
jbufãr
;

99 
	}
}

101 
	$ijkio_ªdroidio_»ad
(
IjkURLCÚ‹xt
 *
h
, *
buf
, 
size
) {

102 
IjkIOAndroidioCÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

103 
JNIEnv
 *
’v
 = 
NULL
;

104 
jby‹A¼ay
 
jbufãr
 = 
NULL
;

105 
jšt
 
»t
 = 0;

107 ià(!
c
 || !c->
ijkio_h‰p
)

108  
	`AVERROR
(
EINVAL
);

110 ià(
JNI_OK
 !ğ
	`SDL_JNI_S‘upTh»adEnv
(&
’v
)) {

111 
	`av_log
(
h
, 
AV_LOG_ERROR
, "%s: SDL_JNI_S‘upTh»adEnv: faed", 
__func__
);

112  
	`AVERROR
(
EINVAL
);

115 
jbufãr
 = 
	`jbufãr_grow
(
’v
, 
h
, 
size
);

116 ià(!
jbufãr
)

117  
	`AVERROR
(
ENOMEM
);

119 
»t
 = 
	`J4AC_IIjkIOH‰p__»ad
(
’v
, 
c
->
ijkio_h‰p
, 
jbufãr
, 
size
);

120 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
))

121  
	`AVERROR
(
EIO
);

122 ià(
»t
 < 0)

123  
AVERROR_EOF
;

124 ià(
»t
 == 0)

125  
	`AVERROR
(
EAGAIN
);

127 (*
’v
)->
	`G‘By‹A¼ayRegiÚ
Ónv, 
jbufãr
, 0, 
»t
, (
jby‹
*)
buf
);

128 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
))

129  
	`AVERROR
(
EIO
);

131  
»t
;

132 
	}
}

134 
št64_t
 
	$ijkio_ªdroidio_£ek
(
IjkURLCÚ‹xt
 *
h
, 
št64_t
 
off£t
, 
wh’û
) {

135 
IjkIOAndroidioCÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

136 
št64_t
 
»t
;

137 
JNIEnv
 *
’v
 = 
NULL
;

139 ià(!
c
 || !c->
ijkio_h‰p
)

140  
	`AVERROR
(
EINVAL
);

142 ià(
JNI_OK
 !ğ
	`SDL_JNI_S‘upTh»adEnv
(&
’v
)) {

143 
	`av_log
(
h
, 
AV_LOG_ERROR
, "%s: SDL_JNI_S‘upTh»adEnv: faed", 
__func__
);

144  
	`AVERROR
(
EINVAL
);

147 
»t
 = 
	`J4AC_IIjkIOH‰p__£ek
(
’v
, 
c
->
ijkio_h‰p
, 
off£t
, 
wh’û
);

148 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
))

149  
	`AVERROR
(
EIO
);

151  
»t
;

152 
	}
}

154 
	$ijkio_ªdroidio_şo£
(
IjkURLCÚ‹xt
 *
h
) {

155 
IjkIOAndroidioCÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

156 
JNIEnv
 *
’v
 = 
NULL
;

158 ià(!
c
 || !c->
ijkio_h‰p
)

159  
	`AVERROR
(
EINVAL
);

161 ià(
JNI_OK
 !ğ
	`SDL_JNI_S‘upTh»adEnv
(&
’v
)) {

162 
	`av_log
(
h
, 
AV_LOG_ERROR
, "%s: SDL_JNI_S‘upTh»adEnv: faed", 
__func__
);

163  
	`AVERROR
(
EINVAL
);

166 
	`J4A_D–‘eGlob®Ref__p
(
’v
, &
c
->
jbufãr
);

168 ià(
c
->
ijkio_h‰p
) {

169 
	`J4AC_IIjkIOH‰p__şo£__ÿtchAÎ
(
’v
, 
c
->
ijkio_h‰p
);

170 
	`J4A_D–‘eGlob®Ref__p
(
’v
, &
c
->
ijkio_h‰p
);

174 
	}
}

176 
IjkURLPrÙocŞ
 
	gijkio_ªdroidio_´ÙocŞ
 = {

177 .
Çme
 = "ijkioandroidio",

178 .
	gu¾_İ’2
 = 
ijkio_ªdroidio_İ’
,

179 .
	gu¾_»ad
 = 
ijkio_ªdroidio_»ad
,

180 .
	gu¾_£ek
 = 
ijkio_ªdroidio_£ek
,

181 .
	gu¾_şo£
 = 
ijkio_ªdroidio_şo£
,

182 .
	g´iv_d©a_size
 = (
IjkIOAndroidioCÚ‹xt
),

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkioapplication.c

21 
	~"ijkißµliÿtiÚ.h
"

23 
	~<¡dlib.h
>

25 
	$ijkio_­¶iÿtiÚ_®loc
(
IjkIOAµliÿtiÚCÚ‹xt
 **
ph
, *
İaque
) {

26 
IjkIOAµliÿtiÚCÚ‹xt
 *
h
 = 
NULL
;

28 
h
 = 
	`ÿÎoc
(1, (
IjkIOAµliÿtiÚCÚ‹xt
));

29 ià(!
h
)

32 
h
->
İaque
 = opaque;

34 *
ph
 = 
h
;

36 
	}
}

38 
	$ijkio_­¶iÿtiÚ_İ’
(
IjkIOAµliÿtiÚCÚ‹xt
 **
ph
, *
İaque
) {

39 
»t
 = 
	`ijkio_­¶iÿtiÚ_®loc
(
ph
, 
İaque
);

40 ià(
»t
)

41  
»t
;

44 
	}
}

46 
	$ijkio_­¶iÿtiÚ_şo£
(
IjkIOAµliÿtiÚCÚ‹xt
 *
h
) {

47 
	`ä“
(
h
);

48 
	}
}

50 
	$ijkio_­¶iÿtiÚ_şo£p
(
IjkIOAµliÿtiÚCÚ‹xt
 **
ph
) {

51 ià(!
ph
 || !*ph)

54 
	`ijkio_­¶iÿtiÚ_şo£
(*
ph
);

55 *
ph
 = 
NULL
;

56 
	}
}

58 
	$ijkio_­¶iÿtiÚ_Ú_ÿche_¡©i¡ic
(
IjkIOAµliÿtiÚCÚ‹xt
 *
h
, 
IjkIOAµCacheSti¡ic
 *
¡©i¡ic
) {

59 ià(
h
 && h->
func_ijkio_Ú_­p_ev’t
)

60 
h
->
	`func_ijkio_Ú_­p_ev’t
(h, 
IJKIOAPP_EVENT_CACHE_STATISTIC
, (*)
¡©i¡ic
, (
IjkIOAµCacheSti¡ic
));

61 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkioapplication.h

22 #iâdeà
IJKAVFORMAT_IJKIOAPPLICATION_H


23 
	#IJKAVFORMAT_IJKIOAPPLICATION_H


	)

25 
	~"ijk¶ay”/ijkavut/ijkuts.h
"

26 
	~"ijk¶ay”/ijkavut/ijkth»adpoŞ.h
"

28 
	~<¡dšt.h
>

30 
	#CACHE_FILE_PATH_MAX_LEN
 512

	)

31 
	#IJKIOAPP_EVENT_CACHE_STATISTIC
 0x1003

32 

	)

33 
	sIjkIOAµCacheSti¡ic
 {

34 
št64_t
 
	mÿche_physiÿl_pos
;

35 
št64_t
 
	mÿche_buf_fÜw¬ds
;

36 
št64_t
 
	mÿche_fe_pos
;

37 
št64_t
 
	mÿche_couÁ_by‹s
;

38 } 
	tIjkIOAµCacheSti¡ic
;

40 
IjkIOAµliÿtiÚCÚ‹xt
 
	tIjkIOAµliÿtiÚCÚ‹xt
;

41 
	sIjkIOAµliÿtiÚCÚ‹xt
 {

42 
IjkTh»adPoŞCÚ‹xt
 *
	mth»adpoŞ_ùx
;

43 
IjkAVIOIÁ”ru±CB
 *
	mijkio_š‹¼u±_ÿÎback
;

44 
	mÿche_fe_·th
[
CACHE_FILE_PATH_MAX_LEN
];

45 
št64_t
 
	mÏ¡_physiÿl_pos
;

46 
št64_t
 
	mÿche_lim™_fe_pos
;

47 *
	mÿche_šfo_m­
;

48 *
	mİaque
;

49 
št64_t
 
	mÿche_couÁ_by‹s
;

50 (*
	mfunc_ijkio_Ú_­p_ev’t
)(
IjkIOAµliÿtiÚCÚ‹xt
 *
	mh
, 
	mev’t_ty³
 ,*
	mobj
, 
	msize
);

53 
ijkio_­¶iÿtiÚ_®loc
(
IjkIOAµliÿtiÚCÚ‹xt
 **
ph
, *
İaque
);

54 
ijkio_­¶iÿtiÚ_İ’
(
IjkIOAµliÿtiÚCÚ‹xt
 **
ph
, *
İaque
);

55 
ijkio_­¶iÿtiÚ_şo£
(
IjkIOAµliÿtiÚCÚ‹xt
 *
h
);

56 
ijkio_­¶iÿtiÚ_şo£p
(
IjkIOAµliÿtiÚCÚ‹xt
 **
ph
);

58 
ijkio_­¶iÿtiÚ_Ú_ÿche_¡©i¡ic
(
IjkIOAµliÿtiÚCÚ‹xt
 *
h
, 
IjkIOAµCacheSti¡ic
 *
¡©i¡ic
);

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkiocache.c

21 
	~"ijkiou¾.h
"

22 
	~"ijkiİrÙocŞ.h
"

23 
	~"ijkißµliÿtiÚ.h
"

24 
	~"ijk¶ay”/ijkavut/ijkŒ“.h
"

25 
	~"ijk¶ay”/ijkavut/ijkuts.h
"

26 
	~"ijk¶ay”/ijkavut/ijkth»adpoŞ.h
"

27 
	~"ijk¶ay”/ijkavut/ijk¡l.h
"

28 
	~"ijk¶ay”/ijkavut/ijkfifo.h
"

30 
	~<¡dšt.h
>

31 
	~<¡dio.h
>

32 
	~<¡dlib.h
>

33 
	~<¡ddef.h
>

34 
	~<¡ršg.h
>

35 
	~<fú.h
>

36 
	~<sys/¡©.h
>

37 
	~<uni¡d.h
>

38 
	~<as£¹.h
>

40 
	#DEFAULT_CACHE_MAX_CAPACITY
 (521 * 1024 * 1024)

	)

41 
	#DEFAULT_CACHE_FORWARDS_FIFO_CAPACITY
 (8 * 1024 * 1024)

	)

42 
	#DEFAULT_CACHE_FILE_FORWARDS_CAPACITY
 (8 * 1024 * 1024)

	)

43 #iâdeà
O_BINARY


44 
	#O_BINARY
 0

	)

47 
	sIjkIOCacheCÚ‹xt
 {

48 *
	mÿche_fe_·th
;

49 
	mfd
;

50 
IjkCacheT»eInfo
 *
	mŒ“_šfo
;

51 
št64_t
 
	mlogiÿl_size
;

52 
št64_t
 
	m»ad_logiÿl_pos
;

53 
št64_t
 
	mfe_logiÿl_pos
;

54 
št64_t
 
	mfifo_logiÿl_pos
;

55 
št64_t
 
	mÿche_physiÿl_pos
;

56 
št64_t
 
	mfe_šÃr_pos
;

57 
št64_t
 
	mfe_logiÿl_’d
;

58 
št64_t
 
	mÿche_max_ÿ·c™y
;

59 
št64_t
 
	mÿche_fÜw¬ds_fifo_ÿ·c™y
;

60 
št64_t
 
	mÿche_fe_fÜw¬ds_ÿ·c™y
;

61 
	mÿche_fe_şo£
;

62 
	mfifo_pos_»£t
;

63 
	mio_eof_»ached
;

64 
	mfifo_eof_»ached
;

65 
	mio_”rÜ
;

66 
	mšÃr_io_”rÜ
;

67 
	m»ad_fe_šÃr_”rÜ
;

68 
	mfe_hªdË_»Œy_couÁ
;

69 
	mfe_”rÜ_couÁ
;

70 
	m£ek_»que¡
;

71 
	m£ek_com¶‘ed
;

72 
	m£ek_wh’û
;

73 
št64_t
 
	m£ek_pos
;

74 
št64_t
 
	m£ek_»t
;

76 
	mcur_fe_no
;

77 *
	mÿche_šfo_m­
;

78 
št64_t
 *
	mÏ¡_physiÿl_pos
;

79 
št64_t
 *
	mÿche_lim™_fe_pos
;

80 
št64_t
 *
	mÿche_couÁ_by‹s
;

82 
IjkFifoBufãr
 *
	mfifo
;

83 
št64_t
 
	mphysiÿl_fifo_pos
;

84 
±h»ad_cÚd_t
 
	mcÚd_wakeup_maš
;

85 
±h»ad_cÚd_t
 
	mcÚd_wakeup_background
;

86 
±h»ad_cÚd_t
 
	mcÚd_wakeup_ex™
;

87 
±h»ad_mu‹x_t
 
	mmu‹x
;

88 
	mabÜt_»que¡
;

89 
IjkAVIOIÁ”ru±CB
 *
	mijkio_š‹¼u±_ÿÎback
;

90 
	msk_is_ruÂšg
;

92 
IjkURLCÚ‹xt
 *
	mšÃr
;

93 
IjkTh»adPoŞCÚ‹xt
 *
	mth»adpoŞ_ùx
;

94 
IjkIOAµliÿtiÚCÚ‹xt
 *
	mijkio_­p_ùx
;

95 } 
	tIjkIOCacheCÚ‹xt
;

97 
	sIjkCacheEÁry
 {

98 
št64_t
 
	mlogiÿl_pos
;

99 
št64_t
 
	mphysiÿl_pos
;

100 
št64_t
 
	msize
;

101 } 
	tIjkCacheEÁry
;

103 
	$cmp
(cÚ¡ *
key
, cÚ¡ *
node
)

105  
	`FFDIFFSIGN
(*(cÚ¡ 
št64_t
 *)
key
, ((cÚ¡ 
IjkCacheEÁry
 *è
node
)->
logiÿl_pos
);

106 
	}
}

108 
	$ÿÎ_šjeù_¡©i¡ic
(
IjkURLCÚ‹xt
 *
h
)

110 
IjkIOCacheCÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

112 ià(
c
->
ijkio_­p_ùx
) {

113 
IjkIOAµCacheSti¡ic
 
¡©i¡ic
 = {0};

114 
¡©i¡ic
.
ÿche_physiÿl_pos
 = 
c
->cache_physical_pos;

115 
¡©i¡ic
.
ÿche_buf_fÜw¬ds
 = 
	`ijk_av_fifo_size
(
c
->
fifo
);

116 
¡©i¡ic
.
ÿche_fe_pos
 = 
c
->
fe_logiÿl_pos
;

117 
¡©i¡ic
.
ÿche_couÁ_by‹s
 = *
c
->cache_count_bytes;

118 
	`ijkio_­¶iÿtiÚ_Ú_ÿche_¡©i¡ic
(
c
->
ijkio_­p_ùx
, &
¡©i¡ic
);

120 
	}
}

122 
	$ijkio_ÿche_check_š‹¼u±
(
IjkURLCÚ‹xt
 *
h
)

124 
IjkIOCacheCÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

125 ià(!
c
)

128 ià(
c
->
abÜt_»que¡
)

131 ià(
c
->
ijkio_š‹¼u±_ÿÎback
 && c->ijkio_š‹¼u±_ÿÎback->
ÿÎback
 &&

132 
c
->
ijkio_š‹¼u±_ÿÎback
->
	`ÿÎback
(c->ijkio_š‹¼u±_ÿÎback->
İaque
)) {

133 
c
->
abÜt_»que¡
 = 1;

136 ià(
c
->
abÜt_»que¡
)

139  
c
->
abÜt_»que¡
;

140 
	}
}

142 
	$’u_ä“
(*
İaque
, *
–em
)

144 
	`ä“
(
–em
);

146 
	}
}

148 
	$Œ“_de¡roy
(*
–em
)

150 
IjkCacheT»eInfo
 *
šfo
 = 
–em
;

151 
	`ijk_av_Œ“_’um”©e
(
šfo
->
roÙ
, 
NULL
, NULL, 
’u_ä“
);

152 
	`ijk_av_Œ“_de¡roy
(
šfo
->
roÙ
);

153 
	`ä“
(
šfo
);

155 
	}
}

157 
	$ijkio_ÿche_fe_”rÜ
(
IjkURLCÚ‹xt
 *
h
) {

158 
IjkIOCacheCÚ‹xt
 *
c
ğ
h
->
´iv_d©a
;

159 ià(
c
 && c->
fe_hªdË_»Œy_couÁ
 > 3) {

160 
c
->
fe_”rÜ_couÁ
++;

161 
	`ijk_m­_Œav”§l_hªdË
(
c
->
ÿche_šfo_m­
, 
Œ“_de¡roy
);

162 
	`ijk_m­_ş—r
(
c
->
ÿche_šfo_m­
);

163 
c
->
Œ“_šfo
 = 
NULL
;

164 *
c
->
Ï¡_physiÿl_pos
 = 0;

165 
c
->
ÿche_physiÿl_pos
 = 0;

166 
c
->
fe_šÃr_pos
 = 0;

167 
c
->
io_eof_»ached
 = 0;

168 
c
->
fe_logiÿl_pos
 = c->
fifo_logiÿl_pos
;

169 
	`şo£
(
c
->
fd
);

170 
c
->
fd
 = -1;

171 ià(
c
->
fe_”rÜ_couÁ
 > 3) {

172 
c
->
fifo_pos_»£t
 = 1;

173 
c
->
ÿche_fe_şo£
 = 1;

174 
	`şo£
(
c
->
fd
);

175 
	`»move
(
c
->
ÿche_fe_·th
);

176 
c
->
fd
 = -1;

179 
c
->
fd
 = 
	`İ’
(c->
ÿche_fe_·th
, 
O_RDWR
 | 
O_BINARY
 | 
O_CREAT
 | 
O_TRUNC
, 0600);

180 ià(
c
->
fd
 >= 0) {

181 
c
->
fe_hªdË_»Œy_couÁ
 = 0;

182 
c
->
Œ“_šfo
 = 
	`ÿÎoc
(1, (
IjkCacheT»eInfo
));

184 
c
->
fifo_pos_»£t
 = 1;

185 
c
->
ÿche_fe_şo£
 = 1;

190 
	}
}

192 
št64_t
 
	$ijkio_ÿche_fe_ov”¿ng
(
IjkURLCÚ‹xt
 *
h
, 
št64_t
 *
cur_pos
, 
size
) {

193 
IjkIOCacheCÚ‹xt
 *
c
ğ
h
->
´iv_d©a
;

194 
IjkCacheT»eInfo
 *
Œ“_šfo
 = 
NULL
;

195 
št64_t
 
ä“_¥aû
 = 0;

196 
št64_t
 
mš_roÙ_id
 = 0;

197 
is_fœ¡_pos
 = 1;

199 ià(1 =ğ
	`ijk_m­_size
(
c
->
ÿche_šfo_m­
)) {

200 
Œ“_šfo
 = 
	`ijk_m­_šdex_g‘
(
c
->
ÿche_šfo_m­
, 0);

201 
ä“_¥aû
 +ğ
Œ“_šfo
->
physiÿl_size
;

202 *
cur_pos
 = 
	`l£ek
(
c
->
fd
, 0, 
SEEK_SET
);

203 *
c
->
ÿche_lim™_fe_pos
 = c->
ÿche_max_ÿ·c™y
;

204 
	`ijk_av_Œ“_’um”©e
(
Œ“_šfo
->
roÙ
, 
NULL
, NULL, 
’u_ä“
);

205 
	`ijk_av_Œ“_de¡roy
(
Œ“_šfo
->
roÙ
);

206 
	`mem£t
(
c
->
Œ“_šfo
, 0, (
IjkCacheT»eInfo
));

207 
c
->
fe_logiÿl_pos
 = c->
fifo_logiÿl_pos
;

208 
c
->
io_eof_»ached
 = 0;

209 *
c
->
Ï¡_physiÿl_pos
 = 0;

210 
c
->
ÿche_physiÿl_pos
 = 0;

211  
c
->
ÿche_max_ÿ·c™y
;

213 
	`ijk_m­_»move
(
c
->
ÿche_šfo_m­
, (
št64_t
)c->
cur_fe_no
);

217 
mš_roÙ_id
 = 
	`ijk_m­_g‘_mš_key
(
c
->
ÿche_šfo_m­
);

218 ià(
mš_roÙ_id
 >= 0)

219 
Œ“_šfo
 = 
	`ijk_m­_g‘
(
c
->
ÿche_šfo_m­
, 
mš_roÙ_id
);

223 ià(
Œ“_šfo
) {

224 
ä“_¥aû
 +ğ
Œ“_šfo
->
physiÿl_size
;

225 
št64_t
 
pos
 = 
	`l£ek
(
c
->
fd
, 
Œ“_šfo
->
physiÿl_š™_pos
, 
SEEK_SET
);

226 ià(
pos
 < 0) {

229 ià(
is_fœ¡_pos
) {

230 *
cur_pos
 = 
pos
;

231 
is_fœ¡_pos
 = 0;

233 
	`ijk_m­_»move
(
c
->
ÿche_šfo_m­
, 
mš_roÙ_id
);

234 *
c
->
Ï¡_physiÿl_pos
 = 
pos
;

235 
c
->
ÿche_physiÿl_pos
 = 
pos
;

236 *
c
->
ÿche_lim™_fe_pos
 = 
Œ“_šfo
->
physiÿl_size
 +»e_šfo->
physiÿl_š™_pos
;

238 ià(*
c
->
ÿche_lim™_fe_pos
 > c->
ÿche_max_ÿ·c™y
)

239 *
c
->
ÿche_lim™_fe_pos
 = c->
ÿche_max_ÿ·c™y
;

241 
	`ijk_av_Œ“_’um”©e
(
Œ“_šfo
->
roÙ
, 
NULL
, NULL, 
’u_ä“
);

242 
	`ijk_av_Œ“_de¡roy
(
Œ“_šfo
->
roÙ
);

243 
	`ä“
(
Œ“_šfo
);

248 ià(
ä“_¥aû
 >ğ
size
) {

253 
	`ijk_m­_put
(
c
->
ÿche_šfo_m­
, (
št64_t
)c->
cur_fe_no
, c->
Œ“_šfo
);

255  
ä“_¥aû
;

256 
	}
}

258 
št64_t
 
	$add_’Œy
(
IjkURLCÚ‹xt
 *
h
, cÚ¡ *
buf
, 
size
)

260 
IjkIOCacheCÚ‹xt
 *
c
ğ
h
->
´iv_d©a
;

261 
št64_t
 
pos
 = -1;

262 
št64_t
 
»t
;

263 
IjkCacheEÁry
 *
’Œy
 = 
NULL
, *
Ãxt
[2] = {NULL, NULL};

264 
IjkCacheEÁry
 *
’Œy_»t
;

265 
IjkAVT»eNode
 *
node
 = 
NULL
;

266 
št64_t
 
ä“_¥aû
;

269 
pos
 = 
	`l£ek
(
c
->
fd
, *c->
Ï¡_physiÿl_pos
, 
SEEK_SET
);

271 ià(
pos
 < 0) {

272 
»t
 = 
	`IJKAVERROR
(
”ºo
);

273 
c
->
fe_hªdË_»Œy_couÁ
++;

274 
	`ijkio_ÿche_fe_”rÜ
(
h
);

275  
»t
;

277 
c
->
ÿche_physiÿl_pos
 = 
pos
;

278 *
c
->
Ï¡_physiÿl_pos
 = 
pos
;

281 ià(
pos
 + 
size
 >ğ*
c
->
ÿche_lim™_fe_pos
) {

282 
ä“_¥aû
 = 
	`ijkio_ÿche_fe_ov”¿ng
(
h
, &
pos
, 
size
);

283 ià(
ä“_¥aû
 < 
size
) {

284 
c
->
fifo_pos_»£t
 = 1;

285 
c
->
ÿche_fe_şo£
 = 1;

288 ià(
pos
 < 0) {

289 
»t
 = 
	`IJKAVERROR
(
”ºo
);

290 
c
->
fe_hªdË_»Œy_couÁ
++;

291 
	`ijkio_ÿche_fe_”rÜ
(
h
);

292  
»t
;

294 ià(
ä“_¥aû
 =ğ
c
->
ÿche_max_ÿ·c™y
)

298 
»t
 = 
	`wr™e
(
c
->
fd
, 
buf
, 
size
);

299 ià(
»t
 < 0) {

300 
»t
 = 
	`IJKAVERROR
(
”ºo
);

301 
c
->
fe_hªdË_»Œy_couÁ
++;

302 
	`ijkio_ÿche_fe_”rÜ
(
h
);

303  
»t
;

305 
c
->
fe_hªdË_»Œy_couÁ
 = 0;

308 
c
->
ÿche_physiÿl_pos
 +ğ
»t
;

309 *
c
->
Ï¡_physiÿl_pos
 +ğ
»t
;

310 
c
->
Œ“_šfo
->
physiÿl_size
 +ğ
»t
;

312 
’Œy
 = 
	`ijk_av_Œ“_fšd
(
c
->
Œ“_šfo
->
roÙ
, &c->
fe_logiÿl_pos
, 
cmp
, (**)
Ãxt
);

314 ià(!
’Œy
)

315 
’Œy
 = 
Ãxt
[0];

317 ià(!
’Œy
 ||

318 
’Œy
->
logiÿl_pos
 +ƒÁry->
size
 !ğ
c
->
fe_logiÿl_pos
 ||

319 
’Œy
->
physiÿl_pos
 +ƒÁry->
size
 !ğ
pos


321 
’Œy
 = 
	`m®loc
((*entry));

322 
node
 = 
	`ijk_av_Œ“_node_®loc
();

323 ià(!
’Œy
 || !
node
) {

324 
»t
 = 
	`IJKAVERROR
(
ENOMEM
);

325 
ç
;

327 
’Œy
->
logiÿl_pos
 = 
c
->
fe_logiÿl_pos
;

328 
’Œy
->
physiÿl_pos
 = 
pos
;

329 
’Œy
->
size
 = 
»t
;

331 
’Œy_»t
 = 
	`ijk_av_Œ“_š£¹
(&
c
->
Œ“_šfo
->
roÙ
, 
’Œy
, 
cmp
, &
node
);

332 ià(
’Œy_»t
 &&ƒÁry_»ˆ!ğ
’Œy
) {

333 
»t
 = -1;

335 
ç
;

338 
’Œy
->
size
 +ğ
»t
;

340  
»t
;

341 
ç
:

344 
	`ä“
(
’Œy
);

345 
	`ä“
(
node
);

346  
»t
;

347 
	}
}

349 
	$w¿µed_fe_»ad
(*
¤c
, *
d¡
, 
size
)

351 
IjkURLCÚ‹xt
 *
h
 = 
¤c
;

352 
IjkIOCacheCÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

353 
»t
;

355 
»t
 = ()
	`»ad
(
c
->
fd
, 
d¡
, 
size
);

356 
c
->
»ad_fe_šÃr_”rÜ
 = 
»t
 < 0 ?„et : 0;

357  
»t
;

358 
	}
}

360 
	$w¿µed_u¾_»ad
(*
¤c
, *
d¡
, 
size
)

362 
IjkURLCÚ‹xt
 *
h
 = 
¤c
;

363 
IjkIOCacheCÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

364 
»t
;

366 
»t
 = 
c
->
šÃr
->
´Ù
->
	`u¾_»ad
(c->šÃr, 
d¡
, 
size
);

368 ià(
»t
 > 0)

369 *
c
->
ÿche_couÁ_by‹s
 +ğ
»t
;

371 
c
->
šÃr_io_”rÜ
 = 
»t
 < 0 ?„et : 0;

373  
»t
;

374 
	}
}

376 
št64_t
 
	$ijkio_ÿche_fl_fifo
(
IjkURLCÚ‹xt
 *
h
) {

377 
IjkIOCacheCÚ‹xt
 *
c
ğ
h
->
´iv_d©a
;

378 ià(!
c
)

379  
	`IJKAVERROR
(
ENOSYS
);

381 
to_cİy
, 
fifo_¥aû
;

382 
IjkCacheEÁry
 *
’Œy
, *
Ãxt
[2] = {
NULL
, NULL};

383 
št64_t
 
r
 = 0;

384 
	`±h»ad_mu‹x_lock
(&
c
->
mu‹x
);

385 ià(
	`ijkio_ÿche_check_š‹¼u±
(
h
)) {

386 
c
->
io_eof_»ached
 = 1;

387 
c
->
fifo_eof_»ached
 = 1;

388 
c
->
io_”rÜ
 = 
IJKAVERROR_EXIT
;

389 
	`±h»ad_cÚd_sigÇl
(&
c
->
cÚd_wakeup_maš
);

390 
	`±h»ad_mu‹x_uÆock
(&
c
->
mu‹x
);

391  
IJKAVERROR_EXIT
;

394 ià(
c
->
£ek_»que¡
) {

395 
c
->
io_eof_»ached
 = 0;

396 
c
->
fifo_eof_»ached
 = 0;

397 
c
->
io_”rÜ
 = 0;

399 
c
->
£ek_com¶‘ed
 = 1;

400 
c
->
£ek_»que¡
 = 0;

401 
c
->
fifo_logiÿl_pos
 = c->
£ek_pos
;

402 
c
->
fe_logiÿl_pos
 = c->
£ek_pos
;

403 
c
->
£ek_»t
 = c->
£ek_pos
;

405 
	`ijk_av_fifo_»£t
(
c
->
fifo
);

406 ià(
c
->
ÿche_fe_şo£
) {

407 ià(!
c
->
šÃr
 || !c->šÃr->
´Ù
 || !c->inner->prot) {

408 
c
->
£ek_»t
 = 
	`IJKAVERROR
(
ENOSYS
);

410 
c
->
£ek_»t
 = c->
šÃr
->
´Ù
->
	`u¾_£ek
(c->šÃr, c->
fifo_logiÿl_pos
, 
SEEK_SET
);

415 
fifo_¥aû
 = 
	`ijk_av_fifo_¥aû
(
c
->
fifo
);

417 ià(
c
->
ÿche_fe_şo£
) {

418 ià(
c
->
fifo_eof_»ached
 || 
fifo_¥aû
 <= 0) {

419 
	`±h»ad_cÚd_sigÇl
(&
c
->
cÚd_wakeup_maš
);

420 
	`±h»ad_cÚd_wa™
(&
c
->
cÚd_wakeup_background
, &c->
mu‹x
);

421 
	`±h»ad_mu‹x_uÆock
(&
c
->
mu‹x
);

425 
št64_t
 
fe_fÜw¬ds_¥eû
 = 
c
->
fe_logiÿl_pos
 - c->
fifo_logiÿl_pos
;

426 ià(
c
->
fifo_eof_»ached
 || 
fifo_¥aû
 <= 0) {

427 
	`±h»ad_cÚd_sigÇl
(&
c
->
cÚd_wakeup_maš
);

428 ià((
fe_fÜw¬ds_¥eû
 >ğ
c
->
ÿche_fe_fÜw¬ds_ÿ·c™y
è|| c->
io_eof_»ached
) {

429 
	`±h»ad_cÚd_wa™
(&
c
->
cÚd_wakeup_background
, &c->
mu‹x
);

431 
	`±h»ad_mu‹x_uÆock
(&
c
->
mu‹x
);

436 
	`±h»ad_mu‹x_uÆock
(&
c
->
mu‹x
);

437 
to_cİy
 = 
	`FFMIN
(4096, 
fifo_¥aû
);

439 ià(
to_cİy
 <= 0) {

440 
	`±h»ad_cÚd_sigÇl
(&
c
->
cÚd_wakeup_maš
);

441  
r
;

444 ià(!
c
->
ÿche_fe_şo£
) {

445 
’Œy
 = 
	`ijk_av_Œ“_fšd
(
c
->
Œ“_šfo
->
roÙ
, &c->
fifo_logiÿl_pos
, 
cmp
, (**)
Ãxt
);

446 ià(!
’Œy
)

447 
’Œy
 = 
Ãxt
[0];

449 ià(
’Œy
) {

450 
št64_t
 
š_block_pos
 = 
c
->
fifo_logiÿl_pos
 - 
’Œy
->
logiÿl_pos
;

451 
	`as£¹
(
’Œy
->
logiÿl_pos
 <ğ
c
->
fifo_logiÿl_pos
);

452 ià(
š_block_pos
 < 
’Œy
->
size
) {

453 
št64_t
 
physiÿl_rg‘
 = 
’Œy
->
physiÿl_pos
 + 
š_block_pos
;

454 ià(
c
->
ÿche_physiÿl_pos
 !ğ
physiÿl_rg‘
) {

455 
r
 = 
	`l£ek
(
c
->
fd
, 
physiÿl_rg‘
, 
SEEK_SET
);

456 ià(
r
 < 0) {

457 
c
->
fe_hªdË_»Œy_couÁ
++;

458 
	`ijkio_ÿche_fe_”rÜ
(
h
);

461 
r
 = 
c
->
ÿche_physiÿl_pos
;

464 ià(
r
 >= 0) {

465 
to_cİy
 = ()
	`FFMIN
Ño_cİy, 
’Œy
->
size
 - 
š_block_pos
);

466 
r
 = 
	`ijk_av_fifo_g’”ic_wr™e
(
c
->
fifo
, 
h
, 
to_cİy
, 
w¿µed_fe_»ad
);

467 ià(
r
 > 0) {

468 
c
->
fifo_logiÿl_pos
 +ğ
r
;

470 if(
c
->
»ad_fe_šÃr_”rÜ
) {

471 
c
->
fe_hªdË_»Œy_couÁ
++;

472 
	`ijkio_ÿche_fe_”rÜ
(
h
);

477 ià(
c
->
io_eof_»ached
)

478 
c
->
fifo_eof_»ached
 = 1;

481 ià(
c
->
io_eof_»ached
)

482 
c
->
fifo_eof_»ached
 = 1;

485 ià(!
c
->
šÃr
 || !c->šÃr->
´Ù
 || !c->inner->prot) {

486 
r
 = 
	`IJKAVERROR
(
ENOSYS
);

488 ià(
c
->
fifo_pos_»£t
) {

489 
r
 = 
c
->
šÃr
->
´Ù
->
	`u¾_£ek
(c->šÃr, c->
fifo_logiÿl_pos
, 
SEEK_SET
);

490 ià(
r
 < 0)

491  
r
;

493 
c
->
fifo_pos_»£t
 = 0;

496 
r
 = 
	`ijk_av_fifo_g’”ic_wr™e
(
c
->
fifo
, 
h
, 
to_cİy
, 
w¿µed_u¾_»ad
);

497 ià(
r
 > 0) {

498 
c
->
fifo_logiÿl_pos
 +ğ
r
;

500 
c
->
io_eof_»ached
 = 1;

501 
c
->
fifo_eof_»ached
 = 1;

502 ià(
c
->
šÃr_io_”rÜ
 < 0)

503 
c
->
io_”rÜ
 = c->
šÃr_io_”rÜ
;

508 
	`±h»ad_cÚd_sigÇl
(&
c
->
cÚd_wakeup_maš
);

509  
r
;

510 
	}
}

512 
št64_t
 
	$ijkio_ÿche_wr™e_fe
(
IjkURLCÚ‹xt
 *
h
) {

513 
IjkIOCacheCÚ‹xt
 *
c
ğ
h
->
´iv_d©a
;

514 
št64_t
 
r
;

515 
buf
[4096] = {0};

516 
to_»ad
 = 4096;

517 
št64_t
 
to_cİy
 = (št64_t)
to_»ad
;

519 
IjkCacheEÁry
 *
roÙ
 = 
NULL
 ,*
l_’Œy
 = NULL, *
r_’Œy
 = NULL, *
Ãxt
[2] = {NULL, NULL};

521 ià(!
c
 || !c->
šÃr
 || !c->šÃr->
´Ù
 || !c->inner->prot)

522  
	`IJKAVERROR
(
ENOSYS
);

524 
roÙ
 = 
	`ijk_av_Œ“_fšd
(
c
->
Œ“_šfo
->roÙ, &c->
fe_logiÿl_pos
, 
cmp
, (**)
Ãxt
);

526 ià(!
roÙ
)

527 
l_’Œy
 = 
Ãxt
[0];

529 ià(
l_’Œy
) {

530 
št64_t
 
š_block_pos
 = 
c
->
fe_logiÿl_pos
 - 
l_’Œy
->
logiÿl_pos
;

531 
	`as£¹
(
l_’Œy
->
logiÿl_pos
 <ğ
c
->
fe_logiÿl_pos
);

532 ià(
š_block_pos
 < 
l_’Œy
->
size
) {

533 
c
->
fe_logiÿl_pos
 = 
l_’Œy
->
logiÿl_pos
 +†_’Œy->
size
;

535 } ià(
roÙ
) {

536 
št64_t
 
š_block_pos
 = 
c
->
fe_logiÿl_pos
 - 
roÙ
->
logiÿl_pos
;

537 
	`as£¹
(
roÙ
->
logiÿl_pos
 <ğ
c
->
fe_logiÿl_pos
);

538 ià(
š_block_pos
 < 
roÙ
->
size
) {

539 
c
->
fe_logiÿl_pos
 = 
roÙ
->
logiÿl_pos
 +„oÙ->
size
;

543 
r_’Œy
 = 
Ãxt
[1];

545 ià(
r_’Œy
) {

546 
to_cİy
 = 
r_’Œy
->
logiÿl_pos
 - 
c
->
fe_logiÿl_pos
;

547 
to_cİy
 = 
	`FFMIN
Ño_cİy, 
to_»ad
);

550 ià(
to_cİy
 == 0) {

554 ià(
c
->
fe_logiÿl_’d
 > 0 && c->
fe_logiÿl_pos
 == c->file_logical_end) {

555 
c
->
io_eof_»ached
 = 1;

559 ià(
c
->
fe_logiÿl_pos
 >ğc->
logiÿl_size
) {

560 
c
->
io_eof_»ached
 = 1;

564 ià(
c
->
fe_logiÿl_pos
 !ğc->
fe_šÃr_pos
) {

565 
r
 = 
c
->
šÃr
->
´Ù
->
	`u¾_£ek
(c->šÃr, c->
fe_logiÿl_pos
, 
SEEK_SET
);

566 ià(
r
 < 0) {

567 
c
->
io_eof_»ached
 = 1;

568 ià(
c
->
fe_logiÿl_’d
 =ğc->
fe_logiÿl_pos
) {

569 
c
->
fe_šÃr_pos
 = c->
fe_logiÿl_’d
;

571  
r
;

573 
c
->
fe_šÃr_pos
 = 
r
;

575 
r
 = 
c
->
šÃr
->
´Ù
->
	`u¾_»ad
(c->šÃr, 
buf
, ()
to_cİy
);

576 ià(
r
 =ğ0 && 
to_cİy
 > 0) {

577 
c
->
fe_logiÿl_’d
 = c->
fe_logiÿl_pos
;

579 ià(
r
 <= 0) {

580 
c
->
io_eof_»ached
 = 1;

581 
c
->
io_”rÜ
 = ()
r
;

582  
r
;

584 *
c
->
ÿche_couÁ_by‹s
 +ğ
r
;

585 
c
->
fe_šÃr_pos
 +ğ
r
;

587 
r
 = 
	`add_’Œy
(
h
, 
buf
, ()r);

589 ià(
r
 > 0)

590 
c
->
fe_logiÿl_pos
 +ğ
r
;

592  
r
;

593 
	}
}

595 
št64_t
 
	$ijkio_ÿche_ffu¾_size
(
IjkURLCÚ‹xt
 *
h
) {

596 
št64_t
 
pos
, 
size
;

597 
IjkIOCacheCÚ‹xt
 *
c
ğ((
IjkURLCÚ‹xt
 *)
h
)->
´iv_d©a
;

598 ià(!
c
 || !c->
šÃr
 || !c->šÃr->
´Ù
)

599  
	`IJKAVERROR
(
ENOSYS
);

600 
size
 = 
c
->
šÃr
->
´Ù
->
	`u¾_£ek
(c->šÃr, 0, 
IJKAVSEEK_SIZE
);

601 ià(
size
 < 0) {

602 
pos
 = 
c
->
šÃr
->
´Ù
->
	`u¾_£ek
(c->šÃr, 0, 
SEEK_CUR
);

603 ià((
size
 = 
c
->
šÃr
->
´Ù
->
	`u¾_£ek
(c->šÃr, -1, 
SEEK_END
)) < 0)

604  
size
;

605 
size
++;

606 
c
->
šÃr
->
´Ù
->
	`u¾_£ek
(c->šÃr, 
pos
, 
SEEK_SET
);

608  
size
;

609 
	}
}

611 
	$ijkio_ÿche_sk
(*
h
, *
r
) {

612 
št64_t
 
»t
;

613 
IjkIOCacheCÚ‹xt
 *
c
ğ((
IjkURLCÚ‹xt
 *)
h
)->
´iv_d©a
;

614 
c
->
sk_is_ruÂšg
 = 1;

616 
»t
 = 
	`ijkio_ÿche_fl_fifo
(
h
);

617 ià(
»t
 =ğ
IJKAVERROR_EXIT
)

620 ià(!
c
->
ÿche_fe_şo£
 &&

621 (
c
->
fe_logiÿl_pos
 - c->
fifo_logiÿl_pos
 <ğc->
ÿche_fe_fÜw¬ds_ÿ·c™y
)

622 && !
c
->
io_eof_»ached
) {

623 
	`ijkio_ÿche_wr™e_fe
(
h
);

626 
	`ÿÎ_šjeù_¡©i¡ic
(
h
);

628 
	`±h»ad_mu‹x_lock
(&
c
->
mu‹x
);

629 
c
->
sk_is_ruÂšg
 = 0;

630 
	`±h»ad_cÚd_sigÇl
(&
c
->
cÚd_wakeup_ex™
);

631 
	`±h»ad_mu‹x_uÆock
(&
c
->
mu‹x
);

632 
	}
}

634 
	$ijkio_ÿche_İ’
(
IjkURLCÚ‹xt
 *
h
, cÚ¡ *
u¾
, 
æags
, 
IjkAVDiùiÚ¬y
 **
İtiÚs
) {

635 
IjkIOCacheCÚ‹xt
 *
c
ğ
h
->
´iv_d©a
;

636 
»t
;

637 ià(!
c
)

638  
	`IJKAVERROR
(
ENOSYS
);

640 
c
->
ijkio_­p_ùx
 = 
h
->ijkio_app_ctx;

641 ià(
c
->
ijkio_­p_ùx
 =ğ
NULL
) {

645 
c
->
ijkio_š‹¼u±_ÿÎback
 = 
h
->
ijkio_­p_ùx
->ijkio_interrupt_callback;

647 
	`ijk_av_¡r¡¬t
(
u¾
, "cache:", &url);

648 
c
->
ÿche_fÜw¬ds_fifo_ÿ·c™y
 = 
DEFAULT_CACHE_FORWARDS_FIFO_CAPACITY
;

649 
c
->
ÿche_fe_fÜw¬ds_ÿ·c™y
 = 
DEFAULT_CACHE_FILE_FORWARDS_CAPACITY
;

650 
c
->
ÿche_max_ÿ·c™y
 = 
DEFAULT_CACHE_MAX_CAPACITY
;

652 
IjkAVDiùiÚ¬yEÁry
 *
t
 = 
NULL
;

653 
t
 = 
	`ijk_av_diù_g‘
(*
İtiÚs
, "ÿche_max_ÿ·c™y", 
NULL
, 
IJK_AV_DICT_IGNORE_SUFFIX
);

654 ià(
t
) {

655 
c
->
ÿche_max_ÿ·c™y
 = 
	`¡¹Şl
(
t
->
v®ue
, 
NULL
, 10);

657 
t
 = 
	`ijk_av_diù_g‘
(*
İtiÚs
, "ÿche_fÜw¬ds_fifo_ÿ·c™y", 
NULL
, 
IJK_AV_DICT_IGNORE_SUFFIX
);

658 ià(
t
) {

659 
c
->
ÿche_fÜw¬ds_fifo_ÿ·c™y
 = 
	`¡¹Şl
(
t
->
v®ue
, 
NULL
, 10);

661 
t
 = 
	`ijk_av_diù_g‘
(*
İtiÚs
, "ÿche_fe_fÜw¬ds_ÿ·c™y", 
NULL
, 
IJK_AV_DICT_IGNORE_SUFFIX
);

662 ià(
t
) {

663 
c
->
ÿche_fe_fÜw¬ds_ÿ·c™y
 = 
	`¡¹Şl
(
t
->
v®ue
, 
NULL
, 10);

666 
t
 = 
	`ijk_av_diù_g‘
(*
İtiÚs
, "ÿche_fe_şo£", 
NULL
, 
IJK_AV_DICT_IGNORE_SUFFIX
);

667 ià(
t
) {

668 
c
->
ÿche_fe_şo£
 = ()
	`¡¹Ş
(
t
->
v®ue
, 
NULL
, 10);

669 
c
->
ÿche_fe_şo£
 = c->cache_file_close != 0 ? 1 : 0;

672 
t
 = 
	`ijk_av_diù_g‘
(*
İtiÚs
, "cur_fe_no", 
NULL
, 
IJK_AV_DICT_IGNORE_SUFFIX
);

673 ià(
t
) {

674 
c
->
cur_fe_no
 = ()
	`¡¹Ş
(
t
->
v®ue
, 
NULL
, 10);

677 
c
->
ÿche_fe_·th
 = c->
ijkio_­p_ùx
->cache_file_path;

679 ià(
c
->
ÿche_fe_·th
 =ğ
NULL
 || 0 =ğ
	`¡¾’
(c->cache_file_path)) {

680 
c
->
ÿche_fe_şo£
 = 1;

683 
c
->
th»adpoŞ_ùx
 = c->
ijkio_­p_ùx
->threadpool_ctx;

684 
c
->
ÿche_šfo_m­
 = c->
ijkio_­p_ùx
->cache_info_map;

685 
c
->
Ï¡_physiÿl_pos
 = &c->
ijkio_­p_ùx
->last_physical_pos;

686 
c
->
ÿche_lim™_fe_pos
 = &c->
ijkio_­p_ùx
->cache_limit_file_pos;

687 
c
->
ÿche_couÁ_by‹s
 = &c->
ijkio_­p_ùx
->cache_count_bytes;

688 ià(!
c
->
Ï¡_physiÿl_pos
 || !c->
th»adpoŞ_ùx
 || !c->
ÿche_šfo_m­
) {

692 ià(!
c
->
ÿche_fe_şo£
) {

694 
c
->
fd
 = 
	`İ’
(c->
ÿche_fe_·th
, 
O_RDWR
 | 
O_BINARY
 | 
O_CREAT
, 0600);

695 ià(
c
->
fd
 < 0) {

696 
c
->
ÿche_fe_şo£
 = 1;

700 
št64_t
 
£ek_»t
 = 
	`l£ek
(
c
->
fd
, *c->
Ï¡_physiÿl_pos
, 
SEEK_SET
);

701 ià(
£ek_»t
 < 0) {

702 
c
->
ÿche_fe_şo£
 = 1;

703 
	`şo£
(
c
->
fd
);

706 
c
->
ÿche_physiÿl_pos
 = *c->
Ï¡_physiÿl_pos
;

709 
c
->
Œ“_šfo
 = 
	`ijk_m­_g‘
(c->
ÿche_šfo_m­
, (
št64_t
)c->
cur_fe_no
);

710 ià(
c
->
Œ“_šfo
 =ğ
NULL
) {

711 
c
->
Œ“_šfo
 = 
	`ÿÎoc
(1, (
IjkCacheT»eInfo
));

712 
c
->
Œ“_šfo
->
physiÿl_š™_pos
 = *c->
Ï¡_physiÿl_pos
;

715 
	`ijk_m­_put
(
c
->
ÿche_šfo_m­
, (
št64_t
)c->
cur_fe_no
, c->
Œ“_šfo
);

717 ià(*
c
->
ÿche_lim™_fe_pos
 <= 0)

718 *
c
->
ÿche_lim™_fe_pos
 = c->
ÿche_max_ÿ·c™y
;

722 
c
->
fifo
 = 
	`ijk_av_fifo_®loc
(()c->
ÿche_fÜw¬ds_fifo_ÿ·c™y
);

724 
»t
 = 
	`ijkio_®loc_u¾
(&(
c
->
šÃr
), 
u¾
);

725 ià(
c
->
šÃr
 && !
»t
) {

726 
c
->
šÃr
->
ijkio_­p_ùx
 = c->ijkio_app_ctx;

727 
»t
 = 
c
->
šÃr
->
´Ù
->
	`u¾_İ’2
(c->šÃr, 
u¾
, 
æags
, 
İtiÚs
);

728 ià(
»t
 < 0)

729 
u¾_ç
;

731 
c
->
logiÿl_size
 = 
	`ijkio_ÿche_ffu¾_size
(
h
);

734 
»t
 = 
	`±h»ad_mu‹x_š™
(&
c
->
mu‹x
, 
NULL
);

735 ià(
»t
 != 0) {

737 
mu‹x_ç
;

740 
»t
 = 
	`±h»ad_cÚd_š™
(&
c
->
cÚd_wakeup_maš
, 
NULL
);

741 ià(
»t
 != 0) {

743 
cÚd_wakeup_maš_ç
;

746 
»t
 = 
	`±h»ad_cÚd_š™
(&
c
->
cÚd_wakeup_background
, 
NULL
);

747 ià(
»t
 != 0) {

749 
cÚd_wakeup_background_ç
;

752 
»t
 = 
	`±h»ad_cÚd_š™
(&
c
->
cÚd_wakeup_ex™
, 
NULL
);

753 ià(
»t
 != 0) {

755 
cÚd_wakeup_ex™_ç
;

758 
»t
 = 
	`ijk_th»adpoŞ_add
(
c
->
th»adpoŞ_ùx
, 
ijkio_ÿche_sk
, 
h
, 
NULL
, 0);

759 ià(
»t
) {

760 
th»ad_ç
;

764 
th»ad_ç
:

765 
	`±h»ad_cÚd_de¡roy
(&
c
->
cÚd_wakeup_ex™
);

766 
cÚd_wakeup_ex™_ç
:

767 
	`±h»ad_cÚd_de¡roy
(&
c
->
cÚd_wakeup_background
);

768 
cÚd_wakeup_background_ç
:

769 
	`±h»ad_cÚd_de¡roy
(&
c
->
cÚd_wakeup_maš
);

770 
cÚd_wakeup_maš_ç
:

771 
	`±h»ad_mu‹x_de¡roy
(&
c
->
mu‹x
);

772 
mu‹x_ç
:

773 ià(
c
->
šÃr
) {

774 ià(
c
->
šÃr
->
´Ù
 && c->šÃr->´Ù->
u¾_şo£
)

775 
»t
 = 
c
->
šÃr
->
´Ù
->
	`u¾_şo£
(c->inner);

776 
	`ijk_av_ä“p
(&
c
->
šÃr
->
´iv_d©a
);

777 
	`ijk_av_ä“p
(&
c
->
šÃr
);

779 
u¾_ç
:

780 
	`ijk_av_fifo_ä“p
(&
c
->
fifo
);

781 ià(
c
->
Œ“_šfo
)

782 
	`ijk_m­_put
(
c
->
ÿche_šfo_m­
, (
št64_t
)c->
cur_fe_no
, c->
Œ“_šfo
);

783  
»t
;

784 
	}
}

786 
	$ijkio_ÿche_»ad
(
IjkURLCÚ‹xt
 *
h
, *
buf
, 
size
) {

787 
IjkIOCacheCÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

788 
to_»ad
 = 
size
;

789 
»t
 = 0;

790 *
d¡
 = 
buf
;

791 ià(!
c
)

792  
	`IJKAVERROR
(
ENOSYS
);

793 
	`±h»ad_mu‹x_lock
(&
c
->
mu‹x
);

794 
to_»ad
 > 0) {

795 
fifo_size
, 
to_cİy
;

796 ià(
	`ijkio_ÿche_check_š‹¼u±
(
h
)) {

797 
»t
 = 
IJKAVERROR_EXIT
;

800 
fifo_size
 = 
	`ijk_av_fifo_size
(
c
->
fifo
);

801 
to_cİy
 = 
	`FFMIN
(
to_»ad
, 
fifo_size
);

802 ià(
to_cİy
 > 0) {

803 
	`ijk_av_fifo_g’”ic_»ad
(
c
->
fifo
, 
d¡
, 
to_cİy
, 
NULL
);

804 
to_»ad
 -ğ
to_cİy
;

805 
»t
 = 
size
 - 
to_»ad
;

806 
d¡
 +ğ
to_cİy
;

807 
c
->
»ad_logiÿl_pos
 +ğ
to_cİy
;

808 ià(
to_»ad
 <= 0)

810 } ià(
c
->
fifo_eof_»ached
) {

811 ià(
»t
 <= 0) {

812 ià(
c
->
io_”rÜ
)

813 
»t
 = 
c
->
io_”rÜ
;

815 
»t
 = 
IJKAVERROR_EOF
;

819 
	`±h»ad_cÚd_sigÇl
(&
c
->
cÚd_wakeup_background
);

820 
	`±h»ad_cÚd_wa™
(&
c
->
cÚd_wakeup_maš
, &c->
mu‹x
);

823 
	`±h»ad_cÚd_sigÇl
(&
c
->
cÚd_wakeup_background
);

824 
	`±h»ad_mu‹x_uÆock
(&
c
->
mu‹x
);

825  
»t
;

826 
	}
}

828 
št64_t
 
	$ijkio_ÿche_£ek
(
IjkURLCÚ‹xt
 *
h
, 
št64_t
 
pos
, 
wh’û
) {

829 
IjkIOCacheCÚ‹xt
 *
c
ğ
h
->
´iv_d©a
;

830 
št64_t
 
»t
, 
Ãw_logiÿl_pos
;

831 ià(!
c
 || !c->
šÃr
 || !c->šÃr->
´Ù
)

832  
	`IJKAVERROR
(
ENOSYS
);

834 ià(
wh’û
 =ğ
IJKAVSEEK_SIZE
) {

835  
c
->
logiÿl_size
;

836 } ià(
wh’û
 =ğ
SEEK_CUR
) {

837 
Ãw_logiÿl_pos
 = 
pos
 + 
c
->
»ad_logiÿl_pos
;

838 } ià(
wh’û
 =ğ
SEEK_SET
){

839 
Ãw_logiÿl_pos
 = 
pos
;

841  
	`IJKAVERROR
(
EINVAL
);

843 ià(
Ãw_logiÿl_pos
 < 0)

844  
	`IJKAVERROR
(
EINVAL
);

846 
	`±h»ad_mu‹x_lock
(&
c
->
mu‹x
);

848 
c
->
£ek_»que¡
 = 1;

849 
c
->
£ek_pos
 = 
Ãw_logiÿl_pos
;

850 
c
->
£ek_wh’û
 = 
SEEK_SET
;

851 
c
->
£ek_com¶‘ed
 = 0;

854 ià(
	`ijkio_ÿche_check_š‹¼u±
(
h
)) {

855 
»t
 = 
IJKAVERROR_EXIT
;

858 ià(
c
->
£ek_com¶‘ed
) {

859 
»t
 = 
c
->
£ek_»t
;

860 
c
->
»ad_logiÿl_pos
 = c->
£ek_pos
;

863 
	`±h»ad_cÚd_sigÇl
(&
c
->
cÚd_wakeup_background
);

864 
	`±h»ad_cÚd_wa™
(&
c
->
cÚd_wakeup_maš
, &c->
mu‹x
);

867 
	`±h»ad_mu‹x_uÆock
(&
c
->
mu‹x
);

868  
»t
;

869 
	}
}

871 
	$ijkio_ÿche_şo£
(
IjkURLCÚ‹xt
 *
h
) {

872 
IjkIOCacheCÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

873 
»t
;

874 ià(!
c
 || !c->
šÃr
 || !c->šÃr->
´Ù
)

875  
	`IJKAVERROR
(
ENOSYS
);

876 
	`±h»ad_mu‹x_lock
(&
c
->
mu‹x
);

877 
c
->
abÜt_»que¡
 = 1;

878 
	`±h»ad_cÚd_sigÇl
(&
c
->
cÚd_wakeup_background
);

879 ià(
c
->
sk_is_ruÂšg
) {

880 
	`±h»ad_cÚd_wa™
(&
c
->
cÚd_wakeup_ex™
, &c->
mu‹x
);

882 
	`±h»ad_mu‹x_uÆock
(&
c
->
mu‹x
);

885 
	`±h»ad_cÚd_de¡roy
(&
c
->
cÚd_wakeup_background
);

886 
	`±h»ad_cÚd_de¡roy
(&
c
->
cÚd_wakeup_maš
);

887 
	`±h»ad_cÚd_de¡roy
(&
c
->
cÚd_wakeup_ex™
);

888 
	`±h»ad_mu‹x_de¡roy
(&
c
->
mu‹x
);

890 
	`şo£
(
c
->
fd
);

892 
»t
 = 
c
->
šÃr
->
´Ù
->
	`u¾_şo£
(c->inner);

893 
	`ijk_av_fifo_ä“p
(&
c
->
fifo
);

895 
	`ijk_av_ä“p
(&
c
->
šÃr
->
´iv_d©a
);

897 
	`ijk_av_ä“p
(&
c
->
šÃr
);

898  
»t
;

899 
	}
}

901 
	$ijkio_ÿche_·u£
(
IjkURLCÚ‹xt
 *
h
) {

902 
IjkIOCacheCÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

903 
»t
 = 0;

904 ià(!
c
 || !c->
šÃr
 || !c->šÃr->
´Ù
)

905  
	`IJKAVERROR
(
ENOSYS
);

907 
	`±h»ad_mu‹x_lock
(&
c
->
mu‹x
);

908 
c
->
abÜt_»que¡
 = 1;

909 
	`±h»ad_cÚd_sigÇl
(&
c
->
cÚd_wakeup_background
);

910 ià(
c
->
sk_is_ruÂšg
) {

911 
	`±h»ad_cÚd_wa™
(&
c
->
cÚd_wakeup_ex™
, &c->
mu‹x
);

913 
	`şo£
(
c
->
fd
);

914 
c
->
fd
 = -1;

915 
	`±h»ad_mu‹x_uÆock
(&
c
->
mu‹x
);

917 ià(
c
->
šÃr
->
´Ù
->
u¾_·u£
) {

918 
»t
 = 
c
->
šÃr
->
´Ù
->
	`u¾_·u£
(c->inner);

921  
»t
;

922 
	}
}

924 
	$ijkio_ÿche_»sume
(
IjkURLCÚ‹xt
 *
h
) {

925 
IjkIOCacheCÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

926 
»t
 = 0;

927 ià(!
c
 || !c->
šÃr
 || !c->šÃr->
´Ù
)

928  
	`IJKAVERROR
(
ENOSYS
);

930 ià(
c
->
ÿche_fe_·th
 =ğ
NULL
 || 0 =ğ
	`¡¾’
(c->cache_file_path)) {

931 
c
->
ÿche_fe_şo£
 = 1;

933 
c
->
fd
 = 
	`İ’
(c->
ÿche_fe_·th
, 
O_RDWR
 | 
O_BINARY
 | 
O_CREAT
, 0600);

934 ià(
c
->
fd
 < 0) {

935 
c
->
ÿche_fe_şo£
 = 1;

938 
št64_t
 
£ek_»t
 = 
	`l£ek
(
c
->
fd
, *c->
Ï¡_physiÿl_pos
, 
SEEK_SET
);

939 ià(
£ek_»t
 < 0) {

940 
c
->
ÿche_fe_şo£
 = 1;

941 
	`şo£
(
c
->
fd
);

943 
c
->
ÿche_physiÿl_pos
 = *c->
Ï¡_physiÿl_pos
;

947 ià(
c
->
šÃr
->
´Ù
->
u¾_»sume
) {

948 
»t
 = 
c
->
šÃr
->
´Ù
->
	`u¾_»sume
(c->inner);

949 ià(
»t
 < 0) {

950  
»t
;

954 
c
->
abÜt_»que¡
 = 0;

956 
»t
 = 
	`ijk_th»adpoŞ_add
(
c
->
th»adpoŞ_ùx
, 
ijkio_ÿche_sk
, 
h
, 
NULL
, 0);

958  
»t
;

959 
	}
}

961 
IjkURLPrÙocŞ
 
	gijkio_ÿche_´ÙocŞ
 = {

962 .
Çme
 = "ijkiocache",

963 .
	gu¾_İ’2
 = 
ijkio_ÿche_İ’
,

964 .
	gu¾_»ad
 = 
ijkio_ÿche_»ad
,

965 .
	gu¾_£ek
 = 
ijkio_ÿche_£ek
,

966 .
	gu¾_şo£
 = 
ijkio_ÿche_şo£
,

967 .
	gu¾_·u£
 = 
ijkio_ÿche_·u£
,

968 .
	gu¾_»sume
 = 
ijkio_ÿche_»sume
,

969 .
	g´iv_d©a_size
 = (
IjkIOCacheCÚ‹xt
),

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkioffio.c

21 
	~"libavfÜm©/u¾.h
"

22 
	~"libavut/av¡ršg.h
"

23 
	~"ijk¶ay”/ijkavut/ijkuts.h
"

24 
	~"ijkiou¾.h
"

26 
	~<¡dšt.h
>

28 
	sIjkIOFFioCÚ‹xt
 {

29 
URLCÚ‹xt
 *
	mšÃr
;

30 } 
	tIjkIOFFioCÚ‹xt
;

32 
	$ijkio_cİy_İtiÚs
(
AVDiùiÚ¬y
 **
d¡
, 
IjkAVDiùiÚ¬y
 *
¤c
) {

33 
IjkAVDiùiÚ¬yEÁry
 *
t
 = 
NULL
;

35 (
t
 = 
	`ijk_av_diù_g‘
(
¤c
, "",, 
IJK_AV_DICT_IGNORE_SUFFIX
))) {

36 
»t
 = 
	`av_diù_£t
(
d¡
, 
t
->
key
,->
v®ue
, 0);

37 ià(
»t
 < 0)

38  
»t
;

42 
	}
}

44 
	$ijkio_ffio_İ’
(
IjkURLCÚ‹xt
 *
h
, cÚ¡ *
u¾
, 
æags
, 
IjkAVDiùiÚ¬y
 **
İtiÚs
) {

45 
»t
 = -1;

47 
IjkIOFFioCÚ‹xt
 *
c
ğ
h
->
´iv_d©a
;

48 ià(!
c
)

51 
AVDiùiÚ¬y
 *
İts
 = 
NULL
;

52 
	`ijkio_cİy_İtiÚs
(&
İts
, *
İtiÚs
);

54 
	`av_¡r¡¬t
(
u¾
, "ffio:", &url);

55 ià(
h
->
ijkio_­p_ùx
) {

56 
»t
 = 
	`ffu¾_İ’_wh™–i¡
(&
c
->
šÃr
, 
u¾
, 
æags
, (
AVIOIÁ”ru±CB
 *)
h
->
ijkio_­p_ùx
->
ijkio_š‹¼u±_ÿÎback
,

57 &
İts
, 
NULL
, NULL, NULL);

59 
»t
 = -1;

62 
	`av_diù_ä“
(&
İts
);

64  
»t
;

65 
	}
}

67 
	$ijkio_ffio_»ad
(
IjkURLCÚ‹xt
 *
h
, *
buf
, 
size
) {

68 ià(!
h
)

71 
IjkIOFFioCÚ‹xt
 *
c
ğ
h
->
´iv_d©a
;

72 ià(!
c
 || !c->
šÃr
)

75  
	`ffu¾_»ad
(
c
->
šÃr
, 
buf
, 
size
);

76 
	}
}

78 
št64_t
 
	$ijkio_ffio_£ek
(
IjkURLCÚ‹xt
 *
h
, 
št64_t
 
off£t
, 
wh’û
) {

79 ià(!
h
)

82 
IjkIOFFioCÚ‹xt
 *
c
ğ
h
->
´iv_d©a
;

84 ià(!
c
 || !c->
šÃr
)

87  
	`ffu¾_£ek
(
c
->
šÃr
, 
off£t
, 
wh’û
);

88 
	}
}

90 
	$ijkio_ffio_şo£
(
IjkURLCÚ‹xt
 *
h
) {

91 ià(!
h
)

94 
IjkIOFFioCÚ‹xt
 *
c
ğ
h
->
´iv_d©a
;

96 ià(!
c
 || !c->
šÃr
)

99  
	`ffu¾_şo£
(
c
->
šÃr
);

100 
	}
}

102 
IjkURLPrÙocŞ
 
	gijkio_ffio_´ÙocŞ
 = {

103 .
Çme
 = "ijkffio",

104 .
	gu¾_İ’2
 = 
ijkio_ffio_İ’
,

105 .
	gu¾_»ad
 = 
ijkio_ffio_»ad
,

106 .
	gu¾_£ek
 = 
ijkio_ffio_£ek
,

107 .
	gu¾_şo£
 = 
ijkio_ffio_şo£
,

108 .
	g´iv_d©a_size
 = (
IjkIOFFioCÚ‹xt
),

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkiomanager.c

22 
	~"ijkiomªag”.h
"

23 
	~"ijkiİrÙocŞ.h
"

24 
	~"ijk¶ay”/ijkavut/ijkuts.h
"

25 
	~"ijk¶ay”/ijkavut/ijkŒ“.h
"

26 
	~"ijk¶ay”/ijkavut/ijk¡l.h
"

28 
	~<¡dlib.h
>

29 
	~<¡ršg.h
>

30 
	~<¡dio.h
>

32 
	$ijkio_mªag”_®loc
(
IjkIOMªag”CÚ‹xt
 **
ph
, *
İaque
)

34 
IjkIOMªag”CÚ‹xt
 *
h
 = 
NULL
;

36 
h
 = (
IjkIOMªag”CÚ‹xt
 *)
	`ÿÎoc
(1, (IjkIOManagerContext));

37 ià(!
h
)

40 
h
->
İaque
 = opaque;

41 
h
->
ijk_ùx_m­
 = 
	`ijk_m­_ü—‹
();

43 
	`ijkio_­¶iÿtiÚ_İ’
(&
h
->
ijkio_­p_ùx
, 
İaque
);

45 
h
->
ijkio_­p_ùx
->
th»adpoŞ_ùx
 = 
	`ijk_th»adpoŞ_ü—‹
(5, 5, 0);

46 
h
->
ijkio_­p_ùx
->
ÿche_šfo_m­
 = 
	`ijk_m­_ü—‹
();

47 *
ph
 = 
h
;

49 
	}
}

51 
	$ijkio_mªag”_ü—‹
(
IjkIOMªag”CÚ‹xt
 **
ph
, *
İaque
)

53  
	`ijkio_mªag”_®loc
(
ph
, 
İaque
);

54 
	}
}

56 
	$’u_ä“
(*
İaque
, *
–em
)

58 
	`ä“
(
–em
);

60 
	}
}

62 
	$Œ“_de¡roy
(*
–em
)

64 
IjkCacheT»eInfo
 *
šfo
 = 
–em
;

65 
	`ijk_av_Œ“_’um”©e
(
šfo
->
roÙ
, 
NULL
, NULL, 
’u_ä“
);

66 
	`ijk_av_Œ“_de¡roy
(
šfo
->
roÙ
);

67 
	`ä“
(
šfo
);

69 
	}
}

71 
	$ijkio_mªag”_de¡roy
(
IjkIOMªag”CÚ‹xt
 *
h
)

73 ià(
h
->
ijkio_­p_ùx
) {

74 
	`ijk_m­_Œav”§l_hªdË
(
h
->
ijkio_­p_ùx
->
ÿche_šfo_m­
, 
Œ“_de¡roy
);

75 
	`ijk_m­_de¡roy
(
h
->
ijkio_­p_ùx
->
ÿche_šfo_m­
);

76 
h
->
ijkio_­p_ùx
->
ÿche_šfo_m­
 = 
NULL
;

78 ià(
h
->
ijkio_­p_ùx
->
th»adpoŞ_ùx
) {

79 
	`ijk_th»adpoŞ_de¡roy
(
h
->
ijkio_­p_ùx
->
th»adpoŞ_ùx
, 
IJK_IMMEDIATE_SHUTDOWN
);

82 ià(0 !ğ
	`¡¾’
(
h
->
ijkio_­p_ùx
->
ÿche_fe_·th
)) {

83 
	`»move
(
h
->
ijkio_­p_ùx
->
ÿche_fe_·th
);

86 
	`ijkio_­¶iÿtiÚ_şo£p
(&
h
->
ijkio_­p_ùx
);

89 
	`ijk_m­_de¡roy
(
h
->
ijk_ùx_m­
);

90 
h
->
ijk_ùx_m­
 = 
NULL
;

92 
	`ä“
(
h
);

93 
	}
}

95 
	$ijkio_mªag”_de¡royp
(
IjkIOMªag”CÚ‹xt
 **
ph
)

97 ià(!
ph
 || !*ph)

100 
	`ijkio_mªag”_de¡roy
(*
ph
);

101 *
ph
 = 
NULL
;

102 
	}
}

104 
	$ijkio_mªag”_£t_ÿÎback
(
IjkIOMªag”CÚ‹xt
 *
h
, *
ÿÎback
) {

105 ià(!
h
)

108 
h
->
ijkio_­p_ùx
->
func_ijkio_Ú_­p_ev’t
 = 
ÿÎback
;

111 
	}
}

115 
	$ijkio_mªag”_£t_®l_ùx_·u£
(
IjkIOMªag”CÚ‹xt
 *
h
) {

116 
IjkURLCÚ‹xt
 *
u¾_ùx
;

117 
size
 = 
	`ijk_m­_size
(
h
->
ijk_ùx_m­
);

119 
i
 = 0; i < 
size
; i++) {

120 
u¾_ùx
 = 
	`ijk_m­_šdex_g‘
(
h
->
ijk_ùx_m­
, 
i
);

121 ià(
u¾_ùx
 =ğ
NULL
 || u¾_ùx->
´Ù
 == NULL)

124 ià(
u¾_ùx
->
´Ù
->
u¾_·u£
)

125 
u¾_ùx
->
´Ù
->
	`u¾_·u£
(url_ctx);

126 
u¾_ùx
->
¡©e
 = 
IJKURL_PAUSED
;

128 
	}
}

130 
	$ijkio_mªag”_io_İ’
(
IjkIOMªag”CÚ‹xt
 *
h
, cÚ¡ *
u¾
, 
æags
, 
IjkAVDiùiÚ¬y
 **
İtiÚs
) {

131 
»t
 = -1;

132 ià(!
h
)

133  
»t
;

134 
IjkAVDiùiÚ¬yEÁry
 *
t
 = 
NULL
;

135 
t
 = 
	`ijk_av_diù_g‘
(*
İtiÚs
, "ÿche_fe_·th",, 
IJK_AV_DICT_IGNORE_SUFFIX
);

136 ià(
t
) {

137 
	`¡rıy
(
h
->
ijkio_­p_ùx
->
ÿche_fe_·th
, 
t
->
v®ue
);

139 ià(
h
->
ijkio_­p_ùx
 =ğ
NULL
) {

143 
h
->
ijkio_­p_ùx
->
ijkio_š‹¼u±_ÿÎback
 = h->ijkio_interrupt_callback;

145 
IjkURLCÚ‹xt
 *
šÃr
 = 
NULL
;

146 
	`ijkio_®loc_u¾
(&
šÃr
, 
u¾
);

147 ià(
šÃr
) {

148 
šÃr
->
ijkio_­p_ùx
 = 
h
->ijkio_app_ctx;

149 ià(
h
->
ijk_ùx_m­
) {

150 
	`ijkio_mªag”_£t_®l_ùx_·u£
(
h
);

151 
šÃr
->
¡©e
 = 
IJKURL_STARTED
;

152 
	`ijk_m­_put
(
h
->
ijk_ùx_m­
, (
št64_t
)(
šŒ_t
)h->
cur_ffm³g_ùx
, 
šÃr
);

154 
»t
 = 
šÃr
->
´Ù
->
	`u¾_İ’2
(šÃr, 
u¾
, 
æags
, 
İtiÚs
);

155 ià(
»t
 < 0)

156 
ç
;

158  
»t
;

161 
ç
:

162 ià(
šÃr
) {

163 ià(
šÃr
->
´Ù
 && iÂ”->´Ù->
u¾_şo£
)

164 
»t
 = 
šÃr
->
´Ù
->
	`u¾_şo£
(inner);

166 ià(
h
->
ijk_ùx_m­
) {

167 
	`ijk_m­_»move
(
h
->
ijk_ùx_m­
, (
št64_t
)(
šŒ_t
)h->
cur_ffm³g_ùx
);

169 
	`ijk_av_ä“p
(&
šÃr
->
´iv_d©a
);

170 
	`ijk_av_ä“p
(&
šÃr
);

173 
	}
}

175 
	$ijkio_mªag”_io_»ad
(
IjkIOMªag”CÚ‹xt
 *
h
, *
buf
, 
size
) {

176 
»t
 = -1;

177 ià(!
h
)

178  
»t
;

180 
IjkURLCÚ‹xt
 *
šÃr
 = 
	`ijk_m­_g‘
(
h
->
ijk_ùx_m­
, (
št64_t
)(
šŒ_t
)h->
cur_ffm³g_ùx
);

181 ià(
šÃr
 && iÂ”->
´Ù
 && iÂ”->´Ù->
u¾_»ad
) {

182 ià(
šÃr
->
¡©e
 =ğ
IJKURL_PAUSED
) {

183 ià(
šÃr
->
´Ù
->
u¾_»sume
) {

184 
»t
 = 
šÃr
->
´Ù
->
	`u¾_»sume
(inner);

185 ià(
»t
 < 0) {

186  
»t
;

189 
šÃr
->
¡©e
 = 
IJKURL_STARTED
;

191 
»t
 = 
šÃr
->
´Ù
->
	`u¾_»ad
(šÃr, 
buf
, 
size
);

194  
»t
;

195 
	}
}

197 
št64_t
 
	$ijkio_mªag”_io_£ek
(
IjkIOMªag”CÚ‹xt
 *
h
, 
št64_t
 
off£t
, 
wh’û
) {

198 
št64_t
 
»t
 = -1;

200 ià(!
h
)

201  
»t
;

203 
IjkURLCÚ‹xt
 *
šÃr
 = 
	`ijk_m­_g‘
(
h
->
ijk_ùx_m­
, (
št64_t
)(
šŒ_t
)h->
cur_ffm³g_ùx
);

204 ià(
šÃr
 && iÂ”->
´Ù
 && iÂ”->´Ù->
u¾_£ek
) {

205 ià(
šÃr
->
¡©e
 =ğ
IJKURL_PAUSED
) {

206 ià(
šÃr
->
´Ù
->
u¾_»sume
) {

207 
»t
 = (
št64_t
)
šÃr
->
´Ù
->
	`u¾_»sume
(inner);

208 ià(
»t
 < 0) {

209  
»t
;

212 
šÃr
->
¡©e
 = 
IJKURL_STARTED
;

214 
»t
 = 
šÃr
->
´Ù
->
	`u¾_£ek
(šÃr, 
off£t
, 
wh’û
 & ~
IJKAVSEEK_FORCE
);

217  
»t
;

218 
	}
}

220 
	$ijkio_mªag”_io_şo£
(
IjkIOMªag”CÚ‹xt
 *
h
) {

221 
»t
 = -1;

222 ià(!
h
)

223  
»t
;

225 
IjkURLCÚ‹xt
 *
šÃr
 = 
	`ijk_m­_g‘
(
h
->
ijk_ùx_m­
, (
št64_t
)(
šŒ_t
)h->
cur_ffm³g_ùx
);

226 ià(
šÃr
) {

227 ià(
šÃr
->
´Ù
 && iÂ”->´Ù->
u¾_şo£
) {

228 
»t
 = 
šÃr
->
´Ù
->
	`u¾_şo£
(inner);

230 
	`ijk_m­_»move
(
h
->
ijk_ùx_m­
, (
št64_t
)(
šŒ_t
)h->
cur_ffm³g_ùx
);

231 
	`ijk_av_ä“p
(&
šÃr
);

234  
»t
;

235 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkiomanager.h

22 #iâdeà
IJKAVFORMAT_IJKIOMANAGER_H


23 
	#IJKAVFORMAT_IJKIOMANAGER_H


	)

25 
	~"ijkiou¾.h
"

26 
	~"ijkißµliÿtiÚ.h
"

28 
	~<¡dšt.h
>

30 
IjkIOMªag”CÚ‹xt
 
	tIjkIOMªag”CÚ‹xt
;

31 
	sIjkIOMªag”CÚ‹xt
 {

32 
IjkAVIOIÁ”ru±CB
 *
	mijkio_š‹¼u±_ÿÎback
;

33 
IjkIOAµliÿtiÚCÚ‹xt
 *
	mijkio_­p_ùx
;

34 *
	mcur_ffm³g_ùx
;

35 *
	mijk_ùx_m­
;

36 *
	mİaque
;

39 
ijkio_mªag”_ü—‹
(
IjkIOMªag”CÚ‹xt
 **
ph
, *
İaque
);

40 
ijkio_mªag”_de¡roy
(
IjkIOMªag”CÚ‹xt
 *
h
);

41 
ijkio_mªag”_de¡royp
(
IjkIOMªag”CÚ‹xt
 **
ph
);

42 
ijkio_mªag”_£t_ÿÎback
(
IjkIOMªag”CÚ‹xt
 *
h
, *
ÿÎback
);

44 
ijkio_mªag”_io_İ’
(
IjkIOMªag”CÚ‹xt
 *
h
, cÚ¡ *
u¾
, 
æags
, 
IjkAVDiùiÚ¬y
 **
İtiÚs
);

45 
ijkio_mªag”_io_»ad
(
IjkIOMªag”CÚ‹xt
 *
h
, *
buf
, 
size
);

46 
št64_t
 
ijkio_mªag”_io_£ek
(
IjkIOMªag”CÚ‹xt
 *
h
, iÁ64_ˆ
off£t
, 
wh’û
);

47 
ijkio_mªag”_io_şo£
(
IjkIOMªag”CÚ‹xt
 *
h
);

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkioprotocol.c

21 
	~"ijkiİrÙocŞ.h
"

22 
	~<¡dlib.h
>

23 
	~<¡ršg.h
>

25 
IjkURLPrÙocŞ
 
ijkio_ffio_´ÙocŞ
;

26 #ifdeà
__ANDROID__


27 
IjkURLPrÙocŞ
 
ijkio_ªdroidio_´ÙocŞ
;

29 
IjkURLPrÙocŞ
 
ijkio_ÿche_´ÙocŞ
;

31 
	$ijkio_®loc_u¾
(
IjkURLCÚ‹xt
 **
ph
, cÚ¡ *
u¾
) {

32 ià(!
ph
) {

36 
IjkURLCÚ‹xt
 *
h
 = 
NULL
;

37 ià(!
	`¡ºcmp
(
u¾
, "ÿche:", 
	`¡¾’
("cache:"))) {

38 
h
 = (
IjkURLCÚ‹xt
 *)
	`ÿÎoc
(1, (IjkURLContext));

39 
h
->
´Ù
 = &
ijkio_ÿche_´ÙocŞ
;

40 
h
->
´iv_d©a
 = 
	`ÿÎoc
(1, 
ijkio_ÿche_´ÙocŞ
.
´iv_d©a_size
);

41 } ià(!
	`¡ºcmp
(
u¾
, "ffio:", 
	`¡¾’
("ffio:"))) {

42 
h
 = (
IjkURLCÚ‹xt
 *)
	`ÿÎoc
(1, (IjkURLContext));

43 
h
->
´Ù
 = &
ijkio_ffio_´ÙocŞ
;

44 
h
->
´iv_d©a
 = 
	`ÿÎoc
(1, 
ijkio_ffio_´ÙocŞ
.
´iv_d©a_size
);

46 #ifdeà
__ANDROID__


47 ià(!
	`¡ºcmp
(
u¾
, "ªdroid:", 
	`¡¾’
("android:"))) {

48 
h
 = (
IjkURLCÚ‹xt
 *)
	`ÿÎoc
(1, (IjkURLContext));

49 
h
->
´Ù
 = &
ijkio_ªdroidio_´ÙocŞ
;

50 
h
->
´iv_d©a
 = 
	`ÿÎoc
(1, 
ijkio_ªdroidio_´ÙocŞ
.
´iv_d©a_size
);

57 *
ph
 = 
h
;

60 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkioprotocol.h

21 
	~"ijkiou¾.h
"

23 
ijkio_®loc_u¾
(
IjkURLCÚ‹xt
 **
šÃr
, cÚ¡ *
u¾
);

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkiourl.h

24 #iâdeà
IJKAVFORMAT_IJKIOURL_H


25 
	#IJKAVFORMAT_IJKIOURL_H


	)

27 
	~<¡dšt.h
>

28 
	~"ijk¶ay”/ijkavut/ijkdiù.h
"

29 
	~"ijkißµliÿtiÚ.h
"

31 
	gIjkURLPrÙocŞ
;

33 
	#IJKURL_PAUSED
 0x10

	)

34 
	#IJKURL_STARTED
 0x20

	)

36 
	sIjkURLCÚ‹xt
 {

37 cÚ¡ 
IjkURLPrÙocŞ
 *
	m´Ù
;

38 
IjkIOAµliÿtiÚCÚ‹xt
 *
	mijkio_­p_ùx
;

39 
	m¡©e
;

40 *
	m´iv_d©a
;

41 } 
	tIjkURLCÚ‹xt
;

43 
	sIjkURLPrÙocŞ
 {

44 cÚ¡ *
	mÇme
;

45 (*
	mu¾_İ’2
)(
IjkURLCÚ‹xt
 *
	mh
, cÚ¡ *
	mu¾
, 
	mæags
, 
IjkAVDiùiÚ¬y
 **
	mİtiÚs
);

46 (*
	mu¾_»ad
)Ğ
IjkURLCÚ‹xt
 *
	mh
, *
	mbuf
, 
	msize
);

47 
št64_t
 (*
u¾_£ek
)Ğ
IjkURLCÚ‹xt
 *
	mh
, iÁ64_ˆ
	mpos
, 
	mwh’û
);

48 (*
	mu¾_şo£
)(
IjkURLCÚ‹xt
 *
	mh
);

49 (*
	mu¾_·u£
)(
IjkURLCÚ‹xt
 *
	mh
);

50 (*
	mu¾_»sume
)(
IjkURLCÚ‹xt
 *
	mh
);

51 
	m´iv_d©a_size
;

52 
	mæags
;

53 } 
	tIjkURLPrÙocŞ
;

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijklivehook.c

22 
	~"libavfÜm©/avfÜm©.h
"

23 
	~"libavfÜm©/u¾.h
"

24 
	~"libavut/av¡ršg.h
"

25 
	~"libavut/İt.h
"

27 
	~"ijk¶ay”/ijkavut/İt.h
"

29 
	~"ijkavfÜm©.h
"

30 
	~"libavut/­¶iÿtiÚ.h
"

33 
AVCÏss
 *
	mşass
;

34 
AVFÜm©CÚ‹xt
 *
	mšÃr
;

36 
AVAµIOCÚŒŞ
 
	mio_cÚŒŞ
;

37 
	mdiscÚtšu™y
;

38 
	m”rÜ
;

41 
AVDiùiÚ¬y
 *
	mİ’_İts
;

42 
št64_t
 
	m­p_ùx_šŒ
;

43 
AVAµliÿtiÚCÚ‹xt
 *
	m­p_ùx
;

44 } 
	tCÚ‹xt
;

46 
	$ijku¾hook_ÿÎ_šjeù
(
AVFÜm©CÚ‹xt
 *
h
)

48 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

49 
»t
 = 0;

51 ià(
	`ff_check_š‹¼u±
(&
h
->
š‹¼u±_ÿÎback
)) {

52 
»t
 = 
AVERROR_EXIT
;

53 
ç
;

56 ià(
c
->
­p_ùx
) {

57 
	`av_log
(
h
, 
AV_LOG_INFO
, "livehook %s\n", 
c
->
io_cÚŒŞ
.
u¾
);

58 
c
->
io_cÚŒŞ
.
is_hªdËd
 = 0;

59 
»t
 = 
	`av_­¶iÿtiÚ_Ú_io_cÚŒŞ
(
c
->
­p_ùx
, 
AVAPP_CTRL_WILL_LIVE_OPEN
, &c->
io_cÚŒŞ
);

60 ià(
»t
 || !
c
->
io_cÚŒŞ
.
u¾
[0]) {

61 
»t
 = 
AVERROR_EXIT
;

62 
ç
;

66 ià(
	`ff_check_š‹¼u±
(&
h
->
š‹¼u±_ÿÎback
)) {

67 
»t
 = 
AVERROR_EXIT
;

68 
ç
;

71 
ç
:

72  
»t
;

73 
	}
}

75 
	$ijklivehook_´obe
(
AVProbeD©a
 *
´obe
)

77 ià(
	`av_¡r¡¬t
(
´obe
->
f’ame
, "ijklivehook:", 
NULL
))

78  
AVPROBE_SCORE_MAX
;

81 
	}
}

83 
	$ijklivehook_»ad_şo£
(
AVFÜm©CÚ‹xt
 *
avf
)

85 
CÚ‹xt
 *
c
 = 
avf
->
´iv_d©a
;

87 
	`avfÜm©_şo£_šput
(&
c
->
šÃr
);

89 
	}
}

92 
ff_®loc_exŒad©a
(
AVCodecP¬am‘”s
 *
·r
, 
size
);

94 
	$cİy_¡»am_´İs
(
AVSŒ—m
 *
¡
, AVSŒ—m *
sourû_¡
)

96 
»t
;

98 ià(
¡
->
codeı¬
->
codec_id
 || !
sourû_¡
->codecpar->codec_id) {

99 ià(
¡
->
codeı¬
->
exŒad©a_size
 < 
sourû_¡
->codecpar->extradata_size) {

100 ià(
¡
->
codeı¬
->
exŒad©a
) {

101 
	`av_ä“p
(&
¡
->
codeı¬
->
exŒad©a
);

102 
¡
->
codeı¬
->
exŒad©a_size
 = 0;

104 
»t
 = 
	`ff_®loc_exŒad©a
(
¡
->
codeı¬
,

105 
sourû_¡
->
codeı¬
->
exŒad©a_size
);

106 ià(
»t
 < 0)

107  
»t
;

109 
	`memıy
(
¡
->
codeı¬
->
exŒad©a
, 
sourû_¡
->codecpar->extradata,

110 
sourû_¡
->
codeı¬
->
exŒad©a_size
);

113 ià((
»t
 = 
	`avcodec_·¿m‘”s_cİy
(
¡
->
codeı¬
, 
sourû_¡
->codecpar)) < 0)

114  
»t
;

115 
¡
->
r_äame_¿‹
 = 
sourû_¡
->r_frame_rate;

116 
¡
->
avg_äame_¿‹
 = 
sourû_¡
->avg_frame_rate;

117 
¡
->
time_ba£
 = 
sourû_¡
->time_base;

118 
¡
->
§m¶e_a¥eù_¿tio
 = 
sourû_¡
->sample_aspect_ratio;

120 
	`av_diù_cİy
(&
¡
->
m‘ad©a
, 
sourû_¡
->metadata, 0);

122 
	}
}

124 
	$İ’_šÃr
(
AVFÜm©CÚ‹xt
 *
avf
)

126 
CÚ‹xt
 *
c
 = 
avf
->
´iv_d©a
;

127 
AVDiùiÚ¬y
 *
tmp_İts
 = 
NULL
;

128 
AVFÜm©CÚ‹xt
 *
Ãw_avf
 = 
NULL
;

129 
»t
 = -1;

130 
i
 = 0;

132 
Ãw_avf
 = 
	`avfÜm©_®loc_cÚ‹xt
();

133 ià(!
Ãw_avf
) {

134 
»t
 = 
	`AVERROR
(
ENOMEM
);

135 
ç
;

138 ià(
c
->
İ’_İts
)

139 
	`av_diù_cİy
(&
tmp_İts
, 
c
->
İ’_İts
, 0);

141 
	`av_diù_£t_št
(&
tmp_İts
, "´obesize", 
avf
->
´obesize
, 0);

142 
	`av_diù_£t_št
(&
tmp_İts
, "fÜm©´obesize", 
avf
->
fÜm©_´obesize
, 0);

143 
	`av_diù_£t_št
(&
tmp_İts
, "ª®yzedu¿tiÚ", 
avf
->
max_ª®yze_du¿tiÚ
, 0);

144 
	`av_diù_£t_št
(&
tmp_İts
, "å¥robesize", 
avf
->
ås_´obe_size
, 0);

145 
	`av_diù_£t_št
(&
tmp_İts
, "max_ts_´obe", 
avf
->
max_ts_´obe
, 0);

147 
Ãw_avf
->
š‹¼u±_ÿÎback
 = 
avf
->interrupt_callback;

148 
»t
 = 
	`avfÜm©_İ’_šput
(&
Ãw_avf
, 
c
->
io_cÚŒŞ
.
u¾
, 
NULL
, &
tmp_İts
);

149 ià(
»t
 < 0)

150 
ç
;

152 
»t
 = 
	`avfÜm©_fšd_¡»am_šfo
(
Ãw_avf
, 
NULL
);

153 ià(
»t
 < 0)

154 
ç
;

156 
i
 = 0; i < 
Ãw_avf
->
nb_¡»ams
; i++) {

157 
AVSŒ—m
 *
¡
 = 
	`avfÜm©_Ãw_¡»am
(
avf
, 
NULL
);

158 ià(!
¡
) {

159 
»t
 = 
	`AVERROR
(
ENOMEM
);

160 
ç
;

163 
»t
 = 
	`cİy_¡»am_´İs
(
¡
, 
Ãw_avf
->
¡»ams
[
i
]);

164 ià(
»t
 < 0)

165 
ç
;

168 
	`avfÜm©_şo£_šput
(&
c
->
šÃr
);

169 
c
->
šÃr
 = 
Ãw_avf
;

170 
Ãw_avf
 = 
NULL
;

171 
»t
 = 0;

172 
ç
:

173 
	`av_diù_ä“
(&
tmp_İts
);

174 
	`avfÜm©_şo£_šput
(&
Ãw_avf
);

175  
»t
;

176 
	}
}

178 
	$ijklivehook_»ad_h—d”
(
AVFÜm©CÚ‹xt
 *
avf
, 
AVDiùiÚ¬y
 **
İtiÚs
)

180 
CÚ‹xt
 *
c
 = 
avf
->
´iv_d©a
;

181 cÚ¡ *
šÃr_u¾
 = 
NULL
;

182 
»t
 = -1;

184 
c
->
­p_ùx
 = (
AVAµliÿtiÚCÚ‹xt
 *)(
šŒ_t
)c->
­p_ùx_šŒ
;

185 
	`av_¡r¡¬t
(
avf
->
f’ame
, "ijklivehook:", &
šÃr_u¾
);

187 
c
->
io_cÚŒŞ
.
size
 = (c->io_control);

188 
	`¡¾ıy
(
c
->
io_cÚŒŞ
.
u¾
, 
šÃr_u¾
, (c->io_control.url));

190 ià(
	`av_¡ri¡¬t
(
c
->
io_cÚŒŞ
.
u¾
, "¹mp", 
NULL
) ||

191 
	`av_¡ri¡¬t
(
c
->
io_cÚŒŞ
.
u¾
, "¹¥", 
NULL
)) {

193 
	`av_log
(
avf
, 
AV_LOG_WARNING
, "remove 'timeout' option for„tmp.\n");

194 
	`av_diù_£t
(
İtiÚs
, "timeout", 
NULL
, 0);

197 ià(
İtiÚs
)

198 
	`av_diù_cİy
(&
c
->
İ’_İts
, *
İtiÚs
, 0);

200 
c
->
io_cÚŒŞ
.
»Œy_couÁ”
 = 0;

201 
»t
 = 
	`İ’_šÃr
(
avf
);

202 
»t
 < 0) {

204 
»t
) {

205 
AVERROR_EXIT
:

206 
ç
;

209 
c
->
io_cÚŒŞ
.
»Œy_couÁ”
++;

210 
»t
 = 
	`ijku¾hook_ÿÎ_šjeù
(
avf
);

211 ià(
»t
) {

212 
»t
 = 
AVERROR_EXIT
;

213 
ç
;

216 
c
->
discÚtšu™y
 = 1;

217 
»t
 = 
	`İ’_šÃr
(
avf
);

221 
ç
:

222  
»t
;

223 
	}
}

225 
	$ijklivehook_»ad_·ck‘
(
AVFÜm©CÚ‹xt
 *
avf
, 
AVPack‘
 *
pkt
)

227 
CÚ‹xt
 *
c
 = 
avf
->
´iv_d©a
;

228 
»t
 = -1;

230 ià(
c
->
”rÜ
)

231  
c
->
”rÜ
;

233 ià(
c
->
šÃr
)

234 
»t
 = 
	`av_»ad_äame
(
c
->
šÃr
, 
pkt
);

236 
c
->
io_cÚŒŞ
.
»Œy_couÁ”
 = 0;

237 
»t
 < 0) {

238 ià(
c
->
šÃr
 && c->šÃr->
pb
 && c->šÃr->pb->
”rÜ
 && 
avf
->pb)

239 
avf
->
pb
->
”rÜ
 = 
c
->
šÃr
->pb->error;

242 
»t
) {

243 
AVERROR_EXIT
:

244 
c
->
”rÜ
 = 
AVERROR_EXIT
;

245 
ç
;

246 
	`AVERROR
(
EAGAIN
):

247 
cÚtšue_»ad
;

250 
c
->
io_cÚŒŞ
.
»Œy_couÁ”
++;

251 
»t
 = 
	`ijku¾hook_ÿÎ_šjeù
(
avf
);

252 ià(
»t
) {

253 
»t
 = 
AVERROR_EXIT
;

254 
ç
;

257 
c
->
discÚtšu™y
 = 1;

258 
»t
 = 
	`İ’_šÃr
(
avf
);

259 ià(
»t
)

262 
cÚtšue_»ad
:

263 
»t
 = 
	`av_»ad_äame
(
c
->
šÃr
, 
pkt
);

266 ià(
c
->
discÚtšu™y
) {

267 
pkt
->
æags
 |ğ
AV_PKT_FLAG_DISCONTINUITY
;

268 
c
->
discÚtšu™y
 = 0;

272 
ç
:

273  
»t
;

274 
	}
}

276 
	#OFFSET
(
x
è
	`off£tof
(
CÚ‹xt
, x)

	)

277 
	#D
 
AV_OPT_FLAG_DECODING_PARAM


	)

279 cÚ¡ 
AVO±iÚ
 
	gİtiÚs
[] = {

280 { "ijk­¶iÿtiÚ", "AVAµliÿtiÚCÚ‹xt", 
OFFSET
(
­p_ùx_šŒ
), 
AV_OPT_TYPE_INT64
, { .
i64
 = 0 }, 
	gINT64_MIN
, 
	gINT64_MAX
, .
	gæags
 = 
D
 },

281 { 
	gNULL
 }

284 #undeà
D


285 #undeà
OFFSET


287 cÚ¡ 
AVCÏss
 
	gijklivehook_şass
 = {

288 .
şass_Çme
 = "LiveHook demuxer",

289 .
	g™em_Çme
 = 
av_deçuÉ_™em_Çme
,

290 .
	gİtiÚ
 = 
İtiÚs
,

291 .
	gv”siÚ
 = 
LIBAVUTIL_VERSION_INT
,

294 
AVIÅutFÜm©
 
	gijkff_ijklivehook_demux”
 = {

295 .
Çme
 = "ijklivehook",

296 .
	glÚg_Çme
 = "Live Hook Controller",

297 .
	gæags
 = 
AVFMT_NOFILE
 | 
AVFMT_TS_DISCONT
,

298 .
	g´iv_d©a_size
 = (
CÚ‹xt
),

299 .
	g»ad_´obe
 = 
ijklivehook_´obe
,

300 .
	g»ad_h—d”2
 = 
ijklivehook_»ad_h—d”
,

301 .
	g»ad_·ck‘
 = 
ijklivehook_»ad_·ck‘
,

302 .
	g»ad_şo£
 = 
ijklivehook_»ad_şo£
,

303 .
	g´iv_şass
 = &
ijklivehook_şass
,

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijklongurl.c

22 
	~<as£¹.h
>

23 
	~"libavfÜm©/avfÜm©.h
"

24 
	~"libavfÜm©/u¾.h
"

25 
	~"libavut/av¡ršg.h
"

26 
	~"libavut/log.h
"

27 
	~"libavut/İt.h
"

29 
	sCÚ‹xt
 {

30 
AVCÏss
 *
	mşass
;

31 
URLCÚ‹xt
 *
	mšÃr
;

34 *
	mu¾
;

35 } 
	tCÚ‹xt
;

37 
	$ijklÚgu¾_İ’
(
URLCÚ‹xt
 *
h
, cÚ¡ *
¬g
, 
æags
, 
AVDiùiÚ¬y
 **
İtiÚs
)

39 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

41 ià(!
c
->
u¾
 || !*c->url)

42  
AVERROR_EXTERNAL
;

44  
	`ffu¾_İ’_wh™–i¡
(&
c
->
šÃr
,

45 
c
->
u¾
,

46 
æags
,

47 &
h
->
š‹¼u±_ÿÎback
,

48 
İtiÚs
,

49 
h
->
´ÙocŞ_wh™–i¡
,

50 
h
->
´ÙocŞ_bÏckli¡
,

51 
h
);

52 
	}
}

54 
	$ijklÚgu¾_şo£
(
URLCÚ‹xt
 *
h
)

56 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

58  
	`ffu¾_şo£
(
c
->
šÃr
);

59 
	}
}

61 
	$ijklÚgu¾_»ad
(
URLCÚ‹xt
 *
h
, *
buf
, 
size
)

63 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

65  
	`ffu¾_»ad
(
c
->
šÃr
, 
buf
, 
size
);

66 
	}
}

68 
št64_t
 
	$ijklÚgu¾_£ek
(
URLCÚ‹xt
 *
h
, 
št64_t
 
pos
, 
wh’û
)

70 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

72  
	`ffu¾_£ek
(
c
->
šÃr
, 
pos
, 
wh’û
);

73 
	}
}

75 
	#OFFSET
(
x
è
	`off£tof
(
CÚ‹xt
, x)

	)

76 
	#D
 
AV_OPT_FLAG_DECODING_PARAM


	)

78 cÚ¡ 
AVO±iÚ
 
	gİtiÚs
[] = {

80 
OFFSET
(
u¾
), 
AV_OPT_TYPE_STRING
, {.
¡r
 = 
NULL
}, 0, 0, 
	gD
 },

81 { 
	gNULL
 }

84 #undeà
D


85 #undeà
OFFSET


87 cÚ¡ 
AVCÏss
 
	gijklÚgu¾_cÚ‹xt_şass
 = {

88 .
şass_Çme
 = "LongUrl",

89 .
	g™em_Çme
 = 
av_deçuÉ_™em_Çme
,

90 .
	gİtiÚ
 = 
İtiÚs
,

91 .
	gv”siÚ
 = 
LIBAVUTIL_VERSION_INT
,

94 
URLPrÙocŞ
 
	gijkimp_ff_ijklÚgu¾_´ÙocŞ
 = {

95 .
Çme
 = "ijklongurl",

96 .
	gu¾_İ’2
 = 
ijklÚgu¾_İ’
,

97 .
	gu¾_»ad
 = 
ijklÚgu¾_»ad
,

98 .
	gu¾_£ek
 = 
ijklÚgu¾_£ek
,

99 .
	gu¾_şo£
 = 
ijklÚgu¾_şo£
,

100 .
	g´iv_d©a_size
 = (
CÚ‹xt
),

101 .
	g´iv_d©a_şass
 = &
ijklÚgu¾_cÚ‹xt_şass
,

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkmediadatasource.c

22 #ifdeà
__ANDROID__


24 
	~<as£¹.h
>

25 
	~"libavfÜm©/avfÜm©.h
"

26 
	~"libavfÜm©/u¾.h
"

27 
	~"libavut/av¡ršg.h
"

28 
	~"libavut/log.h
"

29 
	~"libavut/İt.h
"

31 
	~"ijkavfÜm©/ijkavfÜm©.h
"

32 
	~"ijk¶ay”/ijkavut/İt.h
"

34 
	~"j4a/şass/tv/dªmaku/ijk/medŸ/¶ay”/misc/IMedŸD©aSourû.h
"

35 
	~"ijksdl/ªdroid/ijksdl_ªdroid_jni.h
"

37 
	sCÚ‹xt
 {

38 
AVCÏss
 *
	mşass
;

41 
št64_t
 
	mlogiÿl_pos
;

42 
št64_t
 
	mlogiÿl_size
;

44 
št64_t
 
	mmedŸ_d©a_sourû_±r
;

45 
jobjeù
 
	mmedŸ_d©a_sourû
;

46 
jby‹A¼ay
 
	mjbufãr
;

47 
	mjbufãr_ÿ·c™y
;

48 } 
	tCÚ‹xt
;

50 
	$ijkmds_İ’
(
URLCÚ‹xt
 *
h
, cÚ¡ *
¬g
, 
æags
, 
AVDiùiÚ¬y
 **
İtiÚs
)

52 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

53 
JNIEnv
 *
’v
 = 
NULL
;

54 
jobjeù
 
medŸ_d©a_sourû
 = 
NULL
;

55 *
fš®
 = 
NULL
;

57 
	`av_¡r¡¬t
(
¬g
, "ijkmediadatasource:", &arg);

59 
medŸ_d©a_sourû
 = (
jobjeù
è(
šŒ_t
è
	`¡¹Şl
(
¬g
, &
fš®
, 10);

60 ià(!
medŸ_d©a_sourû
)

61  
	`AVERROR
(
EINVAL
);

63 ià(
JNI_OK
 !ğ
	`SDL_JNI_S‘upTh»adEnv
(&
’v
)) {

64 
	`av_log
(
h
, 
AV_LOG_ERROR
, "%s: SDL_JNI_S‘upTh»adEnv: faed", 
__func__
);

65  
	`AVERROR
(
EINVAL
);

68 
c
->
logiÿl_size
 = 
	`J4AC_IMedŸD©aSourû__g‘Size
(
’v
, 
medŸ_d©a_sourû
);

69 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
)) {

70  
	`AVERROR
(
EINVAL
);

71 } ià(
c
->
logiÿl_size
 < 0) {

72 
h
->
is_¡»amed
 = 1;

73 
c
->
logiÿl_size
 = -1;

76 
c
->
medŸ_d©a_sourû
 = (*
’v
)->
	`NewGlob®Ref
(env, media_data_source);

77 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
è|| !
c
->
medŸ_d©a_sourû
) {

78  
	`AVERROR
(
ENOMEM
);

82 
	}
}

84 
	$ijkmds_şo£
(
URLCÚ‹xt
 *
h
)

86 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

87 
JNIEnv
 *
’v
 = 
NULL
;

89 ià(
JNI_OK
 !ğ
	`SDL_JNI_S‘upTh»adEnv
(&
’v
)) {

90 
	`av_log
(
h
, 
AV_LOG_ERROR
, "%s: SDL_JNI_S‘upTh»adEnv: faed", 
__func__
);

91  
	`AVERROR
(
EINVAL
);

94 
	`J4A_D–‘eGlob®Ref__p
(
’v
, &
c
->
jbufãr
);

96 ià(
c
->
medŸ_d©a_sourû
) {

97 
	`J4AC_IMedŸD©aSourû__şo£__ÿtchAÎ
(
’v
, 
c
->
medŸ_d©a_sourû
);

98 
	`J4A_D–‘eGlob®Ref__p
(
’v
, &
c
->
medŸ_d©a_sourû
);

100 
c
->
medŸ_d©a_sourû_±r
 = 0;

103 
	}
}

105 
jobjeù
 
	$jbufãr_grow
(
JNIEnv
 *
’v
, 
URLCÚ‹xt
 *
h
, 
Ãw_ÿ·c™y
) {

106 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

108 ià(
c
->
jbufãr
 && c->
jbufãr_ÿ·c™y
 >ğ
Ãw_ÿ·c™y
)

109  
c
->
jbufãr
;

111 
Ãw_ÿ·c™y
 = 
	`FFMAX
Òew_ÿ·c™y, 
c
->
jbufãr_ÿ·c™y
 * 2);

113 
	`J4A_D–‘eGlob®Ref__p
(
’v
, &
c
->
jbufãr
);

114 
c
->
jbufãr_ÿ·c™y
 = 0;

116 
c
->
jbufãr
 = 
	`J4A_NewBy‹A¼ay__asGlob®Ref__ÿtchAÎ
(
’v
, 
Ãw_ÿ·c™y
);

117 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
è|| !
c
->
jbufãr
) {

118 
c
->
jbufãr
 = 
NULL
;

119  
NULL
;

122 
c
->
jbufãr_ÿ·c™y
 = 
Ãw_ÿ·c™y
;

123  
c
->
jbufãr
;

124 
	}
}

126 
	$ijkmds_»ad
(
URLCÚ‹xt
 *
h
, *
buf
, 
size
)

128 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

129 
JNIEnv
 *
’v
 = 
NULL
;

130 
jby‹A¼ay
 
jbufãr
 = 
NULL
;

131 
jšt
 
»t
 = 0;

133 ià(!
c
->
medŸ_d©a_sourû
)

134  
	`AVERROR
(
EINVAL
);

136 ià(
JNI_OK
 !ğ
	`SDL_JNI_S‘upTh»adEnv
(&
’v
)) {

137 
	`av_log
(
h
, 
AV_LOG_ERROR
, "%s: SDL_JNI_S‘upTh»adEnv: faed", 
__func__
);

138  
	`AVERROR
(
EINVAL
);

141 
jbufãr
 = 
	`jbufãr_grow
(
’v
, 
h
, 
size
);

142 ià(!
jbufãr
)

143  
	`AVERROR
(
ENOMEM
);

145 
»t
 = 
	`J4AC_IMedŸD©aSourû__»adAt
(
’v
, 
c
->
medŸ_d©a_sourû
, c->
logiÿl_pos
, 
jbufãr
, 0, 
size
);

146 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
))

147  
	`AVERROR
(
EIO
);

148 ià(
»t
 < 0)

149  
AVERROR_EOF
;

150 ià(
»t
 == 0)

151  
	`AVERROR
(
EAGAIN
);

153 (*
’v
)->
	`G‘By‹A¼ayRegiÚ
Ónv, 
jbufãr
, 0, 
»t
, (
jby‹
*)
buf
);

154 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
))

155  
	`AVERROR
(
EIO
);

157 
c
->
logiÿl_pos
 +ğ
»t
;

158  
»t
;

159 
	}
}

161 
št64_t
 
	$ijkmds_£ek
(
URLCÚ‹xt
 *
h
, 
št64_t
 
pos
, 
wh’û
)

163 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

164 
št64_t
 
»t
;

165 
št64_t
 
Ãw_logiÿl_pos
;

166 
JNIEnv
 *
’v
 = 
NULL
;

167 
jobjeù
 
jbufãr
 = 
NULL
;

169 ià(!
c
->
medŸ_d©a_sourû
)

170  
	`AVERROR
(
EINVAL
);

172 ià(
JNI_OK
 !ğ
	`SDL_JNI_S‘upTh»adEnv
(&
’v
)) {

173 
	`av_log
(
h
, 
AV_LOG_ERROR
, "%s: SDL_JNI_S‘upTh»adEnv: faed", 
__func__
);

174  
	`AVERROR
(
EINVAL
);

177 ià(
wh’û
 =ğ
AVSEEK_SIZE
) {

178 
	`av_log
(
h
, 
AV_LOG_TRACE
, "%s: AVSEEK_SIZE: %"
PRId64
"\n", 
__func__
, (
št64_t
)
c
->
logiÿl_size
);

179  
c
->
logiÿl_size
;

180 } ià(
wh’û
 =ğ
SEEK_CUR
) {

181 
	`av_log
(
h
, 
AV_LOG_TRACE
, "%s: %"
PRId64
"\n", 
__func__
, 
pos
);

182 
Ãw_logiÿl_pos
 = 
pos
 + 
c
->
logiÿl_pos
;

183 } ià(
wh’û
 =ğ
SEEK_SET
){

184 
	`av_log
(
h
, 
AV_LOG_TRACE
, "%s: %"
PRId64
"\n", 
__func__
, 
pos
);

185 
Ãw_logiÿl_pos
 = 
pos
;

187  
	`AVERROR
(
EINVAL
);

189 ià(
Ãw_logiÿl_pos
 < 0)

190  
	`AVERROR
(
EINVAL
);

192 
jbufãr
 = 
	`jbufãr_grow
(
’v
, 
h
, 0);

193 ià(!
jbufãr
)

194  
	`AVERROR
(
ENOMEM
);

196 
»t
 = 
	`J4AC_IMedŸD©aSourû__»adAt
(
’v
, 
c
->
medŸ_d©a_sourû
, 
Ãw_logiÿl_pos
, 
jbufãr
, 0, 0);

197 ià(
	`J4A_Exû±iÚCheck__ÿtchAÎ
(
’v
))

198  
	`AVERROR
(
EIO
);

199 ià(
»t
 < 0)

200  
AVERROR_EOF
;

202 
c
->
logiÿl_pos
 = 
Ãw_logiÿl_pos
;

203  
c
->
logiÿl_pos
;

204 
	}
}

206 
	#OFFSET
(
x
è
	`off£tof
(
CÚ‹xt
, x)

	)

207 
	#D
 
AV_OPT_FLAG_DECODING_PARAM


	)

209 cÚ¡ 
AVO±iÚ
 
	gİtiÚs
[] = {

210 { 
NULL
 }

213 #undeà
D


214 #undeà
OFFSET


216 cÚ¡ 
AVCÏss
 
	gijkmedŸd©asourû_cÚ‹xt_şass
 = {

217 .
şass_Çme
 = "IjkMediaDataSource",

218 .
	g™em_Çme
 = 
av_deçuÉ_™em_Çme
,

219 .
	gİtiÚ
 = 
İtiÚs
,

220 .
	gv”siÚ
 = 
LIBAVUTIL_VERSION_INT
,

223 
URLPrÙocŞ
 
	gijkimp_ff_ijkmedŸd©asourû_´ÙocŞ
 = {

224 .
Çme
 = "ijkmediadatasource",

225 .
	gu¾_İ’2
 = 
ijkmds_İ’
,

226 .
	gu¾_»ad
 = 
ijkmds_»ad
,

227 .
	gu¾_£ek
 = 
ijkmds_£ek
,

228 .
	gu¾_şo£
 = 
ijkmds_şo£
,

229 .
	g´iv_d©a_size
 = (
CÚ‹xt
),

230 .
	g´iv_d©a_şass
 = &
ijkmedŸd©asourû_cÚ‹xt_şass
,

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijksegment.c

22 
	~<as£¹.h
>

23 
	~"libavfÜm©/avfÜm©.h
"

24 
	~"libavfÜm©/u¾.h
"

25 
	~"libavut/av¡ršg.h
"

26 
	~"libavut/log.h
"

27 
	~"libavut/İt.h
"

29 
	~"libavut/­¶iÿtiÚ.h
"

31 
	sCÚ‹xt
 {

32 
AVCÏss
 *
	mşass
;

33 
URLCÚ‹xt
 *
	mšÃr
;

36 *
	mh‰p_hook
;

37 
št64_t
 
	m­p_ùx_šŒ
;

38 } 
	tCÚ‹xt
;

40 
	$ijk£gm’t_İ’
(
URLCÚ‹xt
 *
h
, cÚ¡ *
¬g
, 
æags
, 
AVDiùiÚ¬y
 **
İtiÚs
)

42 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

43 
AVAµIOCÚŒŞ
 
io_cÚŒŞ
 = {0};

44 
AVAµliÿtiÚCÚ‹xt
 *
­p_ùx
 = (AVAµliÿtiÚCÚ‹xˆ*)(
šŒ_t
)
c
->
­p_ùx_šŒ
;

45 
»t
 = -1;

46 
£gm’t_šdex
 = -1;

48 
	`av_¡r¡¬t
(
¬g
, "ijksegment:", &arg);

50 ià(!
¬g
 || !*arg)

51  
AVERROR_EXTERNAL
;

53 
£gm’t_šdex
 = ()
	`¡¹Ş
(
¬g
, 
NULL
, 0);

54 
io_cÚŒŞ
.
size
 = (io_control);

55 
io_cÚŒŞ
.
£gm’t_šdex
 = segment_index;

56 
	`¡¾ıy
(
io_cÚŒŞ
.
u¾
, 
¬g
, (io_control.url));

58 ià(
­p_ùx
 && 
io_cÚŒŞ
.
£gm’t_šdex
 < 0) {

59 
»t
 = 
AVERROR_EXTERNAL
;

60 
ç
;

62 
»t
 = 
	`av_­¶iÿtiÚ_Ú_io_cÚŒŞ
(
­p_ùx
, 
AVAPP_CTRL_WILL_CONCAT_SEGMENT_OPEN
, &
io_cÚŒŞ
);

63 ià(
»t
 || !
io_cÚŒŞ
.
u¾
[0]) {

64 
»t
 = 
AVERROR_EXIT
;

65 
ç
;

68 
	`av_diù_£t_št
(
İtiÚs
, "ijk­¶iÿtiÚ", 
c
->
­p_ùx_šŒ
, 0);

69 
	`av_diù_£t_št
(
İtiÚs
, "ijkšjeù-£gm’t-šdex", 
£gm’t_šdex
, 0);

71 
»t
 = 
	`ffu¾_İ’_wh™–i¡
(&
c
->
šÃr
,

72 
io_cÚŒŞ
.
u¾
,

73 
æags
,

74 &
h
->
š‹¼u±_ÿÎback
,

75 
İtiÚs
,

76 
h
->
´ÙocŞ_wh™–i¡
,

77 
h
->
´ÙocŞ_bÏckli¡
,

78 
h
);

79 ià(
»t
)

80 
ç
;

83 
ç
:

84  
»t
;

85 
	}
}

87 
	$ijk£gm’t_şo£
(
URLCÚ‹xt
 *
h
)

89 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

91  
	`ffu¾_şo£
(
c
->
šÃr
);

92 
	}
}

94 
	$ijk£gm’t_»ad
(
URLCÚ‹xt
 *
h
, *
buf
, 
size
)

96 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

98  
	`ffu¾_»ad
(
c
->
šÃr
, 
buf
, 
size
);

99 
	}
}

101 
št64_t
 
	$ijk£gm’t_£ek
(
URLCÚ‹xt
 *
h
, 
št64_t
 
pos
, 
wh’û
)

103 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

105  
	`ffu¾_£ek
(
c
->
šÃr
, 
pos
, 
wh’û
);

106 
	}
}

108 
	#OFFSET
(
x
è
	`off£tof
(
CÚ‹xt
, x)

	)

109 
	#D
 
AV_OPT_FLAG_DECODING_PARAM


	)

111 cÚ¡ 
AVO±iÚ
 
	gİtiÚs
[] = {

112 { "ijk­¶iÿtiÚ", "AVAµliÿtiÚCÚ‹xt", 
OFFSET
(
­p_ùx_šŒ
), 
AV_OPT_TYPE_INT64
, { .
i64
 = 0 }, 
	gINT64_MIN
, 
	gINT64_MAX
, .
	gæags
 = 
D
 },

113 { 
	gNULL
 }

116 #undeà
D


117 #undeà
OFFSET


119 cÚ¡ 
AVCÏss
 
	gijk£gm’t_cÚ‹xt_şass
 = {

120 .
şass_Çme
 = "Inject",

121 .
	g™em_Çme
 = 
av_deçuÉ_™em_Çme
,

122 .
	gİtiÚ
 = 
İtiÚs
,

123 .
	gv”siÚ
 = 
LIBAVUTIL_VERSION_INT
,

126 
URLPrÙocŞ
 
	gijkimp_ff_ijk£gm’t_´ÙocŞ
 = {

127 .
Çme
 = "ijksegment",

128 .
	gu¾_İ’2
 = 
ijk£gm’t_İ’
,

129 .
	gu¾_»ad
 = 
ijk£gm’t_»ad
,

130 .
	gu¾_£ek
 = 
ijk£gm’t_£ek
,

131 .
	gu¾_şo£
 = 
ijk£gm’t_şo£
,

132 .
	g´iv_d©a_size
 = (
CÚ‹xt
),

133 .
	g´iv_d©a_şass
 = &
ijk£gm’t_cÚ‹xt_şass
,

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkurlhook.c

22 
	~<as£¹.h
>

23 
	~"libavfÜm©/avfÜm©.h
"

24 
	~"libavfÜm©/u¾.h
"

25 
	~"libavut/av¡ršg.h
"

26 
	~"libavut/log.h
"

27 
	~"libavut/İt.h
"

29 
	~"libavut/­¶iÿtiÚ.h
"

31 
	sCÚ‹xt
 {

32 
AVCÏss
 *
	mşass
;

33 
URLCÚ‹xt
 *
	mšÃr
;

35 
št64_t
 
	mlogiÿl_pos
;

36 
št64_t
 
	mlogiÿl_size
;

37 
	mio_”rÜ
;

39 
AVAµIOCÚŒŞ
 
	m­p_io_ù¾
;

40 cÚ¡ *
	mscheme
;

41 cÚ¡ *
	mšÃr_scheme
;

44 
	mšÃr_æags
;

45 
AVDiùiÚ¬y
 *
	mšÃr_İtiÚs
;

46 
	m£gm’t_šdex
;

47 
št64_t
 
	m‹¡_ç_pošt
;

48 
št64_t
 
	m‹¡_ç_pošt_Ãxt
;

49 
št64_t
 
	m­p_ùx_šŒ
;

50 
AVAµliÿtiÚCÚ‹xt
 *
	m­p_ùx
;

51 } 
	tCÚ‹xt
;

53 
	$ijku¾hook_ÿÎ_šjeù
(
URLCÚ‹xt
 *
h
)

55 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

56 
»t
 = 0;

58 ià(
	`ff_check_š‹¼u±
(&
h
->
š‹¼u±_ÿÎback
)) {

59 
»t
 = 
AVERROR_EXIT
;

60 
ç
;

63 ià(
c
->
­p_ùx
) {

64 
AVAµIOCÚŒŞ
 
cÚŒŞ_d©a_backup
 = 
c
->
­p_io_ù¾
;

66 
c
->
­p_io_ù¾
.
is_hªdËd
 = 0;

67 
c
->
­p_io_ù¾
.
is_u¾_chªged
 = 0;

68 
»t
 = 
	`av_­¶iÿtiÚ_Ú_io_cÚŒŞ
(
c
->
­p_ùx
, 
AVAPP_CTRL_WILL_HTTP_OPEN
, &c->
­p_io_ù¾
);

69 ià(
»t
 || !
c
->
­p_io_ù¾
.
u¾
[0]) {

70 
»t
 = 
AVERROR_EXIT
;

71 
ç
;

73 ià(!
c
->
­p_io_ù¾
.
is_u¾_chªged
 && 
	`¡rcmp
(
cÚŒŞ_d©a_backup
.
u¾
, c->app_io_ctrl.url)) {

75 
c
->
­p_io_ù¾
.
is_u¾_chªged
 = 1;

78 
	`av_log
(
h
, 
AV_LOG_INFO
, "% % (%s)\n", h->
´Ù
->
Çme
, 
c
->
­p_io_ù¾
.
u¾
, c->­p_io_ù¾.
is_u¾_chªged
 ? "changed" : "remain");

81 ià(
	`ff_check_š‹¼u±
(&
h
->
š‹¼u±_ÿÎback
)) {

82 
»t
 = 
AVERROR_EXIT
;

83 
	`av_log
(
h
, 
AV_LOG_ERROR
, "% % (%s)\n", h->
´Ù
->
Çme
, 
c
->
­p_io_ù¾
.
u¾
, c->­p_io_ù¾.
is_u¾_chªged
 ? "changed" : "remain");

84 
ç
;

87 
ç
:

88  
»t
;

89 
	}
}

91 
	$ijku¾hook_»cÚÃù
(
URLCÚ‹xt
 *
h
, 
AVDiùiÚ¬y
 *
exŒa
)

93 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

94 
»t
 = 0;

95 
URLCÚ‹xt
 *
Ãw_u¾
 = 
NULL
;

96 
AVDiùiÚ¬y
 *
šÃr_İtiÚs
 = 
NULL
;

98 
c
->
‹¡_ç_pošt_Ãxt
 +ğc->
‹¡_ç_pošt
;

100 
	`as£¹
(
c
->
šÃr_İtiÚs
);

101 
	`av_diù_cİy
(&
šÃr_İtiÚs
, 
c
->inner_options, 0);

102 ià(
exŒa
)

103 
	`av_diù_cİy
(&
šÃr_İtiÚs
, 
exŒa
, 0);

105 
»t
 = 
	`ffu¾_İ’_wh™–i¡
(&
Ãw_u¾
,

106 
c
->
­p_io_ù¾
.
u¾
,

107 
c
->
šÃr_æags
,

108 &
h
->
š‹¼u±_ÿÎback
,

109 &
šÃr_İtiÚs
,

110 
h
->
´ÙocŞ_wh™–i¡
,

111 
h
->
´ÙocŞ_bÏckli¡
,

112 
h
);

113 ià(
»t
)

114 
ç
;

116 
	`ffu¾_şo£p
(&
c
->
šÃr
);

118 
c
->
šÃr
 = 
Ãw_u¾
;

119 
h
->
is_¡»amed
 = 
c
->
šÃr
->is_streamed;

120 
c
->
logiÿl_pos
 = 
	`ffu¾_£ek
(c->
šÃr
, 0, 
SEEK_CUR
);

121 ià(
c
->
šÃr
->
is_¡»amed
)

122 
c
->
logiÿl_size
 = -1;

124 
c
->
logiÿl_size
 = 
	`ffu¾_£ek
(c->
šÃr
, 0, 
AVSEEK_SIZE
);

126 
c
->
io_”rÜ
 = 0;

127 
ç
:

128 
	`av_diù_ä“
(&
šÃr_İtiÚs
);

129  
»t
;

130 
	}
}

132 
	$ijku¾hook_š™
(
URLCÚ‹xt
 *
h
, cÚ¡ *
¬g
, 
æags
, 
AVDiùiÚ¬y
 **
İtiÚs
)

134 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

135 
»t
 = 0;

137 
	`av_¡r¡¬t
(
¬g
, 
c
->
scheme
, &arg);

139 
c
->
šÃr_æags
 = 
æags
;

141 ià(
İtiÚs
)

142 
	`av_diù_cİy
(&
c
->
šÃr_İtiÚs
, *
İtiÚs
, 0);

144 
	`av_diù_£t_št
(&
c
->
šÃr_İtiÚs
, "ijk­¶iÿtiÚ", c->
­p_ùx_šŒ
, 0);

145 
	`av_diù_£t_št
(&
c
->
šÃr_İtiÚs
, "ijkšjeù-£gm’t-šdex", c->
£gm’t_šdex
, 0);

147 
c
->
­p_io_ù¾
.
size
 = (c->app_io_ctrl);

148 
c
->
­p_io_ù¾
.
£gm’t_šdex
 = c->segment_index;

149 
c
->
­p_io_ù¾
.
»Œy_couÁ”
 = 0;

151 ià(
	`av_¡r¡¬t
(
¬g
, 
c
->
šÃr_scheme
, 
NULL
)) {

152 
	`¢´štf
(
c
->
­p_io_ù¾
.
u¾
, (c->­p_io_ù¾.u¾), "%s", 
¬g
);

154 
	`¢´štf
(
c
->
­p_io_ù¾
.
u¾
, (c->­p_io_ù¾.u¾), "%s%s", c->
šÃr_scheme
, 
¬g
);

157  
»t
;

158 
	}
}

160 
	$ijktıhook_İ’
(
URLCÚ‹xt
 *
h
, cÚ¡ *
¬g
, 
æags
, 
AVDiùiÚ¬y
 **
İtiÚs
)

162 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

163 
»t
 = 0;

165 
c
->
­p_ùx
 = (
AVAµliÿtiÚCÚ‹xt
 *)(
šŒ_t
)c->
­p_ùx_šŒ
;

166 
c
->
scheme
 = "ijktcphook:";

167 
c
->
šÃr_scheme
 = "tcp:";

168 
»t
 = 
	`ijku¾hook_š™
(
h
, 
¬g
, 
æags
, 
İtiÚs
);

169 ià(
»t
)

170 
ç
;

172 
»t
 = 
	`ijku¾hook_»cÚÃù
(
h
, 
NULL
);

173 ià(
»t
)

174 
ç
;

176 
ç
:

177  
»t
;

178 
	}
}

180 
	$ijku¾hook_şo£
(
URLCÚ‹xt
 *
h
)

182 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

184 
	`av_diù_ä“
(&
c
->
šÃr_İtiÚs
);

185  
	`ffu¾_şo£p
(&
c
->
šÃr
);

186 
	}
}

188 
	$ijku¾hook_»ad
(
URLCÚ‹xt
 *
h
, *
buf
, 
size
)

190 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

191 
»t
 = 0;

193 ià(
c
->
io_”rÜ
 < 0)

194  
c
->
io_”rÜ
;

196 ià(
c
->
‹¡_ç_pošt_Ãxt
 > 0 && c->
logiÿl_pos
 >= c->test_fail_point_next) {

197 
	`av_log
(
h
, 
AV_LOG_ERROR
, "‹¡ fa…ošt:%"
PRId64
"\n", 
c
->
‹¡_ç_pošt_Ãxt
);

198 
c
->
io_”rÜ
 = 
	`AVERROR
(
EIO
);

199  
	`AVERROR
(
EIO
);

202 
»t
 = 
	`ffu¾_»ad
(
c
->
šÃr
, 
buf
, 
size
);

203 ià(
»t
 > 0)

204 
c
->
logiÿl_pos
 +ğ
»t
;

206 
c
->
io_”rÜ
 = 
»t
;

208  
»t
;

209 
	}
}

211 
	$ijku¾hook_wr™e
(
URLCÚ‹xt
 *
h
, cÚ¡ *
buf
, 
size
)

213 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

215  
	`ffu¾_wr™e
(
c
->
šÃr
, 
buf
, 
size
);

216 
	}
}

218 
št64_t
 
	$ijku¾hook_£ek
(
URLCÚ‹xt
 *
h
, 
št64_t
 
pos
, 
wh’û
)

220 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

221 
št64_t
 
£ek_»t
 = 0;

223 
£ek_»t
 = 
	`ffu¾_£ek
(
c
->
šÃr
, 
pos
, 
wh’û
);

224 ià(
£ek_»t
 < 0) {

225 
c
->
io_”rÜ
 = ()
£ek_»t
;

226  
£ek_»t
;

229 
c
->
logiÿl_pos
 = 
£ek_»t
;

230 ià(
c
->
‹¡_ç_pošt
)

231 
c
->
‹¡_ç_pošt_Ãxt
 = c->
logiÿl_pos
 + c->
‹¡_ç_pošt
;

233 
c
->
io_”rÜ
 = 0;

234  
£ek_»t
;

235 
	}
}

237 
	$ijkh‰phook_»cÚÃù_©
(
URLCÚ‹xt
 *
h
, 
št64_t
 
off£t
)

239 
»t
 = 0;

240 
AVDiùiÚ¬y
 *
exŒa_İts
 = 
NULL
;

242 
	`av_diù_£t_št
(&
exŒa_İts
, "off£t", 
off£t
, 0);

243 
»t
 = 
	`ijku¾hook_»cÚÃù
(
h
, 
exŒa_İts
);

244 
	`av_diù_ä“
(&
exŒa_İts
);

245  
»t
;

246 
	}
}

248 
	$ijkh‰phook_İ’
(
URLCÚ‹xt
 *
h
, cÚ¡ *
¬g
, 
æags
, 
AVDiùiÚ¬y
 **
İtiÚs
)

250 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

251 
»t
 = 0;

253 
c
->
­p_ùx
 = (
AVAµliÿtiÚCÚ‹xt
 *)(
šŒ_t
)c->
­p_ùx_šŒ
;

254 
c
->
scheme
 = "ijkhttphook:";

255 ià(
	`av_¡ri¡¬t
(
¬g
, "ijkh‰phook:h‰ps:", 
NULL
))

256 
c
->
šÃr_scheme
 = "https:";

258 
c
->
šÃr_scheme
 = "http:";

260 
»t
 = 
	`ijku¾hook_š™
(
h
, 
¬g
, 
æags
, 
İtiÚs
);

261 ià(
»t
)

262 
ç
;

264 
»t
 = 
	`ijku¾hook_ÿÎ_šjeù
(
h
);

265 ià(
»t
)

266 
ç
;

268 
»t
 = 
	`ijku¾hook_»cÚÃù
(
h
, 
NULL
);

269 
»t
) {

270 
šjeù_»t
 = 0;

272 
»t
) {

273 
AVERROR_EXIT
:

274 
ç
;

277 
c
->
­p_io_ù¾
.
»Œy_couÁ”
++;

278 
šjeù_»t
 = 
	`ijku¾hook_ÿÎ_šjeù
(
h
);

279 ià(
šjeù_»t
) {

280 
»t
 = 
AVERROR_EXIT
;

281 
ç
;

284 ià(!
c
->
­p_io_ù¾
.
is_hªdËd
)

285 
ç
;

287 
	`av_log
(
h
, 
AV_LOG_INFO
, "%s: wÈ»cÚÃù‡ˆ¡¬t\n", 
__func__
);

288 
»t
 = 
	`ijku¾hook_»cÚÃù
(
h
, 
NULL
);

289 
	`av_log
(
h
, 
AV_LOG_INFO
, "%s: did„ecÚÃù‡ˆ¡¬t: %d\n", 
__func__
, 
»t
);

290 ià(
»t
)

291 
c
->
­p_io_ù¾
.
»Œy_couÁ”
++;

294 
ç
:

295  
»t
;

296 
	}
}

298 
	$ijkh‰phook_»ad
(
URLCÚ‹xt
 *
h
, *
buf
, 
size
)

300 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

301 
»t
 = 0;

303 
c
->
­p_io_ù¾
.
»Œy_couÁ”
 = 0;

305 
»t
 = 
	`ijku¾hook_»ad
(
h
, 
buf
, 
size
);

306 
»t
 < 0 && !
h
->
is_¡»amed
 && 
c
->
logiÿl_pos
 < c->
logiÿl_size
) {

307 
»t
) {

308 
AVERROR_EXIT
:

309 
ç
;

312 
c
->
­p_io_ù¾
.
»Œy_couÁ”
++;

313 
»t
 = 
	`ijku¾hook_ÿÎ_šjeù
(
h
);

314 ià(
»t
)

315 
ç
;

317 ià(!
c
->
­p_io_ù¾
.
is_hªdËd
)

318 
ç
;

320 
	`av_log
(
h
, 
AV_LOG_INFO
, "%s: wÈ»cÚÃù(%dè© %"
PRId64
"\n", 
__func__
, 
c
->
­p_io_ù¾
.
»Œy_couÁ”
, c->
logiÿl_pos
);

321 
»t
 = 
	`ijkh‰phook_»cÚÃù_©
(
h
, 
c
->
logiÿl_pos
);

322 
	`av_log
(
h
, 
AV_LOG_INFO
, "%s: did„ecÚÃù(%dè© %"
PRId64
": %d\n", 
__func__
, 
c
->
­p_io_ù¾
.
»Œy_couÁ”
, c->
logiÿl_pos
, 
»t
);

323 ià(
»t
 < 0)

326 
»t
 = 
	`ijku¾hook_»ad
(
h
, 
buf
, 
size
);

329 
ç
:

330 ià(
»t
 <= 0) {

331 
c
->
io_”rÜ
 = 
»t
;

333  
»t
;

334 
	}
}

336 
št64_t
 
	$ijkh‰phook_»£ek_©
(
URLCÚ‹xt
 *
h
, 
št64_t
 
pos
, 
wh’û
, 
fÜû_»cÚÃù
)

338 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

339 
»t
 = 0;

341 ià(!
fÜû_»cÚÃù
)

342  
	`ijku¾hook_£ek
(
h
, 
pos
, 
wh’û
);

344 ià(
wh’û
 =ğ
SEEK_CUR
)

345 
pos
 +ğ
c
->
logiÿl_pos
;

346 ià(
wh’û
 =ğ
SEEK_END
)

347 
pos
 +ğ
c
->
logiÿl_size
;

348 ià(
wh’û
 !ğ
SEEK_SET
)

349  
	`AVERROR
(
EINVAL
);

350 ià(
pos
 < 0)

351  
	`AVERROR
(
EINVAL
);

353 
»t
 = 
	`ijkh‰phook_»cÚÃù_©
(
h
, 
pos
);

354 ià(
»t
) {

355 
c
->
io_”rÜ
 = 
»t
;

356  
»t
;

359 
c
->
io_”rÜ
 = 0;

360  
c
->
logiÿl_pos
;

361 
	}
}

363 
št64_t
 
	$ijkh‰phook_£ek
(
URLCÚ‹xt
 *
h
, 
št64_t
 
pos
, 
wh’û
)

365 
CÚ‹xt
 *
c
 = 
h
->
´iv_d©a
;

366 
»t
 = 0;

367 
št64_t
 
£ek_»t
 = -1;

369 ià(
wh’û
 =ğ
AVSEEK_SIZE
)

370  
c
->
logiÿl_size
;

371 ià((
wh’û
 =ğ
SEEK_CUR
 && 
pos
 == 0) ||

372 (
wh’û
 =ğ
SEEK_SET
 && 
pos
 =ğ
c
->
logiÿl_pos
))

373  
c
->
logiÿl_pos
;

374 ià((
c
->
logiÿl_size
 < 0 && 
wh’û
 =ğ
SEEK_END
è|| 
h
->
is_¡»amed
)

375  
	`AVERROR
(
ENOSYS
);

377 
c
->
­p_io_ù¾
.
»Œy_couÁ”
 = 0;

378 
»t
 = 
	`ijku¾hook_ÿÎ_šjeù
(
h
);

379 ià(
»t
) {

380 
»t
 = 
AVERROR_EXIT
;

381 
ç
;

384 
£ek_»t
 = 
	`ijkh‰phook_»£ek_©
(
h
, 
pos
, 
wh’û
, 
c
->
­p_io_ù¾
.
is_u¾_chªged
);

385 
£ek_»t
 < 0) {

386 
£ek_»t
) {

387 
AVERROR_EXIT
:

388 
AVERROR_EOF
:

389 
ç
;

392 
c
->
­p_io_ù¾
.
»Œy_couÁ”
++;

393 
»t
 = 
	`ijku¾hook_ÿÎ_šjeù
(
h
);

394 ià(
»t
) {

395 
»t
 = 
AVERROR_EXIT
;

396 
ç
;

399 ià(!
c
->
­p_io_ù¾
.
is_hªdËd
)

400 
ç
;

402 
	`av_log
(
h
, 
AV_LOG_INFO
, "%s: wÈ»£ek(%dè©…os=%"
PRId64
", wh’û=%d\n", 
__func__
, 
c
->
­p_io_ù¾
.
»Œy_couÁ”
, 
pos
, 
wh’û
);

403 
£ek_»t
 = 
	`ijkh‰phook_»£ek_©
(
h
, 
pos
, 
wh’û
, 
c
->
­p_io_ù¾
.
is_u¾_chªged
);

404 
	`av_log
(
h
, 
AV_LOG_INFO
, "%s: did„e£ek(%dè©…os=%"
PRId64
", wh’û=%d: %"PRId64"\n", 
__func__
, 
c
->
­p_io_ù¾
.
»Œy_couÁ”
, 
pos
, 
wh’û
, 
£ek_»t
);

407 ià(
c
->
‹¡_ç_pošt
)

408 
c
->
‹¡_ç_pošt_Ãxt
 = c->
logiÿl_pos
 + c->
‹¡_ç_pošt
;

409 
c
->
io_”rÜ
 = 0;

410  
c
->
logiÿl_pos
;

411 
ç
:

412  
»t
;

413 
	}
}

415 
	#OFFSET
(
x
è
	`off£tof
(
CÚ‹xt
, x)

	)

416 
	#D
 
AV_OPT_FLAG_DECODING_PARAM


	)

418 cÚ¡ 
AVO±iÚ
 
	gijktıhook_İtiÚs
[] = {

420 
OFFSET
(
‹¡_ç_pošt
), 
AV_OPT_TYPE_INT
, {.
i64
 = 0}, 0, 
	gINT_MAX
, 
	gD
 },

421 { "ijk­¶iÿtiÚ", "AVAµliÿtiÚCÚ‹xt", 
OFFSET
(
­p_ùx_šŒ
), 
	gAV_OPT_TYPE_INT64
, { .
	gi64
 = 0 }, 
	gINT64_MIN
, 
	gINT64_MAX
, .
	gæags
 = 
D
 },

423 { 
	gNULL
 }

426 cÚ¡ 
AVO±iÚ
 
	gijkh‰phook_İtiÚs
[] = {

428 
OFFSET
(
£gm’t_šdex
), 
AV_OPT_TYPE_INT
, {.
i64
 = 0}, 0, 
	gINT_MAX
, 
	gD
 },

430 
OFFSET
(
‹¡_ç_pošt
), 
	gAV_OPT_TYPE_INT
, {.
	gi64
 = 0}, 0, 
	gINT_MAX
, 
	gD
 },

431 { "ijk­¶iÿtiÚ", "AVAµliÿtiÚCÚ‹xt", 
OFFSET
(
­p_ùx_šŒ
), 
	gAV_OPT_TYPE_INT64
, { .
	gi64
 = 0 }, 
	gINT64_MIN
, 
	gINT64_MAX
, .
	gæags
 = 
D
 },

433 { 
	gNULL
 }

436 #undeà
D


437 #undeà
OFFSET


439 cÚ¡ 
AVCÏss
 
	gijktıhook_cÚ‹xt_şass
 = {

440 .
şass_Çme
 = "TcpHook",

441 .
	g™em_Çme
 = 
av_deçuÉ_™em_Çme
,

442 .
	gİtiÚ
 = 
ijktıhook_İtiÚs
,

443 .
	gv”siÚ
 = 
LIBAVUTIL_VERSION_INT
,

446 
URLPrÙocŞ
 
	gijkimp_ff_ijktıhook_´ÙocŞ
 = {

447 .
Çme
 = "ijktcphook",

448 .
	gu¾_İ’2
 = 
ijktıhook_İ’
,

449 .
	gu¾_»ad
 = 
ijku¾hook_»ad
,

450 .
	gu¾_wr™e
 = 
ijku¾hook_wr™e
,

451 .
	gu¾_şo£
 = 
ijku¾hook_şo£
,

452 .
	g´iv_d©a_size
 = (
CÚ‹xt
),

453 .
	g´iv_d©a_şass
 = &
ijktıhook_cÚ‹xt_şass
,

456 cÚ¡ 
AVCÏss
 
	gijkh‰phook_cÚ‹xt_şass
 = {

457 .
şass_Çme
 = "HttpHook",

458 .
	g™em_Çme
 = 
av_deçuÉ_™em_Çme
,

459 .
	gİtiÚ
 = 
ijkh‰phook_İtiÚs
,

460 .
	gv”siÚ
 = 
LIBAVUTIL_VERSION_INT
,

463 
URLPrÙocŞ
 
	gijkimp_ff_ijkh‰phook_´ÙocŞ
 = {

464 .
Çme
 = "ijkhttphook",

465 .
	gu¾_İ’2
 = 
ijkh‰phook_İ’
,

466 .
	gu¾_»ad
 = 
ijkh‰phook_»ad
,

467 .
	gu¾_wr™e
 = 
ijku¾hook_wr™e
,

468 .
	gu¾_£ek
 = 
ijkh‰phook_£ek
,

469 .
	gu¾_şo£
 = 
ijku¾hook_şo£
,

470 .
	g´iv_d©a_size
 = (
CÚ‹xt
),

471 .
	g´iv_d©a_şass
 = &
ijkh‰phook_cÚ‹xt_şass
,

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijkdict.c

22 
	~"ijkdiù.h
"

23 
	~"ijkuts.h
"

24 
	~<¡ršg.h
>

25 
	~<¡dio.h
>

26 
	~<¡dlib.h
>

27 
	~<ùy³.h
>

28 
	~<š‰y³s.h
>

30 
	sIjkAVDiùiÚ¬y
 {

31 
	mcouÁ
;

32 
IjkAVDiùiÚ¬yEÁry
 *
	m–ems
;

35 
	$ijk_av_diù_couÁ
(cÚ¡ 
IjkAVDiùiÚ¬y
 *
m
)

37  
m
 ? m->
couÁ
 : 0;

38 
	}
}

40 
IjkAVDiùiÚ¬yEÁry
 *
	$ijk_av_diù_g‘
(cÚ¡ 
IjkAVDiùiÚ¬y
 *
m
, cÚ¡ *
key
,

41 cÚ¡ 
IjkAVDiùiÚ¬yEÁry
 *
´ev
, 
æags
)

43 
i
, 
j
;

45 ià(!
m
)

46  
NULL
;

48 ià(
´ev
)

49 
i
 = 
´ev
 - 
m
->
–ems
 + 1;

51 
i
 = 0;

53 ; 
i
 < 
m
->
couÁ
; i++) {

54 cÚ¡ *
s
 = 
m
->
–ems
[
i
].
key
;

55 ià(
æags
 & 
IJK_AV_DICT_MATCH_CASE
)

56 
j
 = 0; 
s
[j] =ğ
key
[j] && key[j]; j++)

59 
j
 = 0; 
	`touµ”
(
s
[j]è=ğtouµ”(
key
[j]) && key[j]; j++)

61 ià(
key
[
j
])

63 ià(
s
[
j
] && !(
æags
 & 
IJK_AV_DICT_IGNORE_SUFFIX
))

65  &
m
->
–ems
[
i
];

67  
NULL
;

68 
	}
}

70 
	$ijk_av_diù_£t
(
IjkAVDiùiÚ¬y
 **
pm
, cÚ¡ *
key
, cÚ¡ *
v®ue
,

71 
æags
)

73 
IjkAVDiùiÚ¬y
 *
m
 = *
pm
;

74 
IjkAVDiùiÚ¬yEÁry
 *
g
 = 
NULL
;

75 *
Şdv®
 = 
NULL
, *
cİy_key
 = NULL, *
cİy_v®ue
 = NULL;

77 ià(!(
æags
 & 
IJK_AV_DICT_MULTIKEY
)) {

78 
g
 = 
	`ijk_av_diù_g‘
(
m
, 
key
, 
NULL
, 
æags
);

80 ià(
æags
 & 
IJK_AV_DICT_DONT_STRDUP_KEY
)

81 
cİy_key
 = (*)
key
;

83 
cİy_key
 = 
	`¡rdup
(
key
);

84 ià(
æags
 & 
IJK_AV_DICT_DONT_STRDUP_VAL
)

85 
cİy_v®ue
 = (*)
v®ue
;

86 ià(
cİy_key
)

87 
cİy_v®ue
 = 
	`¡rdup
(
v®ue
);

88 ià(!
m
)

89 
m
 = *
pm
 = (
IjkAVDiùiÚ¬y
 *)
	`ÿÎoc
(1, (*m));

90 ià(!
m
 || (
key
 && !
cİy_key
è|| (
v®ue
 && !
cİy_v®ue
))

91 
”r_out
;

93 ià(
g
) {

94 ià(
æags
 & 
IJK_AV_DICT_DONT_OVERWRITE
) {

95 
	`ä“
(
cİy_key
);

96 
	`ä“
(
cİy_v®ue
);

99 ià(
æags
 & 
IJK_AV_DICT_APPEND
)

100 
Şdv®
 = 
g
->
v®ue
;

102 
	`ä“
(
g
->
v®ue
);

103 
	`ä“
(
g
->
key
);

104 *
g
 = 
m
->
–ems
[--m->
couÁ
];

105 } ià(
cİy_v®ue
) {

106 
IjkAVDiùiÚ¬yEÁry
 *
tmp
 = (IjkAVDiùiÚ¬yEÁry *)
	`»®loc
(
m
->
–ems
,

107 (
m
->
couÁ
 + 1è* (*m->
–ems
));

108 ià(!
tmp
)

109 
”r_out
;

110 
m
->
–ems
 = 
tmp
;

112 ià(
cİy_v®ue
) {

113 
m
->
–ems
[m->
couÁ
].
key
 = 
cİy_key
;

114 
m
->
–ems
[m->
couÁ
].
v®ue
 = 
cİy_v®ue
;

115 ià(
Şdv®
 && 
æags
 & 
IJK_AV_DICT_APPEND
) {

116 
size_t
 
Ën
 = 
	`¡¾’
(
Şdv®
è+ sŒËn(
cİy_v®ue
) + 1;

117 *
Ãwv®
 = (*)
	`ÿÎoc
(1, 
Ën
);

118 ià(!
Ãwv®
)

119 
”r_out
;

120 
	`¡¾ÿt
(
Ãwv®
, 
Şdv®
, 
Ën
);

121 
	`ijk_av_ä“p
(&
Şdv®
);

122 
	`¡¾ÿt
(
Ãwv®
, 
cİy_v®ue
, 
Ën
);

123 
m
->
–ems
[m->
couÁ
].
v®ue
 = 
Ãwv®
;

124 
	`ijk_av_ä“p
(&
cİy_v®ue
);

126 
m
->
couÁ
++;

128 
	`ijk_av_ä“p
(&
cİy_key
);

130 ià(!
m
->
couÁ
) {

131 
	`ijk_av_ä“p
(&
m
->
–ems
);

132 
	`ijk_av_ä“p
(
pm
);

137 
”r_out
:

138 ià(
m
 && !m->
couÁ
) {

139 
	`ijk_av_ä“p
(&
m
->
–ems
);

140 
	`ijk_av_ä“p
(
pm
);

142 
	`ä“
(
cİy_key
);

143 
	`ä“
(
cİy_v®ue
);

145 
	}
}

147 
	$ijk_av_diù_£t_št
(
IjkAVDiùiÚ¬y
 **
pm
, cÚ¡ *
key
, 
št64_t
 
v®ue
,

148 
æags
)

150 
v®ue¡r
[22];

151 
	`¢´štf
(
v®ue¡r
, (v®ue¡r), "%"
PRId64
, 
v®ue
);

152 
æags
 &ğ~
IJK_AV_DICT_DONT_STRDUP_VAL
;

153  
	`ijk_av_diù_£t
(
pm
, 
key
, 
v®ue¡r
, 
æags
);

154 
	}
}

156 
	$ijk_av_diù_ä“
(
IjkAVDiùiÚ¬y
 **
pm
)

158 
IjkAVDiùiÚ¬y
 *
m
 = *
pm
;

160 ià(
m
) {

161 
m
->
couÁ
--) {

162 
	`ijk_av_ä“p
(&
m
->
–ems
[m->
couÁ
].
key
);

163 
	`ijk_av_ä“p
(&
m
->
–ems
[m->
couÁ
].
v®ue
);

165 
	`ijk_av_ä“p
(&
m
->
–ems
);

167 
	`ijk_av_ä“p
(
pm
);

168 
	}
}

170 
	$ijk_av_diù_cİy
(
IjkAVDiùiÚ¬y
 **
d¡
, cÚ¡ IjkAVDiùiÚ¬y *
¤c
, 
æags
)

172 
IjkAVDiùiÚ¬yEÁry
 *
t
 = 
NULL
;

174 (
t
 = 
	`ijk_av_diù_g‘
(
¤c
, "",, 
IJK_AV_DICT_IGNORE_SUFFIX
))) {

175 
»t
 = 
	`ijk_av_diù_£t
(
d¡
, 
t
->
key
,->
v®ue
, 
æags
);

176 ià(
»t
 < 0)

177  
»t
;

181 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijkdict.h

30 #iâdeà
IJKAVUTIL_IJKDICT_H


31 
	#IJKAVUTIL_IJKDICT_H


	)

33 
	~<¡dšt.h
>

35 
	#IJK_AV_DICT_MATCH_CASE
 1

	)

36 
	#IJK_AV_DICT_IGNORE_SUFFIX
 2

	)

38 
	#IJK_AV_DICT_DONT_STRDUP_KEY
 4

	)

40 
	#IJK_AV_DICT_DONT_STRDUP_VAL
 8

	)

42 
	#IJK_AV_DICT_DONT_OVERWRITE
 16

43 
	#IJK_AV_DICT_APPEND
 32

	)

45 
	#IJK_AV_DICT_MULTIKEY
 64

	)

47 
	sIjkAVDiùiÚ¬yEÁry
 {

48 *
	mkey
;

49 *
	mv®ue
;

50 } 
	tIjkAVDiùiÚ¬yEÁry
;

52 
IjkAVDiùiÚ¬y
 
	tIjkAVDiùiÚ¬y
;

69 
IjkAVDiùiÚ¬yEÁry
 *
ijk_av_diù_g‘
(cÚ¡ 
IjkAVDiùiÚ¬y
 *
m
, cÚ¡ *
key
,

70 cÚ¡ 
IjkAVDiùiÚ¬yEÁry
 *
´ev
, 
æags
);

78 
ijk_av_diù_couÁ
(cÚ¡ 
IjkAVDiùiÚ¬y
 *
m
);

96 
ijk_av_diù_£t
(
IjkAVDiùiÚ¬y
 **
pm
, cÚ¡ *
key
, cÚ¡ *
v®ue
, 
æags
);

104 
ijk_av_diù_£t_št
(
IjkAVDiùiÚ¬y
 **
pm
, cÚ¡ *
key
, 
št64_t
 
v®ue
, 
æags
);

116 
ijk_av_diù_cİy
(
IjkAVDiùiÚ¬y
 **
d¡
, cÚ¡ IjkAVDiùiÚ¬y *
¤c
, 
æags
);

122 
ijk_av_diù_ä“
(
IjkAVDiùiÚ¬y
 **
m
);

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijkfifo.c

23 
	~"ijkfifo.h
"

24 
	~"ijkuts.h
"

25 
	~<¡dlib.h
>

26 
	~<as£¹.h
>

27 
	~<¡ršg.h
>

29 
IjkFifoBufãr
 *
	$fifo_®loc_commÚ
(*
bufãr
, 
size_t
 
size
)

31 
IjkFifoBufãr
 *
f
;

32 ià(!
bufãr
)

33  
NULL
;

34 
f
 = 
	`ÿÎoc
(1, (
IjkFifoBufãr
));

35 ià(!
f
) {

36 
	`ä“
(
bufãr
);

37  
NULL
;

39 
f
->
bufãr
 = buffer;

40 
f
->
’d
 = f->
bufãr
 + 
size
;

41 
	`ijk_av_fifo_»£t
(
f
);

42  
f
;

43 
	}
}

45 
IjkFifoBufãr
 *
	$ijk_av_fifo_®loc
(
size
)

47 *
bufãr
 = 
	`m®loc
(
size
);

48  
	`fifo_®loc_commÚ
(
bufãr
, 
size
);

49 
	}
}

51 
IjkFifoBufãr
 *
	$ijk_av_fifo_®loc_¬¿y
(
size_t
 
nmemb
, size_ˆ
size
)

53 *
bufãr
 = 
	`ÿÎoc
(
nmemb
, 
size
);

54  
	`fifo_®loc_commÚ
(
bufãr
, 
nmemb
 * 
size
);

55 
	}
}

57 
	$ijk_av_fifo_ä“
(
IjkFifoBufãr
 *
f
)

59 ià(
f
) {

60 
	`ijk_av_ä“p
(&
f
->
bufãr
);

61 
	`ä“
(
f
);

63 
	}
}

65 
	$ijk_av_fifo_ä“p
(
IjkFifoBufãr
 **
f
)

67 ià(
f
) {

68 
	`ijk_av_fifo_ä“
(*
f
);

69 *
f
 = 
NULL
;

71 
	}
}

73 
	$ijk_av_fifo_»£t
(
IjkFifoBufãr
 *
f
)

75 
f
->
w±r
 = f->
½Œ
 = f->
bufãr
;

76 
f
->
wndx
 = f->
ºdx
 = 0;

77 
	}
}

79 
	$ijk_av_fifo_size
(cÚ¡ 
IjkFifoBufãr
 *
f
)

81  (
ušt32_t
)(
f
->
wndx
 - f->
ºdx
);

82 
	}
}

84 
	$ijk_av_fifo_¥aû
(cÚ¡ 
IjkFifoBufãr
 *
f
)

86  
f
->
’d
 - f->
bufãr
 - 
	`ijk_av_fifo_size
(f);

87 
	}
}

89 
	$ijk_av_fifo_»®loc2
(
IjkFifoBufãr
 *
f
, 
Ãw_size
)

91 
Şd_size
 = 
f
->
’d
 - f->
bufãr
;

93 ià(
Şd_size
 < 
Ãw_size
) {

94 
Ën
 = 
	`ijk_av_fifo_size
(
f
);

95 
IjkFifoBufãr
 *
f2
 = 
	`ijk_av_fifo_®loc
(
Ãw_size
);

97 ià(!
f2
)

99 
	`ijk_av_fifo_g’”ic_»ad
(
f
, 
f2
->
bufãr
, 
Ën
, 
NULL
);

100 
f2
->
w±r
 +ğ
Ën
;

101 
f2
->
wndx
 +ğ
Ën
;

102 
	`ä“
(
f
->
bufãr
);

103 *
f
 = *
f2
;

104 
	`ä“
(
f2
);

107 
	}
}

109 
	$ijk_av_fifo_grow
(
IjkFifoBufãr
 *
f
, 
size
)

111 
Şd_size
 = 
f
->
’d
 - f->
bufãr
;

112 if(
size
 + ()
	`ijk_av_fifo_size
(
f
) < size)

115 
size
 +ğ
	`ijk_av_fifo_size
(
f
);

117 ià(
Şd_size
 < 
size
)

118  
	`ijk_av_fifo_»®loc2
(
f
, 
	`FFMAX
(
size
, 2*
Şd_size
));

120 
	}
}

124 
ijk_av_fifo_g’”ic_wr™e
(
IjkFifoBufãr
 *
f
, *
¤c
, 
size
,

125 (*
func
)(*, *, ))

127 
tÙ®
 = 
size
;

128 
ušt32_t
 
wndx
ğ
f
->wndx;

129 
ušt8_t
 *
w±r
ğ
f
->wptr;

132 
Ën
 = 
	`FFMIN
(
f
->
’d
 - 
w±r
, 
size
);

133 ià(
func
) {

134 
Ën
 = 
	`func
(
¤c
, 
w±r
,†en);

135 ià(
Ën
 <= 0)

138 
	`memıy
(
w±r
, 
¤c
, 
Ën
);

139 
¤c
 = (
ušt8_t
 *)¤ø+ 
Ën
;

142 
w±r
 +ğ
Ën
;

143 ià(
w±r
 >ğ
f
->
’d
)

144 
w±r
 = 
f
->
bufãr
;

145 
wndx
 +ğ
Ën
;

146 
size
 -ğ
Ën
;

147 } 
size
 > 0);

148 
f
->
wndx
= wndx;

149 
f
->
w±r
= wptr;

150  
tÙ®
 - 
size
;

151 
	}
}

153 
ijk_av_fifo_g’”ic_³ek_©
(
IjkFifoBufãr
 *
f
, *
de¡
, 
off£t
, 
buf_size
, (*
func
)(*, *, ))

155 
ušt8_t
 *
½Œ
 = 
f
->rptr;

157 
	`as£¹
(
off£t
 >= 0);

163 
	`as£¹
(
buf_size
 + ()
off£t
 <ğ
f
->
wndx
 - f->
ºdx
);

165 ià(
off£t
 >ğ
f
->
’d
 - 
½Œ
)

166 
½Œ
 +ğ
off£t
 - (
f
->
’d
 - f->
bufãr
);

168 
½Œ
 +ğ
off£t
;

170 
buf_size
 > 0) {

171 
Ën
;

173 ià(
½Œ
 >ğ
f
->
’d
)

174 
½Œ
 -ğ
f
->
’d
 - f->
bufãr
;

176 
Ën
 = 
	`FFMIN
(
f
->
’d
 - 
½Œ
, 
buf_size
);

177 ià(
func
)

178 
	`func
(
de¡
, 
½Œ
, 
Ën
);

180 
	`memıy
(
de¡
, 
½Œ
, 
Ën
);

181 
de¡
 = (
ušt8_t
 *)de¡ + 
Ën
;

184 
buf_size
 -ğ
Ën
;

185 
½Œ
 +ğ
Ën
;

189 
	}
}

191 
ijk_av_fifo_g’”ic_³ek
(
IjkFifoBufãr
 *
f
, *
de¡
, 
buf_size
,

192 (*
func
)(*, *, ))

195 
ušt8_t
 *
½Œ
 = 
f
->rptr;

198 
Ën
 = 
	`FFMIN
(
f
->
’d
 - 
½Œ
, 
buf_size
);

199 ià(
func
)

200 
	`func
(
de¡
, 
½Œ
, 
Ën
);

202 
	`memıy
(
de¡
, 
½Œ
, 
Ën
);

203 
de¡
 = (
ušt8_t
 *)de¡ + 
Ën
;

206 
½Œ
 +ğ
Ën
;

207 ià(
½Œ
 >ğ
f
->
’d
)

208 
½Œ
 -ğ
f
->
’d
 - f->
bufãr
;

209 
buf_size
 -ğ
Ën
;

210 } 
buf_size
 > 0);

213 
	}
}

215 
ijk_av_fifo_g’”ic_»ad
(
IjkFifoBufãr
 *
f
, *
de¡
, 
buf_size
,

216 (*
func
)(*, *, ))

220 
Ën
 = 
	`FFMIN
(
f
->
’d
 - f->
½Œ
, 
buf_size
);

221 ià(
func
)

222 
	`func
(
de¡
, 
f
->
½Œ
, 
Ën
);

224 
	`memıy
(
de¡
, 
f
->
½Œ
, 
Ën
);

225 
de¡
 = (
ušt8_t
 *)de¡ + 
Ën
;

228 
	`ijk_av_fifo_d¿š
(
f
, 
Ën
);

229 
buf_size
 -ğ
Ën
;

230 } 
buf_size
 > 0);

232 
	}
}

235 
	$ijk_av_fifo_d¿š
(
IjkFifoBufãr
 *
f
, 
size
)

237 
	`as£¹
(
	`ijk_av_fifo_size
(
f
è>ğ
size
);

238 
f
->
½Œ
 +ğ
size
;

239 ià(
f
->
½Œ
 >ğf->
’d
)

240 
f
->
½Œ
 -ğf->
’d
 - f->
bufãr
;

241 
f
->
ºdx
 +ğ
size
;

242 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijkfifo.h

24 #iâdeà
IJKUTIL_IJKFIFO_H


25 
	#IJKUTIL_IJKFIFO_H


	)

27 
	~<¡dšt.h
>

28 
	~<¡ddef.h
>

30 
	sIjkFifoBufãr
 {

31 
ušt8_t
 *
	mbufãr
;

32 
ušt8_t
 *
	m½Œ
, *
	mw±r
, *
	m’d
;

33 
ušt64_t
 
	mºdx
, 
	mwndx
;

34 } 
	tIjkFifoBufãr
;

41 
IjkFifoBufãr
 *
ijk_av_fifo_®loc
(
size
);

49 
IjkFifoBufãr
 *
ijk_av_fifo_®loc_¬¿y
(
size_t
 
nmemb
, size_ˆ
size
);

55 
ijk_av_fifo_ä“
(
IjkFifoBufãr
 *
f
);

61 
ijk_av_fifo_ä“p
(
IjkFifoBufãr
 **
f
);

67 
ijk_av_fifo_»£t
(
IjkFifoBufãr
 *
f
);

75 
ijk_av_fifo_size
(cÚ¡ 
IjkFifoBufãr
 *
f
);

83 
ijk_av_fifo_¥aû
(cÚ¡ 
IjkFifoBufãr
 *
f
);

94 
ijk_av_fifo_g’”ic_³ek_©
(
IjkFifoBufãr
 *
f
, *
de¡
, 
off£t
, 
buf_size
, (*
func
)(*, *, ));

104 
	`ijk_av_fifo_g’”ic_³ek
(
IjkFifoBufãr
 *
f
, *
de¡
, 
buf_size
, (*
func
)(*, *, ));

113 
	`ijk_av_fifo_g’”ic_»ad
(
IjkFifoBufãr
 *
f
, *
de¡
, 
buf_size
, (*
func
)(*, *, ));

128 
	`ijk_av_fifo_g’”ic_wr™e
(
IjkFifoBufãr
 *
f
, *
¤c
, 
size
, (*
func
)(*, *, ));

138 
	`ijk_av_fifo_»®loc2
(
IjkFifoBufãr
 *
f
, 
size
);

149 
	`ijk_av_fifo_grow
(
IjkFifoBufãr
 *
f
, 
add™iÚ®_¥aû
);

156 
	`ijk_av_fifo_d¿š
(
IjkFifoBufãr
 *
f
, 
size
);

168 
šlše
 
ušt8_t
 *
	$ijk_av_fifo_³ek2
(cÚ¡ 
IjkFifoBufãr
 *
f
, 
offs
)

170 
ušt8_t
 *
±r
 = 
f
->
½Œ
 + 
offs
;

171 ià(
±r
 >ğ
f
->
’d
)

172 
±r
 = 
f
->
bufãr
 + (±¸- f->
’d
);

173 ià(
±r
 < 
f
->
bufãr
)

174 
±r
 = 
f
->
’d
 - (f->
bufãr
 -…tr);

175  
±r
;

176 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijkstl.h

21 #iâdeà
IJKAVUTIL_IJKSTL_H


22 
	#IJKAVUTIL_IJKSTL_H


	)

24 
	~<¡dšt.h
>

26 * 
ijk_m­_ü—‹
();

27 
ijk_m­_put
(*
d©a
, 
št64_t
 
key
, *
v®ue
);

28 * 
ijk_m­_g‘
(*
d©a
, 
št64_t
 
key
);

29 
ijk_m­_»move
(*
d©a
, 
št64_t
 
key
);

30 
ijk_m­_size
(*
d©a
);

31 
ijk_m­_max_size
(*
d©a
);

32 * 
ijk_m­_šdex_g‘
(*
d©a
, 
šdex
);

33 
ijk_m­_Œav”§l_hªdË
(*
d©a
, (*
’u
)(*
–em
));

34 
št64_t
 
	`ijk_m­_g‘_mš_key
(*
d©a
);

35 
	`ijk_m­_ş—r
(*
d©a
);

36 
	`ijk_m­_de¡roy
(*
d©a
);

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijkthreadpool.c

22 
	~"ijkth»adpoŞ.h
"

23 
	~"libavut/log.h
"

25 
	~<¡dlib.h
>

26 
	~<uni¡d.h
>

33 *
	$ijk_th»adpoŞ_th»ad
(*
poŞ_ùx
)

35 
IjkTh»adPoŞCÚ‹xt
 *
ùx
 = (IjkTh»adPoŞCÚ‹xˆ*)
poŞ_ùx
;

36 
IjkTh»adPoŞTask
 
sk
;

39 
	`±h»ad_mu‹x_lock
(&(
ùx
->
lock
));

41 (
ùx
->
³ndšg_couÁ
 =ğ0è&& (!ùx->
shutdown
)) {

42 
	`±h»ad_cÚd_wa™
(&(
ùx
->
nÙify
), &(ùx->
lock
));

45 if((
ùx
->
shutdown
 =ğ
IJK_IMMEDIATE_SHUTDOWN
) ||

46 ((
ùx
->
shutdown
 =ğ
IJK_LEISURELY_SHUTDOWN
) &&

47 (
ùx
->
³ndšg_couÁ
 == 0))) {

52 
sk
.
funùiÚ
 = 
ùx
->
queue
[ùx->
queue_h—d
].function;

53 
sk
.
š_¬g
 = 
ùx
->
queue
[ùx->
queue_h—d
].in_arg;

54 
sk
.
out_¬g
 = 
ùx
->
queue
[ùx->
queue_h—d
].out_arg;

55 
ùx
->
queue_h—d
 = (ùx->queue_h—d + 1è% ctx->
queue_size
;

56 
ùx
->
³ndšg_couÁ
 -= 1;

58 
	`±h»ad_mu‹x_uÆock
(&(
ùx
->
lock
));

60 (*(
sk
.
funùiÚ
))Ñask.
š_¬g
,ask.
out_¬g
);

63 
ùx
->
¡¬‹d_couÁ
--;

65 
	`±h»ad_mu‹x_uÆock
(&(
ùx
->
lock
));

66 
	`±h»ad_ex™
(
NULL
);

67 (
NULL
);

68 
	}
}

70 
	$ijk_th»adpoŞ_ä“
(
IjkTh»adPoŞCÚ‹xt
 *
ùx
)

72 if(
ùx
 =ğ
NULL
 || ctx->
¡¬‹d_couÁ
 > 0) {

77 if(
ùx
->
th»ads
) {

78 
	`ä“
(
ùx
->
th»ads
);

79 
	`ä“
(
ùx
->
queue
);

84 
	`±h»ad_mu‹x_lock
(&(
ùx
->
lock
));

85 
	`±h»ad_mu‹x_de¡roy
(&(
ùx
->
lock
));

86 
	`±h»ad_cÚd_de¡roy
(&(
ùx
->
nÙify
));

88 
	`ä“
(
ùx
);

90 
	}
}

92 
IjkTh»adPoŞCÚ‹xt
 *
	$ijk_th»adpoŞ_ü—‹
(
th»ad_couÁ
, 
queue_size
, 
æags
)

94 
IjkTh»adPoŞCÚ‹xt
 *
ùx
;

95 
i
;

97 if(
th»ad_couÁ
 <ğ0 ||h»ad_couÁ > 
MAX_THREADS
 || 
queue_size
 <ğ0 || queue_siz> 
MAX_QUEUE
) {

98  
NULL
;

101 if((
ùx
 = (
IjkTh»adPoŞCÚ‹xt
 *)
	`ÿÎoc
(1, (IjkTh»adPoŞCÚ‹xt))è=ğ
NULL
) {

102 
”r
;

105 
ùx
->
queue_size
 = queue_size;

108 
ùx
->
th»ads
 = (
±h»ad_t
 *)
	`ÿÎoc
(1, Õth»ad_tè* 
th»ad_couÁ
);

109 
ùx
->
queue
 = (
IjkTh»adPoŞTask
 *)
ÿÎoc


110 (
queue_size
, (
IjkTh»adPoŞTask
));

113 if((
	`±h»ad_mu‹x_š™
(&(
ùx
->
lock
), 
NULL
) != 0) ||

114 (
	`±h»ad_cÚd_š™
(&(
ùx
->
nÙify
), 
NULL
) != 0) ||

115 (
ùx
->
th»ads
 =ğ
NULL
) ||

116 (
ùx
->
queue
 =ğ
NULL
)) {

117 
”r
;

121 
i
 = 0; i < 
th»ad_couÁ
; i++) {

122 if(
	`±h»ad_ü—‹
(&(
ùx
->
th»ads
[
i
]), 
NULL
,

123 
ijk_th»adpoŞ_th»ad
, (*)
ùx
) != 0) {

124 
	`ijk_th»adpoŞ_de¡roy
(
ùx
, 0);

125  
NULL
;

127 
ùx
->
th»ad_couÁ
++;

128 
ùx
->
¡¬‹d_couÁ
++;

131  
ùx
;

133 
”r
:

134 if(
ùx
) {

135 
	`ijk_th»adpoŞ_ä“
(
ùx
);

137  
NULL
;

138 
	}
}

140 
	$ijk_th»adpoŞ_add
(
IjkTh»adPoŞCÚ‹xt
 *
ùx
, 
RuÇbË
 
funùiÚ
,

141 *
š_¬g
, *
out_¬g
, 
æags
)

143 
”r
 = 0;

144 
Ãxt
;

146 if(
ùx
 =ğ
NULL
 || 
funùiÚ
 == NULL) {

147  
IJK_THREADPOOL_INVALID
;

150 if(
	`±h»ad_mu‹x_lock
(&(
ùx
->
lock
)) != 0) {

151  
IJK_THREADPOOL_LOCK_FAILURE
;

154 ià(
ùx
->
³ndšg_couÁ
 =ğ
MAX_QUEUE
 || ctx->³ndšg_couÁ =ğùx->
queue_size
) {

155 
	`±h»ad_mu‹x_uÆock
(&
ùx
->
lock
);

156  
IJK_THREADPOOL_QUEUE_FULL
;

159 if(
ùx
->
³ndšg_couÁ
 =ğùx->
queue_size
 - 1) {

160 
Ãw_pueue_size
 = (
ùx
->
queue_size
 * 2è> 
MAX_QUEUE
 ? MAX_QUEUE : (ctx->queue_size * 2);

161 
IjkTh»adPoŞTask
 *
Ãw_queue
 = (IjkTh»adPoŞTask *)
	`»®loc
(
ùx
->
queue
, (IjkTh»adPoŞTaskè* 
Ãw_pueue_size
);

162 ià(
Ãw_queue
) {

163 
ùx
->
queue
 = 
Ãw_queue
;

164 
ùx
->
queue_size
 = 
Ãw_pueue_size
;

168 
Ãxt
 = (
ùx
->
queue_
 + 1è% ctx->
queue_size
;

171 if(
ùx
->
shutdown
) {

172 
”r
 = 
IJK_THREADPOOL_SHUTDOWN
;

177 
ùx
->
queue
[ùx->
queue_
].
funùiÚ
 = function;

178 
ùx
->
queue
[ùx->
queue_
].
š_¬g
 = in_arg;

179 
ùx
->
queue
[ùx->
queue_
].
out_¬g
 = out_arg;

180 
ùx
->
queue_
 = 
Ãxt
;

181 
ùx
->
³ndšg_couÁ
 += 1;

184 if(
	`±h»ad_cÚd_sigÇl
(&(
ùx
->
nÙify
)) != 0) {

185 
”r
 = 
IJK_THREADPOOL_LOCK_FAILURE
;

190 if(
	`±h»ad_mu‹x_uÆock
(&
ùx
->
lock
) != 0) {

191 
”r
 = 
IJK_THREADPOOL_LOCK_FAILURE
;

194  
”r
;

195 
	}
}

197 
	$ijk_th»adpoŞ_ä“p
(
IjkTh»adPoŞCÚ‹xt
 **
ùx
)

199 
»t
 = 0;

201 ià(!
ùx
 || !*ctx)

204 
»t
 = 
	`ijk_th»adpoŞ_ä“
(*
ùx
);

205 *
ùx
 = 
NULL
;

206  
»t
;

207 
	}
}

209 
	$ijk_th»adpoŞ_de¡roy
(
IjkTh»adPoŞCÚ‹xt
 *
ùx
, 
æags
)

211 
i
, 
”r
 = 0;

213 if(
ùx
 =ğ
NULL
) {

214  
IJK_THREADPOOL_INVALID
;

217 if(
	`±h»ad_mu‹x_lock
(&(
ùx
->
lock
)) != 0) {

218  
IJK_THREADPOOL_LOCK_FAILURE
;

223 if(
ùx
->
shutdown
) {

224 
”r
 = 
IJK_THREADPOOL_SHUTDOWN
;

228 
ùx
->
shutdown
 = 
æags
;

231 if((
	`±h»ad_cÚd_brßdÿ¡
(&(
ùx
->
nÙify
)) != 0) ||

232 (
	`±h»ad_mu‹x_uÆock
(&(
ùx
->
lock
)) != 0)) {

233 
”r
 = 
IJK_THREADPOOL_LOCK_FAILURE
;

238 
i
 = 0; i < 
ùx
->
th»ad_couÁ
; i++) {

239 if(
	`±h»ad_još
(
ùx
->
th»ads
[
i
], 
NULL
) != 0) {

240 
”r
 = 
IJK_THREADPOOL_THREAD_FAILURE
;

246 if(!
”r
) {

247  
	`ijk_th»adpoŞ_ä“p
(&
ùx
);

249  
”r
;

250 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijkthreadpool.h

19 #iâdeà
_IJK_THREADPOOL_H_


20 
	#_IJK_THREADPOOL_H_


	)

22 
	~<±h»ad.h
>

24 
	#MAX_THREADS
 100

	)

25 
	#MAX_QUEUE
 1024

	)

28 
	mIJK_THREADPOOL_INVALID
 = -1,

29 
	mIJK_THREADPOOL_LOCK_FAILURE
 = -2,

30 
	mIJK_THREADPOOL_QUEUE_FULL
 = -3,

31 
	mIJK_THREADPOOL_SHUTDOWN
 = -4,

32 
	mIJK_THREADPOOL_THREAD_FAILURE
 = -5

33 } 
	tIjkTh»adPoŞE¼ÜTy³
;

36 
	mIJK_IMMEDIATE_SHUTDOWN
 = 1,

37 
	mIJK_LEISURELY_SHUTDOWN
 = 2

38 } 
	tIjkTh»adPoŞShutdownTy³
;

40 (*
	tRuÇbË
)(*, *);

50 
	sIjkTh»adPoŞTask
 {

51 
RuÇbË
 
funùiÚ
;

52 *
š_¬g
;

53 *
out_¬g
;

54 } 
	tIjkTh»adPoŞTask
;

71 
	sIjkTh»adPoŞCÚ‹xt
 {

72 
±h»ad_mu‹x_t
 
lock
;

73 
±h»ad_cÚd_t
 
nÙify
;

74 
±h»ad_t
 *
th»ads
;

75 
IjkTh»adPoŞTask
 *
queue
;

76 
th»ad_couÁ
;

77 
queue_size
;

78 
queue_h—d
;

79 
queue_
;

80 
³ndšg_couÁ
;

81 
shutdown
;

82 
¡¬‹d_couÁ
;

83 } 
	tIjkTh»adPoŞCÚ‹xt
;

85 
IjkTh»adPoŞCÚ‹xt
 *
	`ijk_th»adpoŞ_ü—‹
(
th»ad_couÁ
, 
queue_size
, 
æags
);

87 
	`ijk_th»adpoŞ_add
(
IjkTh»adPoŞCÚ‹xt
 *
ùx
, 
RuÇbË
 
funùiÚ
,

88 *
š_¬g
, *
out_¬g
, 
æags
);

90 
	`ijk_th»adpoŞ_de¡roy
(
IjkTh»adPoŞCÚ‹xt
 *
ùx
, 
æags
);

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijktree.c

21 
	~"ijkŒ“.h
"

22 
	~<¡dio.h
>

23 
	~<¡dlib.h
>

24 
	~<¡ddef.h
>

25 
	~<¡ršg.h
>

27 
	sIjkAVT»eNode
 {

28 
IjkAVT»eNode
 *
	mchd
[2];

29 *
	m–em
;

30 
	m¡©e
;

31 } 
	tIjkAVT»eNode
;

33 cÚ¡ 
	gijk_av_Œ“_node_size
 = (
IjkAVT»eNode
);

35 
IjkAVT»eNode
 *
	$ijk_av_Œ“_node_®loc
()

37  
	`ÿÎoc
(1, (
IjkAVT»eNode
));

38 
	}
}

40 *
ijk_av_Œ“_fšd
(cÚ¡ 
IjkAVT»eNode
 *
t
, *
key
,

41 (*
cmp
)(cÚ¡ *
key
, cÚ¡ *
b
), *
Ãxt
[2])

43 ià(
t
) {

44 
v
 = 
	`cmp
(
key
, 
t
->
–em
);

45 ià(
v
) {

46 ià(
Ãxt
)

47 
Ãxt
[
v
 >> 31] = 
t
->
–em
;

48  
	`ijk_av_Œ“_fšd
(
t
->
chd
[(
v
 >> 31è^ 1], 
key
, 
cmp
, 
Ãxt
);

50 ià(
Ãxt
) {

51 
	`ijk_av_Œ“_fšd
(
t
->
chd
[0], 
key
, 
cmp
, 
Ãxt
);

52 
	`ijk_av_Œ“_fšd
(
t
->
chd
[1], 
key
, 
cmp
, 
Ãxt
);

54  
t
->
–em
;

57  
NULL
;

58 
	}
}

60 *
ijk_av_Œ“_š£¹
(
IjkAVT»eNode
 **

, *
key
,

61 (*
cmp
)(cÚ¡ *
key
, cÚ¡ *
b
), 
IjkAVT»eNode
 **
Ãxt
)

63 
IjkAVT»eNode
 *
t
 = *

;

64 ià(
t
) {

65 
v
 = 
	`cmp
(
t
->
–em
, 
key
);

66 *
»t
;

67 ià(!
v
) {

68 ià(*
Ãxt
)

69  
t
->
–em
;

70 ià(
t
->
chd
[0] ||->child[1]) {

71 
i
 = !
t
->
chd
[0];

72 *
Ãxt_–em
[2];

73 
	`ijk_av_Œ“_fšd
(
t
->
chd
[
i
], 
key
, 
cmp
, 
Ãxt_–em
);

74 
key
 = 
t
->
–em
 = 
Ãxt_–em
[
i
];

75 
v
 = -
i
;

77 *
Ãxt
 = 
t
;

78 *

 = 
NULL
;

79  
NULL
;

82 
»t
 = 
	`ijk_av_Œ“_š£¹
(&
t
->
chd
[
v
 >> 31], 
key
, 
cmp
, 
Ãxt
);

83 ià(!
»t
) {

84 
i
 = (
v
 >> 31è^ !!*
Ãxt
;

85 
IjkAVT»eNode
 **
chd
 = &
t
->chd[
i
];

86 
t
->
¡©e
 +ğ2 * 
i
 - 1;

88 ià(!(
t
->
¡©e
 & 1)) {

89 ià(
t
->
¡©e
) {

110 ià((*
chd
)->
¡©e
 * 2 =ğ-
t
->state) {

111 *

 = (*
chd
)->chd[
i
 ^ 1];

112 (*
chd
)->chd[
i
 ^ 1] = (*

)->child[i];

113 (*

)->
chd
[
i
] = *child;

114 *
chd
 = (*

)->chd[
i
 ^ 1];

115 (*

)->
chd
[
i
 ^ 1] = 
t
;

117 (*

)->
chd
[0]->
¡©e
 = -((*tp)->state > 0);

118 (*

)->
chd
[1]->
¡©e
 = (*tp)->state < 0;

119 (*

)->
¡©e
 = 0;

121 *

 = *
chd
;

122 *
chd
 = (*chd)->chd[
i
 ^ 1];

123 (*

)->
chd
[
i
 ^ 1] = 
t
;

124 ià((*

)->
¡©e
)

125 
t
->
¡©e
 = 0;

127 
t
->
¡©e
 >>= 1;

128 (*

)->
¡©e
 = -
t
->state;

132 ià(!(*

)->
¡©e
 ^ !!*
Ãxt
)

133  
key
;

135  
»t
;

137 *

 = *
Ãxt
;

138 *
Ãxt
 = 
NULL
;

139 ià(*

) {

140 (*

)->
–em
 = 
key
;

141  
NULL
;

143  
key
;

145 
	}
}

147 
	$ijk_av_Œ“_de¡roy
(
IjkAVT»eNode
 *
t
)

149 ià(
t
) {

150 
	`ijk_av_Œ“_de¡roy
(
t
->
chd
[0]);

151 
	`ijk_av_Œ“_de¡roy
(
t
->
chd
[1]);

152 
	`ä“
(
t
);

154 
	}
}

156 
ijk_av_Œ“_’um”©e
(
IjkAVT»eNode
 *
t
, *
İaque
,

157 (*
cmp
)(*
İaque
, *
–em
),

158 (*
’u
)(*
İaque
, *
–em
))

160 ià(
t
) {

161 
v
 = 
cmp
 ? 
	`cmp
(
İaque
, 
t
->
–em
) : 0;

162 ià(
v
 >= 0)

163 
	`ijk_av_Œ“_’um”©e
(
t
->
chd
[0], 
İaque
, 
cmp
, 
’u
);

164 ià(
v
 == 0)

165 
	`’u
(
İaque
, 
t
->
–em
);

166 ià(
v
 <= 0)

167 
	`ijk_av_Œ“_’um”©e
(
t
->
chd
[1], 
İaque
, 
cmp
, 
’u
);

169 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijktree.h

22 #iâdeà
IJKAVUTIL_IJKTREE_H


23 
	#IJKAVUTIL_IJKTREE_H


	)

37 
	gIjkAVT»eNode
;

38 cÚ¡ 
ijk_av_Œ“_node_size
;

43 
IjkAVT»eNode
 *
ijk_av_Œ“_node_®loc
();

59 *
ijk_av_Œ“_fšd
(cÚ¡ 
IjkAVT»eNode
 *
roÙ
, *
key
,

60 (*
cmp
)(cÚ¡ *
key
, cÚ¡ *
b
), *
Ãxt
[2]);

106 *
	`ijk_av_Œ“_š£¹
(
IjkAVT»eNode
 **
roÙp
, *
key
,

107 (*
cmp
)(cÚ¡ *
key
, cÚ¡ *
b
),

108 
IjkAVT»eNode
 **
Ãxt
);

110 
	`ijk_av_Œ“_de¡roy
(
IjkAVT»eNode
 *
t
);

122 
	`ijk_av_Œ“_’um”©e
(
IjkAVT»eNode
 *
t
, *
İaque
,

123 (*
cmp
)(*
İaque
, *
–em
),

124 (*
’u
)(*
İaque
, *
–em
));

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijkutils.c

2 
	~"ijkuts.h
"

4 
	~<¡ršg.h
>

5 
	~<¡dio.h
>

6 
	~<¡dlib.h
>

7 
	~<ùy³.h
>

8 
	~<š‰y³s.h
>

10 
	$ijk_av_ä“p
(*
¬g
)

12 *
v®
;

14 
	`memıy
(&
v®
, 
¬g
, (val));

15 
	`memıy
(
¬g
, &(*){ 
NULL
 }, (
v®
));

16 
	`ä“
(
v®
);

17 
	}
}

19 
	$ijk_av_¡r¡¬t
(cÚ¡ *
¡r
, cÚ¡ *
pfx
, cÚ¡ **
±r
)

21 *
pfx
 && *pfx =ğ*
¡r
) {

22 
pfx
++;

23 
¡r
++;

25 ià(!*
pfx
 && 
±r
)

26 *
±r
 = 
¡r
;

27  !*
pfx
;

28 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijkutils.h

22 #iâdeà
IJKAVUTIL_IJKUTILS_H


23 
	#IJKAVUTIL_IJKUTILS_H


	)

25 
	~"ijkŒ“.h
"

27 
	~<”ºo.h
>

28 
	~<¡ddef.h
>

29 
	~<¡dšt.h
>

31 
	sIjkAVIOIÁ”ru±CB
 {

32 (*
	mÿÎback
)(*);

33 *
	mİaque
;

34 } 
	tIjkAVIOIÁ”ru±CB
;

36 
	sIjkCacheT»eInfo
 {

37 
IjkAVT»eNode
 *
	mroÙ
;

38 
št64_t
 
	mphysiÿl_š™_pos
;

39 
št64_t
 
	mphysiÿl_size
;

40 } 
	tIjkCacheT»eInfo
;

42 
	#FFDIFFSIGN
(
x
,
y
è(((x)>(y)è- ((x)<(y)))

	)

44 
	#FFMAX
(
a
,
b
è(×è> (bè? (aè: (b))

	)

45 
	#FFMAX3
(
a
,
b
,
c
è
	`FFMAX
(FFMAX×,b),c)

	)

46 
	#FFMIN
(
a
,
b
è(×è> (bè? (bè: (a))

	)

47 
	#FFMIN3
(
a
,
b
,
c
è
	`FFMIN
(FFMIN×,b),c)

	)

49 
	#MKTAG
(
a
,
b
,
c
,
d
è(×è| ((bè<< 8è| ((cè<< 16è| (()(dè<< 24))

	)

52 #ià
EDOM
 > 0

53 
	#IJKAVERROR
(
e
) (-(e))

54 
	#IJKAVUNERROR
(
e
) (-(e))

55 #–£

	)

57 
	#IJKAVERROR
(
e
èÓ)

	)

58 
	#IJKAVUNERROR
(
e
èÓ)

	)

61 
	#FFERRTAG
(
a
, 
b
, 
c
, 
d
è(-()
	`MKTAG
×, b, c, d))

	)

62 
	#IJKAVERROR_BSF_NOT_FOUND
 
	`FFERRTAG
(0xF8,'B','S','F')

63 
	#IJKAVERROR_BUG
 
	`FFERRTAG
( 'B','U','G','!')

64 
	#IJKAVERROR_BUFFER_TOO_SMALL
 
	`FFERRTAG
( 'B','U','F','S')

65 
	#IJKAVERROR_DECODER_NOT_FOUND
 
	`FFERRTAG
(0xF8,'D','E','C')

66 
	#IJKAVERROR_DEMUXER_NOT_FOUND
 
	`FFERRTAG
(0xF8,'D','E','M')

67 
	#IJKAVERROR_ENCODER_NOT_FOUND
 
	`FFERRTAG
(0xF8,'E','N','C')

68 
	#IJKAVERROR_EOF
 
	`FFERRTAG
( 'E','O','F',' ')

69 
	#IJKAVERROR_EXIT
 
	`FFERRTAG
( 'E','X','I','T')

70 
	#IJKAVERROR_EXTERNAL
 
	`FFERRTAG
( 'E','X','T',' ')

71 
	#IJKAVERROR_FILTER_NOT_FOUND
 
	`FFERRTAG
(0xF8,'F','I','L')

72 
	#IJKAVERROR_INVALIDDATA
 
	`FFERRTAG
( 'I','N','D','A')

73 
	#IJKAVERROR_MUXER_NOT_FOUND
 
	`FFERRTAG
(0xF8,'M','U','X')

74 
	#IJKAVERROR_OPTION_NOT_FOUND
 
	`FFERRTAG
(0xF8,'O','P','T')

75 
	#IJKAVERROR_PATCHWELCOME
 
	`FFERRTAG
( 'P','A','W','E')

76 
	#IJKAVERROR_PROTOCOL_NOT_FOUND
 
	`FFERRTAG
(0xF8,'P','R','O')

77 
	#IJKAVERROR_STREAM_NOT_FOUND
 
	`FFERRTAG
(0xF8,'S','T','R')

78 

	)

84 
	#IJKAVSEEK_SIZE
 0x10000

	)

92 
	#IJKAVSEEK_FORCE
 0x20000

	)

94 
ijk_av_ä“p
(*
¬g
);

96 
ijk_av_¡r¡¬t
(cÚ¡ *
¡r
, cÚ¡ *
pfx
, cÚ¡ **
±r
);

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/opt.h

24 #iâdeà
FFPLAY__IJKOPT_H


25 
	#FFPLAY__IJKOPT_H


	)

27 
	~"libavut/İt.h
"

29 
	#IJKAV_OPTION_INT
(
deçuÉ__
, 
mš__
, 
max__
) \

30 .
ty³
 = 
AV_OPT_TYPE_INT
, \

31 { .
i64
 = 
deçuÉ__
 }, \

32 .
mš
 = 
mš__
, \

33 .
max
 = 
max__
, \

34 .
æags
 = 
AV_OPT_FLAG_DECODING_PARAM


	)

36 
	#IJKAV_OPTION_INT64
(
deçuÉ__
, 
mš__
, 
max__
) \

37 .
ty³
 = 
AV_OPT_TYPE_INT64
, \

38 { .
i64
 = 
deçuÉ__
 }, \

39 .
mš
 = 
mš__
, \

40 .
max
 = 
max__
, \

41 .
æags
 = 
AV_OPT_FLAG_DECODING_PARAM


	)

43 
	#IJKAV_OPTION_CONST
(
deçuÉ__
) \

44 .
ty³
 = 
AV_OPT_TYPE_CONST
, \

45 { .
i64
 = 
deçuÉ__
 }, \

46 .
mš
 = 
INT_MIN
, \

47 .
max
 = 
INT_MAX
, \

48 .
æags
 = 
AV_OPT_FLAG_DECODING_PARAM


	)

50 
	#IJKAV_OPTION_STR
(
deçuÉ__
) \

51 .
ty³
 = 
AV_OPT_TYPE_STRING
, \

52 { .
¡r
 = 
deçuÉ__
 }, \

53 .
mš
 = 0, \

54 .
max
 = 0, \

55 .
æags
 = 
AV_OPT_FLAG_DECODING_PARAM


	)

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkmeta.c

24 
	~"ijkm‘a.h
"

25 
	~"ff_ffšc.h
"

26 
	~"ijksdl/ijksdl_misc.h
"

28 
	#IJK_META_INIT_CAPACITY
 13

	)

30 
	sIjkMedŸM‘a
 {

31 
SDL_mu‹x
 *
	mmu‹x
;

33 
AVDiùiÚ¬y
 *
	mdiù
;

35 
size_t
 
	mchd»n_couÁ
;

36 
size_t
 
	mchd»n_ÿ·c™y
;

37 
IjkMedŸM‘a
 **
	mchd»n
;

40 
IjkMedŸM‘a
 *
	$ijkm‘a_ü—‹
()

42 
IjkMedŸM‘a
 *
m‘a
 = (IjkMedŸM‘¨*)
	`ÿÎoc
(1, (IjkMediaMeta));

43 ià(!
m‘a
)

44  
NULL
;

46 
m‘a
->
mu‹x
 = 
	`SDL_C»©eMu‹x
();

47 ià(!
m‘a
->
mu‹x
)

48 
ç
;

50  
m‘a
;

51 
ç
:

52 
	`ijkm‘a_de¡roy
(
m‘a
);

53  
NULL
;

54 
	}
}

56 
	$ijkm‘a_»£t
(
IjkMedŸM‘a
 *
m‘a
)

58 ià(
m‘a
 && m‘a->
diù
)

59 
	`av_diù_ä“
(&
m‘a
->
diù
);

60 
	}
}

62 
	$ijkm‘a_de¡roy
(
IjkMedŸM‘a
 *
m‘a
)

64 ià(!
m‘a
)

67 ià(
m‘a
->
diù
) {

68 
	`av_diù_ä“
(&
m‘a
->
diù
);

71 ià(
m‘a
->
chd»n
) {

72 
i
 = 0; i < 
m‘a
->
chd»n_couÁ
; ++i) {

73 
IjkMedŸM‘a
 *
chd
 = 
m‘a
->
chd»n
[
i
];

74 ià(
chd
) {

75 
	`ijkm‘a_de¡roy
(
chd
);

78 
	`ä“
(
m‘a
->
chd»n
);

79 
m‘a
->
chd»n
 = 
NULL
;

82 
	`SDL_De¡royMu‹xP
(&
m‘a
->
mu‹x
);

83 
	`ä“
(
m‘a
);

84 
	}
}

86 
	$ijkm‘a_de¡roy_p
(
IjkMedŸM‘a
 **
m‘a
)

88 ià(!
m‘a
)

91 
	`ijkm‘a_de¡roy
(*
m‘a
);

92 *
m‘a
 = 
NULL
;

93 
	}
}

95 
	$ijkm‘a_lock
(
IjkMedŸM‘a
 *
m‘a
)

97 ià(!
m‘a
 || !m‘a->
mu‹x
)

100 
	`SDL_LockMu‹x
(
m‘a
->
mu‹x
);

101 
	}
}

103 
	$ijkm‘a_uÆock
(
IjkMedŸM‘a
 *
m‘a
)

105 ià(!
m‘a
 || !m‘a->
mu‹x
)

108 
	`SDL_UÆockMu‹x
(
m‘a
->
mu‹x
);

109 
	}
}

111 
	$ijkm‘a_­³nd_chd_l
(
IjkMedŸM‘a
 *
m‘a
, IjkMedŸM‘¨*
chd
)

113 ià(!
m‘a
 || !
chd
)

116 ià(!
m‘a
->
chd»n
) {

117 
m‘a
->
chd»n
 = (
IjkMedŸM‘a
 **)
	`ÿÎoc
(
IJK_META_INIT_CAPACITY
, (IjkMediaMeta *));

118 ià(!
m‘a
->
chd»n
)

120 
m‘a
->
chd»n_couÁ
 = 0;

121 
m‘a
->
chd»n_ÿ·c™y
 = 
IJK_META_INIT_CAPACITY
;

122 } ià(
m‘a
->
chd»n_couÁ
 >ğm‘a->
chd»n_ÿ·c™y
) {

123 
size_t
 
Ãw_ÿ·c™y
 = 
m‘a
->
chd»n_ÿ·c™y
 * 2;

124 
IjkMedŸM‘a
 **
Ãw_chd»n
 = (IjkMedŸM‘¨**)
	`ÿÎoc
(
Ãw_ÿ·c™y
, (IjkMediaMeta *));

125 ià(!
Ãw_chd»n
)

128 
	`memıy
(
Ãw_chd»n
, 
m‘a
->
chd»n
, m‘a->
chd»n_ÿ·c™y
 * (
IjkMedŸM‘a
 *));

129 
	`ä“
(
m‘a
->
chd»n
);

130 
m‘a
->
chd»n
 = 
Ãw_chd»n
;

131 
m‘a
->
chd»n_ÿ·c™y
 = 
Ãw_ÿ·c™y
;

134 
m‘a
->
chd»n
[m‘a->
chd»n_couÁ
] = 
chd
;

135 
m‘a
->
chd»n_couÁ
++;

136 
	}
}

138 
	$ijkm‘a_£t_št64_l
(
IjkMedŸM‘a
 *
m‘a
, cÚ¡ *
Çme
, 
št64_t
 
v®ue
)

140 ià(!
m‘a
)

143 
	`av_diù_£t_št
(&
m‘a
->
diù
, 
Çme
, 
v®ue
, 0);

144 
	}
}

146 
	$ijkm‘a_£t_¡ršg_l
(
IjkMedŸM‘a
 *
m‘a
, cÚ¡ *
Çme
, cÚ¡ *
v®ue
)

148 ià(!
m‘a
)

151 
	`av_diù_£t
(&
m‘a
->
diù
, 
Çme
, 
v®ue
, 0);

152 
	}
}

154 
št64_t
 
	$g‘_b™_¿‹
(
AVCodecP¬am‘”s
 *
codeı¬
)

156 
št64_t
 
b™_¿‹
;

157 
b™s_³r_§m¶e
;

159 
codeı¬
->
codec_ty³
) {

160 
AVMEDIA_TYPE_VIDEO
:

161 
AVMEDIA_TYPE_DATA
:

162 
AVMEDIA_TYPE_SUBTITLE
:

163 
AVMEDIA_TYPE_ATTACHMENT
:

164 
b™_¿‹
 = 
codeı¬
->bit_rate;

166 
AVMEDIA_TYPE_AUDIO
:

167 
b™s_³r_§m¶e
 = 
	`av_g‘_b™s_³r_§m¶e
(
codeı¬
->
codec_id
);

168 
b™_¿‹
 = 
b™s_³r_§m¶e
 ? 
codeı¬
->
§m¶e_¿‹
 * codeı¬->
chªÃls
 * bits_per_sample : codecpar->bit_rate;

171 
b™_¿‹
 = 0;

174  
b™_¿‹
;

175 
	}
}

177 
	$ijkm‘a_£t_avfÜm©_cÚ‹xt_l
(
IjkMedŸM‘a
 *
m‘a
, 
AVFÜm©CÚ‹xt
 *
ic
)

179 ià(!
m‘a
 || !
ic
)

182 ià(
ic
->
ifÜm©
 && ic->ifÜm©->
Çme
)

183 
	`ijkm‘a_£t_¡ršg_l
(
m‘a
, 
IJKM_KEY_FORMAT
, 
ic
->
ifÜm©
->
Çme
);

185 ià(
ic
->
du¿tiÚ
 !ğ
AV_NOPTS_VALUE
)

186 
	`ijkm‘a_£t_št64_l
(
m‘a
, 
IJKM_KEY_DURATION_US
, 
ic
->
du¿tiÚ
);

188 ià(
ic
->
¡¬t_time
 !ğ
AV_NOPTS_VALUE
)

189 
	`ijkm‘a_£t_št64_l
(
m‘a
, 
IJKM_KEY_START_US
, 
ic
->
¡¬t_time
);

191 ià(
ic
->
b™_¿‹
)

192 
	`ijkm‘a_£t_št64_l
(
m‘a
, 
IJKM_KEY_BITRATE
, 
ic
->
b™_¿‹
);

194 
IjkMedŸM‘a
 *
¡»am_m‘a
 = 
NULL
;

195 
i
 = 0; i < 
ic
->
nb_¡»ams
; i++) {

196 ià(!
¡»am_m‘a
)

197 
	`ijkm‘a_de¡roy_p
(&
¡»am_m‘a
);

199 
AVSŒ—m
 *
¡
 = 
ic
->
¡»ams
[
i
];

200 ià(!
¡
 || !¡->
codeı¬
)

203 
¡»am_m‘a
 = 
	`ijkm‘a_ü—‹
();

204 ià(!
¡»am_m‘a
)

207 
AVCodecP¬am‘”s
 *
codeı¬
 = 
¡
->codecpar;

208 cÚ¡ *
codec_Çme
 = 
	`avcodec_g‘_Çme
(
codeı¬
->
codec_id
);

209 ià(
codec_Çme
)

210 
	`ijkm‘a_£t_¡ršg_l
(
¡»am_m‘a
, 
IJKM_KEY_CODEC_NAME
, 
codec_Çme
);

211 ià(
codeı¬
->
´ofe
 !ğ
FF_PROFILE_UNKNOWN
) {

212 cÚ¡ 
AVCodec
 *
codec
 = 
	`avcodec_fšd_decod”
(
codeı¬
->
codec_id
);

213 ià(
codec
) {

214 
	`ijkm‘a_£t_št64_l
(
¡»am_m‘a
, 
IJKM_KEY_CODEC_PROFILE_ID
, 
codeı¬
->
´ofe
);

215 cÚ¡ *
´ofe
 = 
	`av_g‘_´ofe_Çme
(
codec
, 
codeı¬
->profile);

216 ià(
´ofe
)

217 
	`ijkm‘a_£t_¡ršg_l
(
¡»am_m‘a
, 
IJKM_KEY_CODEC_PROFILE
, 
´ofe
);

218 ià(
codec
->
lÚg_Çme
)

219 
	`ijkm‘a_£t_¡ršg_l
(
¡»am_m‘a
, 
IJKM_KEY_CODEC_LONG_NAME
, 
codec
->
lÚg_Çme
);

220 
	`ijkm‘a_£t_št64_l
(
¡»am_m‘a
, 
IJKM_KEY_CODEC_LEVEL
, 
codeı¬
->
Ëv–
);

221 ià(
codeı¬
->
fÜm©
 !ğ
AV_PIX_FMT_NONE
)

222 
	`ijkm‘a_£t_¡ršg_l
(
¡»am_m‘a
, 
IJKM_KEY_CODEC_PIXEL_FORMAT
, 
	`av_g‘_pix_fmt_Çme
(
codeı¬
->
fÜm©
));

226 
št64_t
 
b™¿‹
 = 
	`g‘_b™_¿‹
(
codeı¬
);

227 ià(
b™¿‹
 > 0) {

228 
	`ijkm‘a_£t_št64_l
(
¡»am_m‘a
, 
IJKM_KEY_BITRATE
, 
b™¿‹
);

231 
codeı¬
->
codec_ty³
) {

232 
AVMEDIA_TYPE_VIDEO
: {

233 
	`ijkm‘a_£t_¡ršg_l
(
¡»am_m‘a
, 
IJKM_KEY_TYPE
, 
IJKM_VAL_TYPE__VIDEO
);

235 ià(
codeı¬
->
width
 > 0)

236 
	`ijkm‘a_£t_št64_l
(
¡»am_m‘a
, 
IJKM_KEY_WIDTH
, 
codeı¬
->
width
);

237 ià(
codeı¬
->
height
 > 0)

238 
	`ijkm‘a_£t_št64_l
(
¡»am_m‘a
, 
IJKM_KEY_HEIGHT
, 
codeı¬
->
height
);

239 ià(
¡
->
§m¶e_a¥eù_¿tio
.
num
 > 0 && st->§m¶e_a¥eù_¿tio.
d’
 > 0) {

240 
	`ijkm‘a_£t_št64_l
(
¡»am_m‘a
, 
IJKM_KEY_SAR_NUM
, 
codeı¬
->
§m¶e_a¥eù_¿tio
.
num
);

241 
	`ijkm‘a_£t_št64_l
(
¡»am_m‘a
, 
IJKM_KEY_SAR_DEN
, 
codeı¬
->
§m¶e_a¥eù_¿tio
.
d’
);

244 ià(
¡
->
avg_äame_¿‹
.
num
 > 0 && st->avg_äame_¿‹.
d’
 > 0) {

245 
	`ijkm‘a_£t_št64_l
(
¡»am_m‘a
, 
IJKM_KEY_FPS_NUM
, 
¡
->
avg_äame_¿‹
.
num
);

246 
	`ijkm‘a_£t_št64_l
(
¡»am_m‘a
, 
IJKM_KEY_FPS_DEN
, 
¡
->
avg_äame_¿‹
.
d’
);

248 ià(
¡
->
r_äame_¿‹
.
num
 > 0 && st->r_äame_¿‹.
d’
 > 0) {

249 
	`ijkm‘a_£t_št64_l
(
¡»am_m‘a
, 
IJKM_KEY_TBR_NUM
, 
¡
->
avg_äame_¿‹
.
num
);

250 
	`ijkm‘a_£t_št64_l
(
¡»am_m‘a
, 
IJKM_KEY_TBR_DEN
, 
¡
->
avg_äame_¿‹
.
d’
);

254 
AVMEDIA_TYPE_AUDIO
: {

255 
	`ijkm‘a_£t_¡ršg_l
(
¡»am_m‘a
, 
IJKM_KEY_TYPE
, 
IJKM_VAL_TYPE__AUDIO
);

257 ià(
codeı¬
->
§m¶e_¿‹
)

258 
	`ijkm‘a_£t_št64_l
(
¡»am_m‘a
, 
IJKM_KEY_SAMPLE_RATE
, 
codeı¬
->
§m¶e_¿‹
);

259 ià(
codeı¬
->
chªÃl_Ïyout
)

260 
	`ijkm‘a_£t_št64_l
(
¡»am_m‘a
, 
IJKM_KEY_CHANNEL_LAYOUT
, 
codeı¬
->
chªÃl_Ïyout
);

263 
AVMEDIA_TYPE_SUBTITLE
: {

264 
	`ijkm‘a_£t_¡ršg_l
(
¡»am_m‘a
, 
IJKM_KEY_TYPE
, 
IJKM_VAL_TYPE__TIMEDTEXT
);

268 
	`ijkm‘a_£t_¡ršg_l
(
¡»am_m‘a
, 
IJKM_KEY_TYPE
, 
IJKM_VAL_TYPE__UNKNOWN
);

273 
AVDiùiÚ¬yEÁry
 *
Ïng
 = 
	`av_diù_g‘
(
¡
->
m‘ad©a
, "Ïnguage", 
NULL
, 0);

274 ià(
Ïng
 &&†ªg->
v®ue
)

275 
	`ijkm‘a_£t_¡ršg_l
(
¡»am_m‘a
, 
IJKM_KEY_LANGUAGE
, 
Ïng
->
v®ue
);

277 
	`ijkm‘a_­³nd_chd_l
(
m‘a
, 
¡»am_m‘a
);

278 
¡»am_m‘a
 = 
NULL
;

281 ià(!
¡»am_m‘a
)

282 
	`ijkm‘a_de¡roy_p
(&
¡»am_m‘a
);

283 
	}
}

285 cÚ¡ *
	$ijkm‘a_g‘_¡ršg_l
(
IjkMedŸM‘a
 *
m‘a
, cÚ¡ *
Çme
)

287 ià(!
m‘a
 || !m‘a->
diù
)

288  
NULL
;

290 
AVDiùiÚ¬yEÁry
 *
’Œy
 = 
	`av_diù_g‘
(
m‘a
->
diù
, 
Çme
, 
NULL
, 0);

291 ià(!
’Œy
)

292  
NULL
;

294  
’Œy
->
v®ue
;

295 
	}
}

297 
št64_t
 
	$ijkm‘a_g‘_št64_l
(
IjkMedŸM‘a
 *
m‘a
, cÚ¡ *
Çme
, 
št64_t
 
deçuÉV®ue
)

299 ià(!
m‘a
 || !m‘a->
diù
)

300  
deçuÉV®ue
;

302 
AVDiùiÚ¬yEÁry
 *
’Œy
 = 
	`av_diù_g‘
(
m‘a
->
diù
, 
Çme
, 
NULL
, 0);

303 ià(!
’Œy
 || !’Œy->
v®ue
)

304  
deçuÉV®ue
;

306  
	`©Şl
(
’Œy
->
v®ue
);

307 
	}
}

309 
size_t
 
	$ijkm‘a_g‘_chd»n_couÁ_l
(
IjkMedŸM‘a
 *
m‘a
)

311 ià(!
m‘a
 || !m‘a->
chd»n
)

314  
m‘a
->
chd»n_couÁ
;

315 
	}
}

317 
IjkMedŸM‘a
 *
	$ijkm‘a_g‘_chd_l
(
IjkMedŸM‘a
 *
m‘a
, 
size_t
 
šdex
)

319 ià(!
m‘a
)

320  
NULL
;

322 ià(
šdex
 >ğ
m‘a
->
chd»n_couÁ
)

323  
NULL
;

325  
m‘a
->
chd»n
[
šdex
];

326 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkmeta.h

24 #iâdeà
IJKPLAYER__IJKMETA_H


25 
	#IJKPLAYER__IJKMETA_H


	)

27 
	~<¡dšt.h
>

28 
	~<¡dlib.h
>

31 
	#IJKM_KEY_FORMAT
 "fÜm©"

	)

32 
	#IJKM_KEY_DURATION_US
 "du¿tiÚ_us"

	)

33 
	#IJKM_KEY_START_US
 "¡¬t_us"

	)

34 
	#IJKM_KEY_BITRATE
 "b™¿‹"

	)

35 
	#IJKM_KEY_VIDEO_STREAM
 "video"

	)

36 
	#IJKM_KEY_AUDIO_STREAM
 "audio"

	)

37 
	#IJKM_KEY_TIMEDTEXT_STREAM
 "timed‹xt"

	)

40 
	#IJKM_KEY_TYPE
 "ty³"

	)

41 
	#IJKM_VAL_TYPE__VIDEO
 "video"

	)

42 
	#IJKM_VAL_TYPE__AUDIO
 "audio"

	)

43 
	#IJKM_VAL_TYPE__TIMEDTEXT
 "timed‹xt"

	)

44 
	#IJKM_VAL_TYPE__UNKNOWN
 "unknown"

	)

45 
	#IJKM_KEY_LANGUAGE
 "Ïnguage"

	)

47 
	#IJKM_KEY_CODEC_NAME
 "codec_Çme"

	)

48 
	#IJKM_KEY_CODEC_PROFILE
 "codec_´ofe"

	)

49 
	#IJKM_KEY_CODEC_LEVEL
 "codec_Ëv–"

	)

50 
	#IJKM_KEY_CODEC_LONG_NAME
 "codec_lÚg_Çme"

	)

51 
	#IJKM_KEY_CODEC_PIXEL_FORMAT
 "codec_pix–_fÜm©"

	)

52 
	#IJKM_KEY_CODEC_PROFILE_ID
 "codec_´ofe_id"

	)

55 
	#IJKM_KEY_WIDTH
 "width"

	)

56 
	#IJKM_KEY_HEIGHT
 "height"

	)

57 
	#IJKM_KEY_FPS_NUM
 "ås_num"

	)

58 
	#IJKM_KEY_FPS_DEN
 "ås_d’"

	)

59 
	#IJKM_KEY_TBR_NUM
 "tbr_num"

	)

60 
	#IJKM_KEY_TBR_DEN
 "tbr_d’"

	)

61 
	#IJKM_KEY_SAR_NUM
 "§r_num"

	)

62 
	#IJKM_KEY_SAR_DEN
 "§r_d’"

	)

64 
	#IJKM_KEY_SAMPLE_RATE
 "§m¶e_¿‹"

	)

65 
	#IJKM_KEY_CHANNEL_LAYOUT
 "chªÃl_Ïyout"

	)

68 
	#IJKM_KEY_STREAMS
 "¡»ams"

	)

70 
	gAVFÜm©CÚ‹xt
;

71 
IjkMedŸM‘a
 
	tIjkMedŸM‘a
;

73 
IjkMedŸM‘a
 *
ijkm‘a_ü—‹
();

74 
ijkm‘a_»£t
(
IjkMedŸM‘a
 *
m‘a
);

75 
ijkm‘a_de¡roy
(
IjkMedŸM‘a
 *
m‘a
);

76 
ijkm‘a_de¡roy_p
(
IjkMedŸM‘a
 **
m‘a
);

78 
ijkm‘a_lock
(
IjkMedŸM‘a
 *
m‘a
);

79 
ijkm‘a_uÆock
(
IjkMedŸM‘a
 *
m‘a
);

81 
ijkm‘a_­³nd_chd_l
(
IjkMedŸM‘a
 *
m‘a
, IjkMedŸM‘¨*
chd
);

82 
ijkm‘a_£t_št64_l
(
IjkMedŸM‘a
 *
m‘a
, cÚ¡ *
Çme
, 
št64_t
 
v®ue
);

83 
ijkm‘a_£t_¡ršg_l
(
IjkMedŸM‘a
 *
m‘a
, cÚ¡ *
Çme
, cÚ¡ *
v®ue
);

84 
ijkm‘a_£t_avfÜm©_cÚ‹xt_l
(
IjkMedŸM‘a
 *
m‘a
, 
AVFÜm©CÚ‹xt
 *
ic
);

87 cÚ¡ *
ijkm‘a_g‘_¡ršg_l
(
IjkMedŸM‘a
 *
m‘a
, cÚ¡ *
Çme
);

88 
št64_t
 
ijkm‘a_g‘_št64_l
(
IjkMedŸM‘a
 *
m‘a
, cÚ¡ *
Çme
, iÁ64_ˆ
deçuÉV®ue
);

89 
size_t
 
ijkm‘a_g‘_chd»n_couÁ_l
(
IjkMedŸM‘a
 *
m‘a
);

91 
IjkMedŸM‘a
 *
ijkm‘a_g‘_chd_l
(IjkMedŸM‘¨*
m‘a
, 
size_t
 
šdex
);

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkplayer.c

24 
	~"ijk¶ay”.h
"

25 
	~"ijk¶ay”_š‹º®.h
"

26 
	~"ijkv”siÚ.h
"

28 
	#MP_RET_IF_FAILED
(
»t
) \

30 
»tv®
 = 
»t
; \

31 ià(
»tv®
 != 0)  (retval); \

32 } 0)

	)

34 
	#MPST_RET_IF_EQ_INT
(
»®
, 
ex³ùed
, 
”rcode
) \

36 ià((
»®
è=ğ(
ex³ùed
)è (
”rcode
); \

37 } 0)

	)

39 
	#MPST_RET_IF_EQ
(
»®
, 
ex³ùed
) \

40 
	`MPST_RET_IF_EQ_INT
(
»®
, 
ex³ùed
, 
EIJK_INVALID_STATE
)

	)

42 
šlše
 
	$ijkmp_de¡roy
(
IjkMedŸPÏy”
 *
mp
)

44 ià(!
mp
)

47 
	`få_de¡roy_p
(&
mp
->
fåÏy”
);

48 ià(
mp
->
msg_th»ad
) {

49 
	`SDL_Wa™Th»ad
(
mp
->
msg_th»ad
, 
NULL
);

50 
mp
->
msg_th»ad
 = 
NULL
;

53 
	`±h»ad_mu‹x_de¡roy
(&
mp
->
mu‹x
);

55 
	`ä“p
((**)&
mp
->
d©a_sourû
);

56 
	`mem£t
(
mp
, 0, (
IjkMedŸPÏy”
));

57 
	`ä“p
((**)&
mp
);

58 
	}
}

60 
šlše
 
	$ijkmp_de¡roy_p
(
IjkMedŸPÏy”
 **
pmp
)

62 ià(!
pmp
)

65 
	`ijkmp_de¡roy
(*
pmp
);

66 *
pmp
 = 
NULL
;

67 
	}
}

69 
	$ijkmp_glob®_š™
()

71 
	`få_glob®_š™
();

72 
	}
}

74 
	$ijkmp_glob®_unš™
()

76 
	`få_glob®_unš™
();

77 
	}
}

79 
	$ijkmp_glob®_£t_log_»pÜt
(
u£_»pÜt
)

81 
	`få_glob®_£t_log_»pÜt
(
u£_»pÜt
);

82 
	}
}

84 
	$ijkmp_glob®_£t_log_Ëv–
(
log_Ëv–
)

86 
	`få_glob®_£t_log_Ëv–
(
log_Ëv–
);

87 
	}
}

89 
	$ijkmp_glob®_£t_šjeù_ÿÎback
(
ijk_šjeù_ÿÎback
 
cb
)

91 
	`få_glob®_£t_šjeù_ÿÎback
(
cb
);

92 
	}
}

94 cÚ¡ *
	$ijkmp_v”siÚ
()

96  
IJKPLAYER_VERSION
;

97 
	}
}

99 
ijkmp_io_¡©_»gi¡”
((*
cb
)(cÚ¡ *
u¾
, 
ty³
, 
by‹s
))

101 
	`få_io_¡©_»gi¡”
(
cb
);

102 
	}
}

104 
ijkmp_io_¡©_com¶‘e_»gi¡”
((*
cb
)(cÚ¡ *
u¾
,

105 
št64_t
 
»ad_by‹s
, iÁ64_ˆ
tÙ®_size
,

106 
št64_t
 
–·£d_time
, iÁ64_ˆ
tÙ®_du¿tiÚ
))

108 
	`få_io_¡©_com¶‘e_»gi¡”
(
cb
);

109 
	}
}

111 
	$ijkmp_chªge_¡©e_l
(
IjkMedŸPÏy”
 *
mp
, 
Ãw_¡©e
)

113 
mp
->
mp_¡©e
 = 
Ãw_¡©e
;

114 
	`få_nÙify_msg1
(
mp
->
fåÏy”
, 
FFP_MSG_PLAYBACK_STATE_CHANGED
);

115 
	}
}

117 
IjkMedŸPÏy”
 *
ijkmp_ü—‹
((*
msg_loİ
)(*))

119 
IjkMedŸPÏy”
 *
mp
 = (IjkMedŸPÏy” *è
	`m®locz
((IjkMediaPlayer));

120 ià(!
mp
)

121 
ç
;

123 
mp
->
fåÏy”
 = 
	`få_ü—‹
();

124 ià(!
mp
->
fåÏy”
)

125 
ç
;

127 
mp
->
msg_loİ
 = msg_loop;

129 
	`ijkmp_šc_»f
(
mp
);

130 
	`±h»ad_mu‹x_š™
(&
mp
->
mu‹x
, 
NULL
);

132  
mp
;

134 
ç
:

135 
	`ijkmp_de¡roy_p
(&
mp
);

136  
NULL
;

137 
	}
}

139 *
	$ijkmp_£t_šjeù_İaque
(
IjkMedŸPÏy”
 *
mp
, *
İaque
)

141 
	`as£¹
(
mp
);

143 
	`MPTRACE
("%s(%p)\n", 
__func__
, 
İaque
);

144 *
´ev_w—k_thiz
 = 
	`få_£t_šjeù_İaque
(
mp
->
fåÏy”
, 
İaque
);

145 
	`MPTRACE
("%s()=void\n", 
__func__
);

146  
´ev_w—k_thiz
;

147 
	}
}

149 *
	$ijkmp_£t_ijkio_šjeù_İaque
(
IjkMedŸPÏy”
 *
mp
, *
İaque
)

151 
	`as£¹
(
mp
);

153 
	`MPTRACE
("%s(%p)\n", 
__func__
, 
İaque
);

154 *
´ev_w—k_thiz
 = 
	`få_£t_ijkio_šjeù_İaque
(
mp
->
fåÏy”
, 
İaque
);

155 
	`MPTRACE
("%s()=void\n", 
__func__
);

156  
´ev_w—k_thiz
;

157 
	}
}

159 
	$ijkmp_£t_İtiÚ
(
IjkMedŸPÏy”
 *
mp
, 
İt_ÿ‹gÜy
, cÚ¡ *
Çme
, cÚ¡ *
v®ue
)

161 
	`as£¹
(
mp
);

164 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

165 
	`få_£t_İtiÚ
(
mp
->
fåÏy”
, 
İt_ÿ‹gÜy
, 
Çme
, 
v®ue
);

166 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

168 
	}
}

170 
	$ijkmp_£t_İtiÚ_št
(
IjkMedŸPÏy”
 *
mp
, 
İt_ÿ‹gÜy
, cÚ¡ *
Çme
, 
št64_t
 
v®ue
)

172 
	`as£¹
(
mp
);

175 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

176 
	`få_£t_İtiÚ_št
(
mp
->
fåÏy”
, 
İt_ÿ‹gÜy
, 
Çme
, 
v®ue
);

177 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

179 
	}
}

181 
	$ijkmp_g‘_video_codec_šfo
(
IjkMedŸPÏy”
 *
mp
, **
codec_šfo
)

183 
	`as£¹
(
mp
);

185 
	`MPTRACE
("%s\n", 
__func__
);

186 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

187 
»t
 = 
	`få_g‘_video_codec_šfo
(
mp
->
fåÏy”
, 
codec_šfo
);

188 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

189 
	`MPTRACE
("%s()=void\n", 
__func__
);

190  
»t
;

191 
	}
}

193 
	$ijkmp_g‘_audio_codec_šfo
(
IjkMedŸPÏy”
 *
mp
, **
codec_šfo
)

195 
	`as£¹
(
mp
);

197 
	`MPTRACE
("%s\n", 
__func__
);

198 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

199 
»t
 = 
	`få_g‘_audio_codec_šfo
(
mp
->
fåÏy”
, 
codec_šfo
);

200 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

201 
	`MPTRACE
("%s()=void\n", 
__func__
);

202  
»t
;

203 
	}
}

205 
	$ijkmp_£t_¶ayback_¿‹
(
IjkMedŸPÏy”
 *
mp
, 
¿‹
)

207 
	`as£¹
(
mp
);

209 
	`MPTRACE
("%s(%f)\n", 
__func__
, 
¿‹
);

210 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

211 
	`få_£t_¶ayback_¿‹
(
mp
->
fåÏy”
, 
¿‹
);

212 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

213 
	`MPTRACE
("%s()=void\n", 
__func__
);

214 
	}
}

216 
	$ijkmp_£t_¶ayback_vŞume
(
IjkMedŸPÏy”
 *
mp
, 
vŞume
)

218 
	`as£¹
(
mp
);

220 
	`MPTRACE
("%s(%f)\n", 
__func__
, 
vŞume
);

221 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

222 
	`få_£t_¶ayback_vŞume
(
mp
->
fåÏy”
, 
vŞume
);

223 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

224 
	`MPTRACE
("%s()=void\n", 
__func__
);

225 
	}
}

227 
	$ijkmp_£t_¡»am_£Ëùed
(
IjkMedŸPÏy”
 *
mp
, 
¡»am
, 
£Ëùed
)

229 
	`as£¹
(
mp
);

231 
	`MPTRACE
("%s(%d, %d)\n", 
__func__
, 
¡»am
, 
£Ëùed
);

232 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

233 
»t
 = 
	`få_£t_¡»am_£Ëùed
(
mp
->
fåÏy”
, 
¡»am
, 
£Ëùed
);

234 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

235 
	`MPTRACE
("%s(%d, %d)=%d\n", 
__func__
, 
¡»am
, 
£Ëùed
, 
»t
);

236  
»t
;

237 
	}
}

239 
	$ijkmp_g‘_´İ”ty_æßt
(
IjkMedŸPÏy”
 *
mp
, 
id
, 
deçuÉ_v®ue
)

241 
	`as£¹
(
mp
);

243 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

244 
»t
 = 
	`få_g‘_´İ”ty_æßt
(
mp
->
fåÏy”
, 
id
, 
deçuÉ_v®ue
);

245 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

246  
»t
;

247 
	}
}

249 
	$ijkmp_£t_´İ”ty_æßt
(
IjkMedŸPÏy”
 *
mp
, 
id
, 
v®ue
)

251 
	`as£¹
(
mp
);

253 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

254 
	`få_£t_´İ”ty_æßt
(
mp
->
fåÏy”
, 
id
, 
v®ue
);

255 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

256 
	}
}

258 
št64_t
 
	$ijkmp_g‘_´İ”ty_št64
(
IjkMedŸPÏy”
 *
mp
, 
id
, 
št64_t
 
deçuÉ_v®ue
)

260 
	`as£¹
(
mp
);

262 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

263 
št64_t
 
»t
 = 
	`få_g‘_´İ”ty_št64
(
mp
->
fåÏy”
, 
id
, 
deçuÉ_v®ue
);

264 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

265  
»t
;

266 
	}
}

268 
	$ijkmp_£t_´İ”ty_št64
(
IjkMedŸPÏy”
 *
mp
, 
id
, 
št64_t
 
v®ue
)

270 
	`as£¹
(
mp
);

272 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

273 
	`få_£t_´İ”ty_št64
(
mp
->
fåÏy”
, 
id
, 
v®ue
);

274 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

275 
	}
}

277 
IjkMedŸM‘a
 *
	$ijkmp_g‘_m‘a_l
(
IjkMedŸPÏy”
 *
mp
)

279 
	`as£¹
(
mp
);

281 
	`MPTRACE
("%s\n", 
__func__
);

282 
IjkMedŸM‘a
 *
»t
 = 
	`få_g‘_m‘a_l
(
mp
->
fåÏy”
);

283 
	`MPTRACE
("%s()=void\n", 
__func__
);

284  
»t
;

285 
	}
}

287 
	$ijkmp_shutdown_l
(
IjkMedŸPÏy”
 *
mp
)

289 
	`as£¹
(
mp
);

291 
	`MPTRACE
("ijkmp_shutdown_l()\n");

292 ià(
mp
->
fåÏy”
) {

293 
	`få_¡İ_l
(
mp
->
fåÏy”
);

294 
	`få_wa™_¡İ_l
(
mp
->
fåÏy”
);

296 
	`MPTRACE
("ijkmp_shutdown_l()=void\n");

297 
	}
}

299 
	$ijkmp_shutdown
(
IjkMedŸPÏy”
 *
mp
)

301  
	`ijkmp_shutdown_l
(
mp
);

302 
	}
}

304 
	$ijkmp_šc_»f
(
IjkMedŸPÏy”
 *
mp
)

306 
	`as£¹
(
mp
);

307 
	`__sync_ãtch_ªd_add
(&
mp
->
»f_couÁ
, 1);

308 
	}
}

310 
	$ijkmp_dec_»f
(
IjkMedŸPÏy”
 *
mp
)

312 ià(!
mp
)

315 
»f_couÁ
 = 
	`__sync_sub_ªd_ãtch
(&
mp
->ref_count, 1);

316 ià(
»f_couÁ
 == 0) {

317 
	`MPTRACE
("ijkmp_dec_ref():„ef=0\n");

318 
	`ijkmp_shutdown
(
mp
);

319 
	`ijkmp_de¡roy_p
(&
mp
);

321 
	}
}

323 
	$ijkmp_dec_»f_p
(
IjkMedŸPÏy”
 **
pmp
)

325 ià(!
pmp
)

328 
	`ijkmp_dec_»f
(*
pmp
);

329 *
pmp
 = 
NULL
;

330 
	}
}

332 
	$ijkmp_£t_d©a_sourû_l
(
IjkMedŸPÏy”
 *
mp
, cÚ¡ *
u¾
)

334 
	`as£¹
(
mp
);

335 
	`as£¹
(
u¾
);

338 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_INITIALIZED
);

339 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_ASYNC_PREPARING
);

340 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_PREPARED
);

341 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_STARTED
);

342 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_PAUSED
);

343 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_COMPLETED
);

344 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_STOPPED
);

345 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_ERROR
);

346 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_END
);

348 
	`ä“p
((**)&
mp
->
d©a_sourû
);

349 
mp
->
d©a_sourû
 = 
	`¡rdup
(
u¾
);

350 ià(!
mp
->
d©a_sourû
)

351  
EIJK_OUT_OF_MEMORY
;

353 
	`ijkmp_chªge_¡©e_l
(
mp
, 
MP_STATE_INITIALIZED
);

355 
	}
}

357 
	$ijkmp_£t_d©a_sourû
(
IjkMedŸPÏy”
 *
mp
, cÚ¡ *
u¾
)

359 
	`as£¹
(
mp
);

360 
	`as£¹
(
u¾
);

361 
	`MPTRACE
("ijkmp_£t_d©a_sourû(u¾=\"%s\")\n", 
u¾
);

362 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

363 
»tv®
 = 
	`ijkmp_£t_d©a_sourû_l
(
mp
, 
u¾
);

364 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

365 
	`MPTRACE
("ijkmp_£t_d©a_sourû(u¾=\"%s\")=%d\n", 
u¾
, 
»tv®
);

366  
»tv®
;

367 
	}
}

369 
	$ijkmp_msg_loİ
(*
¬g
)

371 
IjkMedŸPÏy”
 *
mp
 = 
¬g
;

372 
»t
 = 
mp
->
	`msg_loİ
(
¬g
);

373  
»t
;

374 
	}
}

376 
	$ijkmp_´•¬e_async_l
(
IjkMedŸPÏy”
 *
mp
)

378 
	`as£¹
(
mp
);

380 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_IDLE
);

382 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_ASYNC_PREPARING
);

383 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_PREPARED
);

384 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_STARTED
);

385 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_PAUSED
);

386 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_COMPLETED
);

388 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_ERROR
);

389 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_END
);

391 
	`as£¹
(
mp
->
d©a_sourû
);

393 
	`ijkmp_chªge_¡©e_l
(
mp
, 
MP_STATE_ASYNC_PREPARING
);

395 
	`msg_queue_¡¬t
(&
mp
->
fåÏy”
->
msg_queue
);

398 
	`ijkmp_šc_»f
(
mp
);

399 
mp
->
msg_th»ad
 = 
	`SDL_C»©eTh»adEx
(&mp->
_msg_th»ad
, 
ijkmp_msg_loİ
, mp, "ff_msg_loop");

403 
»tv®
 = 
	`få_´•¬e_async_l
(
mp
->
fåÏy”
, mp->
d©a_sourû
);

404 ià(
»tv®
 < 0) {

405 
	`ijkmp_chªge_¡©e_l
(
mp
, 
MP_STATE_ERROR
);

406  
»tv®
;

410 
	}
}

412 
	$ijkmp_´•¬e_async
(
IjkMedŸPÏy”
 *
mp
)

414 
	`as£¹
(
mp
);

415 
	`MPTRACE
("ijkmp_prepare_async()\n");

416 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

417 
»tv®
 = 
	`ijkmp_´•¬e_async_l
(
mp
);

418 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

419 
	`MPTRACE
("ijkmp_´•¬e_async()=%d\n", 
»tv®
);

420  
»tv®
;

421 
	}
}

423 
	$ikjmp_chk¡_¡¬t_l
(
mp_¡©e
)

425 
	`MPST_RET_IF_EQ
(
mp_¡©e
, 
MP_STATE_IDLE
);

426 
	`MPST_RET_IF_EQ
(
mp_¡©e
, 
MP_STATE_INITIALIZED
);

427 
	`MPST_RET_IF_EQ
(
mp_¡©e
, 
MP_STATE_ASYNC_PREPARING
);

432 
	`MPST_RET_IF_EQ
(
mp_¡©e
, 
MP_STATE_STOPPED
);

433 
	`MPST_RET_IF_EQ
(
mp_¡©e
, 
MP_STATE_ERROR
);

434 
	`MPST_RET_IF_EQ
(
mp_¡©e
, 
MP_STATE_END
);

437 
	}
}

439 
	$ijkmp_¡¬t_l
(
IjkMedŸPÏy”
 *
mp
)

441 
	`as£¹
(
mp
);

443 
	`MP_RET_IF_FAILED
(
	`ikjmp_chk¡_¡¬t_l
(
mp
->
mp_¡©e
));

445 
	`få_»move_msg
(
mp
->
fåÏy”
, 
FFP_REQ_START
);

446 
	`få_»move_msg
(
mp
->
fåÏy”
, 
FFP_REQ_PAUSE
);

447 
	`få_nÙify_msg1
(
mp
->
fåÏy”
, 
FFP_REQ_START
);

450 
	}
}

452 
	$ijkmp_¡¬t
(
IjkMedŸPÏy”
 *
mp
)

454 
	`as£¹
(
mp
);

455 
	`MPTRACE
("ijkmp_start()\n");

456 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

457 
»tv®
 = 
	`ijkmp_¡¬t_l
(
mp
);

458 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

459 
	`MPTRACE
("ijkmp_¡¬t()=%d\n", 
»tv®
);

460  
»tv®
;

461 
	}
}

463 
	$ikjmp_chk¡_·u£_l
(
mp_¡©e
)

465 
	`MPST_RET_IF_EQ
(
mp_¡©e
, 
MP_STATE_IDLE
);

466 
	`MPST_RET_IF_EQ
(
mp_¡©e
, 
MP_STATE_INITIALIZED
);

467 
	`MPST_RET_IF_EQ
(
mp_¡©e
, 
MP_STATE_ASYNC_PREPARING
);

472 
	`MPST_RET_IF_EQ
(
mp_¡©e
, 
MP_STATE_STOPPED
);

473 
	`MPST_RET_IF_EQ
(
mp_¡©e
, 
MP_STATE_ERROR
);

474 
	`MPST_RET_IF_EQ
(
mp_¡©e
, 
MP_STATE_END
);

477 
	}
}

479 
	$ijkmp_·u£_l
(
IjkMedŸPÏy”
 *
mp
)

481 
	`as£¹
(
mp
);

483 
	`MP_RET_IF_FAILED
(
	`ikjmp_chk¡_·u£_l
(
mp
->
mp_¡©e
));

485 
	`få_»move_msg
(
mp
->
fåÏy”
, 
FFP_REQ_START
);

486 
	`få_»move_msg
(
mp
->
fåÏy”
, 
FFP_REQ_PAUSE
);

487 
	`få_nÙify_msg1
(
mp
->
fåÏy”
, 
FFP_REQ_PAUSE
);

490 
	}
}

492 
	$ijkmp_·u£
(
IjkMedŸPÏy”
 *
mp
)

494 
	`as£¹
(
mp
);

495 
	`MPTRACE
("ijkmp_pause()\n");

496 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

497 
»tv®
 = 
	`ijkmp_·u£_l
(
mp
);

498 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

499 
	`MPTRACE
("ijkmp_·u£()=%d\n", 
»tv®
);

500  
»tv®
;

501 
	}
}

503 
	$ijkmp_¡İ_l
(
IjkMedŸPÏy”
 *
mp
)

505 
	`as£¹
(
mp
);

507 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_IDLE
);

508 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_INITIALIZED
);

515 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_ERROR
);

516 
	`MPST_RET_IF_EQ
(
mp
->
mp_¡©e
, 
MP_STATE_END
);

518 
	`få_»move_msg
(
mp
->
fåÏy”
, 
FFP_REQ_START
);

519 
	`få_»move_msg
(
mp
->
fåÏy”
, 
FFP_REQ_PAUSE
);

520 
»tv®
 = 
	`få_¡İ_l
(
mp
->
fåÏy”
);

521 ià(
»tv®
 < 0) {

522  
»tv®
;

525 
	`ijkmp_chªge_¡©e_l
(
mp
, 
MP_STATE_STOPPED
);

527 
	}
}

529 
	$ijkmp_¡İ
(
IjkMedŸPÏy”
 *
mp
)

531 
	`as£¹
(
mp
);

532 
	`MPTRACE
("ijkmp_stop()\n");

533 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

534 
»tv®
 = 
	`ijkmp_¡İ_l
(
mp
);

535 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

536 
	`MPTRACE
("ijkmp_¡İ()=%d\n", 
»tv®
);

537  
»tv®
;

538 
	}
}

540 
boŞ
 
	$ijkmp_is_¶ayšg
(
IjkMedŸPÏy”
 *
mp
)

542 
	`as£¹
(
mp
);

543 ià(
mp
->
mp_¡©e
 =ğ
MP_STATE_PREPARED
 ||

544 
mp
->
mp_¡©e
 =ğ
MP_STATE_STARTED
) {

545  
Œue
;

548  
çl£
;

549 
	}
}

551 
	$ikjmp_chk¡_£ek_l
(
mp_¡©e
)

553 
	`MPST_RET_IF_EQ
(
mp_¡©e
, 
MP_STATE_IDLE
);

554 
	`MPST_RET_IF_EQ
(
mp_¡©e
, 
MP_STATE_INITIALIZED
);

555 
	`MPST_RET_IF_EQ
(
mp_¡©e
, 
MP_STATE_ASYNC_PREPARING
);

560 
	`MPST_RET_IF_EQ
(
mp_¡©e
, 
MP_STATE_STOPPED
);

561 
	`MPST_RET_IF_EQ
(
mp_¡©e
, 
MP_STATE_ERROR
);

562 
	`MPST_RET_IF_EQ
(
mp_¡©e
, 
MP_STATE_END
);

565 
	}
}

567 
	$ijkmp_£ek_to_l
(
IjkMedŸPÏy”
 *
mp
, 
m£c
)

569 
	`as£¹
(
mp
);

571 
	`MP_RET_IF_FAILED
(
	`ikjmp_chk¡_£ek_l
(
mp
->
mp_¡©e
));

573 
mp
->
£ek_»q
 = 1;

574 
mp
->
£ek_m£c
 = 
m£c
;

575 
	`få_»move_msg
(
mp
->
fåÏy”
, 
FFP_REQ_SEEK
);

576 
	`få_nÙify_msg2
(
mp
->
fåÏy”
, 
FFP_REQ_SEEK
, ()
m£c
);

580 
	}
}

582 
	$ijkmp_£ek_to
(
IjkMedŸPÏy”
 *
mp
, 
m£c
)

584 
	`as£¹
(
mp
);

585 
	`MPTRACE
("ijkmp_£ek_to(%ld)\n", 
m£c
);

586 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

587 
»tv®
 = 
	`ijkmp_£ek_to_l
(
mp
, 
m£c
);

588 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

589 
	`MPTRACE
("ijkmp_£ek_to(%ld)=%d\n", 
m£c
, 
»tv®
);

591  
»tv®
;

592 
	}
}

594 
	$ijkmp_g‘_¡©e
(
IjkMedŸPÏy”
 *
mp
)

596  
mp
->
mp_¡©e
;

597 
	}
}

599 
	$ijkmp_g‘_cu¼’t_pos™iÚ_l
(
IjkMedŸPÏy”
 *
mp
)

601 ià(
mp
->
£ek_»q
)

602  
mp
->
£ek_m£c
;

603  
	`få_g‘_cu¼’t_pos™iÚ_l
(
mp
->
fåÏy”
);

604 
	}
}

606 
	$ijkmp_g‘_cu¼’t_pos™iÚ
(
IjkMedŸPÏy”
 *
mp
)

608 
	`as£¹
(
mp
);

609 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

610 
»tv®
;

611 ià(
mp
->
£ek_»q
)

612 
»tv®
 = 
mp
->
£ek_m£c
;

614 
»tv®
 = 
	`ijkmp_g‘_cu¼’t_pos™iÚ_l
(
mp
);

615 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

616  
»tv®
;

617 
	}
}

619 
	$ijkmp_g‘_du¿tiÚ_l
(
IjkMedŸPÏy”
 *
mp
)

621  
	`få_g‘_du¿tiÚ_l
(
mp
->
fåÏy”
);

622 
	}
}

624 
	$ijkmp_g‘_du¿tiÚ
(
IjkMedŸPÏy”
 *
mp
)

626 
	`as£¹
(
mp
);

627 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

628 
»tv®
 = 
	`ijkmp_g‘_du¿tiÚ_l
(
mp
);

629 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

630  
»tv®
;

631 
	}
}

633 
	$ijkmp_g‘_¶ayabË_du¿tiÚ_l
(
IjkMedŸPÏy”
 *
mp
)

635  
	`få_g‘_¶ayabË_du¿tiÚ_l
(
mp
->
fåÏy”
);

636 
	}
}

638 
	$ijkmp_g‘_¶ayabË_du¿tiÚ
(
IjkMedŸPÏy”
 *
mp
)

640 
	`as£¹
(
mp
);

641 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

642 
»tv®
 = 
	`ijkmp_g‘_¶ayabË_du¿tiÚ_l
(
mp
);

643 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

644  
»tv®
;

645 
	}
}

647 
	$ijkmp_£t_loİ
(
IjkMedŸPÏy”
 *
mp
, 
loİ
)

649 
	`as£¹
(
mp
);

650 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

651 
	`få_£t_loİ
(
mp
->
fåÏy”
, 
loİ
);

652 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

653 
	}
}

655 
	$ijkmp_g‘_loİ
(
IjkMedŸPÏy”
 *
mp
)

657 
	`as£¹
(
mp
);

658 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

659 
loİ
 = 
	`få_g‘_loİ
(
mp
->
fåÏy”
);

660 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

661  
loİ
;

662 
	}
}

664 *
	$ijkmp_g‘_w—k_thiz
(
IjkMedŸPÏy”
 *
mp
)

666  
mp
->
w—k_thiz
;

667 
	}
}

669 *
	$ijkmp_£t_w—k_thiz
(
IjkMedŸPÏy”
 *
mp
, *
w—k_thiz
)

671 *
´ev_w—k_thiz
 = 
mp
->
w—k_thiz
;

673 
mp
->
w—k_thiz
 = weak_thiz;

675  
´ev_w—k_thiz
;

676 
	}
}

679 
	$ijkmp_g‘_msg
(
IjkMedŸPÏy”
 *
mp
, 
AVMes§ge
 *
msg
, 
block
)

681 
	`as£¹
(
mp
);

683 
cÚtšue_wa™_Ãxt_msg
 = 0;

684 
»tv®
 = 
	`msg_queue_g‘
(&
mp
->
fåÏy”
->
msg_queue
, 
msg
, 
block
);

685 ià(
»tv®
 <= 0)

686  
»tv®
;

688 
msg
->
wh©
) {

689 
FFP_MSG_PREPARED
:

690 
	`MPTRACE
("ijkmp_get_msg: FFP_MSG_PREPARED\n");

691 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

692 ià(
mp
->
mp_¡©e
 =ğ
MP_STATE_ASYNC_PREPARING
) {

693 
	`ijkmp_chªge_¡©e_l
(
mp
, 
MP_STATE_PREPARED
);

696 
	`av_log
(
mp
->
fåÏy”
, 
AV_LOG_DEBUG
, "FFP_MSG_PREPARED:ƒxpecting mp_state==MP_STATE_ASYNC_PREPARING\n");

698 ià(
	`få_is_·u£d_l
(
mp
->
fåÏy”
)) {

699 
	`ijkmp_chªge_¡©e_l
(
mp
, 
MP_STATE_PAUSED
);

701 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

704 
FFP_MSG_COMPLETED
:

705 
	`MPTRACE
("ijkmp_get_msg: FFP_MSG_COMPLETED\n");

707 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

708 
mp
->
»¡¬t
 = 1;

709 
mp
->
»¡¬t_äom_begšnšg
 = 1;

710 
	`ijkmp_chªge_¡©e_l
(
mp
, 
MP_STATE_COMPLETED
);

711 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

714 
FFP_MSG_SEEK_COMPLETE
:

715 
	`MPTRACE
("ijkmp_get_msg: FFP_MSG_SEEK_COMPLETE\n");

717 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

718 
mp
->
£ek_»q
 = 0;

719 
mp
->
£ek_m£c
 = 0;

720 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

723 
FFP_REQ_START
:

724 
	`MPTRACE
("ijkmp_get_msg: FFP_REQ_START\n");

725 
cÚtšue_wa™_Ãxt_msg
 = 1;

726 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

727 ià(0 =ğ
	`ikjmp_chk¡_¡¬t_l
(
mp
->
mp_¡©e
)) {

729 ià(
mp
->
»¡¬t
) {

730 ià(
mp
->
»¡¬t_äom_begšnšg
) {

731 
	`av_log
(
mp
->
fåÏy”
, 
AV_LOG_DEBUG
, "ijkmp_get_msg: FFP_REQ_START:„estart from beginning\n");

732 
»tv®
 = 
	`få_¡¬t_äom_l
(
mp
->
fåÏy”
, 0);

733 ià(
»tv®
 == 0)

734 
	`ijkmp_chªge_¡©e_l
(
mp
, 
MP_STATE_STARTED
);

736 
	`av_log
(
mp
->
fåÏy”
, 
AV_LOG_DEBUG
, "ijkmp_get_msg: FFP_REQ_START:„estart from seek…os\n");

737 
»tv®
 = 
	`få_¡¬t_l
(
mp
->
fåÏy”
);

738 ià(
»tv®
 == 0)

739 
	`ijkmp_chªge_¡©e_l
(
mp
, 
MP_STATE_STARTED
);

741 
mp
->
»¡¬t
 = 0;

742 
mp
->
»¡¬t_äom_begšnšg
 = 0;

744 
	`av_log
(
mp
->
fåÏy”
, 
AV_LOG_DEBUG
, "ijkmp_get_msg: FFP_REQ_START: start on fly\n");

745 
»tv®
 = 
	`få_¡¬t_l
(
mp
->
fåÏy”
);

746 ià(
»tv®
 == 0)

747 
	`ijkmp_chªge_¡©e_l
(
mp
, 
MP_STATE_STARTED
);

750 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

753 
FFP_REQ_PAUSE
:

754 
	`MPTRACE
("ijkmp_get_msg: FFP_REQ_PAUSE\n");

755 
cÚtšue_wa™_Ãxt_msg
 = 1;

756 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

757 ià(0 =ğ
	`ikjmp_chk¡_·u£_l
(
mp
->
mp_¡©e
)) {

758 
·u£_»t
 = 
	`få_·u£_l
(
mp
->
fåÏy”
);

759 ià(
·u£_»t
 == 0)

760 
	`ijkmp_chªge_¡©e_l
(
mp
, 
MP_STATE_PAUSED
);

762 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

765 
FFP_REQ_SEEK
:

766 
	`MPTRACE
("ijkmp_get_msg: FFP_REQ_SEEK\n");

767 
cÚtšue_wa™_Ãxt_msg
 = 1;

769 
	`±h»ad_mu‹x_lock
(&
mp
->
mu‹x
);

770 ià(0 =ğ
	`ikjmp_chk¡_£ek_l
(
mp
->
mp_¡©e
)) {

771 
mp
->
»¡¬t_äom_begšnšg
 = 0;

772 ià(0 =ğ
	`få_£ek_to_l
(
mp
->
fåÏy”
, 
msg
->
¬g1
)) {

773 
	`av_log
(
mp
->
fåÏy”
, 
AV_LOG_DEBUG
, "ijkmp_g‘_msg: FFP_REQ_SEEK: s“kØ%d\n", ()
msg
->
¬g1
);

776 
	`±h»ad_mu‹x_uÆock
(&
mp
->
mu‹x
);

779 ià(
cÚtšue_wa™_Ãxt_msg
) {

780 
	`msg_ä“_»s
(
msg
);

784  
»tv®
;

788 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkplayer.h

24 #iâdeà
IJKPLAYER_ANDROID__IJKPLAYER_H


25 
	#IJKPLAYER_ANDROID__IJKPLAYER_H


	)

27 
	~<¡dboŞ.h
>

28 
	~"ff_ffmsg_queue.h
"

30 
	~"ijkm‘a.h
"

32 #iâdeà
MPTRACE


33 
	#MPTRACE
 
ALOGD


	)

36 
IjkMedŸPÏy”
 
	tIjkMedŸPÏy”
;

37 
	gFFPÏy”
;

38 
	gSDL_Vout
;

59 
	#MP_STATE_IDLE
 0

	)

67 
	#MP_STATE_INITIALIZED
 1

	)

76 
	#MP_STATE_ASYNC_PREPARING
 2

	)

85 
	#MP_STATE_PREPARED
 3

	)

98 
	#MP_STATE_STARTED
 4

	)

109 
	#MP_STATE_PAUSED
 5

	)

120 
	#MP_STATE_COMPLETED
 6

	)

129 
	#MP_STATE_STOPPED
 7

	)

135 
	#MP_STATE_ERROR
 8

	)

140 
	#MP_STATE_END
 9

	)

144 
	#IJKMP_IO_STAT_READ
 1

	)

147 
	#IJKMP_OPT_CATEGORY_FORMAT
 
FFP_OPT_CATEGORY_FORMAT


	)

148 
	#IJKMP_OPT_CATEGORY_CODEC
 
FFP_OPT_CATEGORY_CODEC


	)

149 
	#IJKMP_OPT_CATEGORY_SWS
 
FFP_OPT_CATEGORY_SWS


	)

150 
	#IJKMP_OPT_CATEGORY_PLAYER
 
FFP_OPT_CATEGORY_PLAYER


	)

151 
	#IJKMP_OPT_CATEGORY_SWR
 
FFP_OPT_CATEGORY_SWR


	)

154 
ijkmp_glob®_š™
();

155 
ijkmp_glob®_unš™
();

156 
ijkmp_glob®_£t_log_»pÜt
(
u£_»pÜt
);

157 
ijkmp_glob®_£t_log_Ëv–
(
log_Ëv–
);

158 
ijkmp_glob®_£t_šjeù_ÿÎback
(
ijk_šjeù_ÿÎback
 
cb
);

159 cÚ¡ *
ijkmp_v”siÚ
();

160 
ijkmp_io_¡©_»gi¡”
((*
cb
)(cÚ¡ *
u¾
, 
ty³
, 
by‹s
));

161 
	`ijkmp_io_¡©_com¶‘e_»gi¡”
((*
cb
)(cÚ¡ *
u¾
,

162 
št64_t
 
»ad_by‹s
, iÁ64_ˆ
tÙ®_size
,

163 
št64_t
 
–·£d_time
, iÁ64_ˆ
tÙ®_du¿tiÚ
));

166 
IjkMedŸPÏy”
 *
	`ijkmp_ü—‹
((*
msg_loİ
)(*));

167 * 
	`ijkmp_£t_šjeù_İaque
(
IjkMedŸPÏy”
 *
mp
, *
İaque
);

168 * 
	`ijkmp_£t_ijkio_šjeù_İaque
(
IjkMedŸPÏy”
 *
mp
, *
İaque
);

170 
	`ijkmp_£t_İtiÚ
(
IjkMedŸPÏy”
 *
mp
, 
İt_ÿ‹gÜy
, cÚ¡ *
Çme
, cÚ¡ *
v®ue
);

171 
	`ijkmp_£t_İtiÚ_št
(
IjkMedŸPÏy”
 *
mp
, 
İt_ÿ‹gÜy
, cÚ¡ *
Çme
, 
št64_t
 
v®ue
);

173 
	`ijkmp_g‘_video_codec_šfo
(
IjkMedŸPÏy”
 *
mp
, **
codec_šfo
);

174 
	`ijkmp_g‘_audio_codec_šfo
(
IjkMedŸPÏy”
 *
mp
, **
codec_šfo
);

175 
	`ijkmp_£t_¶ayback_¿‹
(
IjkMedŸPÏy”
 *
mp
, 
¿‹
);

176 
	`ijkmp_£t_¶ayback_vŞume
(
IjkMedŸPÏy”
 *
mp
, 
¿‹
);

178 
	`ijkmp_£t_¡»am_£Ëùed
(
IjkMedŸPÏy”
 *
mp
, 
¡»am
, 
£Ëùed
);

180 
	`ijkmp_g‘_´İ”ty_æßt
(
IjkMedŸPÏy”
 *
mp
, 
id
, 
deçuÉ_v®ue
);

181 
	`ijkmp_£t_´İ”ty_æßt
(
IjkMedŸPÏy”
 *
mp
, 
id
, 
v®ue
);

182 
št64_t
 
	`ijkmp_g‘_´İ”ty_št64
(
IjkMedŸPÏy”
 *
mp
, 
id
, iÁ64_ˆ
deçuÉ_v®ue
);

183 
	`ijkmp_£t_´İ”ty_št64
(
IjkMedŸPÏy”
 *
mp
, 
id
, 
št64_t
 
v®ue
);

186 
IjkMedŸM‘a
 *
	`ijkmp_g‘_m‘a_l
(
IjkMedŸPÏy”
 *
mp
);

190 
	`ijkmp_shutdown
(
IjkMedŸPÏy”
 *
mp
);

192 
	`ijkmp_šc_»f
(
IjkMedŸPÏy”
 *
mp
);

196 
	`ijkmp_dec_»f
(
IjkMedŸPÏy”
 *
mp
);

197 
	`ijkmp_dec_»f_p
(
IjkMedŸPÏy”
 **
pmp
);

199 
	`ijkmp_£t_d©a_sourû
(
IjkMedŸPÏy”
 *
mp
, cÚ¡ *
u¾
);

200 
	`ijkmp_´•¬e_async
(
IjkMedŸPÏy”
 *
mp
);

201 
	`ijkmp_¡¬t
(
IjkMedŸPÏy”
 *
mp
);

202 
	`ijkmp_·u£
(
IjkMedŸPÏy”
 *
mp
);

203 
	`ijkmp_¡İ
(
IjkMedŸPÏy”
 *
mp
);

204 
	`ijkmp_£ek_to
(
IjkMedŸPÏy”
 *
mp
, 
m£c
);

205 
	`ijkmp_g‘_¡©e
(
IjkMedŸPÏy”
 *
mp
);

206 
boŞ
 
	`ijkmp_is_¶ayšg
(
IjkMedŸPÏy”
 *
mp
);

207 
	`ijkmp_g‘_cu¼’t_pos™iÚ
(
IjkMedŸPÏy”
 *
mp
);

208 
	`ijkmp_g‘_du¿tiÚ
(
IjkMedŸPÏy”
 *
mp
);

209 
	`ijkmp_g‘_¶ayabË_du¿tiÚ
(
IjkMedŸPÏy”
 *
mp
);

210 
	`ijkmp_£t_loİ
(
IjkMedŸPÏy”
 *
mp
, 
loİ
);

211 
	`ijkmp_g‘_loİ
(
IjkMedŸPÏy”
 *
mp
);

213 *
	`ijkmp_g‘_w—k_thiz
(
IjkMedŸPÏy”
 *
mp
);

214 *
	`ijkmp_£t_w—k_thiz
(
IjkMedŸPÏy”
 *
mp
, *
w—k_thiz
);

218 
	`ijkmp_g‘_msg
(
IjkMedŸPÏy”
 *
mp
, 
AVMes§ge
 *
msg
, 
block
);

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkplayer_internal.h

24 #iâdeà
IJKPLAYER_ANDROID__IJKPLAYER_INTERNAL_H


25 
	#IJKPLAYER_ANDROID__IJKPLAYER_INTERNAL_H


	)

27 
	~<as£¹.h
>

28 
	~"ijksdl/ijksdl.h
"

29 
	~"ff_fã¼Ü.h
"

30 
	~"ff_fåÏy.h
"

31 
	~"ijk¶ay”.h
"

33 
	sIjkMedŸPÏy”
 {

34 vŞ©
	m»f_couÁ
;

35 
±h»ad_mu‹x_t
 
	mmu‹x
;

36 
FFPÏy”
 *
	mfåÏy”
;

38 (*
	mmsg_loİ
)(*);

39 
SDL_Th»ad
 *
	mmsg_th»ad
;

40 
SDL_Th»ad
 
	m_msg_th»ad
;

42 
	mmp_¡©e
;

43 *
	md©a_sourû
;

44 *
	mw—k_thiz
;

46 
	m»¡¬t
;

47 
	m»¡¬t_äom_begšnšg
;

48 
	m£ek_»q
;

49 
	m£ek_m£c
;

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkversion.h

2 #iâdeà
IJKVERSION_H


3 
	#IJKVERSION_H


	)

4 
	#IJKPLAYER_VERSION
 "k0.7.7.1-16-ga394d78"

	)

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/pipeline/ffpipeline_ffplay.c

24 
	~"få–še_fåÏy.h
"

25 
	~"få’ode_fåÏy_vdec.h
"

26 
	~"../ff_fåÏy.h
"

28 
SDL_CÏss
 
	gg_p–še_şass
 = {

29 .
Çme
 = "ffpipeline_ffplay",

32 
	sIJKFF_P–še_O·que
 {

33 
FFPÏy”
 *
	mfå
;

36 
	$func_de¡roy
(
IJKFF_P–še
 *
p–še
)

39 
	}
}

41 
IJKFF_P’ode
 *
	$func_İ’_video_decod”
(
IJKFF_P–še
 *
p–še
, 
FFPÏy”
 *
få
)

43  
	`få’ode_ü—‹_video_decod”_äom_fåÏy
(
få
);

44 
	}
}

46 
SDL_Aout
 *
	$func_İ’_audio_ouut
(
IJKFF_P–še
 *
p–še
, 
FFPÏy”
 *
få
)

48  
NULL
;

49 
	}
}

51 
IJKFF_P–še
 *
	$få–še_ü—‹_äom_fåÏy
(
FFPÏy”
 *
få
)

53 
IJKFF_P–še
 *
p–še
 = 
	`få–še_®loc
(&
g_p–še_şass
, (
IJKFF_P–še_O·que
));

54 ià(!
p–še
)

55  
p–še
;

57 
IJKFF_P–še_O·que
 *
İaque
 = 
p–še
->opaque;

58 
İaque
->
få
 = ffp;

60 
p–še
->
func_de¡roy
 = func_destroy;

61 
p–še
->
func_İ’_video_decod”
 = func_open_video_decoder;

62 
p–še
->
func_İ’_audio_ouut
 = func_open_audio_output;

64  
p–še
;

65 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/pipeline/ffpipeline_ffplay.h

24 #iâdeà
FFPLAY__FF_FFPIPELINE_FFPLAY_H


25 
	#FFPLAY__FF_FFPIPELINE_FFPLAY_H


	)

27 
	~"../ff_få–še.h
"

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/pipeline/ffpipenode_ffplay_vdec.c

24 
	~"få’ode_fåÏy_vdec.h
"

25 
	~"../ff_få’ode.h
"

26 
	~"../ff_fåÏy.h
"

28 
	sIJKFF_P’ode_O·que
 {

29 
FFPÏy”
 *
	mfå
;

32 
	$func_de¡roy
(
IJKFF_P’ode
 *
node
)

35 
	}
}

37 
	$func_run_sync
(
IJKFF_P’ode
 *
node
)

39 
IJKFF_P’ode_O·que
 *
İaque
 = 
node
->opaque;

41  
	`få_video_th»ad
(
İaque
->
få
);

42 
	}
}

44 
IJKFF_P’ode
 *
	$få’ode_ü—‹_video_decod”_äom_fåÏy
(
FFPÏy”
 *
få
)

46 
IJKFF_P’ode
 *
node
 = 
	`få’ode_®loc
((
IJKFF_P’ode_O·que
));

47 ià(!
node
)

48  
node
;

50 
IJKFF_P’ode_O·que
 *
İaque
 = 
node
->opaque;

51 
İaque
->
få
 = ffp;

53 
node
->
func_de¡roy
 = func_destroy;

54 
node
->
func_run_sync
 = func_run_sync;

56 
	`få_£t_video_codec_šfo
(
få
, 
AVCODEC_MODULE_NAME
, 
	`avcodec_g‘_Çme
(få->
is
->
viddec
.
avùx
->
codec_id
));

57 
få
->
¡©
.
vdec_ty³
 = 
FFP_PROPV_DECODER_AVCODEC
;

58  
node
;

59 
	}
}

	@/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/pipeline/ffpipenode_ffplay_vdec.h

24 #iâdeà
FFPLAY__FF_FFPIPENODE_FFPLAY_VDEC_H


25 
	#FFPLAY__FF_FFPIPENODE_FFPLAY_VDEC_H


	)

27 
	~"../ff_få’ode.h
"

29 
	gFFPÏy”
;

31 
IJKFF_P’ode
 *
få’ode_ü—‹_video_decod”_äom_fåÏy
(
FFPÏy”
 *
få
);

	@
1
.
0
70
6027
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/ffmpeg_api_jni.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/ffmpeg_api_jni.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/ijkplayer_android.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/ijkplayer_android.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/ijkplayer_android_def.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/ijkplayer_jni.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/pipeline/ffpipeline_android.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/pipeline/ffpipeline_android.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/pipeline/ffpipenode_android_mediacodec_vdec.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/pipeline/ffpipenode_android_mediacodec_vdec.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/pipeline/h264_nal.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/pipeline/hevc_nal.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/android/pipeline/mpeg4_esds.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/config.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_cmdutils.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_cmdutils.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_fferror.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffinc.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffmsg.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffmsg_queue.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffpipeline.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffpipeline.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffpipenode.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffpipenode.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffplay.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffplay.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffplay_debug.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffplay_def.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ff_ffplay_options.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/allformats.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkasync.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkavformat.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkio.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkioandroidio.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkioapplication.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkioapplication.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkiocache.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkioffio.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkiomanager.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkiomanager.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkioprotocol.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkioprotocol.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkiourl.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijklivehook.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijklongurl.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkmediadatasource.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijksegment.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavformat/ijkurlhook.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijkdict.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijkdict.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijkfifo.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijkfifo.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijkstl.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijkthreadpool.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijkthreadpool.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijktree.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijktree.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijkutils.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/ijkutils.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkavutil/opt.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkmeta.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkmeta.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkplayer.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkplayer.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkplayer_internal.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/ijkversion.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/pipeline/ffpipeline_ffplay.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/pipeline/ffpipeline_ffplay.h
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/pipeline/ffpipenode_ffplay_vdec.c
/Users/xiejinbao/Documents/github/ijkplayer/ijkmedia/ijkplayer/pipeline/ffpipenode_ffplay_vdec.h
